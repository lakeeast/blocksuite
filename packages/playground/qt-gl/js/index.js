var Av=Object.defineProperty;var zv=(t,e,n)=>e in t?Av(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Fr=(t,e,n)=>(zv(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const $v="modulepreload",Wv=function(t){return"/"+t},Ih={},Ic=function(e,n,r){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=Wv(i),i in Ih)return;Ih[i]=!0;const a=i.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let l=s.length-1;l>=0;l--){const f=s[l];if(f.href===i&&(!a||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${o}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":$v,a||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),a)return new Promise((l,f)=>{u.addEventListener("load",l),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e())},Hv="";function gl(t,e){const n=Object.create(null),r=t.split(",");for(let s=0;s<r.length;s++)n[r[s]]=!0;return e?s=>!!n[s.toLowerCase()]:s=>!!n[s]}function pl(t){if(ae(t)){const e={};for(let n=0;n<t.length;n++){const r=t[n],s=ot(r)?Kv(r):pl(r);if(s)for(const i in s)e[i]=s[i]}return e}else{if(ot(t))return t;if(je(t))return t}}const Iv=/;(?![^(]*\))/g,jv=/:([^]+)/,Pv=/\/\*.*?\*\//gs;function Kv(t){const e={};return t.replace(Pv,"").split(Iv).forEach(n=>{if(n){const r=n.split(jv);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function dl(t){let e="";if(ot(t))e=t;else if(ae(t))for(let n=0;n<t.length;n++){const r=dl(t[n]);r&&(e+=r+" ")}else if(je(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const Xv="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Yv=gl(Xv);function Qd(t){return!!t||t===""}const Fe={},Ps=[],on=()=>{},qv=()=>!1,Zv=/^on[^a-z]/,Sc=t=>Zv.test(t),yl=t=>t.startsWith("onUpdate:"),gt=Object.assign,xl=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},Qv=Object.prototype.hasOwnProperty,Te=(t,e)=>Qv.call(t,e),ae=Array.isArray,Ii=t=>wc(t)==="[object Map]",Jv=t=>wc(t)==="[object Set]",ue=t=>typeof t=="function",ot=t=>typeof t=="string",Tl=t=>typeof t=="symbol",je=t=>t!==null&&typeof t=="object",Jd=t=>je(t)&&ue(t.then)&&ue(t.catch),em=Object.prototype.toString,wc=t=>em.call(t),tm=t=>wc(t).slice(8,-1),nm=t=>wc(t)==="[object Object]",vl=t=>ot(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Vo=gl(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Cc=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},rm=/-(\w)/g,Pn=Cc(t=>t.replace(rm,(e,n)=>n?n.toUpperCase():"")),sm=/\B([A-Z])/g,Zt=Cc(t=>t.replace(sm,"-$1").toLowerCase()),e0=Cc(t=>t.charAt(0).toUpperCase()+t.slice(1)),jc=Cc(t=>t?`on${e0(t)}`:""),na=(t,e)=>!Object.is(t,e),Pc=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},Wo=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},Ho=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let jh;const im=()=>jh||(jh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Lt;class t0{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Lt,!e&&Lt&&(this.index=(Lt.scopes||(Lt.scopes=[])).push(this)-1)}run(e){if(this.active){const n=Lt;try{return Lt=this,e()}finally{Lt=n}}}on(){Lt=this}off(){Lt=this.parent}stop(e){if(this.active){let n,r;for(n=0,r=this.effects.length;n<r;n++)this.effects[n].stop();for(n=0,r=this.cleanups.length;n<r;n++)this.cleanups[n]();if(this.scopes)for(n=0,r=this.scopes.length;n<r;n++)this.scopes[n].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this.active=!1}}}function n0(t){return new t0(t)}function am(t,e=Lt){e&&e.active&&e.effects.push(t)}function om(){return Lt}function cm(t){Lt&&Lt.cleanups.push(t)}const ml=t=>{const e=new Set(t);return e.w=0,e.n=0,e},r0=t=>(t.w&Or)>0,s0=t=>(t.n&Or)>0,um=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=Or},fm=t=>{const{deps:e}=t;if(e.length){let n=0;for(let r=0;r<e.length;r++){const s=e[r];r0(s)&&!s0(s)?s.delete(t):e[n++]=s,s.w&=~Or,s.n&=~Or}e.length=n}},ff=new WeakMap;let Gi=0,Or=1;const lf=30;let Qt;const ss=Symbol(""),hf=Symbol("");class Sl{constructor(e,n=null,r){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,am(this,r)}run(){if(!this.active)return this.fn();let e=Qt,n=Mr;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=Qt,Qt=this,Mr=!0,Or=1<<++Gi,Gi<=lf?um(this):Ph(this),this.fn()}finally{Gi<=lf&&fm(this),Or=1<<--Gi,Qt=this.parent,Mr=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Qt===this?this.deferStop=!0:this.active&&(Ph(this),this.onStop&&this.onStop(),this.active=!1)}}function Ph(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let Mr=!0;const i0=[];function hi(){i0.push(Mr),Mr=!1}function gi(){const t=i0.pop();Mr=t===void 0?!0:t}function Vt(t,e,n){if(Mr&&Qt){let r=ff.get(t);r||ff.set(t,r=new Map);let s=r.get(n);s||r.set(n,s=ml()),a0(s)}}function a0(t,e){let n=!1;Gi<=lf?s0(t)||(t.n|=Or,n=!r0(t)):n=!t.has(Qt),n&&(t.add(Qt),Qt.deps.push(t))}function qn(t,e,n,r,s,i){const a=ff.get(t);if(!a)return;let o=[];if(e==="clear")o=[...a.values()];else if(n==="length"&&ae(t)){const c=Ho(r);a.forEach((u,l)=>{(l==="length"||l>=c)&&o.push(u)})}else switch(n!==void 0&&o.push(a.get(n)),e){case"add":ae(t)?vl(n)&&o.push(a.get("length")):(o.push(a.get(ss)),Ii(t)&&o.push(a.get(hf)));break;case"delete":ae(t)||(o.push(a.get(ss)),Ii(t)&&o.push(a.get(hf)));break;case"set":Ii(t)&&o.push(a.get(ss));break}if(o.length===1)o[0]&&gf(o[0]);else{const c=[];for(const u of o)u&&c.push(...u);gf(ml(c))}}function gf(t,e){const n=ae(t)?t:[...t];for(const r of n)r.computed&&Kh(r);for(const r of n)r.computed||Kh(r)}function Kh(t,e){(t!==Qt||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const lm=gl("__proto__,__v_isRef,__isVue"),o0=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Tl)),hm=wl(),gm=wl(!1,!0),pm=wl(!0),Xh=dm();function dm(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const r=me(this);for(let i=0,a=this.length;i<a;i++)Vt(r,"get",i+"");const s=r[e](...n);return s===-1||s===!1?r[e](...n.map(me)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){hi();const r=me(this)[e].apply(this,n);return gi(),r}}),t}function wl(t=!1,e=!1){return function(r,s,i){if(s==="__v_isReactive")return!t;if(s==="__v_isReadonly")return t;if(s==="__v_isShallow")return e;if(s==="__v_raw"&&i===(t?e?Lm:h0:e?l0:f0).get(r))return r;const a=ae(r);if(!t&&a&&Te(Xh,s))return Reflect.get(Xh,s,i);const o=Reflect.get(r,s,i);return(Tl(s)?o0.has(s):lm(s))||(t||Vt(r,"get",s),e)?o:Be(o)?a&&vl(s)?o:o.value:je(o)?t?g0(o):Ec(o):o}}const ym=c0(),xm=c0(!0);function c0(t=!1){return function(n,r,s,i){let a=n[r];if(Js(a)&&Be(a)&&!Be(s))return!1;if(!t&&(!Io(s)&&!Js(s)&&(a=me(a),s=me(s)),!ae(n)&&Be(a)&&!Be(s)))return a.value=s,!0;const o=ae(n)&&vl(r)?Number(r)<n.length:Te(n,r),c=Reflect.set(n,r,s,i);return n===me(i)&&(o?na(s,a)&&qn(n,"set",r,s):qn(n,"add",r,s)),c}}function Tm(t,e){const n=Te(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&n&&qn(t,"delete",e,void 0),r}function vm(t,e){const n=Reflect.has(t,e);return(!Tl(e)||!o0.has(e))&&Vt(t,"has",e),n}function mm(t){return Vt(t,"iterate",ae(t)?"length":ss),Reflect.ownKeys(t)}const u0={get:hm,set:ym,deleteProperty:Tm,has:vm,ownKeys:mm},Sm={get:pm,set(t,e){return!0},deleteProperty(t,e){return!0}},wm=gt({},u0,{get:gm,set:xm}),Cl=t=>t,Mc=t=>Reflect.getPrototypeOf(t);function Oa(t,e,n=!1,r=!1){t=t.__v_raw;const s=me(t),i=me(e);n||(e!==i&&Vt(s,"get",e),Vt(s,"get",i));const{has:a}=Mc(s),o=r?Cl:n?_l:ra;if(a.call(s,e))return o(t.get(e));if(a.call(s,i))return o(t.get(i));t!==s&&t.get(e)}function Da(t,e=!1){const n=this.__v_raw,r=me(n),s=me(t);return e||(t!==s&&Vt(r,"has",t),Vt(r,"has",s)),t===s?n.has(t):n.has(t)||n.has(s)}function ba(t,e=!1){return t=t.__v_raw,!e&&Vt(me(t),"iterate",ss),Reflect.get(t,"size",t)}function Yh(t){t=me(t);const e=me(this);return Mc(e).has.call(e,t)||(e.add(t),qn(e,"add",t,t)),this}function qh(t,e){e=me(e);const n=me(this),{has:r,get:s}=Mc(n);let i=r.call(n,t);i||(t=me(t),i=r.call(n,t));const a=s.call(n,t);return n.set(t,e),i?na(e,a)&&qn(n,"set",t,e):qn(n,"add",t,e),this}function Zh(t){const e=me(this),{has:n,get:r}=Mc(e);let s=n.call(e,t);s||(t=me(t),s=n.call(e,t)),r&&r.call(e,t);const i=e.delete(t);return s&&qn(e,"delete",t,void 0),i}function Qh(){const t=me(this),e=t.size!==0,n=t.clear();return e&&qn(t,"clear",void 0,void 0),n}function La(t,e){return function(r,s){const i=this,a=i.__v_raw,o=me(a),c=e?Cl:t?_l:ra;return!t&&Vt(o,"iterate",ss),a.forEach((u,l)=>r.call(s,c(u),c(l),i))}}function Va(t,e,n){return function(...r){const s=this.__v_raw,i=me(s),a=Ii(i),o=t==="entries"||t===Symbol.iterator&&a,c=t==="keys"&&a,u=s[t](...r),l=n?Cl:e?_l:ra;return!e&&Vt(i,"iterate",c?hf:ss),{next(){const{value:f,done:h}=u.next();return h?{value:f,done:h}:{value:o?[l(f[0]),l(f[1])]:l(f),done:h}},[Symbol.iterator](){return this}}}}function nr(t){return function(...e){return t==="delete"?!1:this}}function Cm(){const t={get(i){return Oa(this,i)},get size(){return ba(this)},has:Da,add:Yh,set:qh,delete:Zh,clear:Qh,forEach:La(!1,!1)},e={get(i){return Oa(this,i,!1,!0)},get size(){return ba(this)},has:Da,add:Yh,set:qh,delete:Zh,clear:Qh,forEach:La(!1,!0)},n={get(i){return Oa(this,i,!0)},get size(){return ba(this,!0)},has(i){return Da.call(this,i,!0)},add:nr("add"),set:nr("set"),delete:nr("delete"),clear:nr("clear"),forEach:La(!0,!1)},r={get(i){return Oa(this,i,!0,!0)},get size(){return ba(this,!0)},has(i){return Da.call(this,i,!0)},add:nr("add"),set:nr("set"),delete:nr("delete"),clear:nr("clear"),forEach:La(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{t[i]=Va(i,!1,!1),n[i]=Va(i,!0,!1),e[i]=Va(i,!1,!0),r[i]=Va(i,!0,!0)}),[t,n,e,r]}const[Mm,Em,_m,Rm]=Cm();function Ml(t,e){const n=e?t?Rm:_m:t?Em:Mm;return(r,s,i)=>s==="__v_isReactive"?!t:s==="__v_isReadonly"?t:s==="__v_raw"?r:Reflect.get(Te(n,s)&&s in r?n:r,s,i)}const Om={get:Ml(!1,!1)},Dm={get:Ml(!1,!0)},bm={get:Ml(!0,!1)},f0=new WeakMap,l0=new WeakMap,h0=new WeakMap,Lm=new WeakMap;function Vm(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Fm(t){return t.__v_skip||!Object.isExtensible(t)?0:Vm(tm(t))}function Ec(t){return Js(t)?t:El(t,!1,u0,Om,f0)}function Bm(t){return El(t,!1,wm,Dm,l0)}function g0(t){return El(t,!0,Sm,bm,h0)}function El(t,e,n,r,s){if(!je(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const i=s.get(t);if(i)return i;const a=Fm(t);if(a===0)return t;const o=new Proxy(t,a===2?r:n);return s.set(t,o),o}function Kn(t){return Js(t)?Kn(t.__v_raw):!!(t&&t.__v_isReactive)}function Js(t){return!!(t&&t.__v_isReadonly)}function Io(t){return!!(t&&t.__v_isShallow)}function p0(t){return Kn(t)||Js(t)}function me(t){const e=t&&t.__v_raw;return e?me(e):t}function ei(t){return Wo(t,"__v_skip",!0),t}const ra=t=>je(t)?Ec(t):t,_l=t=>je(t)?g0(t):t;function d0(t){Mr&&Qt&&(t=me(t),a0(t.dep||(t.dep=ml())))}function y0(t,e){t=me(t),t.dep&&gf(t.dep)}function Be(t){return!!(t&&t.__v_isRef===!0)}function va(t){return km(t,!1)}function km(t,e){return Be(t)?t:new Nm(t,e)}class Nm{constructor(e,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?e:me(e),this._value=n?e:ra(e)}get value(){return d0(this),this._value}set value(e){const n=this.__v_isShallow||Io(e)||Js(e);e=n?e:me(e),na(e,this._rawValue)&&(this._rawValue=e,this._value=n?e:ra(e),y0(this))}}function Um(t){return Be(t)?t.value:t}const Gm={get:(t,e,n)=>Um(Reflect.get(t,e,n)),set:(t,e,n,r)=>{const s=t[e];return Be(s)&&!Be(n)?(s.value=n,!0):Reflect.set(t,e,n,r)}};function x0(t){return Kn(t)?t:new Proxy(t,Gm)}function Am(t){const e=ae(t)?new Array(t.length):{};for(const n in t)e[n]=T0(t,n);return e}class zm{constructor(e,n,r){this._object=e,this._key=n,this._defaultValue=r,this.__v_isRef=!0}get value(){const e=this._object[this._key];return e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}}function T0(t,e,n){const r=t[e];return Be(r)?r:new zm(t,e,n)}var v0;class $m{constructor(e,n,r,s){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this[v0]=!1,this._dirty=!0,this.effect=new Sl(e,()=>{this._dirty||(this._dirty=!0,y0(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=r}get value(){const e=me(this);return d0(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}v0="__v_isReadonly";function Wm(t,e,n=!1){let r,s;const i=ue(t);return i?(r=t,s=on):(r=t.get,s=t.set),new $m(r,s,i||!s,n)}function Er(t,e,n,r){let s;try{s=r?t(...r):t()}catch(i){_c(i,e,n)}return s}function cn(t,e,n,r){if(ue(t)){const i=Er(t,e,n,r);return i&&Jd(i)&&i.catch(a=>{_c(a,e,n)}),i}const s=[];for(let i=0;i<t.length;i++)s.push(cn(t[i],e,n,r));return s}function _c(t,e,n,r=!0){const s=e?e.vnode:null;if(e){let i=e.parent;const a=e.proxy,o=n;for(;i;){const u=i.ec;if(u){for(let l=0;l<u.length;l++)if(u[l](t,a,o)===!1)return}i=i.parent}const c=e.appContext.config.errorHandler;if(c){Er(c,null,10,[t,a,o]);return}}Hm(t,n,s,r)}function Hm(t,e,n,r=!0){console.error(t)}let sa=!1,pf=!1;const ht=[];let En=0;const Ks=[];let An=null,Zr=0;const m0=Promise.resolve();let Rl=null;function Ol(t){const e=Rl||m0;return t?e.then(this?t.bind(this):t):e}function Im(t){let e=En+1,n=ht.length;for(;e<n;){const r=e+n>>>1;ia(ht[r])<t?e=r+1:n=r}return e}function Dl(t){(!ht.length||!ht.includes(t,sa&&t.allowRecurse?En+1:En))&&(t.id==null?ht.push(t):ht.splice(Im(t.id),0,t),S0())}function S0(){!sa&&!pf&&(pf=!0,Rl=m0.then(C0))}function jm(t){const e=ht.indexOf(t);e>En&&ht.splice(e,1)}function Pm(t){ae(t)?Ks.push(...t):(!An||!An.includes(t,t.allowRecurse?Zr+1:Zr))&&Ks.push(t),S0()}function Jh(t,e=sa?En+1:0){for(;e<ht.length;e++){const n=ht[e];n&&n.pre&&(ht.splice(e,1),e--,n())}}function w0(t){if(Ks.length){const e=[...new Set(Ks)];if(Ks.length=0,An){An.push(...e);return}for(An=e,An.sort((n,r)=>ia(n)-ia(r)),Zr=0;Zr<An.length;Zr++)An[Zr]();An=null,Zr=0}}const ia=t=>t.id==null?1/0:t.id,Km=(t,e)=>{const n=ia(t)-ia(e);if(n===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function C0(t){pf=!1,sa=!0,ht.sort(Km);const e=on;try{for(En=0;En<ht.length;En++){const n=ht[En];n&&n.active!==!1&&Er(n,null,14)}}finally{En=0,ht.length=0,w0(),sa=!1,Rl=null,(ht.length||Ks.length)&&C0()}}function Xm(t,e,...n){if(t.isUnmounted)return;const r=t.vnode.props||Fe;let s=n;const i=e.startsWith("update:"),a=i&&e.slice(7);if(a&&a in r){const l=`${a==="modelValue"?"model":a}Modifiers`,{number:f,trim:h}=r[l]||Fe;h&&(s=n.map(g=>ot(g)?g.trim():g)),f&&(s=n.map(Ho))}let o,c=r[o=jc(e)]||r[o=jc(Pn(e))];!c&&i&&(c=r[o=jc(Zt(e))]),c&&cn(c,t,6,s);const u=r[o+"Once"];if(u){if(!t.emitted)t.emitted={};else if(t.emitted[o])return;t.emitted[o]=!0,cn(u,t,6,s)}}function M0(t,e,n=!1){const r=e.emitsCache,s=r.get(t);if(s!==void 0)return s;const i=t.emits;let a={},o=!1;if(!ue(t)){const c=u=>{const l=M0(u,e,!0);l&&(o=!0,gt(a,l))};!n&&e.mixins.length&&e.mixins.forEach(c),t.extends&&c(t.extends),t.mixins&&t.mixins.forEach(c)}return!i&&!o?(je(t)&&r.set(t,null),null):(ae(i)?i.forEach(c=>a[c]=null):gt(a,i),je(t)&&r.set(t,a),a)}function Rc(t,e){return!t||!Sc(e)?!1:(e=e.slice(2).replace(/Once$/,""),Te(t,e[0].toLowerCase()+e.slice(1))||Te(t,Zt(e))||Te(t,e))}let rn=null,E0=null;function jo(t){const e=rn;return rn=t,E0=t&&t.type.__scopeId||null,e}function Ym(t,e=rn,n){if(!e||t._n)return t;const r=(...s)=>{r._d&&og(-1);const i=jo(e);let a;try{a=t(...s)}finally{jo(i),r._d&&og(1)}return a};return r._n=!0,r._c=!0,r._d=!0,r}function Kc(t){const{type:e,vnode:n,proxy:r,withProxy:s,props:i,propsOptions:[a],slots:o,attrs:c,emit:u,render:l,renderCache:f,data:h,setupState:g,ctx:d,inheritAttrs:p}=t;let y,x;const m=jo(t);try{if(n.shapeFlag&4){const v=s||r;y=wn(l.call(v,v,f,i,g,h,d)),x=c}else{const v=e;y=wn(v.length>1?v(i,{attrs:c,slots:o,emit:u}):v(i,null)),x=e.props?c:qm(c)}}catch(v){Xi.length=0,_c(v,t,1),y=Xn(aa)}let T=y;if(x&&p!==!1){const v=Object.keys(x),{shapeFlag:S}=T;v.length&&S&7&&(a&&v.some(yl)&&(x=Zm(x,a)),T=ti(T,x))}return n.dirs&&(T=ti(T),T.dirs=T.dirs?T.dirs.concat(n.dirs):n.dirs),n.transition&&(T.transition=n.transition),y=T,jo(m),y}const qm=t=>{let e;for(const n in t)(n==="class"||n==="style"||Sc(n))&&((e||(e={}))[n]=t[n]);return e},Zm=(t,e)=>{const n={};for(const r in t)(!yl(r)||!(r.slice(9)in e))&&(n[r]=t[r]);return n};function Qm(t,e,n){const{props:r,children:s,component:i}=t,{props:a,children:o,patchFlag:c}=e,u=i.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&c>=0){if(c&1024)return!0;if(c&16)return r?eg(r,a,u):!!a;if(c&8){const l=e.dynamicProps;for(let f=0;f<l.length;f++){const h=l[f];if(a[h]!==r[h]&&!Rc(u,h))return!0}}}else return(s||o)&&(!o||!o.$stable)?!0:r===a?!1:r?a?eg(r,a,u):!0:!!a;return!1}function eg(t,e,n){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==t[i]&&!Rc(n,i))return!0}return!1}function Jm({vnode:t,parent:e},n){for(;e&&e.subTree===t;)(t=e.vnode).el=n,e=e.parent}const eS=t=>t.__isSuspense;function tS(t,e){e&&e.pendingBranch?ae(t)?e.effects.push(...t):e.effects.push(t):Pm(t)}function nS(t,e){if(at){let n=at.provides;const r=at.parent&&at.parent.provides;r===n&&(n=at.provides=Object.create(r)),n[t]=e}}function ji(t,e,n=!1){const r=at||rn;if(r){const s=r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(s&&t in s)return s[t];if(arguments.length>1)return n&&ue(e)?e.call(r.proxy):e}}const Fa={};function Pi(t,e,n){return _0(t,e,n)}function _0(t,e,{immediate:n,deep:r,flush:s,onTrack:i,onTrigger:a}=Fe){const o=at;let c,u=!1,l=!1;if(Be(t)?(c=()=>t.value,u=Io(t)):Kn(t)?(c=()=>t,r=!0):ae(t)?(l=!0,u=t.some(T=>Kn(T)||Io(T)),c=()=>t.map(T=>{if(Be(T))return T.value;if(Kn(T))return Ws(T);if(ue(T))return Er(T,o,2)})):ue(t)?e?c=()=>Er(t,o,2):c=()=>{if(!(o&&o.isUnmounted))return f&&f(),cn(t,o,3,[h])}:c=on,e&&r){const T=c;c=()=>Ws(T())}let f,h=T=>{f=x.onStop=()=>{Er(T,o,4)}},g;if(ca)if(h=on,e?n&&cn(e,o,3,[c(),l?[]:void 0,h]):c(),s==="sync"){const T=YS();g=T.__watcherHandles||(T.__watcherHandles=[])}else return on;let d=l?new Array(t.length).fill(Fa):Fa;const p=()=>{if(x.active)if(e){const T=x.run();(r||u||(l?T.some((v,S)=>na(v,d[S])):na(T,d)))&&(f&&f(),cn(e,o,3,[T,d===Fa?void 0:l&&d[0]===Fa?[]:d,h]),d=T)}else x.run()};p.allowRecurse=!!e;let y;s==="sync"?y=p:s==="post"?y=()=>Et(p,o&&o.suspense):(p.pre=!0,o&&(p.id=o.uid),y=()=>Dl(p));const x=new Sl(c,y);e?n?p():d=x.run():s==="post"?Et(x.run.bind(x),o&&o.suspense):x.run();const m=()=>{x.stop(),o&&o.scope&&xl(o.scope.effects,x)};return g&&g.push(m),m}function rS(t,e,n){const r=this.proxy,s=ot(t)?t.includes(".")?R0(r,t):()=>r[t]:t.bind(r,r);let i;ue(e)?i=e:(i=e.handler,n=e);const a=at;ni(this);const o=_0(s,i.bind(r),n);return a?ni(a):is(),o}function R0(t,e){const n=e.split(".");return()=>{let r=t;for(let s=0;s<n.length&&r;s++)r=r[n[s]];return r}}function Ws(t,e){if(!je(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),Be(t))Ws(t.value,e);else if(ae(t))for(let n=0;n<t.length;n++)Ws(t[n],e);else if(Jv(t)||Ii(t))t.forEach(n=>{Ws(n,e)});else if(nm(t))for(const n in t)Ws(t[n],e);return t}function Oc(t){return ue(t)?{setup:t,name:t.name}:t}const Fo=t=>!!t.type.__asyncLoader,O0=t=>t.type.__isKeepAlive;function sS(t,e){D0(t,"a",e)}function iS(t,e){D0(t,"da",e)}function D0(t,e,n=at){const r=t.__wdc||(t.__wdc=()=>{let s=n;for(;s;){if(s.isDeactivated)return;s=s.parent}return t()});if(Dc(e,r,n),n){let s=n.parent;for(;s&&s.parent;)O0(s.parent.vnode)&&aS(r,e,n,s),s=s.parent}}function aS(t,e,n,r){const s=Dc(e,t,r,!0);Ll(()=>{xl(r[e],s)},n)}function Dc(t,e,n=at,r=!1){if(n){const s=n[t]||(n[t]=[]),i=e.__weh||(e.__weh=(...a)=>{if(n.isUnmounted)return;hi(),ni(n);const o=cn(e,n,t,a);return is(),gi(),o});return r?s.unshift(i):s.push(i),i}}const Qn=t=>(e,n=at)=>(!ca||t==="sp")&&Dc(t,(...r)=>e(...r),n),oS=Qn("bm"),bl=Qn("m"),cS=Qn("bu"),uS=Qn("u"),fS=Qn("bum"),Ll=Qn("um"),lS=Qn("sp"),hS=Qn("rtg"),gS=Qn("rtc");function pS(t,e=at){Dc("ec",t,e)}function Br(t,e,n,r){const s=t.dirs,i=e&&e.dirs;for(let a=0;a<s.length;a++){const o=s[a];i&&(o.oldValue=i[a].value);let c=o.dir[r];c&&(hi(),cn(c,n,8,[t.el,o,t,e]),gi())}}const dS=Symbol(),df=t=>t?H0(t)?Nl(t)||t.proxy:df(t.parent):null,Ki=gt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>df(t.parent),$root:t=>df(t.root),$emit:t=>t.emit,$options:t=>Vl(t),$forceUpdate:t=>t.f||(t.f=()=>Dl(t.update)),$nextTick:t=>t.n||(t.n=Ol.bind(t.proxy)),$watch:t=>rS.bind(t)}),Xc=(t,e)=>t!==Fe&&!t.__isScriptSetup&&Te(t,e),yS={get({_:t},e){const{ctx:n,setupState:r,data:s,props:i,accessCache:a,type:o,appContext:c}=t;let u;if(e[0]!=="$"){const g=a[e];if(g!==void 0)switch(g){case 1:return r[e];case 2:return s[e];case 4:return n[e];case 3:return i[e]}else{if(Xc(r,e))return a[e]=1,r[e];if(s!==Fe&&Te(s,e))return a[e]=2,s[e];if((u=t.propsOptions[0])&&Te(u,e))return a[e]=3,i[e];if(n!==Fe&&Te(n,e))return a[e]=4,n[e];yf&&(a[e]=0)}}const l=Ki[e];let f,h;if(l)return e==="$attrs"&&Vt(t,"get",e),l(t);if((f=o.__cssModules)&&(f=f[e]))return f;if(n!==Fe&&Te(n,e))return a[e]=4,n[e];if(h=c.config.globalProperties,Te(h,e))return h[e]},set({_:t},e,n){const{data:r,setupState:s,ctx:i}=t;return Xc(s,e)?(s[e]=n,!0):r!==Fe&&Te(r,e)?(r[e]=n,!0):Te(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(i[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:r,appContext:s,propsOptions:i}},a){let o;return!!n[a]||t!==Fe&&Te(t,a)||Xc(e,a)||(o=i[0])&&Te(o,a)||Te(r,a)||Te(Ki,a)||Te(s.config.globalProperties,a)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:Te(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};let yf=!0;function xS(t){const e=Vl(t),n=t.proxy,r=t.ctx;yf=!1,e.beforeCreate&&tg(e.beforeCreate,t,"bc");const{data:s,computed:i,methods:a,watch:o,provide:c,inject:u,created:l,beforeMount:f,mounted:h,beforeUpdate:g,updated:d,activated:p,deactivated:y,beforeDestroy:x,beforeUnmount:m,destroyed:T,unmounted:v,render:S,renderTracked:w,renderTriggered:M,errorCaptured:E,serverPrefetch:D,expose:O,inheritAttrs:_,components:V,directives:L,filters:F}=e;if(u&&TS(u,r,null,t.appContext.config.unwrapInjectedRef),a)for(const H in a){const P=a[H];ue(P)&&(r[H]=P.bind(n))}if(s){const H=s.call(n,n);je(H)&&(t.data=Ec(H))}if(yf=!0,i)for(const H in i){const P=i[H],U=ue(P)?P.bind(n,n):ue(P.get)?P.get.bind(n,n):on,Y=!ue(P)&&ue(P.set)?P.set.bind(n):on,ee=Ul({get:U,set:Y});Object.defineProperty(r,H,{enumerable:!0,configurable:!0,get:()=>ee.value,set:te=>ee.value=te})}if(o)for(const H in o)b0(o[H],r,n,H);if(c){const H=ue(c)?c.call(n):c;Reflect.ownKeys(H).forEach(P=>{nS(P,H[P])})}l&&tg(l,t,"c");function A(H,P){ae(P)?P.forEach(U=>H(U.bind(n))):P&&H(P.bind(n))}if(A(oS,f),A(bl,h),A(cS,g),A(uS,d),A(sS,p),A(iS,y),A(pS,E),A(gS,w),A(hS,M),A(fS,m),A(Ll,v),A(lS,D),ae(O))if(O.length){const H=t.exposed||(t.exposed={});O.forEach(P=>{Object.defineProperty(H,P,{get:()=>n[P],set:U=>n[P]=U})})}else t.exposed||(t.exposed={});S&&t.render===on&&(t.render=S),_!=null&&(t.inheritAttrs=_),V&&(t.components=V),L&&(t.directives=L)}function TS(t,e,n=on,r=!1){ae(t)&&(t=xf(t));for(const s in t){const i=t[s];let a;je(i)?"default"in i?a=ji(i.from||s,i.default,!0):a=ji(i.from||s):a=ji(i),Be(a)&&r?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>a.value,set:o=>a.value=o}):e[s]=a}}function tg(t,e,n){cn(ae(t)?t.map(r=>r.bind(e.proxy)):t.bind(e.proxy),e,n)}function b0(t,e,n,r){const s=r.includes(".")?R0(n,r):()=>n[r];if(ot(t)){const i=e[t];ue(i)&&Pi(s,i)}else if(ue(t))Pi(s,t.bind(n));else if(je(t))if(ae(t))t.forEach(i=>b0(i,e,n,r));else{const i=ue(t.handler)?t.handler.bind(n):e[t.handler];ue(i)&&Pi(s,i,t)}}function Vl(t){const e=t.type,{mixins:n,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:a}}=t.appContext,o=i.get(e);let c;return o?c=o:!s.length&&!n&&!r?c=e:(c={},s.length&&s.forEach(u=>Po(c,u,a,!0)),Po(c,e,a)),je(e)&&i.set(e,c),c}function Po(t,e,n,r=!1){const{mixins:s,extends:i}=e;i&&Po(t,i,n,!0),s&&s.forEach(a=>Po(t,a,n,!0));for(const a in e)if(!(r&&a==="expose")){const o=vS[a]||n&&n[a];t[a]=o?o(t[a],e[a]):e[a]}return t}const vS={data:ng,props:Yr,emits:Yr,methods:Yr,computed:Yr,beforeCreate:vt,created:vt,beforeMount:vt,mounted:vt,beforeUpdate:vt,updated:vt,beforeDestroy:vt,beforeUnmount:vt,destroyed:vt,unmounted:vt,activated:vt,deactivated:vt,errorCaptured:vt,serverPrefetch:vt,components:Yr,directives:Yr,watch:SS,provide:ng,inject:mS};function ng(t,e){return e?t?function(){return gt(ue(t)?t.call(this,this):t,ue(e)?e.call(this,this):e)}:e:t}function mS(t,e){return Yr(xf(t),xf(e))}function xf(t){if(ae(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function vt(t,e){return t?[...new Set([].concat(t,e))]:e}function Yr(t,e){return t?gt(gt(Object.create(null),t),e):e}function SS(t,e){if(!t)return e;if(!e)return t;const n=gt(Object.create(null),t);for(const r in e)n[r]=vt(t[r],e[r]);return n}function wS(t,e,n,r=!1){const s={},i={};Wo(i,Lc,1),t.propsDefaults=Object.create(null),L0(t,e,s,i);for(const a in t.propsOptions[0])a in s||(s[a]=void 0);n?t.props=r?s:Bm(s):t.type.props?t.props=s:t.props=i,t.attrs=i}function CS(t,e,n,r){const{props:s,attrs:i,vnode:{patchFlag:a}}=t,o=me(s),[c]=t.propsOptions;let u=!1;if((r||a>0)&&!(a&16)){if(a&8){const l=t.vnode.dynamicProps;for(let f=0;f<l.length;f++){let h=l[f];if(Rc(t.emitsOptions,h))continue;const g=e[h];if(c)if(Te(i,h))g!==i[h]&&(i[h]=g,u=!0);else{const d=Pn(h);s[d]=Tf(c,o,d,g,t,!1)}else g!==i[h]&&(i[h]=g,u=!0)}}}else{L0(t,e,s,i)&&(u=!0);let l;for(const f in o)(!e||!Te(e,f)&&((l=Zt(f))===f||!Te(e,l)))&&(c?n&&(n[f]!==void 0||n[l]!==void 0)&&(s[f]=Tf(c,o,f,void 0,t,!0)):delete s[f]);if(i!==o)for(const f in i)(!e||!Te(e,f))&&(delete i[f],u=!0)}u&&qn(t,"set","$attrs")}function L0(t,e,n,r){const[s,i]=t.propsOptions;let a=!1,o;if(e)for(let c in e){if(Vo(c))continue;const u=e[c];let l;s&&Te(s,l=Pn(c))?!i||!i.includes(l)?n[l]=u:(o||(o={}))[l]=u:Rc(t.emitsOptions,c)||(!(c in r)||u!==r[c])&&(r[c]=u,a=!0)}if(i){const c=me(n),u=o||Fe;for(let l=0;l<i.length;l++){const f=i[l];n[f]=Tf(s,c,f,u[f],t,!Te(u,f))}}return a}function Tf(t,e,n,r,s,i){const a=t[n];if(a!=null){const o=Te(a,"default");if(o&&r===void 0){const c=a.default;if(a.type!==Function&&ue(c)){const{propsDefaults:u}=s;n in u?r=u[n]:(ni(s),r=u[n]=c.call(null,e),is())}else r=c}a[0]&&(i&&!o?r=!1:a[1]&&(r===""||r===Zt(n))&&(r=!0))}return r}function V0(t,e,n=!1){const r=e.propsCache,s=r.get(t);if(s)return s;const i=t.props,a={},o=[];let c=!1;if(!ue(t)){const l=f=>{c=!0;const[h,g]=V0(f,e,!0);gt(a,h),g&&o.push(...g)};!n&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}if(!i&&!c)return je(t)&&r.set(t,Ps),Ps;if(ae(i))for(let l=0;l<i.length;l++){const f=Pn(i[l]);rg(f)&&(a[f]=Fe)}else if(i)for(const l in i){const f=Pn(l);if(rg(f)){const h=i[l],g=a[f]=ae(h)||ue(h)?{type:h}:Object.assign({},h);if(g){const d=ag(Boolean,g.type),p=ag(String,g.type);g[0]=d>-1,g[1]=p<0||d<p,(d>-1||Te(g,"default"))&&o.push(f)}}}const u=[a,o];return je(t)&&r.set(t,u),u}function rg(t){return t[0]!=="$"}function sg(t){const e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:t===null?"null":""}function ig(t,e){return sg(t)===sg(e)}function ag(t,e){return ae(e)?e.findIndex(n=>ig(n,t)):ue(e)&&ig(e,t)?0:-1}const F0=t=>t[0]==="_"||t==="$stable",Fl=t=>ae(t)?t.map(wn):[wn(t)],MS=(t,e,n)=>{if(e._n)return e;const r=Ym((...s)=>Fl(e(...s)),n);return r._c=!1,r},B0=(t,e,n)=>{const r=t._ctx;for(const s in t){if(F0(s))continue;const i=t[s];if(ue(i))e[s]=MS(s,i,r);else if(i!=null){const a=Fl(i);e[s]=()=>a}}},k0=(t,e)=>{const n=Fl(e);t.slots.default=()=>n},ES=(t,e)=>{if(t.vnode.shapeFlag&32){const n=e._;n?(t.slots=me(e),Wo(e,"_",n)):B0(e,t.slots={})}else t.slots={},e&&k0(t,e);Wo(t.slots,Lc,1)},_S=(t,e,n)=>{const{vnode:r,slots:s}=t;let i=!0,a=Fe;if(r.shapeFlag&32){const o=e._;o?n&&o===1?i=!1:(gt(s,e),!n&&o===1&&delete s._):(i=!e.$stable,B0(e,s)),a=e}else e&&(k0(t,e),a={default:1});if(i)for(const o in s)!F0(o)&&!(o in a)&&delete s[o]};function N0(){return{app:null,config:{isNativeTag:qv,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let RS=0;function OS(t,e){return function(r,s=null){ue(r)||(r=Object.assign({},r)),s!=null&&!je(s)&&(s=null);const i=N0(),a=new Set;let o=!1;const c=i.app={_uid:RS++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:qS,get config(){return i.config},set config(u){},use(u,...l){return a.has(u)||(u&&ue(u.install)?(a.add(u),u.install(c,...l)):ue(u)&&(a.add(u),u(c,...l))),c},mixin(u){return i.mixins.includes(u)||i.mixins.push(u),c},component(u,l){return l?(i.components[u]=l,c):i.components[u]},directive(u,l){return l?(i.directives[u]=l,c):i.directives[u]},mount(u,l,f){if(!o){const h=Xn(r,s);return h.appContext=i,l&&e?e(h,u):t(h,u,f),o=!0,c._container=u,u.__vue_app__=c,Nl(h.component)||h.component.proxy}},unmount(){o&&(t(null,c._container),delete c._container.__vue_app__)},provide(u,l){return i.provides[u]=l,c}};return c}}function vf(t,e,n,r,s=!1){if(ae(t)){t.forEach((h,g)=>vf(h,e&&(ae(e)?e[g]:e),n,r,s));return}if(Fo(r)&&!s)return;const i=r.shapeFlag&4?Nl(r.component)||r.component.proxy:r.el,a=s?null:i,{i:o,r:c}=t,u=e&&e.r,l=o.refs===Fe?o.refs={}:o.refs,f=o.setupState;if(u!=null&&u!==c&&(ot(u)?(l[u]=null,Te(f,u)&&(f[u]=null)):Be(u)&&(u.value=null)),ue(c))Er(c,o,12,[a,l]);else{const h=ot(c),g=Be(c);if(h||g){const d=()=>{if(t.f){const p=h?Te(f,c)?f[c]:l[c]:c.value;s?ae(p)&&xl(p,i):ae(p)?p.includes(i)||p.push(i):h?(l[c]=[i],Te(f,c)&&(f[c]=l[c])):(c.value=[i],t.k&&(l[t.k]=c.value))}else h?(l[c]=a,Te(f,c)&&(f[c]=a)):g&&(c.value=a,t.k&&(l[t.k]=a))};a?(d.id=-1,Et(d,n)):d()}}}const Et=tS;function DS(t){return bS(t)}function bS(t,e){const n=im();n.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:a,createText:o,createComment:c,setText:u,setElementText:l,parentNode:f,nextSibling:h,setScopeId:g=on,insertStaticContent:d}=t,p=(R,b,k,$=null,z=null,j=null,X=!1,I=null,K=!!b.dynamicChildren)=>{if(R===b)return;R&&!Ei(R,b)&&($=Pe(R),te(R,z,j,!0),R=null),b.patchFlag===-2&&(K=!1,b.dynamicChildren=null);const{type:W,ref:Q,shapeFlag:Z}=b;switch(W){case bc:y(R,b,k,$);break;case aa:x(R,b,k,$);break;case Yc:R==null&&m(b,k,$,X);break;case Wn:V(R,b,k,$,z,j,X,I,K);break;default:Z&1?S(R,b,k,$,z,j,X,I,K):Z&6?L(R,b,k,$,z,j,X,I,K):(Z&64||Z&128)&&W.process(R,b,k,$,z,j,X,I,K,$e)}Q!=null&&z&&vf(Q,R&&R.ref,j,b||R,!b)},y=(R,b,k,$)=>{if(R==null)r(b.el=o(b.children),k,$);else{const z=b.el=R.el;b.children!==R.children&&u(z,b.children)}},x=(R,b,k,$)=>{R==null?r(b.el=c(b.children||""),k,$):b.el=R.el},m=(R,b,k,$)=>{[R.el,R.anchor]=d(R.children,b,k,$,R.el,R.anchor)},T=({el:R,anchor:b},k,$)=>{let z;for(;R&&R!==b;)z=h(R),r(R,k,$),R=z;r(b,k,$)},v=({el:R,anchor:b})=>{let k;for(;R&&R!==b;)k=h(R),s(R),R=k;s(b)},S=(R,b,k,$,z,j,X,I,K)=>{X=X||b.type==="svg",R==null?w(b,k,$,z,j,X,I,K):D(R,b,z,j,X,I,K)},w=(R,b,k,$,z,j,X,I)=>{let K,W;const{type:Q,props:Z,shapeFlag:J,transition:re,dirs:he}=R;if(K=R.el=a(R.type,j,Z&&Z.is,Z),J&8?l(K,R.children):J&16&&E(R.children,K,null,$,z,j&&Q!=="foreignObject",X,I),he&&Br(R,null,$,"created"),Z){for(const _e in Z)_e!=="value"&&!Vo(_e)&&i(K,_e,null,Z[_e],j,R.children,$,z,Se);"value"in Z&&i(K,"value",null,Z.value),(W=Z.onVnodeBeforeMount)&&yn(W,$,R)}M(K,R,R.scopeId,X,$),he&&Br(R,null,$,"beforeMount");const Oe=(!z||z&&!z.pendingBranch)&&re&&!re.persisted;Oe&&re.beforeEnter(K),r(K,b,k),((W=Z&&Z.onVnodeMounted)||Oe||he)&&Et(()=>{W&&yn(W,$,R),Oe&&re.enter(K),he&&Br(R,null,$,"mounted")},z)},M=(R,b,k,$,z)=>{if(k&&g(R,k),$)for(let j=0;j<$.length;j++)g(R,$[j]);if(z){let j=z.subTree;if(b===j){const X=z.vnode;M(R,X,X.scopeId,X.slotScopeIds,z.parent)}}},E=(R,b,k,$,z,j,X,I,K=0)=>{for(let W=K;W<R.length;W++){const Q=R[W]=I?Tr(R[W]):wn(R[W]);p(null,Q,b,k,$,z,j,X,I)}},D=(R,b,k,$,z,j,X)=>{const I=b.el=R.el;let{patchFlag:K,dynamicChildren:W,dirs:Q}=b;K|=R.patchFlag&16;const Z=R.props||Fe,J=b.props||Fe;let re;k&&kr(k,!1),(re=J.onVnodeBeforeUpdate)&&yn(re,k,b,R),Q&&Br(b,R,k,"beforeUpdate"),k&&kr(k,!0);const he=z&&b.type!=="foreignObject";if(W?O(R.dynamicChildren,W,I,k,$,he,j):X||P(R,b,I,null,k,$,he,j,!1),K>0){if(K&16)_(I,b,Z,J,k,$,z);else if(K&2&&Z.class!==J.class&&i(I,"class",null,J.class,z),K&4&&i(I,"style",Z.style,J.style,z),K&8){const Oe=b.dynamicProps;for(let _e=0;_e<Oe.length;_e++){const We=Oe[_e],Wt=Z[We],Ts=J[We];(Ts!==Wt||We==="value")&&i(I,We,Wt,Ts,z,R.children,k,$,Se)}}K&1&&R.children!==b.children&&l(I,b.children)}else!X&&W==null&&_(I,b,Z,J,k,$,z);((re=J.onVnodeUpdated)||Q)&&Et(()=>{re&&yn(re,k,b,R),Q&&Br(b,R,k,"updated")},$)},O=(R,b,k,$,z,j,X)=>{for(let I=0;I<b.length;I++){const K=R[I],W=b[I],Q=K.el&&(K.type===Wn||!Ei(K,W)||K.shapeFlag&70)?f(K.el):k;p(K,W,Q,null,$,z,j,X,!0)}},_=(R,b,k,$,z,j,X)=>{if(k!==$){if(k!==Fe)for(const I in k)!Vo(I)&&!(I in $)&&i(R,I,k[I],null,X,b.children,z,j,Se);for(const I in $){if(Vo(I))continue;const K=$[I],W=k[I];K!==W&&I!=="value"&&i(R,I,W,K,X,b.children,z,j,Se)}"value"in $&&i(R,"value",k.value,$.value)}},V=(R,b,k,$,z,j,X,I,K)=>{const W=b.el=R?R.el:o(""),Q=b.anchor=R?R.anchor:o("");let{patchFlag:Z,dynamicChildren:J,slotScopeIds:re}=b;re&&(I=I?I.concat(re):re),R==null?(r(W,k,$),r(Q,k,$),E(b.children,k,Q,z,j,X,I,K)):Z>0&&Z&64&&J&&R.dynamicChildren?(O(R.dynamicChildren,J,k,z,j,X,I),(b.key!=null||z&&b===z.subTree)&&U0(R,b,!0)):P(R,b,k,Q,z,j,X,I,K)},L=(R,b,k,$,z,j,X,I,K)=>{b.slotScopeIds=I,R==null?b.shapeFlag&512?z.ctx.activate(b,k,$,X,K):F(b,k,$,z,j,X,K):G(R,b,K)},F=(R,b,k,$,z,j,X)=>{const I=R.component=WS(R,$,z);if(O0(R)&&(I.ctx.renderer=$e),HS(I),I.asyncDep){if(z&&z.registerDep(I,A),!R.el){const K=I.subTree=Xn(aa);x(null,K,b,k)}return}A(I,R,b,k,z,j,X)},G=(R,b,k)=>{const $=b.component=R.component;if(Qm(R,b,k))if($.asyncDep&&!$.asyncResolved){H($,b,k);return}else $.next=b,jm($.update),$.update();else b.el=R.el,$.vnode=b},A=(R,b,k,$,z,j,X)=>{const I=()=>{if(R.isMounted){let{next:Q,bu:Z,u:J,parent:re,vnode:he}=R,Oe=Q,_e;kr(R,!1),Q?(Q.el=he.el,H(R,Q,X)):Q=he,Z&&Pc(Z),(_e=Q.props&&Q.props.onVnodeBeforeUpdate)&&yn(_e,re,Q,he),kr(R,!0);const We=Kc(R),Wt=R.subTree;R.subTree=We,p(Wt,We,f(Wt.el),Pe(Wt),R,z,j),Q.el=We.el,Oe===null&&Jm(R,We.el),J&&Et(J,z),(_e=Q.props&&Q.props.onVnodeUpdated)&&Et(()=>yn(_e,re,Q,he),z)}else{let Q;const{el:Z,props:J}=b,{bm:re,m:he,parent:Oe}=R,_e=Fo(b);if(kr(R,!1),re&&Pc(re),!_e&&(Q=J&&J.onVnodeBeforeMount)&&yn(Q,Oe,b),kr(R,!0),Z&&$t){const We=()=>{R.subTree=Kc(R),$t(Z,R.subTree,R,z,null)};_e?b.type.__asyncLoader().then(()=>!R.isUnmounted&&We()):We()}else{const We=R.subTree=Kc(R);p(null,We,k,$,R,z,j),b.el=We.el}if(he&&Et(he,z),!_e&&(Q=J&&J.onVnodeMounted)){const We=b;Et(()=>yn(Q,Oe,We),z)}(b.shapeFlag&256||Oe&&Fo(Oe.vnode)&&Oe.vnode.shapeFlag&256)&&R.a&&Et(R.a,z),R.isMounted=!0,b=k=$=null}},K=R.effect=new Sl(I,()=>Dl(W),R.scope),W=R.update=()=>K.run();W.id=R.uid,kr(R,!0),W()},H=(R,b,k)=>{b.component=R;const $=R.vnode.props;R.vnode=b,R.next=null,CS(R,b.props,$,k),_S(R,b.children,k),hi(),Jh(),gi()},P=(R,b,k,$,z,j,X,I,K=!1)=>{const W=R&&R.children,Q=R?R.shapeFlag:0,Z=b.children,{patchFlag:J,shapeFlag:re}=b;if(J>0){if(J&128){Y(W,Z,k,$,z,j,X,I,K);return}else if(J&256){U(W,Z,k,$,z,j,X,I,K);return}}re&8?(Q&16&&Se(W,z,j),Z!==W&&l(k,Z)):Q&16?re&16?Y(W,Z,k,$,z,j,X,I,K):Se(W,z,j,!0):(Q&8&&l(k,""),re&16&&E(Z,k,$,z,j,X,I,K))},U=(R,b,k,$,z,j,X,I,K)=>{R=R||Ps,b=b||Ps;const W=R.length,Q=b.length,Z=Math.min(W,Q);let J;for(J=0;J<Z;J++){const re=b[J]=K?Tr(b[J]):wn(b[J]);p(R[J],re,k,null,z,j,X,I,K)}W>Q?Se(R,z,j,!0,!1,Z):E(b,k,$,z,j,X,I,K,Z)},Y=(R,b,k,$,z,j,X,I,K)=>{let W=0;const Q=b.length;let Z=R.length-1,J=Q-1;for(;W<=Z&&W<=J;){const re=R[W],he=b[W]=K?Tr(b[W]):wn(b[W]);if(Ei(re,he))p(re,he,k,null,z,j,X,I,K);else break;W++}for(;W<=Z&&W<=J;){const re=R[Z],he=b[J]=K?Tr(b[J]):wn(b[J]);if(Ei(re,he))p(re,he,k,null,z,j,X,I,K);else break;Z--,J--}if(W>Z){if(W<=J){const re=J+1,he=re<Q?b[re].el:$;for(;W<=J;)p(null,b[W]=K?Tr(b[W]):wn(b[W]),k,he,z,j,X,I,K),W++}}else if(W>J)for(;W<=Z;)te(R[W],z,j,!0),W++;else{const re=W,he=W,Oe=new Map;for(W=he;W<=J;W++){const Rt=b[W]=K?Tr(b[W]):wn(b[W]);Rt.key!=null&&Oe.set(Rt.key,W)}let _e,We=0;const Wt=J-he+1;let Ts=!1,$h=0;const Mi=new Array(Wt);for(W=0;W<Wt;W++)Mi[W]=0;for(W=re;W<=Z;W++){const Rt=R[W];if(We>=Wt){te(Rt,z,j,!0);continue}let dn;if(Rt.key!=null)dn=Oe.get(Rt.key);else for(_e=he;_e<=J;_e++)if(Mi[_e-he]===0&&Ei(Rt,b[_e])){dn=_e;break}dn===void 0?te(Rt,z,j,!0):(Mi[dn-he]=W+1,dn>=$h?$h=dn:Ts=!0,p(Rt,b[dn],k,null,z,j,X,I,K),We++)}const Wh=Ts?LS(Mi):Ps;for(_e=Wh.length-1,W=Wt-1;W>=0;W--){const Rt=he+W,dn=b[Rt],Hh=Rt+1<Q?b[Rt+1].el:$;Mi[W]===0?p(null,dn,k,Hh,z,j,X,I,K):Ts&&(_e<0||W!==Wh[_e]?ee(dn,k,Hh,2):_e--)}}},ee=(R,b,k,$,z=null)=>{const{el:j,type:X,transition:I,children:K,shapeFlag:W}=R;if(W&6){ee(R.component.subTree,b,k,$);return}if(W&128){R.suspense.move(b,k,$);return}if(W&64){X.move(R,b,k,$e);return}if(X===Wn){r(j,b,k);for(let Z=0;Z<K.length;Z++)ee(K[Z],b,k,$);r(R.anchor,b,k);return}if(X===Yc){T(R,b,k);return}if($!==2&&W&1&&I)if($===0)I.beforeEnter(j),r(j,b,k),Et(()=>I.enter(j),z);else{const{leave:Z,delayLeave:J,afterLeave:re}=I,he=()=>r(j,b,k),Oe=()=>{Z(j,()=>{he(),re&&re()})};J?J(j,he,Oe):Oe()}else r(j,b,k)},te=(R,b,k,$=!1,z=!1)=>{const{type:j,props:X,ref:I,children:K,dynamicChildren:W,shapeFlag:Q,patchFlag:Z,dirs:J}=R;if(I!=null&&vf(I,null,k,R,!0),Q&256){b.ctx.deactivate(R);return}const re=Q&1&&J,he=!Fo(R);let Oe;if(he&&(Oe=X&&X.onVnodeBeforeUnmount)&&yn(Oe,b,R),Q&6)Qe(R.component,k,$);else{if(Q&128){R.suspense.unmount(k,$);return}re&&Br(R,null,b,"beforeUnmount"),Q&64?R.type.remove(R,b,k,z,$e,$):W&&(j!==Wn||Z>0&&Z&64)?Se(W,b,k,!1,!0):(j===Wn&&Z&384||!z&&Q&16)&&Se(K,b,k),$&&q(R)}(he&&(Oe=X&&X.onVnodeUnmounted)||re)&&Et(()=>{Oe&&yn(Oe,b,R),re&&Br(R,null,b,"unmounted")},k)},q=R=>{const{type:b,el:k,anchor:$,transition:z}=R;if(b===Wn){Mt(k,$);return}if(b===Yc){v(R);return}const j=()=>{s(k),z&&!z.persisted&&z.afterLeave&&z.afterLeave()};if(R.shapeFlag&1&&z&&!z.persisted){const{leave:X,delayLeave:I}=z,K=()=>X(k,j);I?I(R.el,j,K):K()}else j()},Mt=(R,b)=>{let k;for(;R!==b;)k=h(R),s(R),R=k;s(b)},Qe=(R,b,k)=>{const{bum:$,scope:z,update:j,subTree:X,um:I}=R;$&&Pc($),z.stop(),j&&(j.active=!1,te(X,R,b,k)),I&&Et(I,b),Et(()=>{R.isUnmounted=!0},b),b&&b.pendingBranch&&!b.isUnmounted&&R.asyncDep&&!R.asyncResolved&&R.suspenseId===b.pendingId&&(b.deps--,b.deps===0&&b.resolve())},Se=(R,b,k,$=!1,z=!1,j=0)=>{for(let X=j;X<R.length;X++)te(R[X],b,k,$,z)},Pe=R=>R.shapeFlag&6?Pe(R.component.subTree):R.shapeFlag&128?R.suspense.next():h(R.anchor||R.el),zt=(R,b,k)=>{R==null?b._vnode&&te(b._vnode,null,null,!0):p(b._vnode||null,R,b,null,null,null,k),Jh(),w0(),b._vnode=R},$e={p,um:te,m:ee,r:q,mt:F,mc:E,pc:P,pbc:O,n:Pe,o:t};let ct,$t;return e&&([ct,$t]=e($e)),{render:zt,hydrate:ct,createApp:OS(zt,ct)}}function kr({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function U0(t,e,n=!1){const r=t.children,s=e.children;if(ae(r)&&ae(s))for(let i=0;i<r.length;i++){const a=r[i];let o=s[i];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=s[i]=Tr(s[i]),o.el=a.el),n||U0(a,o)),o.type===bc&&(o.el=a.el)}}function LS(t){const e=t.slice(),n=[0];let r,s,i,a,o;const c=t.length;for(r=0;r<c;r++){const u=t[r];if(u!==0){if(s=n[n.length-1],t[s]<u){e[r]=s,n.push(r);continue}for(i=0,a=n.length-1;i<a;)o=i+a>>1,t[n[o]]<u?i=o+1:a=o;u<t[n[i]]&&(i>0&&(e[r]=n[i-1]),n[i]=r)}}for(i=n.length,a=n[i-1];i-- >0;)n[i]=a,a=e[a];return n}const VS=t=>t.__isTeleport,Wn=Symbol(void 0),bc=Symbol(void 0),aa=Symbol(void 0),Yc=Symbol(void 0),Xi=[];let sn=null;function Bl(t=!1){Xi.push(sn=t?null:[])}function FS(){Xi.pop(),sn=Xi[Xi.length-1]||null}let oa=1;function og(t){oa+=t}function G0(t){return t.dynamicChildren=oa>0?sn||Ps:null,FS(),oa>0&&sn&&sn.push(t),t}function A0(t,e,n,r,s,i){return G0($0(t,e,n,r,s,i,!0))}function BS(t,e,n,r,s){return G0(Xn(t,e,n,r,s,!0))}function kS(t){return t?t.__v_isVNode===!0:!1}function Ei(t,e){return t.type===e.type&&t.key===e.key}const Lc="__vInternal",z0=({key:t})=>t??null,Bo=({ref:t,ref_key:e,ref_for:n})=>t!=null?ot(t)||Be(t)||ue(t)?{i:rn,r:t,k:e,f:!!n}:t:null;function $0(t,e=null,n=null,r=0,s=null,i=t===Wn?0:1,a=!1,o=!1){const c={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&z0(e),ref:e&&Bo(e),scopeId:E0,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:rn};return o?(kl(c,n),i&128&&t.normalize(c)):n&&(c.shapeFlag|=ot(n)?8:16),oa>0&&!a&&sn&&(c.patchFlag>0||i&6)&&c.patchFlag!==32&&sn.push(c),c}const Xn=NS;function NS(t,e=null,n=null,r=0,s=null,i=!1){if((!t||t===dS)&&(t=aa),kS(t)){const o=ti(t,e,!0);return n&&kl(o,n),oa>0&&!i&&sn&&(o.shapeFlag&6?sn[sn.indexOf(t)]=o:sn.push(o)),o.patchFlag|=-2,o}if(KS(t)&&(t=t.__vccOpts),e){e=US(e);let{class:o,style:c}=e;o&&!ot(o)&&(e.class=dl(o)),je(c)&&(p0(c)&&!ae(c)&&(c=gt({},c)),e.style=pl(c))}const a=ot(t)?1:eS(t)?128:VS(t)?64:je(t)?4:ue(t)?2:0;return $0(t,e,n,r,s,a,i,!0)}function US(t){return t?p0(t)||Lc in t?gt({},t):t:null}function ti(t,e,n=!1){const{props:r,ref:s,patchFlag:i,children:a}=t,o=e?AS(r||{},e):r;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:o,key:o&&z0(o),ref:e&&e.ref?n&&s?ae(s)?s.concat(Bo(e)):[s,Bo(e)]:Bo(e):s,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Wn?i===-1?16:i|16:i,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&ti(t.ssContent),ssFallback:t.ssFallback&&ti(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx}}function GS(t=" ",e=0){return Xn(bc,null,t,e)}function wn(t){return t==null||typeof t=="boolean"?Xn(aa):ae(t)?Xn(Wn,null,t.slice()):typeof t=="object"?Tr(t):Xn(bc,null,String(t))}function Tr(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:ti(t)}function kl(t,e){let n=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(ae(e))n=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),kl(t,s()),s._c&&(s._d=!0));return}else{n=32;const s=e._;!s&&!(Lc in e)?e._ctx=rn:s===3&&rn&&(rn.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else ue(e)?(e={default:e,_ctx:rn},n=32):(e=String(e),r&64?(n=16,e=[GS(e)]):n=8);t.children=e,t.shapeFlag|=n}function AS(...t){const e={};for(let n=0;n<t.length;n++){const r=t[n];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=dl([e.class,r.class]));else if(s==="style")e.style=pl([e.style,r.style]);else if(Sc(s)){const i=e[s],a=r[s];a&&i!==a&&!(ae(i)&&i.includes(a))&&(e[s]=i?[].concat(i,a):a)}else s!==""&&(e[s]=r[s])}return e}function yn(t,e,n,r=null){cn(t,e,7,[n,r])}const zS=N0();let $S=0;function WS(t,e,n){const r=t.type,s=(e?e.appContext:t.appContext)||zS,i={uid:$S++,vnode:t,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new t0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:V0(r,s),emitsOptions:M0(r,s),emit:null,emitted:null,propsDefaults:Fe,inheritAttrs:r.inheritAttrs,ctx:Fe,data:Fe,props:Fe,attrs:Fe,slots:Fe,refs:Fe,setupState:Fe,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=Xm.bind(null,i),t.ce&&t.ce(i),i}let at=null;const W0=()=>at||rn,ni=t=>{at=t,t.scope.on()},is=()=>{at&&at.scope.off(),at=null};function H0(t){return t.vnode.shapeFlag&4}let ca=!1;function HS(t,e=!1){ca=e;const{props:n,children:r}=t.vnode,s=H0(t);wS(t,n,s,e),ES(t,r);const i=s?IS(t,e):void 0;return ca=!1,i}function IS(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=ei(new Proxy(t.ctx,yS));const{setup:r}=n;if(r){const s=t.setupContext=r.length>1?PS(t):null;ni(t),hi();const i=Er(r,t,0,[t.props,s]);if(gi(),is(),Jd(i)){if(i.then(is,is),e)return i.then(a=>{cg(t,a,e)}).catch(a=>{_c(a,t,0)});t.asyncDep=i}else cg(t,i,e)}else I0(t,e)}function cg(t,e,n){ue(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:je(e)&&(t.setupState=x0(e)),I0(t,n)}let ug;function I0(t,e,n){const r=t.type;if(!t.render){if(!e&&ug&&!r.render){const s=r.template||Vl(t).template;if(s){const{isCustomElement:i,compilerOptions:a}=t.appContext.config,{delimiters:o,compilerOptions:c}=r,u=gt(gt({isCustomElement:i,delimiters:o},a),c);r.render=ug(s,u)}}t.render=r.render||on}ni(t),hi(),xS(t),gi(),is()}function jS(t){return new Proxy(t.attrs,{get(e,n){return Vt(t,"get","$attrs"),e[n]}})}function PS(t){const e=r=>{t.exposed=r||{}};let n;return{get attrs(){return n||(n=jS(t))},slots:t.slots,emit:t.emit,expose:e}}function Nl(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(x0(ei(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in Ki)return Ki[n](t)},has(e,n){return n in e||n in Ki}}))}function KS(t){return ue(t)&&"__vccOpts"in t}const Ul=(t,e)=>Wm(t,e,ca),XS=Symbol(""),YS=()=>ji(XS),qS="3.2.45",ZS="http://www.w3.org/2000/svg",Qr=typeof document<"u"?document:null,fg=Qr&&Qr.createElement("template"),QS={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,r)=>{const s=e?Qr.createElementNS(ZS,t):Qr.createElement(t,n?{is:n}:void 0);return t==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:t=>Qr.createTextNode(t),createComment:t=>Qr.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Qr.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,r,s,i){const a=n?n.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),n),!(s===i||!(s=s.nextSibling)););else{fg.innerHTML=r?`<svg>${t}</svg>`:t;const o=fg.content;if(r){const c=o.firstChild;for(;c.firstChild;)o.appendChild(c.firstChild);o.removeChild(c)}e.insertBefore(o,n)}return[a?a.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}};function JS(t,e,n){const r=t._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}function ew(t,e,n){const r=t.style,s=ot(n);if(n&&!s){for(const i in n)mf(r,i,n[i]);if(e&&!ot(e))for(const i in e)n[i]==null&&mf(r,i,"")}else{const i=r.display;s?e!==n&&(r.cssText=n):e&&t.removeAttribute("style"),"_vod"in t&&(r.display=i)}}const lg=/\s*!important$/;function mf(t,e,n){if(ae(n))n.forEach(r=>mf(t,e,r));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const r=tw(t,e);lg.test(n)?t.setProperty(Zt(r),n.replace(lg,""),"important"):t[r]=n}}const hg=["Webkit","Moz","ms"],qc={};function tw(t,e){const n=qc[e];if(n)return n;let r=Pn(e);if(r!=="filter"&&r in t)return qc[e]=r;r=e0(r);for(let s=0;s<hg.length;s++){const i=hg[s]+r;if(i in t)return qc[e]=i}return e}const gg="http://www.w3.org/1999/xlink";function nw(t,e,n,r,s){if(r&&e.startsWith("xlink:"))n==null?t.removeAttributeNS(gg,e.slice(6,e.length)):t.setAttributeNS(gg,e,n);else{const i=Yv(e);n==null||i&&!Qd(n)?t.removeAttribute(e):t.setAttribute(e,i?"":n)}}function rw(t,e,n,r,s,i,a){if(e==="innerHTML"||e==="textContent"){r&&a(r,s,i),t[e]=n??"";return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=n;const c=n??"";(t.value!==c||t.tagName==="OPTION")&&(t.value=c),n==null&&t.removeAttribute(e);return}let o=!1;if(n===""||n==null){const c=typeof t[e];c==="boolean"?n=Qd(n):n==null&&c==="string"?(n="",o=!0):c==="number"&&(n=0,o=!0)}try{t[e]=n}catch{}o&&t.removeAttribute(e)}function sw(t,e,n,r){t.addEventListener(e,n,r)}function iw(t,e,n,r){t.removeEventListener(e,n,r)}function aw(t,e,n,r,s=null){const i=t._vei||(t._vei={}),a=i[e];if(r&&a)a.value=r;else{const[o,c]=ow(e);if(r){const u=i[e]=fw(r,s);sw(t,o,u,c)}else a&&(iw(t,o,a,c),i[e]=void 0)}}const pg=/(?:Once|Passive|Capture)$/;function ow(t){let e;if(pg.test(t)){e={};let r;for(;r=t.match(pg);)t=t.slice(0,t.length-r[0].length),e[r[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Zt(t.slice(2)),e]}let Zc=0;const cw=Promise.resolve(),uw=()=>Zc||(cw.then(()=>Zc=0),Zc=Date.now());function fw(t,e){const n=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=n.attached)return;cn(lw(r,n.value),e,5,[r])};return n.value=t,n.attached=uw(),n}function lw(t,e){if(ae(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const dg=/^on[a-z]/,hw=(t,e,n,r,s=!1,i,a,o,c)=>{e==="class"?JS(t,r,s):e==="style"?ew(t,n,r):Sc(e)?yl(e)||aw(t,e,n,r,a):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):gw(t,e,r,s))?rw(t,e,r,i,a,o,c):(e==="true-value"?t._trueValue=r:e==="false-value"&&(t._falseValue=r),nw(t,e,r,s))};function gw(t,e,n,r){return r?!!(e==="innerHTML"||e==="textContent"||e in t&&dg.test(e)&&ue(n)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||dg.test(e)&&ot(n)?!1:e in t}function pw(t,e){const n=Oc(t);class r extends Gl{constructor(i){super(n,i,e)}}return r.def=n,r}const dw=typeof HTMLElement<"u"?HTMLElement:class{};class Gl extends dw{constructor(e,n={},r){super(),this._def=e,this._props=n,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this.shadowRoot&&r?r(this._createVNode(),this.shadowRoot):(this.attachShadow({mode:"open"}),this._def.__asyncLoader||this._resolveProps(this._def))}connectedCallback(){this._connected=!0,this._instance||(this._resolved?this._update():this._resolveDef())}disconnectedCallback(){this._connected=!1,Ol(()=>{this._connected||(xg(null,this.shadowRoot),this._instance=null)})}_resolveDef(){this._resolved=!0;for(let r=0;r<this.attributes.length;r++)this._setAttr(this.attributes[r].name);new MutationObserver(r=>{for(const s of r)this._setAttr(s.attributeName)}).observe(this,{attributes:!0});const e=(r,s=!1)=>{const{props:i,styles:a}=r;let o;if(i&&!ae(i))for(const c in i){const u=i[c];(u===Number||u&&u.type===Number)&&(c in this._props&&(this._props[c]=Ho(this._props[c])),(o||(o=Object.create(null)))[Pn(c)]=!0)}this._numberProps=o,s&&this._resolveProps(r),this._applyStyles(a),this._update()},n=this._def.__asyncLoader;n?n().then(r=>e(r,!0)):e(this._def)}_resolveProps(e){const{props:n}=e,r=ae(n)?n:Object.keys(n||{});for(const s of Object.keys(this))s[0]!=="_"&&r.includes(s)&&this._setProp(s,this[s],!0,!1);for(const s of r.map(Pn))Object.defineProperty(this,s,{get(){return this._getProp(s)},set(i){this._setProp(s,i)}})}_setAttr(e){let n=this.getAttribute(e);const r=Pn(e);this._numberProps&&this._numberProps[r]&&(n=Ho(n)),this._setProp(r,n,!1)}_getProp(e){return this._props[e]}_setProp(e,n,r=!0,s=!0){n!==this._props[e]&&(this._props[e]=n,s&&this._instance&&this._update(),r&&(n===!0?this.setAttribute(Zt(e),""):typeof n=="string"||typeof n=="number"?this.setAttribute(Zt(e),n+""):n||this.removeAttribute(Zt(e))))}_update(){xg(this._createVNode(),this.shadowRoot)}_createVNode(){const e=Xn(this._def,gt({},this._props));return this._instance||(e.ce=n=>{this._instance=n,n.isCE=!0;const r=(i,a)=>{this.dispatchEvent(new CustomEvent(i,{detail:a}))};n.emit=(i,...a)=>{r(i,a),Zt(i)!==i&&r(Zt(i),a)};let s=this;for(;s=s&&(s.parentNode||s.host);)if(s instanceof Gl){n.parent=s._instance,n.provides=s._instance.provides;break}}),e}_applyStyles(e){e&&e.forEach(n=>{const r=document.createElement("style");r.textContent=n,this.shadowRoot.appendChild(r)})}}const yw=gt({patchProp:hw},QS);let yg;function j0(){return yg||(yg=DS(yw))}const xg=(...t)=>{j0().render(...t)},xw=(...t)=>{const e=j0().createApp(...t),{mount:n}=e;return e.mount=r=>{const s=Tw(r);if(!s)return;const i=e._component;!ue(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.innerHTML="";const a=n(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),a},e};function Tw(t){return ot(t)?document.querySelector(t):t}var vw=!1;/*!
  * pinia v2.0.29
  * (c) 2023 Eduardo San Martin Morote
  * @license MIT
  */let P0;const Vc=t=>P0=t,K0=Symbol();function Sf(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var Yi;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(Yi||(Yi={}));function mw(){const t=n0(!0),e=t.run(()=>va({}));let n=[],r=[];const s=ei({install(i){Vc(s),s._a=i,i.provide(K0,s),i.config.globalProperties.$pinia=s,r.forEach(a=>n.push(a)),r=[]},use(i){return!this._a&&!vw?r.push(i):n.push(i),this},_p:n,_a:null,_e:t,_s:new Map,state:e});return s}const X0=()=>{};function Tg(t,e,n,r=X0){t.push(e);const s=()=>{const i=t.indexOf(e);i>-1&&(t.splice(i,1),r())};return!n&&om()&&cm(s),s}function vs(t,...e){t.slice().forEach(n=>{n(...e)})}function wf(t,e){t instanceof Map&&e instanceof Map&&e.forEach((n,r)=>t.set(r,n)),t instanceof Set&&e instanceof Set&&e.forEach(t.add,t);for(const n in e){if(!e.hasOwnProperty(n))continue;const r=e[n],s=t[n];Sf(s)&&Sf(r)&&t.hasOwnProperty(n)&&!Be(r)&&!Kn(r)?t[n]=wf(s,r):t[n]=r}return t}const Sw=Symbol();function ww(t){return!Sf(t)||!t.hasOwnProperty(Sw)}const{assign:vr}=Object;function Cw(t){return!!(Be(t)&&t.effect)}function Mw(t,e,n,r){const{state:s,actions:i,getters:a}=e,o=n.state.value[t];let c;function u(){o||(n.state.value[t]=s?s():{});const l=Am(n.state.value[t]);return vr(l,i,Object.keys(a||{}).reduce((f,h)=>(f[h]=ei(Ul(()=>{Vc(n);const g=n._s.get(t);return a[h].call(g,g)})),f),{}))}return c=Y0(t,u,e,n,r,!0),c.$reset=function(){const f=s?s():{};this.$patch(h=>{vr(h,f)})},c}function Y0(t,e,n={},r,s,i){let a;const o=vr({actions:{}},n),c={deep:!0};let u,l,f=ei([]),h=ei([]),g;const d=r.state.value[t];!i&&!d&&(r.state.value[t]={}),va({});let p;function y(M){let E;u=l=!1,typeof M=="function"?(M(r.state.value[t]),E={type:Yi.patchFunction,storeId:t,events:g}):(wf(r.state.value[t],M),E={type:Yi.patchObject,payload:M,storeId:t,events:g});const D=p=Symbol();Ol().then(()=>{p===D&&(u=!0)}),l=!0,vs(f,E,r.state.value[t])}const x=X0;function m(){a.stop(),f=[],h=[],r._s.delete(t)}function T(M,E){return function(){Vc(r);const D=Array.from(arguments),O=[],_=[];function V(G){O.push(G)}function L(G){_.push(G)}vs(h,{args:D,name:M,store:S,after:V,onError:L});let F;try{F=E.apply(this&&this.$id===t?this:S,D)}catch(G){throw vs(_,G),G}return F instanceof Promise?F.then(G=>(vs(O,G),G)).catch(G=>(vs(_,G),Promise.reject(G))):(vs(O,F),F)}}const v={_p:r,$id:t,$onAction:Tg.bind(null,h),$patch:y,$reset:x,$subscribe(M,E={}){const D=Tg(f,M,E.detached,()=>O()),O=a.run(()=>Pi(()=>r.state.value[t],_=>{(E.flush==="sync"?l:u)&&M({storeId:t,type:Yi.direct,events:g},_)},vr({},c,E)));return D},$dispose:m},S=Ec(v);r._s.set(t,S);const w=r._e.run(()=>(a=n0(),a.run(()=>e())));for(const M in w){const E=w[M];if(Be(E)&&!Cw(E)||Kn(E))i||(d&&ww(E)&&(Be(E)?E.value=d[M]:wf(E,d[M])),r.state.value[t][M]=E);else if(typeof E=="function"){const D=T(M,E);w[M]=D,o.actions[M]=E}}return vr(S,w),vr(me(S),w),Object.defineProperty(S,"$state",{get:()=>r.state.value[t],set:M=>{y(E=>{vr(E,M)})}}),r._p.forEach(M=>{vr(S,a.run(()=>M({store:S,app:r._a,pinia:r,options:o})))}),d&&i&&n.hydrate&&n.hydrate(S.$state,d),u=!0,l=!0,S}function q0(t,e,n){let r,s;const i=typeof e=="function";typeof t=="string"?(r=t,s=i?n:e):(s=t,r=t.id);function a(o,c){const u=W0();return o=o||u&&ji(K0,null),o&&Vc(o),o=P0,o._s.has(r)||(i?Y0(r,e,s,o):Mw(r,s,o)),o._s.get(r)}return a.$id=r,a}function Ew(t){{t=me(t);const e={};for(const n in t){const r=t[n];(Be(r)||Kn(r))&&(e[n]=T0(t,n))}return e}}const _w=q0("host",()=>{const t=va(document);function e(r){t.value=r}const n=Ul(()=>t.value===document?document.documentElement:t.value);return{root:t,documentElement:n,setRoot:e}}),Cf=q0("vtk",()=>{const t=va(null);function e(n){t.value=n}return{mgr:t,setVtk:e}});var ye=1e-6,rt=typeof Float32Array<"u"?Float32Array:Array,Rw=Math.PI/180;function Ow(t){return t*Rw}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Z0(){var t=new rt(9);return rt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Al(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Dw(t){var e=new rt(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function bw(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Lw(t,e,n,r,s,i,a,o,c){var u=new rt(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=s,u[5]=i,u[6]=a,u[7]=o,u[8]=c,u}function Vw(t,e,n,r,s,i,a,o,c,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=u,t}function ys(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Q0(t,e){if(t===e){var n=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function zl(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],l=e[8],f=l*a-o*u,h=-l*i+o*c,g=u*i-a*c,d=n*f+r*h+s*g;return d?(d=1/d,t[0]=f*d,t[1]=(-l*r+s*u)*d,t[2]=(o*r-s*a)*d,t[3]=h*d,t[4]=(l*n-s*c)*d,t[5]=(-o*n+s*i)*d,t[6]=g*d,t[7]=(-u*n+r*c)*d,t[8]=(a*n-r*i)*d,t):null}function Fw(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],l=e[8];return t[0]=a*l-o*u,t[1]=s*u-r*l,t[2]=r*o-s*a,t[3]=o*c-i*l,t[4]=n*l-s*c,t[5]=s*i-n*o,t[6]=i*u-a*c,t[7]=r*c-n*u,t[8]=n*a-r*i,t}function Bw(t){var e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],u=t[8];return e*(u*i-a*c)+n*(-u*s+a*o)+r*(c*s-i*o)}function J0(t,e,n){var r=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],l=e[7],f=e[8],h=n[0],g=n[1],d=n[2],p=n[3],y=n[4],x=n[5],m=n[6],T=n[7],v=n[8];return t[0]=h*r+g*a+d*u,t[1]=h*s+g*o+d*l,t[2]=h*i+g*c+d*f,t[3]=p*r+y*a+x*u,t[4]=p*s+y*o+x*l,t[5]=p*i+y*c+x*f,t[6]=m*r+T*a+v*u,t[7]=m*s+T*o+v*l,t[8]=m*i+T*c+v*f,t}function kw(t,e,n){var r=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],l=e[7],f=e[8],h=n[0],g=n[1];return t[0]=r,t[1]=s,t[2]=i,t[3]=a,t[4]=o,t[5]=c,t[6]=h*r+g*a+u,t[7]=h*s+g*o+l,t[8]=h*i+g*c+f,t}function Nw(t,e,n){var r=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],l=e[7],f=e[8],h=Math.sin(n),g=Math.cos(n);return t[0]=g*r+h*a,t[1]=g*s+h*o,t[2]=g*i+h*c,t[3]=g*a-h*r,t[4]=g*o-h*s,t[5]=g*c-h*i,t[6]=u,t[7]=l,t[8]=f,t}function Uw(t,e,n){var r=n[0],s=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Gw(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Aw(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function zw(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function $w(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Ww(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],a=n+n,o=r+r,c=s+s,u=n*a,l=r*a,f=r*o,h=s*a,g=s*o,d=s*c,p=i*a,y=i*o,x=i*c;return t[0]=1-f-d,t[3]=l-x,t[6]=h+y,t[1]=l+x,t[4]=1-u-d,t[7]=g-p,t[2]=h-y,t[5]=g+p,t[8]=1-u-f,t}function Hw(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],l=e[8],f=e[9],h=e[10],g=e[11],d=e[12],p=e[13],y=e[14],x=e[15],m=n*o-r*a,T=n*c-s*a,v=n*u-i*a,S=r*c-s*o,w=r*u-i*o,M=s*u-i*c,E=l*p-f*d,D=l*y-h*d,O=l*x-g*d,_=f*y-h*p,V=f*x-g*p,L=h*x-g*y,F=m*L-T*V+v*_+S*O-w*D+M*E;return F?(F=1/F,t[0]=(o*L-c*V+u*_)*F,t[1]=(c*O-a*L-u*D)*F,t[2]=(a*V-o*O+u*E)*F,t[3]=(s*V-r*L-i*_)*F,t[4]=(n*L-s*O+i*D)*F,t[5]=(r*O-n*V-i*E)*F,t[6]=(p*M-y*w+x*S)*F,t[7]=(y*v-d*M-x*T)*F,t[8]=(d*w-p*v+x*m)*F,t):null}function Iw(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function jw(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Pw(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Kw(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function ey(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Xw(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function Yw(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function qw(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Zw(t,e){var n=t[0],r=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],u=t[7],l=t[8],f=e[0],h=e[1],g=e[2],d=e[3],p=e[4],y=e[5],x=e[6],m=e[7],T=e[8];return Math.abs(n-f)<=ye*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-h)<=ye*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-g)<=ye*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(i-d)<=ye*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-p)<=ye*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-y)<=ye*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(c-x)<=ye*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-m)<=ye*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(l-T)<=ye*Math.max(1,Math.abs(l),Math.abs(T))}var Qw=J0,Jw=ey;const e2=Object.freeze(Object.defineProperty({__proto__:null,add:Kw,adjoint:Fw,clone:Dw,copy:bw,create:Z0,determinant:Bw,equals:Zw,exactEquals:qw,frob:Pw,fromMat2d:$w,fromMat4:Al,fromQuat:Ww,fromRotation:Aw,fromScaling:zw,fromTranslation:Gw,fromValues:Lw,identity:ys,invert:zl,mul:Qw,multiply:J0,multiplyScalar:Xw,multiplyScalarAndAdd:Yw,normalFromMat4:Hw,projection:Iw,rotate:Nw,scale:Uw,set:Vw,str:jw,sub:Jw,subtract:ey,translate:kw,transpose:Q0},Symbol.toStringTag,{value:"Module"}));function $l(){var t=new rt(16);return rt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function t2(t){var e=new rt(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function it(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function n2(t,e,n,r,s,i,a,o,c,u,l,f,h,g,d,p){var y=new rt(16);return y[0]=t,y[1]=e,y[2]=n,y[3]=r,y[4]=s,y[5]=i,y[6]=a,y[7]=o,y[8]=c,y[9]=u,y[10]=l,y[11]=f,y[12]=h,y[13]=g,y[14]=d,y[15]=p,y}function r2(t,e,n,r,s,i,a,o,c,u,l,f,h,g,d,p,y){return t[0]=e,t[1]=n,t[2]=r,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=u,t[9]=l,t[10]=f,t[11]=h,t[12]=g,t[13]=d,t[14]=p,t[15]=y,t}function ce(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Le(t,e){if(t===e){var n=e[1],r=e[2],s=e[3],i=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=s,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function wt(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],l=e[8],f=e[9],h=e[10],g=e[11],d=e[12],p=e[13],y=e[14],x=e[15],m=n*o-r*a,T=n*c-s*a,v=n*u-i*a,S=r*c-s*o,w=r*u-i*o,M=s*u-i*c,E=l*p-f*d,D=l*y-h*d,O=l*x-g*d,_=f*y-h*p,V=f*x-g*p,L=h*x-g*y,F=m*L-T*V+v*_+S*O-w*D+M*E;return F?(F=1/F,t[0]=(o*L-c*V+u*_)*F,t[1]=(s*V-r*L-i*_)*F,t[2]=(p*M-y*w+x*S)*F,t[3]=(h*w-f*M-g*S)*F,t[4]=(c*O-a*L-u*D)*F,t[5]=(n*L-s*O+i*D)*F,t[6]=(y*v-d*M-x*T)*F,t[7]=(l*M-h*v+g*T)*F,t[8]=(a*V-o*O+u*E)*F,t[9]=(r*O-n*V-i*E)*F,t[10]=(d*w-p*v+x*m)*F,t[11]=(f*v-l*w-g*m)*F,t[12]=(o*D-a*_-c*E)*F,t[13]=(n*_-r*D+s*E)*F,t[14]=(p*T-d*S-y*m)*F,t[15]=(l*S-f*T+h*m)*F,t):null}function s2(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],l=e[8],f=e[9],h=e[10],g=e[11],d=e[12],p=e[13],y=e[14],x=e[15];return t[0]=o*(h*x-g*y)-f*(c*x-u*y)+p*(c*g-u*h),t[1]=-(r*(h*x-g*y)-f*(s*x-i*y)+p*(s*g-i*h)),t[2]=r*(c*x-u*y)-o*(s*x-i*y)+p*(s*u-i*c),t[3]=-(r*(c*g-u*h)-o*(s*g-i*h)+f*(s*u-i*c)),t[4]=-(a*(h*x-g*y)-l*(c*x-u*y)+d*(c*g-u*h)),t[5]=n*(h*x-g*y)-l*(s*x-i*y)+d*(s*g-i*h),t[6]=-(n*(c*x-u*y)-a*(s*x-i*y)+d*(s*u-i*c)),t[7]=n*(c*g-u*h)-a*(s*g-i*h)+l*(s*u-i*c),t[8]=a*(f*x-g*p)-l*(o*x-u*p)+d*(o*g-u*f),t[9]=-(n*(f*x-g*p)-l*(r*x-i*p)+d*(r*g-i*f)),t[10]=n*(o*x-u*p)-a*(r*x-i*p)+d*(r*u-i*o),t[11]=-(n*(o*g-u*f)-a*(r*g-i*f)+l*(r*u-i*o)),t[12]=-(a*(f*y-h*p)-l*(o*y-c*p)+d*(o*h-c*f)),t[13]=n*(f*y-h*p)-l*(r*y-s*p)+d*(r*h-s*f),t[14]=-(n*(o*y-c*p)-a*(r*y-s*p)+d*(r*c-s*o)),t[15]=n*(o*h-c*f)-a*(r*h-s*f)+l*(r*c-s*o),t}function i2(t){var e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],u=t[8],l=t[9],f=t[10],h=t[11],g=t[12],d=t[13],p=t[14],y=t[15],x=e*a-n*i,m=e*o-r*i,T=e*c-s*i,v=n*o-r*a,S=n*c-s*a,w=r*c-s*o,M=u*d-l*g,E=u*p-f*g,D=u*y-h*g,O=l*p-f*d,_=l*y-h*d,V=f*y-h*p;return x*V-m*_+T*O+v*D-S*E+w*M}function Ye(t,e,n){var r=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],u=e[6],l=e[7],f=e[8],h=e[9],g=e[10],d=e[11],p=e[12],y=e[13],x=e[14],m=e[15],T=n[0],v=n[1],S=n[2],w=n[3];return t[0]=T*r+v*o+S*f+w*p,t[1]=T*s+v*c+S*h+w*y,t[2]=T*i+v*u+S*g+w*x,t[3]=T*a+v*l+S*d+w*m,T=n[4],v=n[5],S=n[6],w=n[7],t[4]=T*r+v*o+S*f+w*p,t[5]=T*s+v*c+S*h+w*y,t[6]=T*i+v*u+S*g+w*x,t[7]=T*a+v*l+S*d+w*m,T=n[8],v=n[9],S=n[10],w=n[11],t[8]=T*r+v*o+S*f+w*p,t[9]=T*s+v*c+S*h+w*y,t[10]=T*i+v*u+S*g+w*x,t[11]=T*a+v*l+S*d+w*m,T=n[12],v=n[13],S=n[14],w=n[15],t[12]=T*r+v*o+S*f+w*p,t[13]=T*s+v*c+S*h+w*y,t[14]=T*i+v*u+S*g+w*x,t[15]=T*a+v*l+S*d+w*m,t}function Ae(t,e,n){var r=n[0],s=n[1],i=n[2],a,o,c,u,l,f,h,g,d,p,y,x;return e===t?(t[12]=e[0]*r+e[4]*s+e[8]*i+e[12],t[13]=e[1]*r+e[5]*s+e[9]*i+e[13],t[14]=e[2]*r+e[6]*s+e[10]*i+e[14],t[15]=e[3]*r+e[7]*s+e[11]*i+e[15]):(a=e[0],o=e[1],c=e[2],u=e[3],l=e[4],f=e[5],h=e[6],g=e[7],d=e[8],p=e[9],y=e[10],x=e[11],t[0]=a,t[1]=o,t[2]=c,t[3]=u,t[4]=l,t[5]=f,t[6]=h,t[7]=g,t[8]=d,t[9]=p,t[10]=y,t[11]=x,t[12]=a*r+l*s+d*i+e[12],t[13]=o*r+f*s+p*i+e[13],t[14]=c*r+h*s+y*i+e[14],t[15]=u*r+g*s+x*i+e[15]),t}function hs(t,e,n){var r=n[0],s=n[1],i=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Pt(t,e,n,r){var s=r[0],i=r[1],a=r[2],o=Math.hypot(s,i,a),c,u,l,f,h,g,d,p,y,x,m,T,v,S,w,M,E,D,O,_,V,L,F,G;return o<ye?null:(o=1/o,s*=o,i*=o,a*=o,c=Math.sin(n),u=Math.cos(n),l=1-u,f=e[0],h=e[1],g=e[2],d=e[3],p=e[4],y=e[5],x=e[6],m=e[7],T=e[8],v=e[9],S=e[10],w=e[11],M=s*s*l+u,E=i*s*l+a*c,D=a*s*l-i*c,O=s*i*l-a*c,_=i*i*l+u,V=a*i*l+s*c,L=s*a*l+i*c,F=i*a*l-s*c,G=a*a*l+u,t[0]=f*M+p*E+T*D,t[1]=h*M+y*E+v*D,t[2]=g*M+x*E+S*D,t[3]=d*M+m*E+w*D,t[4]=f*O+p*_+T*V,t[5]=h*O+y*_+v*V,t[6]=g*O+x*_+S*V,t[7]=d*O+m*_+w*V,t[8]=f*L+p*F+T*G,t[9]=h*L+y*F+v*G,t[10]=g*L+x*F+S*G,t[11]=d*L+m*F+w*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Wl(t,e,n){var r=Math.sin(n),s=Math.cos(n),i=e[4],a=e[5],o=e[6],c=e[7],u=e[8],l=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*s+u*r,t[5]=a*s+l*r,t[6]=o*s+f*r,t[7]=c*s+h*r,t[8]=u*s-i*r,t[9]=l*s-a*r,t[10]=f*s-o*r,t[11]=h*s-c*r,t}function Hl(t,e,n){var r=Math.sin(n),s=Math.cos(n),i=e[0],a=e[1],o=e[2],c=e[3],u=e[8],l=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s-u*r,t[1]=a*s-l*r,t[2]=o*s-f*r,t[3]=c*s-h*r,t[8]=i*r+u*s,t[9]=a*r+l*s,t[10]=o*r+f*s,t[11]=c*r+h*s,t}function Il(t,e,n){var r=Math.sin(n),s=Math.cos(n),i=e[0],a=e[1],o=e[2],c=e[3],u=e[4],l=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s+u*r,t[1]=a*s+l*r,t[2]=o*s+f*r,t[3]=c*s+h*r,t[4]=u*s-i*r,t[5]=l*s-a*r,t[6]=f*s-o*r,t[7]=h*s-c*r,t}function ty(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ny(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ry(t,e,n){var r=n[0],s=n[1],i=n[2],a=Math.hypot(r,s,i),o,c,u;return a<ye?null:(a=1/a,r*=a,s*=a,i*=a,o=Math.sin(e),c=Math.cos(e),u=1-c,t[0]=r*r*u+c,t[1]=s*r*u+i*o,t[2]=i*r*u-s*o,t[3]=0,t[4]=r*s*u-i*o,t[5]=s*s*u+c,t[6]=i*s*u+r*o,t[7]=0,t[8]=r*i*u+s*o,t[9]=s*i*u-r*o,t[10]=i*i*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function a2(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o2(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c2(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sy(t,e,n){var r=e[0],s=e[1],i=e[2],a=e[3],o=r+r,c=s+s,u=i+i,l=r*o,f=r*c,h=r*u,g=s*c,d=s*u,p=i*u,y=a*o,x=a*c,m=a*u;return t[0]=1-(g+p),t[1]=f+m,t[2]=h-x,t[3]=0,t[4]=f-m,t[5]=1-(l+p),t[6]=d+y,t[7]=0,t[8]=h+x,t[9]=d-y,t[10]=1-(l+g),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function u2(t,e){var n=new rt(3),r=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],l=e[7],f=r*r+s*s+i*i+a*a;return f>0?(n[0]=(o*a+l*r+c*i-u*s)*2/f,n[1]=(c*a+l*s+u*r-o*i)*2/f,n[2]=(u*a+l*i+o*s-c*r)*2/f):(n[0]=(o*a+l*r+c*i-u*s)*2,n[1]=(c*a+l*s+u*r-o*i)*2,n[2]=(u*a+l*i+o*s-c*r)*2),sy(t,e,n),t}function f2(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function iy(t,e){var n=e[0],r=e[1],s=e[2],i=e[4],a=e[5],o=e[6],c=e[8],u=e[9],l=e[10];return t[0]=Math.hypot(n,r,s),t[1]=Math.hypot(i,a,o),t[2]=Math.hypot(c,u,l),t}function Mf(t,e){var n=new rt(3);iy(n,e);var r=1/n[0],s=1/n[1],i=1/n[2],a=e[0]*r,o=e[1]*s,c=e[2]*i,u=e[4]*r,l=e[5]*s,f=e[6]*i,h=e[8]*r,g=e[9]*s,d=e[10]*i,p=a+l+d,y=0;return p>0?(y=Math.sqrt(p+1)*2,t[3]=.25*y,t[0]=(f-g)/y,t[1]=(h-c)/y,t[2]=(o-u)/y):a>l&&a>d?(y=Math.sqrt(1+a-l-d)*2,t[3]=(f-g)/y,t[0]=.25*y,t[1]=(o+u)/y,t[2]=(h+c)/y):l>d?(y=Math.sqrt(1+l-a-d)*2,t[3]=(h-c)/y,t[0]=(o+u)/y,t[1]=.25*y,t[2]=(f+g)/y):(y=Math.sqrt(1+d-a-l)*2,t[3]=(o-u)/y,t[0]=(h+c)/y,t[1]=(f+g)/y,t[2]=.25*y),t}function ay(t,e,n,r){var s=e[0],i=e[1],a=e[2],o=e[3],c=s+s,u=i+i,l=a+a,f=s*c,h=s*u,g=s*l,d=i*u,p=i*l,y=a*l,x=o*c,m=o*u,T=o*l,v=r[0],S=r[1],w=r[2];return t[0]=(1-(d+y))*v,t[1]=(h+T)*v,t[2]=(g-m)*v,t[3]=0,t[4]=(h-T)*S,t[5]=(1-(f+y))*S,t[6]=(p+x)*S,t[7]=0,t[8]=(g+m)*w,t[9]=(p-x)*w,t[10]=(1-(f+d))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function l2(t,e,n,r,s){var i=e[0],a=e[1],o=e[2],c=e[3],u=i+i,l=a+a,f=o+o,h=i*u,g=i*l,d=i*f,p=a*l,y=a*f,x=o*f,m=c*u,T=c*l,v=c*f,S=r[0],w=r[1],M=r[2],E=s[0],D=s[1],O=s[2],_=(1-(p+x))*S,V=(g+v)*S,L=(d-T)*S,F=(g-v)*w,G=(1-(h+x))*w,A=(y+m)*w,H=(d+T)*M,P=(y-m)*M,U=(1-(h+p))*M;return t[0]=_,t[1]=V,t[2]=L,t[3]=0,t[4]=F,t[5]=G,t[6]=A,t[7]=0,t[8]=H,t[9]=P,t[10]=U,t[11]=0,t[12]=n[0]+E-(_*E+F*D+H*O),t[13]=n[1]+D-(V*E+G*D+P*O),t[14]=n[2]+O-(L*E+A*D+U*O),t[15]=1,t}function Ko(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],a=n+n,o=r+r,c=s+s,u=n*a,l=r*a,f=r*o,h=s*a,g=s*o,d=s*c,p=i*a,y=i*o,x=i*c;return t[0]=1-f-d,t[1]=l+x,t[2]=h-y,t[3]=0,t[4]=l-x,t[5]=1-u-d,t[6]=g+p,t[7]=0,t[8]=h+y,t[9]=g-p,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h2(t,e,n,r,s,i,a){var o=1/(n-e),c=1/(s-r),u=1/(i-a);return t[0]=i*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*o,t[9]=(s+r)*c,t[10]=(a+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*u,t[15]=0,t}function oy(t,e,n,r,s){var i=1/Math.tan(e/2),a;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(r-s),t[10]=(s+r)*a,t[14]=2*s*r*a):(t[10]=-1,t[14]=-2*r),t}var g2=oy;function p2(t,e,n,r,s){var i=1/Math.tan(e/2),a;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(r-s),t[10]=s*a,t[14]=s*r*a):(t[10]=-1,t[14]=-r),t}function d2(t,e,n,r){var s=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+o),u=2/(s+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((a-o)*c*.5),t[9]=(s-i)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function cy(t,e,n,r,s,i,a){var o=1/(e-n),c=1/(r-s),u=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*o,t[13]=(s+r)*c,t[14]=(a+i)*u,t[15]=1,t}var uy=cy;function y2(t,e,n,r,s,i,a){var o=1/(e-n),c=1/(r-s),u=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+n)*o,t[13]=(s+r)*c,t[14]=i*u,t[15]=1,t}function fy(t,e,n,r){var s,i,a,o,c,u,l,f,h,g,d=e[0],p=e[1],y=e[2],x=r[0],m=r[1],T=r[2],v=n[0],S=n[1],w=n[2];return Math.abs(d-v)<ye&&Math.abs(p-S)<ye&&Math.abs(y-w)<ye?ce(t):(l=d-v,f=p-S,h=y-w,g=1/Math.hypot(l,f,h),l*=g,f*=g,h*=g,s=m*h-T*f,i=T*l-x*h,a=x*f-m*l,g=Math.hypot(s,i,a),g?(g=1/g,s*=g,i*=g,a*=g):(s=0,i=0,a=0),o=f*a-h*i,c=h*s-l*a,u=l*i-f*s,g=Math.hypot(o,c,u),g?(g=1/g,o*=g,c*=g,u*=g):(o=0,c=0,u=0),t[0]=s,t[1]=o,t[2]=l,t[3]=0,t[4]=i,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=h,t[11]=0,t[12]=-(s*d+i*p+a*y),t[13]=-(o*d+c*p+u*y),t[14]=-(l*d+f*p+h*y),t[15]=1,t)}function x2(t,e,n,r){var s=e[0],i=e[1],a=e[2],o=r[0],c=r[1],u=r[2],l=s-n[0],f=i-n[1],h=a-n[2],g=l*l+f*f+h*h;g>0&&(g=1/Math.sqrt(g),l*=g,f*=g,h*=g);var d=c*h-u*f,p=u*l-o*h,y=o*f-c*l;return g=d*d+p*p+y*y,g>0&&(g=1/Math.sqrt(g),d*=g,p*=g,y*=g),t[0]=d,t[1]=p,t[2]=y,t[3]=0,t[4]=f*y-h*p,t[5]=h*d-l*y,t[6]=l*p-f*d,t[7]=0,t[8]=l,t[9]=f,t[10]=h,t[11]=0,t[12]=s,t[13]=i,t[14]=a,t[15]=1,t}function T2(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function v2(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function m2(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function ly(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function S2(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function w2(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function C2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function M2(t,e){var n=t[0],r=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],u=t[7],l=t[8],f=t[9],h=t[10],g=t[11],d=t[12],p=t[13],y=t[14],x=t[15],m=e[0],T=e[1],v=e[2],S=e[3],w=e[4],M=e[5],E=e[6],D=e[7],O=e[8],_=e[9],V=e[10],L=e[11],F=e[12],G=e[13],A=e[14],H=e[15];return Math.abs(n-m)<=ye*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-T)<=ye*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(s-v)<=ye*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(i-S)<=ye*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(a-w)<=ye*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-M)<=ye*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(c-E)<=ye*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-D)<=ye*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(l-O)<=ye*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(f-_)<=ye*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(h-V)<=ye*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(g-L)<=ye*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(d-F)<=ye*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(p-G)<=ye*Math.max(1,Math.abs(p),Math.abs(G))&&Math.abs(y-A)<=ye*Math.max(1,Math.abs(y),Math.abs(A))&&Math.abs(x-H)<=ye*Math.max(1,Math.abs(x),Math.abs(H))}var Ef=Ye,E2=ly;const _f=Object.freeze(Object.defineProperty({__proto__:null,add:m2,adjoint:s2,clone:t2,copy:it,create:$l,determinant:i2,equals:M2,exactEquals:C2,frob:v2,fromQuat:Ko,fromQuat2:u2,fromRotation:ry,fromRotationTranslation:sy,fromRotationTranslationScale:ay,fromRotationTranslationScaleOrigin:l2,fromScaling:ny,fromTranslation:ty,fromValues:n2,fromXRotation:a2,fromYRotation:o2,fromZRotation:c2,frustum:h2,getRotation:Mf,getScaling:iy,getTranslation:f2,identity:ce,invert:wt,lookAt:fy,mul:Ef,multiply:Ye,multiplyScalar:S2,multiplyScalarAndAdd:w2,ortho:uy,orthoNO:cy,orthoZO:y2,perspective:g2,perspectiveFromFieldOfView:d2,perspectiveNO:oy,perspectiveZO:p2,rotate:Pt,rotateX:Wl,rotateY:Hl,rotateZ:Il,scale:hs,set:r2,str:T2,sub:E2,subtract:ly,targetTo:x2,translate:Ae,transpose:Le},Symbol.toStringTag,{value:"Module"}));function hy(){var t=new rt(3);return rt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Rf(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function vg(t,e,n){var r=new rt(3);return r[0]=t,r[1]=e,r[2]=n,r}function Cn(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Ai(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function wr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function dr(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function _2(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function _r(t,e){var n=e[0],r=e[1],s=e[2],i=n*n+r*r+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function jl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xs(t,e,n){var r=e[0],s=e[1],i=e[2],a=n[0],o=n[1],c=n[2];return t[0]=s*c-i*o,t[1]=i*a-r*c,t[2]=r*o-s*a,t}function we(t,e,n){var r=e[0],s=e[1],i=e[2],a=n[3]*r+n[7]*s+n[11]*i+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*s+n[8]*i+n[12])/a,t[1]=(n[1]*r+n[5]*s+n[9]*i+n[13])/a,t[2]=(n[2]*r+n[6]*s+n[10]*i+n[14])/a,t}function mg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Sg(t,e){var n=t[0],r=t[1],s=t[2],i=e[0],a=e[1],o=e[2];return Math.abs(n-i)<=ye*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-a)<=ye*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-o)<=ye*Math.max(1,Math.abs(s),Math.abs(o))}var Of=wr,gy=Rf;(function(){var t=hy();return function(e,n,r,s,i,a){var o,c;for(n||(n=3),r||(r=0),s?c=Math.min(s*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function R2(){var t=new rt(4);return rt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function O2(t,e,n,r){var s=new rt(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=r,s}function D2(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],a=n*n+r*r+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=s*a,t[3]=i*a,t}function Ba(t,e,n){var r=e[0],s=e[1],i=e[2],a=e[3];return t[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*a,t[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*a,t[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*a,t[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*a,t}(function(){var t=R2();return function(e,n,r,s,i,a){var o,c;for(n||(n=4),r||(r=0),s?c=Math.min(s*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function gs(){var t=new rt(4);return rt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Pl(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function b2(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>ye?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function wg(t,e,n){var r=e[0],s=e[1],i=e[2],a=e[3],o=n[0],c=n[1],u=n[2],l=n[3];return t[0]=r*l+a*o+s*u-i*c,t[1]=s*l+a*c+i*o-r*u,t[2]=i*l+a*u+r*c-s*o,t[3]=a*l-r*o-s*c-i*u,t}function ko(t,e,n,r){var s=e[0],i=e[1],a=e[2],o=e[3],c=n[0],u=n[1],l=n[2],f=n[3],h,g,d,p,y;return g=s*c+i*u+a*l+o*f,g<0&&(g=-g,c=-c,u=-u,l=-l,f=-f),1-g>ye?(h=Math.acos(g),d=Math.sin(h),p=Math.sin((1-r)*h)/d,y=Math.sin(r*h)/d):(p=1-r,y=r),t[0]=p*s+y*c,t[1]=p*i+y*u,t[2]=p*a+y*l,t[3]=p*o+y*f,t}function L2(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function V2(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;r=Math.sqrt(e[s*3+s]-e[i*3+i]-e[a*3+a]+1),t[s]=.5*r,r=.5/r,t[3]=(e[i*3+a]-e[a*3+i])*r,t[i]=(e[i*3+s]+e[s*3+i])*r,t[a]=(e[a*3+s]+e[s*3+a])*r}return t}var Cg=O2,py=D2;(function(){var t=hy(),e=vg(1,0,0),n=vg(0,1,0);return function(r,s,i){var a=jl(s,i);return a<-.999999?(Xs(t,e,s),gy(t)<1e-6&&Xs(t,n,s),_r(t,t),Pl(r,t,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Xs(t,s,i),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+a,py(r,r))}})();(function(){var t=gs(),e=gs();return function(n,r,s,i,a,o){return ko(t,r,a,o),ko(e,s,i,o),ko(n,t,e,2*o*(1-o)),n}})();(function(){var t=Z0();return function(e,n,r,s){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],py(e,V2(e,t))}})();var Ut=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function F2(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){if(this instanceof r){var s=[null];s.push.apply(s,arguments);var i=Function.bind.apply(e,s);return new i}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var dy=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,s,i;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(s=r;s--!==0;)if(!t(e[s],n[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(n).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[s]))return!1;for(s=r;s--!==0;){var a=i[s];if(!t(e[a],n[a]))return!1}return!0}return e!==e&&n!==n},Mg=Object.prototype.toString,yy=function(e){var n=Mg.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Mg.call(e.callee)==="[object Function]"),r},Qc,Eg;function B2(){if(Eg)return Qc;Eg=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=yy,s=Object.prototype.propertyIsEnumerable,i=!s.call({toString:null},"toString"),a=s.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(h){var g=h.constructor;return g&&g.prototype===h},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},l=function(){if(typeof window>"u")return!1;for(var h in window)try{if(!u["$"+h]&&e.call(window,h)&&window[h]!==null&&typeof window[h]=="object")try{c(window[h])}catch{return!0}}catch{return!0}return!1}(),f=function(h){if(typeof window>"u"||!l)return c(h);try{return c(h)}catch{return!1}};t=function(g){var d=g!==null&&typeof g=="object",p=n.call(g)==="[object Function]",y=r(g),x=d&&n.call(g)==="[object String]",m=[];if(!d&&!p&&!y)throw new TypeError("Object.keys called on a non-object");var T=a&&p;if(x&&g.length>0&&!e.call(g,0))for(var v=0;v<g.length;++v)m.push(String(v));if(y&&g.length>0)for(var S=0;S<g.length;++S)m.push(String(S));else for(var w in g)!(T&&w==="prototype")&&e.call(g,w)&&m.push(String(w));if(i)for(var M=f(g),E=0;E<o.length;++E)!(M&&o[E]==="constructor")&&e.call(g,o[E])&&m.push(o[E]);return m}}return Qc=t,Qc}var k2=Array.prototype.slice,N2=yy,_g=Object.keys,No=_g?function(e){return _g(e)}:B2(),Rg=Object.keys;No.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return N2(r)?Rg(k2.call(r)):Rg(r)})}else Object.keys=No;return Object.keys||No};var U2=No,G2=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;e[n]=s;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,n);if(a.value!==s||a.enumerable!==!0)return!1}return!0},Og=typeof Symbol<"u"&&Symbol,A2=G2,z2=function(){return typeof Og!="function"||typeof Symbol!="function"||typeof Og("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:A2()},$2="Function.prototype.bind called on incompatible ",Jc=Array.prototype.slice,W2=Object.prototype.toString,H2="[object Function]",I2=function(e){var n=this;if(typeof n!="function"||W2.call(n)!==H2)throw new TypeError($2+n);for(var r=Jc.call(arguments,1),s,i=function(){if(this instanceof s){var l=n.apply(this,r.concat(Jc.call(arguments)));return Object(l)===l?l:this}else return n.apply(e,r.concat(Jc.call(arguments)))},a=Math.max(0,n.length-r.length),o=[],c=0;c<a;c++)o.push("$"+c);if(s=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this,arguments); }")(i),n.prototype){var u=function(){};u.prototype=n.prototype,s.prototype=new u,u.prototype=null}return s},j2=I2,xy=Function.prototype.bind||j2,P2=xy,K2=P2.call(Function.call,Object.prototype.hasOwnProperty),ge,ri=SyntaxError,Ty=Function,Ys=TypeError,eu=function(t){try{return Ty('"use strict"; return ('+t+").constructor;")()}catch{}},as=Object.getOwnPropertyDescriptor;if(as)try{as({},"")}catch{as=null}var tu=function(){throw new Ys},X2=as?function(){try{return arguments.callee,tu}catch{try{return as(arguments,"callee").get}catch{return tu}}}():tu,ms=z2(),Mn=Object.getPrototypeOf||function(t){return t.__proto__},As={},Y2=typeof Uint8Array>"u"?ge:Mn(Uint8Array),os={"%AggregateError%":typeof AggregateError>"u"?ge:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?ge:ArrayBuffer,"%ArrayIteratorPrototype%":ms?Mn([][Symbol.iterator]()):ge,"%AsyncFromSyncIteratorPrototype%":ge,"%AsyncFunction%":As,"%AsyncGenerator%":As,"%AsyncGeneratorFunction%":As,"%AsyncIteratorPrototype%":As,"%Atomics%":typeof Atomics>"u"?ge:Atomics,"%BigInt%":typeof BigInt>"u"?ge:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?ge:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?ge:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?ge:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?ge:Float32Array,"%Float64Array%":typeof Float64Array>"u"?ge:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?ge:FinalizationRegistry,"%Function%":Ty,"%GeneratorFunction%":As,"%Int8Array%":typeof Int8Array>"u"?ge:Int8Array,"%Int16Array%":typeof Int16Array>"u"?ge:Int16Array,"%Int32Array%":typeof Int32Array>"u"?ge:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ms?Mn(Mn([][Symbol.iterator]())):ge,"%JSON%":typeof JSON=="object"?JSON:ge,"%Map%":typeof Map>"u"?ge:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ms?ge:Mn(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?ge:Promise,"%Proxy%":typeof Proxy>"u"?ge:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?ge:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?ge:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ms?ge:Mn(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?ge:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ms?Mn(""[Symbol.iterator]()):ge,"%Symbol%":ms?Symbol:ge,"%SyntaxError%":ri,"%ThrowTypeError%":X2,"%TypedArray%":Y2,"%TypeError%":Ys,"%Uint8Array%":typeof Uint8Array>"u"?ge:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?ge:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?ge:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?ge:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?ge:WeakMap,"%WeakRef%":typeof WeakRef>"u"?ge:WeakRef,"%WeakSet%":typeof WeakSet>"u"?ge:WeakSet};try{null.error}catch(t){var q2=Mn(Mn(t));os["%Error.prototype%"]=q2}var Z2=function t(e){var n;if(e==="%AsyncFunction%")n=eu("async function () {}");else if(e==="%GeneratorFunction%")n=eu("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=eu("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var s=t("%AsyncGenerator%");s&&(n=Mn(s.prototype))}return os[e]=n,n},Dg={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ma=xy,Xo=K2,Q2=ma.call(Function.call,Array.prototype.concat),J2=ma.call(Function.apply,Array.prototype.splice),bg=ma.call(Function.call,String.prototype.replace),Yo=ma.call(Function.call,String.prototype.slice),eC=ma.call(Function.call,RegExp.prototype.exec),tC=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,nC=/\\(\\)?/g,rC=function(e){var n=Yo(e,0,1),r=Yo(e,-1);if(n==="%"&&r!=="%")throw new ri("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new ri("invalid intrinsic syntax, expected opening `%`");var s=[];return bg(e,tC,function(i,a,o,c){s[s.length]=o?bg(c,nC,"$1"):a||i}),s},sC=function(e,n){var r=e,s;if(Xo(Dg,r)&&(s=Dg[r],r="%"+s[0]+"%"),Xo(os,r)){var i=os[r];if(i===As&&(i=Z2(r)),typeof i>"u"&&!n)throw new Ys("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:s,name:r,value:i}}throw new ri("intrinsic "+e+" does not exist!")},iC=function(e,n){if(typeof e!="string"||e.length===0)throw new Ys("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new Ys('"allowMissing" argument must be a boolean');if(eC(/^%?[^%]*%?$/,e)===null)throw new ri("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=rC(e),s=r.length>0?r[0]:"",i=sC("%"+s+"%",n),a=i.name,o=i.value,c=!1,u=i.alias;u&&(s=u[0],J2(r,Q2([0,1],u)));for(var l=1,f=!0;l<r.length;l+=1){var h=r[l],g=Yo(h,0,1),d=Yo(h,-1);if((g==='"'||g==="'"||g==="`"||d==='"'||d==="'"||d==="`")&&g!==d)throw new ri("property names with quotes must have matching quotes");if((h==="constructor"||!f)&&(c=!0),s+="."+h,a="%"+s+"%",Xo(os,a))o=os[a];else if(o!=null){if(!(h in o)){if(!n)throw new Ys("base intrinsic for "+e+" exists, but the property is not available.");return}if(as&&l+1>=r.length){var p=as(o,h);f=!!p,f&&"get"in p&&!("originalValue"in p.get)?o=p.get:o=o[h]}else f=Xo(o,h),o=o[h];f&&!c&&(os[a]=o)}}return o},aC=iC,Df=aC("%Object.defineProperty%",!0),bf=function(){if(Df)try{return Df({},"a",{value:1}),!0}catch{return!1}return!1};bf.hasArrayLengthDefineBug=function(){if(!bf())return null;try{return Df([],"length",{value:1}).length!==1}catch{return!0}};var oC=bf,cC=U2,uC=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",fC=Object.prototype.toString,lC=Array.prototype.concat,vy=Object.defineProperty,hC=function(t){return typeof t=="function"&&fC.call(t)==="[object Function]"},gC=oC(),my=vy&&gC,pC=function(t,e,n,r){e in t&&(!hC(r)||!r())||(my?vy(t,e,{configurable:!0,enumerable:!1,value:n,writable:!0}):t[e]=n)},Sy=function(t,e){var n=arguments.length>2?arguments[2]:{},r=cC(e);uC&&(r=lC.call(r,Object.getOwnPropertySymbols(e)));for(var s=0;s<r.length;s+=1)pC(t,r[s],e[r[s]],n[r[s]])};Sy.supportsDescriptors=!!my;var wy=Sy,qo={},nu={get exports(){return qo},set exports(t){qo=t}};typeof self<"u"?nu.exports=self:typeof window<"u"?nu.exports=window:nu.exports=Function("return this")();var dC=qo,Cy=function(){return typeof Ut!="object"||!Ut||Ut.Math!==Math||Ut.Array!==Array?dC:Ut},yC=wy,xC=Cy,TC=function(){var e=xC();if(yC.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(e,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},vC=wy,mC=qo,My=Cy,SC=TC,wC=My(),Ey=function(){return wC};vC(Ey,{getPolyfill:My,implementation:mC,shim:SC});var CC=Ey;const Yt=CC(),_y={vtkObject:()=>null};function an(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Yt.console&&Yt.console.error&&Yt.console.error("Invalid VTK object"),null;const e=_y[t.vtkClass];if(!e)return Yt.console&&Yt.console.error&&Yt.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(s=>{n[s]&&typeof n[s]=="object"&&n[s].vtkClass&&(n[s]=an(n[s]))});const r=e(n);return r&&r.modified&&r.modified(),r}function MC(t,e){_y[t]=e}an.register=MC;class ru extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let Lf=0;const Ry=Symbol("void");function EC(){return Lf}const Oy={};function Jr(){}const _C=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];_C.forEach(t=>{Oy[t]=Jr});Yt.console=console.hasOwnProperty("log")?console:Oy;const Dr={debug:Jr,error:Yt.console.error||Jr,info:Yt.console.info||Jr,log:Yt.console.log||Jr,warn:Yt.console.warn||Jr};function Dy(t,e){Dr[t]&&(Dr[t]=e||Jr)}function by(){Dr.log(...arguments)}function Ly(){Dr.info(...arguments)}function Zo(){Dr.debug(...arguments)}function oe(){Dr.error(...arguments)}function Fc(){Dr.warn(...arguments)}const Lg={};function Vy(t){Lg[t]||(Dr.error(t),Lg[t]=!0)}const pt=Object.create(null);pt.Float32Array=Float32Array;pt.Float64Array=Float64Array;pt.Uint8Array=Uint8Array;pt.Int8Array=Int8Array;pt.Uint16Array=Uint16Array;pt.Int16Array=Int16Array;pt.Uint32Array=Uint32Array;pt.Int32Array=Int32Array;pt.Uint8ClampedArray=Uint8ClampedArray;try{pt.BigInt64Array=BigInt64Array,pt.BigUint64Array=BigUint64Array}catch{}function pi(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(pt[t]||Float64Array)(...n)}function Kl(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(pt[t]||Float64Array).from(...n)}function Bc(t){return t.charAt(0).toUpperCase()+t.slice(1)}function ke(t){return Bc(t[0]==="_"?t.slice(1):t)}function Fy(t){return t.charAt(0).toLowerCase()+t.slice(1)}function By(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let s=Number(t),i="B";for(;s>n;)s/=n,i=r.pop();return`${s.toFixed(e)} ${i}`}function ky(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function Ny(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function RC(t){return Object.values(pt).some(e=>t instanceof e)}function OC(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function DC(t,e){return Object.keys(t).find(n=>t[n]===e)}function Uy(t){return t&&t.isA?t.getState():t}function Xl(t){setTimeout(t,0)}function Gy(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function st(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ny(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++Lf),!("classHierarchy"in e))e.classHierarchy=new ru("vtkObject");else if(!(e.classHierarchy instanceof ru)){const i=new ru;for(let a=0;a<e.classHierarchy.length;a++)i.push(e.classHierarchy[a]);e.classHierarchy=i}function r(i){n[i]=null}function s(i){function a(){r(i)}return Object.freeze({unsubscribe:a})}return t.isDeleted=()=>!!e.deleted,t.modified=i=>{if(e.deleted){oe("instance deleted - cannot call any method");return}i&&i<t.getMTime()||(e.mtime=++Lf,n.forEach(a=>a&&a(t)))},t.onModified=i=>{if(e.deleted)return oe("instance deleted - cannot call any method"),null;const a=n.length;return n.push(i),s(a)},t.getMTime=()=>e.mtime,t.isA=i=>{let a=e.classHierarchy.length;for(;a--;)if(e.classHierarchy[a]===i)return!0;return!1},t.getClassName=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-i]},t.set=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(i).forEach(u=>{const l=o?null:t[`set${Bc(u)}`];l&&Array.isArray(i[u])&&l.length>1?c=l(...i[u])||c:l?c=l(i[u])||c:(["mtime"].indexOf(u)===-1&&!a&&Fc(`Warning: Set value to model directly ${u}, ${i[u]}`),c=e[u]!==i[u]||c,e[u]=i[u])}),c},t.get=function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];if(!a.length)return e;const c={};return a.forEach(u=>{c[u]=e[u]}),c},t.getReferenceByName=i=>e[i],t.delete=()=>{Object.keys(e).forEach(i=>delete e[i]),n.forEach((i,a)=>r(a)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const i={...e,vtkClass:t.getClassName()};Object.keys(i).forEach(o=>{i[o]===null||i[o]===void 0||o[0]==="_"?delete i[o]:i[o].isA?i[o]=i[o].getState():Array.isArray(i[o])?i[o]=i[o].map(Uy):RC(i[o])&&(i[o]=Array.from(i[o]))});const a={};return Object.keys(i).sort().forEach(o=>{a[o]=i[o]}),a.mtime&&delete a.mtime,a},t.shallowCopy=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${i.getClassName()} into ${t.getClassName()}`);const o=i.get(),c=Object.keys(e).sort();Object.keys(o).sort().forEach(l=>{const f=c.indexOf(l);f===-1?a&&Zo(`add ${l} in shallowCopy`):c.splice(f,1),e[l]=o[l]}),c.length&&a&&Zo(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const bC={object(t,e,n){return function(){return{...e[n.name]}}}};function Ct(t,e,n){n.forEach(r=>{if(typeof r=="object"){const s=bC[r.type];s?t[`get${ke(r.name)}`]=s(t,e,r):t[`get${ke(r.name)}`]=()=>e[r.name]}else t[`get${ke(r)}`]=()=>e[r]})}const Ay={enum(t,e,n){const r=`_on${ke(n.name)}Changed`;return s=>{var i;if(typeof s=="string"){if(n.enum[s]!==void 0)return e[n.name]!==n.enum[s]?(e[n.name]=n.enum[s],t.modified(),!0):!1;throw oe(`Set Enum with invalid argument ${n}, ${s}`),new RangeError("Set Enum with invalid string argument")}if(typeof s=="number"){if(e[n.name]!==s){if(Object.keys(n.enum).map(a=>n.enum[a]).indexOf(s)!==-1){const a=e[n.name];return e[n.name]=s,(i=e[r])==null||i.call(e,t,e,s,a),t.modified(),!0}throw oe(`Set Enum outside numeric range ${n}, ${s}`),new RangeError("Set Enum outside numeric range")}return!1}throw oe(`Set Enum with invalid argument (String/Number) ${n}, ${s}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){var s;((s=n.params)==null?void 0:s.length)===1&&Fc('Setter of type "object" with a single "param" field is not supported');const r=`_on${ke(n.name)}Changed`;return function(){var u,l;for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];let c;if(a.length>1&&((u=n.params)!=null&&u.length)?c=n.params.reduce((f,h,g)=>Object.assign(f,{[h]:a[g]}),{}):c=a[0],!dy(e[n.name],c)){const f=e[n.name];return e[n.name]=c,(l=e[r])==null||l.call(e,t,e,c,f),t.modified(),!0}return!1}}};function Vg(t){if(typeof t=="object"){const e=Ay[t.type];if(e)return(n,r)=>e(n,r,t);throw oe(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const s=`_on${ke(t)}Changed`;return function(a){var o;if(r.deleted)return oe("instance deleted - cannot call any method"),!1;if(r[t]!==a){const c=r[t.name];return r[t]=a,(o=r[s])==null||o.call(r,n,r,a,c),n.modified(),!0}return!1}}}function Sa(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${ke(r.name)}`]=Vg(r)(t,e):t[`set${ke(r)}`]=Vg(r)(t,e)})}function Ze(t,e,n){Ct(t,e,n),Sa(t,e,n)}function di(t,e,n){n.forEach(r=>{t[`get${ke(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${ke(r)}ByReference`]=()=>e[r]})}function Yl(t,e,n,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(i=>{if(e[i]&&r&&e[i].length!==r)throw new RangeError(`Invalid initial number of values for array (${i})`);const a=`_on${ke(i)}Changed`;t[`set${ke(i)}`]=function(){var g;if(e.deleted)return oe("instance deleted - cannot call any method"),!1;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];let l=c,f,h=!1;if(l.length===1&&(l[0]==null||l[0].length>=0)&&(l=l[0],h=!0),l==null)f=e[i]!==l;else{if(r&&l.length!==r)if(l.length<r&&s!==void 0)for(l=Array.from(l),h=!1;l.length<r;)l.push(s);else throw new RangeError(`Invalid number of values for array setter (${i})`);f=e[i]==null||e[i].length!==l.length;for(let d=0;!f&&d<l.length;++d)f=e[i][d]!==l[d];f&&h&&(l=Array.from(l))}if(f){const d=e[i.name];e[i]=l,(g=e[a])==null||g.call(e,t,e,l,d),t.modified()}return f},t[`set${ke(i)}From`]=o=>{const c=e[i];o.forEach((u,l)=>{c[l]=u})}})}function ql(t,e,n,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;di(t,e,n),Yl(t,e,n,r,s)}function wa(t,e,n){for(let r=0;r<n.length;r++){const s=n[r];e[s]!==void 0&&(e[`_${s}`]=e[s],delete e[s])}}function zy(t,e,n,r){e.inputData?e.inputData=e.inputData.map(an):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(an):e.inputConnection=[],e.output?e.output=e.output.map(an):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(an):e.inputArrayToProcess=[],e.numberOfInputs=n;function s(g){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){oe("instance deleted - cannot call any method");return}if(d>=e.numberOfInputs){oe(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[d]!==g||e.inputConnection[d])&&(e.inputData[d]=g,e.inputConnection[d]=null,t.modified&&t.modified())}function i(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[g]&&(e.inputData[g]=e.inputConnection[g]()),e.inputData[g]}function a(g){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){oe("instance deleted - cannot call any method");return}if(d>=e.numberOfInputs){let p=`algorithm ${t.getClassName()} only has `;p+=`${e.numberOfInputs}`,p+=" input ports. To add more input ports, use addInputConnection()",oe(p);return}e.inputData[d]=null,e.inputConnection[d]=g}function o(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[g]}function c(){let g=e.numberOfInputs;for(;g&&!e.inputData[g-1]&&!e.inputConnection[g-1];)g--;return g===e.numberOfInputs&&e.numberOfInputs++,g}function u(g){if(e.deleted){oe("instance deleted - cannot call any method");return}a(g,c())}function l(g){if(e.deleted){oe("instance deleted - cannot call any method");return}s(g,c())}function f(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(oe("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[g])}t.shouldUpdate=()=>{var y,x;const g=t.getMTime();let d=1/0,p=r;for(;p--;){if(!e.output[p]||e.output[p].isDeleted())return!0;const m=e.output[p].getMTime();if(m<g)return!0;m<d&&(d=m)}for(p=e.numberOfInputs;p--;)if((y=e.inputConnection[p])!=null&&y.filter.shouldUpdate()||((x=t.getInputData(p))==null?void 0:x.getMTime())>d)return!0;return!1};function h(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const d=()=>f(g);return d.filter=t,d}if(e.numberOfInputs){let g=e.numberOfInputs;for(;g--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=s,t.setInputConnection=a,t.addInputData=l,t.addInputConnection=u,t.getInputData=i,t.getInputConnection=o}r&&(t.getOutputData=f,t.getOutputPort=h),t.update=()=>{const g=[];if(e.numberOfInputs){let d=0;for(;d<e.numberOfInputs;)g[d]=t.getInputData(d),d++}t.shouldUpdate()&&t.requestData&&t.requestData(g,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=g=>{const d=e.inputArrayToProcess[g],p=e.inputData[g];return d&&p?p[`get${d.fieldAssociation}`]().getArray(d.arrayName):null},t.setInputArrayToProcess=function(g,d,p){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<g;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[g]={arrayName:d,fieldAssociation:p,attributeType:y}}}const Zl=Symbol("Event abort");function $y(t,e,n){const r=[],s=t.delete;let i=1;function a(u){for(let l=0;l<r.length;++l){const[f]=r[l];if(f===u){r.splice(l,1);return}}}function o(u){function l(){a(u)}return Object.freeze({unsubscribe:l})}function c(){if(e.deleted){oe("instance deleted - cannot call any method");return}const u=r.slice();for(let l=0;l<u.length;++l){const[,f,h]=u[l];if(f){if(h<0)setTimeout(()=>f.apply(t,arguments),1-h);else if(f.apply(t,arguments)===Zl)break}}}t[`invoke${ke(n)}`]=c,t[`on${ke(n)}`]=function(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!u.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return oe("instance deleted - cannot call any method"),null;const f=i++;return r.push([f,u,l]),r.sort((h,g)=>g[2]-h[2]),o(f)},t.delete=()=>{s(),r.forEach(u=>{let[l]=u;return a(l)})}}function Re(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s={},i={};return t(i,s,r),Object.freeze(i)};return e&&an.register(e,n),n}function Wy(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return e.filter(a=>!!a).map(a=>a(...s))}}function Ql(t){return t&&t.isA&&t.isA("vtkObject")}function Qo(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Ql(t)){if(r.indexOf(t)>=0)return n;r.push(t);const s=e(t);s!==void 0&&n.push(s);const i=t.get();Object.keys(i).forEach(a=>{const o=i[a];Array.isArray(o)?o.forEach(c=>{Qo(c,e,n,r)}):Qo(o,e,n,r)})}return n}function Hy(t,e,n){var r=this;let s;const i=function(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];const u=r,l=()=>{s=null,n||t.apply(u,o)},f=n&&!s;clearTimeout(s),s=setTimeout(l,e),f&&t.apply(u,o)};return i.cancel=()=>clearTimeout(s),i}function Iy(t,e){let n=!1,r=null;function s(){n=!1,r!==null&&(i(...r),r=null)}function i(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];if(n){r=o;return}n=!0,t(...o),setTimeout(s,e)}return i}function Jl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,s)=>{e.keystore[r]=s},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let LC=1;const ka="__root__";function jy(t,e){Jl(t,e);const n=t.delete;e.proxyId=`${LC++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),Ct(t,e,["proxyId","proxyGroup","proxyName"]),Ze(t,e,["proxyManager"]);const r={},s={};function i(u,l){s[l]||(s[l]=[]);const f=s[l];for(let h=0;h<u.length;h++)f.push(u[h].name),r[u[h].name]=u[h],u[h].children&&u[h].children.length&&i(u[h].children,u[h].name)}i(e.ui,ka),t.updateUI=u=>{e.ui=JSON.parse(JSON.stringify(u||[])),Object.keys(r).forEach(l=>delete r[l]),Object.keys(s).forEach(l=>delete s[l]),i(e.ui,ka),t.modified()};function a(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ka;return s[u]}t.updateProxyProperty=(u,l)=>{const f=r[u];f?Object.assign(f,l):r[u]={...l}},t.activate=()=>{if(e.proxyManager){const u=`setActive${ke(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[u]&&e.proxyManager[u](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(u,l)=>{l in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[l]=[]),e.propertyLinkSubscribers[l].push(u)},t.gcPropertyLinks=u=>{const l=e.propertyLinkSubscribers[u]||[];for(;l.length;)l.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(u){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[u])return e.propertyLinkMap[u];let f=null;const h=[];let g=0,d=!1;function p(v){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(d)return null;const w=[];let M=null;for(g=h.length;g--;){const D=h[g];D.instance===v?M=D:w.push(D)}if(!M)return null;const E=M.instance[`get${ke(M.propertyName)}`]();if(!OC(E,f)||S){for(f=E,d=!0;w.length;){const D=w.pop();D.instance.set({[D.propertyName]:f})}d=!1}return e.propertyLinkMap[u].persistent&&(e.propertyLinkMap[u].value=E),E}function y(v,S){const w=[];for(g=h.length;g--;){const M=h[g];M.instance===v&&(M.propertyName===S||S===void 0)&&(M.subscription.unsubscribe(),w.push(g))}for(;w.length;)h.splice(w.pop(),1)}function x(v,S){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const M=v.onModified(p),E=h[0];return h.push({instance:v,propertyName:S,subscription:M}),w&&(e.propertyLinkMap[u].persistent&&e.propertyLinkMap[u].value!==void 0?v.set({[S]:e.propertyLinkMap[u].value}):E&&p(E.instance,!0)),{unsubscribe:()=>y(v,S)}}function m(){for(;h.length;)h.pop().subscription.unsubscribe()}const T={bind:x,unbind:y,unsubscribe:m,persistent:l};return e.propertyLinkMap[u]=T,T};function o(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ka;const l=[],f=e.proxyId,h=a(u)||[];for(let g=0;g<h.length;g++){const d=h[g],p=t[`get${ke(d)}`],y=p?p():void 0,x={id:f,name:d,value:y},m=o(d);m.length&&(x.children=m),l.push(x)}return l}t.listPropertyNames=()=>o().map(u=>u.name),t.getPropertyByName=u=>o().find(l=>l.name===u),t.getPropertyDomainByName=u=>(r[u]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:o()}),t.delete=()=>{const u=Object.keys(e.propertyLinkMap);let l=u.length;for(;l--;)e.propertyLinkMap[u[l]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let u=0;u<e.links.length;u++){const{link:l,property:f,persistent:h,updateOnBind:g,type:d}=e.links[u];if(d==="application"){const p=e.proxyManager.getPropertyLink(l,h);t.registerPropertyLinkForGC(p,"application"),p.bind(t,f,g)}}}Xl(c)}function Py(t,e,n){const r=t.delete,s=[],i=Object.keys(n);let a=i.length;for(;a--;){const o=i[a],{modelKey:c,property:u,modified:l=!0}=n[o],f=ke(u),h=ke(o);t[`get${h}`]=e[c][`get${f}`],t[`set${h}`]=e[c][`set${f}`],l&&s.push(e[c].onModified(t.modified))}t.delete=()=>{for(;s.length;)s.pop().unsubscribe();r()}}function Ky(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function s(o){const c=Object.keys(o);let u=c.length;for(;u--;){const l=c[u];e[l].set(o[l])}}const i=Object.keys(r);let a=i.length;for(;a--;){const o=i[a];e[o]=r[o];const c=n[o];t[`set${ke(o)}`]=u=>{if(u!==e[o]){e[o]=u;const l=c[u];s(l),t.modified()}}}i.length&&Ct(t,e,i)}const Fg=10,Bg=40,kg=800;function Xy(t){let e=0,n=0,r=0,s=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*Fg,s=n*Fg,"deltaY"in t&&(s=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||s)&&t.deltaMode&&(t.deltaMode===1?(r*=Bg,s*=Bg):(r*=kg,s*=kg)),r&&!e&&(e=r<1?-1:1),s&&!n&&(n=s<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:s||r}}var C={algo:zy,capitalize:Bc,chain:Wy,debounce:Hy,enumToString:DC,event:$y,EVENT_ABORT:Zl,formatBytesToProperUnit:By,formatNumbersWithThousandSeparator:ky,get:Ct,getArray:di,getCurrentGlobalMTime:EC,getStateArrayMapFunc:Uy,isVtkObject:Ql,keystore:Jl,measurePromiseExecution:Gy,moveToProtected:wa,newInstance:Re,newTypedArray:pi,newTypedArrayFrom:Kl,normalizeWheel:Xy,obj:st,proxy:jy,proxyPropertyMapping:Py,proxyPropertyState:Ky,safeArrays:Ny,set:Sa,setArray:Yl,setGet:Ze,setGetArray:ql,setImmediate:Xl,setLoggerFunction:Dy,throttle:Iy,traverseInstanceTree:Qo,TYPED_ARRAYS:pt,uncapitalize:Fy,VOID:Ry,vtkDebugMacro:Zo,vtkErrorMacro:oe,vtkInfoMacro:Ly,vtkLogMacro:by,vtkOnceErrorMacro:Vy,vtkWarningMacro:Fc,objectSetterMap:Ay},On=Object.freeze({__proto__:null,VOID:Ry,setLoggerFunction:Dy,vtkLogMacro:by,vtkInfoMacro:Ly,vtkDebugMacro:Zo,vtkErrorMacro:oe,vtkWarningMacro:Fc,vtkOnceErrorMacro:Vy,TYPED_ARRAYS:pt,newTypedArray:pi,newTypedArrayFrom:Kl,capitalize:Bc,_capitalize:ke,uncapitalize:Fy,formatBytesToProperUnit:By,formatNumbersWithThousandSeparator:ky,setImmediateVTK:Xl,measurePromiseExecution:Gy,obj:st,get:Ct,set:Sa,setGet:Ze,getArray:di,setArray:Yl,setGetArray:ql,moveToProtected:wa,algo:zy,EVENT_ABORT:Zl,event:$y,newInstance:Re,chain:Wy,isVtkObject:Ql,traverseInstanceTree:Qo,debounce:Hy,throttle:Iy,keystore:Jl,proxy:jy,proxyPropertyMapping:Py,proxyPropertyState:Ky,normalizeWheel:Xy,default:C});const{vtkErrorMacro:VC}=C,FC=["Build","Render"];function BC(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const s=r.getTraverseOperation(),i=t[s];if(i){i(r);return}t.apply(r,!0);for(let a=0;a<e.children.length;a++)e.children[a].traverse(r);t.apply(r,!1)},t.apply=(r,s)=>{const i=t[r.getOperation()];i&&i(s,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let s=0;s<e.children.length;++s){const a=e.children[s].getViewNodeFor(r);if(a)return a}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const s=e._parent.getLastAncestorOfType(r);return s||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const s=e._renderableChildMap.get(r);if(s!==void 0)return s.setVisited(!0),s;const i=t.createViewNode(r);if(i)return i.setParent(t),i.setVisited(!0),e._renderableChildMap.set(r,i),e.children.push(i),i},t.addMissingNodes=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i],o=t.addMissingNode(a);if(s&&o!==void 0&&e.children[i]!==o){for(let c=i+1;c<e.children.length;++c)if(e.children[c]===o){e.children.splice(c,1),e.children.splice(i,0,o);break}}}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let s=0;s<r.length;++s){const i=r[s];if(e.children.indexOf(i)===-1){i.setParent(t),e.children.push(i);const o=i.getRenderable();o&&e._renderableChildMap.set(o,i)}i.setVisited(!0)}},t.removeNode=r=>{const s=e.children.findIndex(a=>a===r);if(s<0)return!1;const i=r.getRenderable();return i&&e._renderableChildMap.delete(i),r.delete(),e.children.splice(s,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let s=0;s<e.children.length;++s){const i=e.children[s];if(i.getVisited())e.children[r++]=i,i.setVisited(!1);else{const o=i.getRenderable();o&&e._renderableChildMap.delete(o),i.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return VC("Cannot create view nodes without my own factory"),null;const s=e.myFactory.createNode(r);return s&&s.setRenderable(r),s};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const kC={renderable:null,myFactory:null,children:[],visited:!1};function Yy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kC,n),C.obj(t,e),C.event(t,e,"event"),e._renderableChildMap=new Map,C.get(t,e,["visited"]),C.setGet(t,e,["_parent","renderable","myFactory"]),C.getArray(t,e,["children"]),C.moveToProtected(t,e,["parent"]),BC(t,e)}const NC=C.newInstance(Yy,"vtkViewNode");var Ne={newInstance:NC,extend:Yy,PASS_TYPES:FC};function UC(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,s=n.getClassName(r++),i=!1;const a=Object.keys(e.overrides);for(;s&&!i;)a.indexOf(s)!==-1?i=!0:s=n.getClassName(r++);if(!i)return null;const o=e.overrides[s]();return o.setMyFactory(t),o}}const GC={};function qy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GC,n),C.obj(t,e),UC(t,e)}const AC=C.newInstance(qy,"vtkViewNodeFactory");var Zy={newInstance:AC,extend:qy};const Qy=Object.create(null);function At(t,e){Qy[t]=e}function zC(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const $C={};function Jy(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$C,n),e.overrides=Qy,Zy.extend(t,e,n),zC(t,e)}const WC=C.newInstance(Jy,"vtkOpenGLViewNodeFactory");var HC={newInstance:WC,extend:Jy};function IC(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){it(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),Al(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),zl(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Le(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();it(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),Le(e.keyMatrices.vcpc,e.keyMatrices.vcpc),Ye(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const jC={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function PC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jC,n),Ne.extend(t,e,n),e.keyMatrixTime={},st(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Ze(t,e,["context","keyMatrixTime"]),IC(t,e)}const KC=Re(PC);At("vtkCamera",KC);const{vtkDebugMacro:XC}=On;function YC(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps(),!0),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let s=0;s<r.length;++s)r[s].getSwitch()>0&&n++;return n||(XC("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const s=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=s.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(s.clearDepth(1),r|=s.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const i=t.getTiledSizeAndOrigin();s.enable(s.SCISSOR_TEST),s.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),s.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),s.colorMask(!0,!0,!0,!0),r&&s.clear(r),s.enable(s.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],s=n[0]-r[0],i=n[1]-r[1],a=e._parent.normalizedDisplayToDisplay(s,i),o=Math.round(a[0]),c=Math.round(a[1]),u=n[2]-r[0],l=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(u,l);let h=Math.round(f[0])-o,g=Math.round(f[1])-c;return h<0&&(h=0),g<0&&(g=0),{usize:h,vsize:g,lowerLeftU:o,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const i=e.renderable.getBackgroundByReference();r.clearColor(i[0],i[1],i[2],i[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const s=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),r.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const qC={context:null,_openGLRenderWindow:null,selector:null};function ZC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qC,n),Ne.extend(t,e,n),Ct(t,e,["shaderCache"]),Ze(t,e,["selector"]),wa(t,e,["openGLRenderWindow"]),YC(t,e)}const QC=Re(ZC,"vtkOpenGLRenderer");At("vtkRenderer",QC);function JC(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const s=e.children[r];s.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(s)):e.oglmapper=s}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let s=0;s<e.activeTextures.length;s++)e.activeTextures[s].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let s=0;s<e.activeTextures.length;s++)e.activeTextures[s].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),it(e.keyMatrices.mcwc,e.renderable.getMatrix()),Le(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?ys(e.keyMatrices.normalMatrix):(Al(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),zl(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Q0(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const eM={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function tM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eM,n),Ne.extend(t,e,n),e.keyMatrixTime={},st(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:ys(new Float64Array(9)),mcwc:ce(new Float64Array(16))},Ze(t,e,["context"]),Ct(t,e,["activeTextures"]),JC(t,e)}const nM=Re(tM);At("vtkActor",nM);function rM(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const s=e.children[r];s.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(s)):e.oglmapper=s}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let s=0;s<e.activeTextures.length;s++)e.activeTextures[s].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let s=0;s<e.activeTextures.length;s++)e.activeTextures[s].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let s=0;s<e.activeTextures.length;s++)e.activeTextures[s].deactivate()}}const sM={context:null,activeTextures:null};function iM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sM,n),Ne.extend(t,e,n),Ze(t,e,["context"]),Ct(t,e,["activeTextures"]),rM(t,e)}const aM=Re(iM);At("vtkActor2D",aM);function Uo(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function oM(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function ex(t){let e,n,r;t.length!==2?(e=Uo,n=(o,c)=>Uo(t(o),c),r=(o,c)=>t(o)-c):(e=t===Uo||t===oM?t:cM,n=t,r=t);function s(o,c,u=0,l=o.length){if(u<l){if(e(c,c)!==0)return l;do{const f=u+l>>>1;n(o[f],c)<0?u=f+1:l=f}while(u<l)}return u}function i(o,c,u=0,l=o.length){if(u<l){if(e(c,c)!==0)return l;do{const f=u+l>>>1;n(o[f],c)<=0?u=f+1:l=f}while(u<l)}return u}function a(o,c,u=0,l=o.length){const f=s(o,c,u,l-1);return f>u&&r(o[f-1],c)>-r(o[f],c)?f-1:f}return{left:s,center:a,right:i}}function cM(){return 0}function uM(t){return t===null?NaN:+t}const fM=ex(Uo),lM=fM.right;ex(uM).center;const hM=lM,gM=Math.sqrt(50),pM=Math.sqrt(10),dM=Math.sqrt(2);function Jo(t,e,n){const r=(e-t)/Math.max(0,n),s=Math.floor(Math.log10(r)),i=r/Math.pow(10,s),a=i>=gM?10:i>=pM?5:i>=dM?2:1;let o,c,u;return s<0?(u=Math.pow(10,-s)/a,o=Math.round(t*u),c=Math.round(e*u),o/u<t&&++o,c/u>e&&--c,u=-u):(u=Math.pow(10,s)*a,o=Math.round(t/u),c=Math.round(e/u),o*u<t&&++o,c*u>e&&--c),c<o&&.5<=n&&n<2?Jo(t,e,n*2):[o,c,u]}function yM(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[s,i,a]=r?Jo(e,t,n):Jo(t,e,n);if(!(i>=s))return[];const o=i-s+1,c=new Array(o);if(r)if(a<0)for(let u=0;u<o;++u)c[u]=(i-u)/-a;else for(let u=0;u<o;++u)c[u]=(i-u)*a;else if(a<0)for(let u=0;u<o;++u)c[u]=(s+u)/-a;else for(let u=0;u<o;++u)c[u]=(s+u)*a;return c}function Vf(t,e,n){return e=+e,t=+t,n=+n,Jo(t,e,n)[2]}function xM(t,e,n){e=+e,t=+t,n=+n;const r=e<t,s=r?Vf(e,t,n):Vf(t,e,n);return(r?-1:1)*(s<0?1/-s:s)}function TM(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function eh(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function tx(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ca(){}var ua=.7,ec=1/ua,qs="\\s*([+-]?\\d+)\\s*",fa="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",_n="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vM=/^#([0-9a-f]{3,8})$/,mM=new RegExp(`^rgb\\(${qs},${qs},${qs}\\)$`),SM=new RegExp(`^rgb\\(${_n},${_n},${_n}\\)$`),wM=new RegExp(`^rgba\\(${qs},${qs},${qs},${fa}\\)$`),CM=new RegExp(`^rgba\\(${_n},${_n},${_n},${fa}\\)$`),MM=new RegExp(`^hsl\\(${fa},${_n},${_n}\\)$`),EM=new RegExp(`^hsla\\(${fa},${_n},${_n},${fa}\\)$`),Ng={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};eh(Ca,la,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Ug,formatHex:Ug,formatHex8:_M,formatHsl:RM,formatRgb:Gg,toString:Gg});function Ug(){return this.rgb().formatHex()}function _M(){return this.rgb().formatHex8()}function RM(){return nx(this).formatHsl()}function Gg(){return this.rgb().formatRgb()}function la(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=vM.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Ag(e):n===3?new _t(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Na(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Na(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=mM.exec(t))?new _t(e[1],e[2],e[3],1):(e=SM.exec(t))?new _t(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=wM.exec(t))?Na(e[1],e[2],e[3],e[4]):(e=CM.exec(t))?Na(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=MM.exec(t))?Wg(e[1],e[2]/100,e[3]/100,1):(e=EM.exec(t))?Wg(e[1],e[2]/100,e[3]/100,e[4]):Ng.hasOwnProperty(t)?Ag(Ng[t]):t==="transparent"?new _t(NaN,NaN,NaN,0):null}function Ag(t){return new _t(t>>16&255,t>>8&255,t&255,1)}function Na(t,e,n,r){return r<=0&&(t=e=n=NaN),new _t(t,e,n,r)}function OM(t){return t instanceof Ca||(t=la(t)),t?(t=t.rgb(),new _t(t.r,t.g,t.b,t.opacity)):new _t}function Ff(t,e,n,r){return arguments.length===1?OM(t):new _t(t,e,n,r??1)}function _t(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}eh(_t,Ff,tx(Ca,{brighter(t){return t=t==null?ec:Math.pow(ec,t),new _t(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ua:Math.pow(ua,t),new _t(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new _t(cs(this.r),cs(this.g),cs(this.b),tc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zg,formatHex:zg,formatHex8:DM,formatRgb:$g,toString:$g}));function zg(){return`#${ns(this.r)}${ns(this.g)}${ns(this.b)}`}function DM(){return`#${ns(this.r)}${ns(this.g)}${ns(this.b)}${ns((isNaN(this.opacity)?1:this.opacity)*255)}`}function $g(){const t=tc(this.opacity);return`${t===1?"rgb(":"rgba("}${cs(this.r)}, ${cs(this.g)}, ${cs(this.b)}${t===1?")":`, ${t})`}`}function tc(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function cs(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ns(t){return t=cs(t),(t<16?"0":"")+t.toString(16)}function Wg(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Jt(t,e,n,r)}function nx(t){if(t instanceof Jt)return new Jt(t.h,t.s,t.l,t.opacity);if(t instanceof Ca||(t=la(t)),!t)return new Jt;if(t instanceof Jt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,s=Math.min(e,n,r),i=Math.max(e,n,r),a=NaN,o=i-s,c=(i+s)/2;return o?(e===i?a=(n-r)/o+(n<r)*6:n===i?a=(r-e)/o+2:a=(e-n)/o+4,o/=c<.5?i+s:2-i-s,a*=60):o=c>0&&c<1?0:a,new Jt(a,o,c,t.opacity)}function bM(t,e,n,r){return arguments.length===1?nx(t):new Jt(t,e,n,r??1)}function Jt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}eh(Jt,bM,tx(Ca,{brighter(t){return t=t==null?ec:Math.pow(ec,t),new Jt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ua:Math.pow(ua,t),new Jt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,s=2*n-r;return new _t(su(t>=240?t-240:t+120,s,r),su(t,s,r),su(t<120?t+240:t-120,s,r),this.opacity)},clamp(){return new Jt(Hg(this.h),Ua(this.s),Ua(this.l),tc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=tc(this.opacity);return`${t===1?"hsl(":"hsla("}${Hg(this.h)}, ${Ua(this.s)*100}%, ${Ua(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Hg(t){return t=(t||0)%360,t<0?t+360:t}function Ua(t){return Math.max(0,Math.min(1,t||0))}function su(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const th=t=>()=>t;function LM(t,e){return function(n){return t+n*e}}function VM(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function FM(t){return(t=+t)==1?rx:function(e,n){return n-e?VM(e,n,t):th(isNaN(e)?n:e)}}function rx(t,e){var n=e-t;return n?LM(t,n):th(isNaN(t)?e:t)}const Ig=function t(e){var n=FM(e);function r(s,i){var a=n((s=Ff(s)).r,(i=Ff(i)).r),o=n(s.g,i.g),c=n(s.b,i.b),u=rx(s.opacity,i.opacity);return function(l){return s.r=a(l),s.g=o(l),s.b=c(l),s.opacity=u(l),s+""}}return r.gamma=t,r}(1);function BM(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),s;return function(i){for(s=0;s<n;++s)r[s]=t[s]*(1-i)+e[s]*i;return r}}function kM(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function NM(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,s=new Array(r),i=new Array(n),a;for(a=0;a<r;++a)s[a]=nh(t[a],e[a]);for(;a<n;++a)i[a]=e[a];return function(o){for(a=0;a<r;++a)i[a]=s[a](o);return i}}function UM(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function nc(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function GM(t,e){var n={},r={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?n[s]=nh(t[s],e[s]):r[s]=e[s];return function(i){for(s in n)r[s]=n[s](i);return r}}var Bf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,iu=new RegExp(Bf.source,"g");function AM(t){return function(){return t}}function zM(t){return function(e){return t(e)+""}}function $M(t,e){var n=Bf.lastIndex=iu.lastIndex=0,r,s,i,a=-1,o=[],c=[];for(t=t+"",e=e+"";(r=Bf.exec(t))&&(s=iu.exec(e));)(i=s.index)>n&&(i=e.slice(n,i),o[a]?o[a]+=i:o[++a]=i),(r=r[0])===(s=s[0])?o[a]?o[a]+=s:o[++a]=s:(o[++a]=null,c.push({i:a,x:nc(r,s)})),n=iu.lastIndex;return n<e.length&&(i=e.slice(n),o[a]?o[a]+=i:o[++a]=i),o.length<2?c[0]?zM(c[0].x):AM(e):(e=c.length,function(u){for(var l=0,f;l<e;++l)o[(f=c[l]).i]=f.x(u);return o.join("")})}function nh(t,e){var n=typeof e,r;return e==null||n==="boolean"?th(e):(n==="number"?nc:n==="string"?(r=la(e))?(e=r,Ig):$M:e instanceof la?Ig:e instanceof Date?UM:kM(e)?BM:Array.isArray(e)?NM:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?GM:nc)(t,e)}function WM(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function HM(t){return function(){return t}}function IM(t){return+t}var jg=[0,1];function Hs(t){return t}function kf(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:HM(isNaN(e)?NaN:.5)}function jM(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function PM(t,e,n){var r=t[0],s=t[1],i=e[0],a=e[1];return s<r?(r=kf(s,r),i=n(a,i)):(r=kf(r,s),i=n(i,a)),function(o){return i(r(o))}}function KM(t,e,n){var r=Math.min(t.length,e.length)-1,s=new Array(r),i=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)s[a]=kf(t[a],t[a+1]),i[a]=n(e[a],e[a+1]);return function(o){var c=hM(t,o,1,r)-1;return i[c](s[c](o))}}function XM(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function YM(){var t=jg,e=jg,n=nh,r,s,i,a=Hs,o,c,u;function l(){var h=Math.min(t.length,e.length);return a!==Hs&&(a=jM(t[0],t[h-1])),o=h>2?KM:PM,c=u=null,f}function f(h){return h==null||isNaN(h=+h)?i:(c||(c=o(t.map(r),e,n)))(r(a(h)))}return f.invert=function(h){return a(s((u||(u=o(e,t.map(r),nc)))(h)))},f.domain=function(h){return arguments.length?(t=Array.from(h,IM),l()):t.slice()},f.range=function(h){return arguments.length?(e=Array.from(h),l()):e.slice()},f.rangeRound=function(h){return e=Array.from(h),n=WM,l()},f.clamp=function(h){return arguments.length?(a=h?!0:Hs,l()):a!==Hs},f.interpolate=function(h){return arguments.length?(n=h,l()):n},f.unknown=function(h){return arguments.length?(i=h,f):i},function(h,g){return r=h,s=g,l()}}function qM(){return YM()(Hs,Hs)}function ZM(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function rc(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function si(t){return t=rc(Math.abs(t)),t?t[1]:NaN}function QM(t,e){return function(n,r){for(var s=n.length,i=[],a=0,o=t[0],c=0;s>0&&o>0&&(c+o+1>r&&(o=Math.max(1,r-c)),i.push(n.substring(s-=o,s+o)),!((c+=o+1)>r));)o=t[a=(a+1)%t.length];return i.reverse().join(e)}}function JM(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var eE=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function sc(t){if(!(e=eE.exec(t)))throw new Error("invalid format: "+t);var e;return new rh({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}sc.prototype=rh.prototype;function rh(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}rh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function tE(t){e:for(var e=t.length,n=1,r=-1,s;n<e;++n)switch(t[n]){case".":r=s=n;break;case"0":r===0&&(r=n),s=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(s+1):t}var sx;function nE(t,e){var n=rc(t,e);if(!n)return t+"";var r=n[0],s=n[1],i=s-(sx=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,a=r.length;return i===a?r:i>a?r+new Array(i-a+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+rc(t,Math.max(0,e+i-1))[0]}function Pg(t,e){var n=rc(t,e);if(!n)return t+"";var r=n[0],s=n[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}const Kg={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:ZM,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Pg(t*100,e),r:Pg,s:nE,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Xg(t){return t}var Yg=Array.prototype.map,qg=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function rE(t){var e=t.grouping===void 0||t.thousands===void 0?Xg:QM(Yg.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",i=t.numerals===void 0?Xg:JM(Yg.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function u(f){f=sc(f);var h=f.fill,g=f.align,d=f.sign,p=f.symbol,y=f.zero,x=f.width,m=f.comma,T=f.precision,v=f.trim,S=f.type;S==="n"?(m=!0,S="g"):Kg[S]||(T===void 0&&(T=12),v=!0,S="g"),(y||h==="0"&&g==="=")&&(y=!0,h="0",g="=");var w=p==="$"?n:p==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",M=p==="$"?r:/[%p]/.test(S)?a:"",E=Kg[S],D=/[defgprs%]/.test(S);T=T===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,T)):Math.max(0,Math.min(20,T));function O(_){var V=w,L=M,F,G,A;if(S==="c")L=E(_)+L,_="";else{_=+_;var H=_<0||1/_<0;if(_=isNaN(_)?c:E(Math.abs(_),T),v&&(_=tE(_)),H&&+_==0&&d!=="+"&&(H=!1),V=(H?d==="("?d:o:d==="-"||d==="("?"":d)+V,L=(S==="s"?qg[8+sx/3]:"")+L+(H&&d==="("?")":""),D){for(F=-1,G=_.length;++F<G;)if(A=_.charCodeAt(F),48>A||A>57){L=(A===46?s+_.slice(F+1):_.slice(F))+L,_=_.slice(0,F);break}}}m&&!y&&(_=e(_,1/0));var P=V.length+_.length+L.length,U=P<x?new Array(x-P+1).join(h):"";switch(m&&y&&(_=e(U+_,U.length?x-L.length:1/0),U=""),g){case"<":_=V+_+L+U;break;case"=":_=V+U+_+L;break;case"^":_=U.slice(0,P=U.length>>1)+V+_+L+U.slice(P);break;default:_=U+V+_+L;break}return i(_)}return O.toString=function(){return f+""},O}function l(f,h){var g=u((f=sc(f),f.type="f",f)),d=Math.max(-8,Math.min(8,Math.floor(si(h)/3)))*3,p=Math.pow(10,-d),y=qg[8+d/3];return function(x){return g(p*x)+y}}return{format:u,formatPrefix:l}}var Ga,ix,ax;sE({thousands:",",grouping:[3],currency:["$",""]});function sE(t){return Ga=rE(t),ix=Ga.format,ax=Ga.formatPrefix,Ga}function iE(t){return Math.max(0,-si(Math.abs(t)))}function aE(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(si(e)/3)))*3-si(Math.abs(t)))}function oE(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,si(e)-si(t))+1}function cE(t,e,n,r){var s=xM(t,e,n),i;switch(r=sc(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(i=aE(s,a))&&(r.precision=i),ax(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(i=oE(s,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=i-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(i=iE(s))&&(r.precision=i-(r.type==="%")*2);break}}return ix(r)}function uE(t){var e=t.domain;return t.ticks=function(n){var r=e();return yM(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var s=e();return cE(s[0],s[s.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),s=0,i=r.length-1,a=r[s],o=r[i],c,u,l=10;for(o<a&&(u=a,a=o,o=u,u=s,s=i,i=u);l-- >0;){if(u=Vf(a,o,n),u===c)return r[s]=a,r[i]=o,e(r);if(u>0)a=Math.floor(a/u)*u,o=Math.ceil(o/u)*u;else if(u<0)a=Math.ceil(a*u)/u,o=Math.floor(o*u)/u;else break;c=u}return t},t}function sh(){var t=qM();return t.copy=function(){return XM(t,sh())},TM.apply(t,arguments),uE(t)}var Nf={},fE={get exports(){return Nf},set exports(t){Nf=t}};(function(t){(function(e,n,r){function s(c){var u=this,l=o();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=l(" "),u.s1=l(" "),u.s2=l(" "),u.s0-=l(c),u.s0<0&&(u.s0+=1),u.s1-=l(c),u.s1<0&&(u.s1+=1),u.s2-=l(c),u.s2<0&&(u.s2+=1),l=null}function i(c,u){return u.c=c.c,u.s0=c.s0,u.s1=c.s1,u.s2=c.s2,u}function a(c,u){var l=new s(c),f=u&&u.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function o(){var c=4022871197,u=function(l){l=String(l);for(var f=0;f<l.length;f++){c+=l.charCodeAt(f);var h=.02519603282416938*c;c=h>>>0,h-=c,h*=c,c=h>>>0,h-=c,c+=h*4294967296}return(c>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=a:r&&r.amd?r(function(){return a}):this.alea=a})(Ut,t,!1)})(fE);var Uf={},lE={get exports(){return Uf},set exports(t){Uf=t}};(function(t){(function(e,n,r){function s(o){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var f=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^f^f>>>8},o===(o|0)?c.x=o:u+=o;for(var l=0;l<u.length+64;l++)c.x^=u.charCodeAt(l)|0,c.next()}function i(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c}function a(o,c){var u=new s(o),l=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var h=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(h+g)/(1<<21);while(d===0);return d},f.int32=u.next,f.quick=f,l&&(typeof l=="object"&&i(l,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=a:r&&r.amd?r(function(){return a}):this.xor128=a})(Ut,t,!1)})(lE);var Gf={},hE={get exports(){return Gf},set exports(t){Gf=t}};(function(t){(function(e,n,r){function s(o){var c=this,u="";c.next=function(){var f=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(f^f<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,o===(o|0)?c.x=o:u+=o;for(var l=0;l<u.length+64;l++)c.x^=u.charCodeAt(l)|0,l==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function i(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c.v=o.v,c.d=o.d,c}function a(o,c){var u=new s(o),l=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var h=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(h+g)/(1<<21);while(d===0);return d},f.int32=u.next,f.quick=f,l&&(typeof l=="object"&&i(l,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=a:r&&r.amd?r(function(){return a}):this.xorwow=a})(Ut,t,!1)})(hE);var Af={},gE={get exports(){return Af},set exports(t){Af=t}};(function(t){(function(e,n,r){function s(o){var c=this;c.next=function(){var l=c.x,f=c.i,h,g;return h=l[f],h^=h>>>7,g=h^h<<24,h=l[f+1&7],g^=h^h>>>10,h=l[f+3&7],g^=h^h>>>3,h=l[f+4&7],g^=h^h<<7,h=l[f+7&7],h=h^h<<13,g^=h^h<<9,l[f]=g,c.i=f+1&7,g};function u(l,f){var h,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,h=0;h<f.length;++h)g[h&7]=g[h&7]<<15^f.charCodeAt(h)+g[h+1&7]<<13;for(;g.length<8;)g.push(0);for(h=0;h<8&&g[h]===0;++h);for(h==8?g[7]=-1:g[h],l.x=g,l.i=0,h=256;h>0;--h)l.next()}u(c,o)}function i(o,c){return c.x=o.x.slice(),c.i=o.i,c}function a(o,c){o==null&&(o=+new Date);var u=new s(o),l=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var h=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(h+g)/(1<<21);while(d===0);return d},f.int32=u.next,f.quick=f,l&&(l.x&&i(l,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=a:r&&r.amd?r(function(){return a}):this.xorshift7=a})(Ut,t,!1)})(gE);var zf={},pE={get exports(){return zf},set exports(t){zf=t}};(function(t){(function(e,n,r){function s(o){var c=this;c.next=function(){var l=c.w,f=c.X,h=c.i,g,d;return c.w=l=l+1640531527|0,d=f[h+34&127],g=f[h=h+1&127],d^=d<<13,g^=g<<17,d^=d>>>15,g^=g>>>12,d=f[h]=d^g,c.i=h,d+(l^l>>>16)|0};function u(l,f){var h,g,d,p,y,x=[],m=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,m=Math.max(m,f.length)),d=0,p=-32;p<m;++p)f&&(g^=f.charCodeAt((p+32)%f.length)),p===0&&(y=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,p>=0&&(y=y+1640531527|0,h=x[p&127]^=g+y,d=h==0?d+1:0);for(d>=128&&(x[(f&&f.length||0)&127]=-1),d=127,p=4*128;p>0;--p)g=x[d+34&127],h=x[d=d+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,x[d]=g^h;l.w=y,l.X=x,l.i=d}u(c,o)}function i(o,c){return c.i=o.i,c.w=o.w,c.X=o.X.slice(),c}function a(o,c){o==null&&(o=+new Date);var u=new s(o),l=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var h=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(h+g)/(1<<21);while(d===0);return d},f.int32=u.next,f.quick=f,l&&(l.X&&i(l,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=a:r&&r.amd?r(function(){return a}):this.xor4096=a})(Ut,t,!1)})(pE);var $f={},dE={get exports(){return $f},set exports(t){$f=t}};(function(t){(function(e,n,r){function s(o){var c=this,u="";c.next=function(){var f=c.b,h=c.c,g=c.d,d=c.a;return f=f<<25^f>>>7^h,h=h-g|0,g=g<<24^g>>>8^d,d=d-f|0,c.b=f=f<<20^f>>>12^h,c.c=h=h-g|0,c.d=g<<16^h>>>16^d,c.a=d-f|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,o===Math.floor(o)?(c.a=o/4294967296|0,c.b=o|0):u+=o;for(var l=0;l<u.length+20;l++)c.b^=u.charCodeAt(l)|0,c.next()}function i(o,c){return c.a=o.a,c.b=o.b,c.c=o.c,c.d=o.d,c}function a(o,c){var u=new s(o),l=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var h=u.next()>>>11,g=(u.next()>>>0)/4294967296,d=(h+g)/(1<<21);while(d===0);return d},f.int32=u.next,f.quick=f,l&&(typeof l=="object"&&i(l,u),f.state=function(){return i(u,{})}),f}n&&n.exports?n.exports=a:r&&r.amd?r(function(){return a}):this.tychei=a})(Ut,t,!1)})(dE);var Wf={},yE={get exports(){return Wf},set exports(t){Wf=t}};const xE={},TE=Object.freeze(Object.defineProperty({__proto__:null,default:xE},Symbol.toStringTag,{value:"Module"})),vE=F2(TE);(function(t){(function(e,n,r){var s=256,i=6,a=52,o="random",c=r.pow(s,i),u=r.pow(2,a),l=u*2,f=s-1,h;function g(v,S,w){var M=[];S=S==!0?{entropy:!0}:S||{};var E=x(y(S.entropy?[v,T(n)]:v??m(),3),M),D=new d(M),O=function(){for(var _=D.g(i),V=c,L=0;_<u;)_=(_+L)*s,V*=s,L=D.g(1);for(;_>=l;)_/=2,V/=2,L>>>=1;return(_+L)/V};return O.int32=function(){return D.g(4)|0},O.quick=function(){return D.g(4)/4294967296},O.double=O,x(T(D.S),n),(S.pass||w||function(_,V,L,F){return F&&(F.S&&p(F,D),_.state=function(){return p(D,{})}),L?(r[o]=_,V):_})(O,E,"global"in S?S.global:this==r,S.state)}function d(v){var S,w=v.length,M=this,E=0,D=M.i=M.j=0,O=M.S=[];for(w||(v=[w++]);E<s;)O[E]=E++;for(E=0;E<s;E++)O[E]=O[D=f&D+v[E%w]+(S=O[E])],O[D]=S;(M.g=function(_){for(var V,L=0,F=M.i,G=M.j,A=M.S;_--;)V=A[F=f&F+1],L=L*s+A[f&(A[F]=A[G=f&G+V])+(A[G]=V)];return M.i=F,M.j=G,L})(s)}function p(v,S){return S.i=v.i,S.j=v.j,S.S=v.S.slice(),S}function y(v,S){var w=[],M=typeof v,E;if(S&&M=="object")for(E in v)try{w.push(y(v[E],S-1))}catch{}return w.length?w:M=="string"?v:v+"\0"}function x(v,S){for(var w=v+"",M,E=0;E<w.length;)S[f&E]=f&(M^=S[f&E]*19)+w.charCodeAt(E++);return T(S)}function m(){try{var v;return h&&(v=h.randomBytes)?v=v(s):(v=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(v)),T(v)}catch{var S=e.navigator,w=S&&S.plugins;return[+new Date,e,w,e.screen,T(n)]}}function T(v){return String.fromCharCode.apply(0,v)}if(x(r.random(),n),t.exports){t.exports=g;try{h=vE}catch{}}else r["seed"+o]=g})(typeof self<"u"?self:Ut,[],Math)})(yE);var mE=Nf,SE=Uf,wE=Gf,CE=Af,ME=zf,EE=$f,yi=Wf;yi.alea=mE;yi.xor128=SE;yi.xorwow=wE;yi.xorshift7=CE;yi.xor4096=ME;yi.tychei=EE;const _E=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RE=1e-6,OE=1e-12,{vtkErrorMacro:qU,vtkWarningMacro:Zg}=C;function Hf(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}function Ge(t){return t/180*Math.PI}function ha(t){return t*180/Math.PI}const{round:Aa,floor:ZU,ceil:QU,min:JU,max:eG}=Math;function qt(t){let e=1;for(;e<t;)e*=2;return e}function za(t){return t===qt(t)}function If(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Rr(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Qg(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function pe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ga(t,e,n){const r=t[1]*e[2]-t[2]*e[1],s=t[2]*e[0]-t[0]*e[2],i=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=s,n[2]=i,n}function ox(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function pa(t){const e=ox(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function mn(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function DE(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function bE(t){const e=DE(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function Go(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function LE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:RE;if(t.length!==e.length)return!1;function r(s,i){return Math.abs(s-e[i])<=n}return t.every(r)}const cx=LE;function au(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function Jg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=au(t[0],n),e[1]=au(t[1],n),e[2]=au(t[2],n),e}function VE(t,e,n){let r,s,i,a,o=0,c,u,l;const f=Hf(n);for(r=0;r<n;r++){for(a=0,s=0;s<n;s++)(l=Math.abs(t[r*n+s]))>a&&(a=l);if(a===0)return Zg("Unable to factor linear system"),0;f[r]=1/a}for(s=0;s<n;s++){for(r=0;r<s;r++){for(c=t[r*n+s],i=0;i<r;i++)c-=t[r*n+i]*t[i*n+s];t[r*n+s]=c}for(a=0,r=s;r<n;r++){for(c=t[r*n+s],i=0;i<s;i++)c-=t[r*n+i]*t[i*n+s];t[r*n+s]=c,(u=f[r]*Math.abs(c))>=a&&(a=u,o=r)}if(s!==o){for(i=0;i<n;i++)u=t[o*n+i],t[o*n+i]=t[s*n+i],t[s*n+i]=u;f[o]=f[s]}if(e[s]=o,Math.abs(t[s*n+s])<=OE)return Zg("Unable to factor linear system"),0;if(s!==n-1)for(u=1/t[s*n+s],r=s+1;r<n;r++)t[r*n+s]*=u}return 1}function FE(t,e,n,r){let s,i,a,o,c;for(a=-1,s=0;s<r;s++){if(o=e[s],c=n[o],n[o]=n[s],a>=0)for(i=a;i<=s-1;i++)c-=t[s*r+i]*n[i];else c!==0&&(a=s);n[s]=c}for(s=r-1;s>=0;s--){for(c=n[s],i=s+1;i<r;i++)c-=t[s*r+i]*n[i];n[s]=c/t[s*r+s]}}function BE(t,e,n){if(n===2){const s=Hf(2),i=Go(t[0],t[1],t[2],t[3]);return i===0?0:(s[0]=(t[3]*e[0]-t[1]*e[1])/i,s[1]=(-(t[2]*e[0])+t[0]*e[1])/i,e[0]=s[0],e[1]=s[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=Hf(n);return VE(t,r,n)===0?0:(FE(t,r,e,n),1)}function kE(t,e){const[n,r,s]=t,i=1/3,a=1/6,o=2/3,c=5/6;let u,l,f;n>a&&n<=i?(l=1,u=(i-n)/a,f=0):n>i&&n<=.5?(l=1,f=(n-i)/a,u=0):n>.5&&n<=o?(f=1,l=(o-n)/a,u=0):n>o&&n<=c?(f=1,u=(n-o)/a,l=0):n>c&&n<=1?(u=1,f=(1-n)/a,l=0):(u=1,l=n/a,f=0),u=r*u+(1-r),l=r*l+(1-r),f=r*f+(1-r),u*=s,l*=s,f*=s,e[0]=u,e[1]=l,e[2]=f}function ih(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function ou(t){return!(t[1]-t[0]<0)}function cu(t,e,n){return t<e?e:t>n?n:t}function ep(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=cu(t[0],e[0],n[0]),r[1]=cu(t[1],e[1],n[1]),r[2]=cu(t[2],e[2],n[2]),r}const{isFinite:tG,isNaN:NE}=Number,ux=NE;function ah(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function UE(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{C.vtkErrorMacro("not implemented")}}const GE={};function fx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GE,n),C.obj(t,e),C.setGet(t,e,["transform"]),UE(t,e)}const AE=C.newInstance(fx,"vtkImplicitFunction");var zE={newInstance:AE,extend:fx};const jf=1e-6,lx="coincide",hx="disjoint";function $E(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function gx(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function px(t,e,n,r){const s=[];Rr(t,e,s);const i=pe(n,s);r[0]=t[0]-i*n[0],r[1]=t[1]-i*n[1],r[2]=t[2]-i*n[2]}function dx(t,e,n){const r=pe(t,e);let s=pe(e,e);return s===0&&(s=1),n[0]=t[0]-r*e[0]/s,n[1]=t[1]-r*e[1]/s,n[2]=t[2]-r*e[2]/s,n}function yx(t,e,n,r){const s=[];Rr(t,e,s);const i=pe(n,s),a=pe(n,n);a!==0?(r[0]=t[0]-i*n[0]/a,r[1]=t[1]-i*n[1]/a,r[2]=t[2]-i*n[2]/a):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function xx(t,e,n,r){const s={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},i=[],a=[];Rr(e,t,i),Rr(n,t,a);const o=pe(r,a),c=pe(r,i);let u,l;return c<0?u=-c:u=c,o<0?l=-o*jf:l=o*jf,u<=l||(s.t=o/c,s.x[0]=t[0]+s.t*i[0],s.x[1]=t[1]+s.t*i[1],s.x[2]=t[2]+s.t*i[2],s.intersection=!0,s.betweenPoints=s.t>=0&&s.t<=1),s}function Tx(t,e,n,r){const s={intersection:!1,l0:[],l1:[],error:null},i=[];ga(e,r,i);const a=i.map(f=>Math.abs(f));if(a[0]+a[1]+a[2]<jf){const f=[];return Rr(t,n,f),pe(e,f)===0?s.error=lx:s.error=hx,s}let o;a[0]>a[1]&&a[0]>a[2]?o="x":a[1]>a[2]?o="y":o="z";const c=[],u=-pe(e,t),l=-pe(r,n);switch(o){case"x":c[0]=0,c[1]=(l*e[2]-u*r[2])/i[0],c[2]=(u*r[1]-l*e[1])/i[0];break;case"y":c[0]=(u*r[2]-l*e[2])/i[1],c[1]=0,c[2]=(l*e[0]-u*r[0])/i[1];break;case"z":c[0]=(l*e[1]-u*r[1])/i[2],c[1]=(u*r[0]-l*e[0])/i[2],c[2]=0;break}return s.l0=c,If(c,i,s.l1),s.intersection=!0,s}const WE={evaluate:$E,distanceToPlane:gx,projectPoint:px,projectVector:dx,generalizedProjectPoint:yx,intersectWithLine:xx,intersectWithPlane:Tx,DISJOINT:hx,COINCIDE:lx};function HE(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>gx(n,e.origin,e.normal),t.projectPoint=(n,r)=>{px(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>dx(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{yx(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,s)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(s-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>xx(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>Tx(n,r,e.origin,e.normal)}const IE={normal:[0,0,1],origin:[0,0,0]};function vx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IE,n),zE.extend(t,e,n),C.setGetArray(t,e,["normal","origin"],3),HE(t,e)}const jE=C.newInstance(vx,"vtkPlane");var ii={newInstance:jE,extend:vx,...WE};const kc=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function mx(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Zn(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function oh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ch(t){return oh(t,kc)}function ic(t,e,n,r){const[s,i,a,o,c,u]=t;return t[0]=s<e?s:e,t[1]=i>e?i:e,t[2]=a<n?a:n,t[3]=o>n?o:n,t[4]=c<r?c:r,t[5]=u>r?u:r,t}function uh(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)ic(t,...e[n]);else for(let n=0;n<e.length;n+=3)ic(t,...e.slice(n,n+3));return t}function Sx(t,e,n,r,s,i,a){const[o,c,u,l,f,h]=t;return a===void 0?(t[0]=Math.min(e[0],o),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],u),t[3]=Math.max(e[3],l),t[4]=Math.min(e[4],f),t[5]=Math.max(e[5],h)):(t[0]=Math.min(e,o),t[1]=Math.max(n,c),t[2]=Math.min(r,u),t[3]=Math.max(s,l),t[4]=Math.min(i,f),t[5]=Math.max(a,h)),t}function wx(t,e,n,r){const[s,i,a,o,c,u]=t;return t[0]=e,t[1]=e>i?e:i,t[2]=n,t[3]=n>o?n:o,t[4]=r,t[5]=r>u?r:u,s!==e||a!==n||c!==r}function Cx(t,e,n,r){const[s,i,a,o,c,u]=t;return t[0]=e<s?e:s,t[1]=e,t[2]=n<a?n:a,t[3]=n,t[4]=r<c?r:c,t[5]=r,i!==e||o!==n||u!==r}function Mx(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function fh(t,e,n,r){return Zn(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function lh(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function PE(t,e,n,r){if(!Zn(t))return!1;const s=lh(t);return t[0]-=s[0],t[1]-=s[0],t[2]-=s[1],t[3]-=s[1],t[4]-=s[2],t[5]-=s[2],fh(t,e,n,r),t[0]+=s[0],t[1]+=s[0],t[2]+=s[1],t[3]+=s[1],t[4]+=s[2],t[5]+=s[2],!0}function qi(t,e){return t[e*2+1]-t[e*2]}function Nc(t){return[qi(t,0),qi(t,1),qi(t,2)]}function Ex(t){return t.slice(0,2)}function _x(t){return t.slice(2,4)}function Rx(t){return t.slice(4,6)}function Ox(t){const e=Nc(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function Dx(t){if(Zn(t)){const e=Nc(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function hh(t){return[t[0],t[2],t[4]]}function gh(t){return[t[1],t[3],t[5]]}function $a(t,e){return t<=0&&e>=0||t>=0&&e<=0}function ph(t,e){let n=0;for(let r=0;r<2;r++)for(let s=2;s<4;s++)for(let i=4;i<6;i++)e[n++]=[t[r],t[s],t[i]];return e}function bx(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function Lx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=ph(t,[]);for(let s=0;s<r.length;++s)we(r[s],r[s],e);return ch(n),uh(n,r)}function Vx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function Fx(t,e,n,r){const s=[].concat(kc),i=t.getData();for(let a=0;a<i.length;a+=3){const o=[i[a],i[a+1],i[a+2]],c=pe(o,e);s[0]=Math.min(c,s[0]),s[1]=Math.max(c,s[1]);const u=pe(o,n);s[2]=Math.min(u,s[2]),s[3]=Math.max(u,s[3]);const l=pe(o,r);s[4]=Math.min(l,s[4]),s[5]=Math.max(l,s[5])}return s}function Bx(t,e,n,r,s){let i=!0;const a=[];let o=0;const c=[],u=[0,0,0],l=0,f=1,h=2;for(let g=0;g<3;g++)e[g]<t[2*g]?(a[g]=f,u[g]=t[2*g],i=!1):e[g]>t[2*g+1]?(a[g]=l,u[g]=t[2*g+1],i=!1):a[g]=h;if(i)return r[0]=e[0],r[1]=e[1],r[2]=e[2],s[0]=0,1;for(let g=0;g<3;g++)a[g]!==h&&n[g]!==0?c[g]=(u[g]-e[g])/n[g]:c[g]=-1;for(let g=0;g<3;g++)c[o]<c[g]&&(o=g);if(c[o]>1||c[o]<0)return 0;s[0]=c[o];for(let g=0;g<3;g++)if(o!==g){if(r[g]=e[g]+c[o]*n[g],r[g]<t[2*g]||r[g]>t[2*g+1])return 0}else r[g]=u[g];return 1}function kx(t,e,n){const r=[];let s=0,i=1,a=1;for(let o=4;o<=5;++o){r[2]=t[o];for(let c=2;c<=3;++c){r[1]=t[c];for(let u=0;u<=1;++u)if(r[0]=t[u],s=ii.evaluate(n,e,r),a&&(i=s>=0?1:-1,a=0),s===0||i>0&&s<0||i<0&&s>0)return 1}}return 0}function Nx(t,e){if(!(Zn(t)&&Zn(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let s=0;s<3;s++)if(r=!1,e[s*2]>=t[s*2]&&e[s*2]<=t[s*2+1]?(r=!0,n[s*2]=e[s*2]):t[s*2]>=e[s*2]&&t[s*2]<=e[s*2+1]&&(r=!0,n[s*2]=t[s*2]),e[s*2+1]>=t[s*2]&&e[s*2+1]<=t[s*2+1]?(r=!0,n[s*2+1]=e[2*s+1]):t[s*2+1]>=e[s*2]&&t[s*2+1]<=e[s*2+1]&&(r=!0,n[s*2+1]=t[s*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function ac(t,e){if(!(Zn(t)&&Zn(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function oc(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function KE(t,e){return!(!ac(t,e)||!oc(t,...hh(e))||!oc(t,...gh(e)))}function Ux(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],s=[0,0,0,0,0,0,0,0];let i=0;for(let f=0;f<2;f++)for(let h=2;h<4;h++)for(let g=4;g<6;g++){const d=[t[f],t[h],t[g]];s[i++]=ii.evaluate(n,e,d)}let a=2;for(;a--&&!($a(s[r[a][0]],s[r[a][4]])&&$a(s[r[a][1]],s[r[a][5]])&&$a(s[r[a][2]],s[r[a][6]])&&$a(s[r[a][3]],s[r[a][7]])););if(a<0)return!1;const o=Math.sign(n[a]),c=Math.abs((t[a*2+1]-t[a*2])*n[a]);let u=o>0?1:0;for(let f=0;f<4;f++){if(c===0)continue;const h=Math.abs(s[r[a][f]])/c;o>0&&h<u&&(u=h),o<0&&h>u&&(u=h)}const l=(1-u)*t[a*2]+u*t[a*2+1];return o>0?t[a*2]=l:t[a*2+1]=l,!0}class XE{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(kc))}getBounds(){return this.bounds}equals(e){return mx(this.bounds,e)}isValid(){return Zn(this.bounds)}setBounds(e){return oh(this.bounds,e)}reset(){return ch(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return ic(this.bounds,...n)}addPoints(e){return uh(this.bounds,e)}addBounds(e,n,r,s,i,a){return Sx(this.bounds,e,n,r,s,i,a)}setMinPoint(e,n,r){return wx(this.bounds,e,n,r)}setMaxPoint(e,n,r){return Cx(this.bounds,e,n,r)}inflate(e){return Mx(this.bounds,e)}scale(e,n,r){return fh(this.bounds,e,n,r)}getCenter(){return lh(this.bounds)}getLength(e){return qi(this.bounds,e)}getLengths(){return Nc(this.bounds)}getMaxLength(){return Ox(this.bounds)}getDiagonalLength(){return Dx(this.bounds)}getMinPoint(){return hh(this.bounds)}getMaxPoint(){return gh(this.bounds)}getXRange(){return Ex(this.bounds)}getYRange(){return _x(this.bounds)}getZRange(){return Rx(this.bounds)}getCorners(e){return ph(this.bounds,e)}computeCornerPoints(e,n){return bx(this.bounds,e,n)}computeLocalBounds(e,n,r){return Fx(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Lx(this.bounds,e,n)}computeScale3(e){return Vx(this.bounds,e)}cutWithPlane(e,n){return Ux(this.bounds,e,n)}intersectBox(e,n,r,s){return Bx(this.bounds,e,n,r,s)}intersectPlane(e,n){return kx(this.bounds,e,n)}intersect(e){return Nx(this.bounds,e)}intersects(e){return ac(this.bounds,e)}containsPoint(e,n,r){return oc(this.bounds,e,n,r)}contains(e){return ac(this.bounds,e)}}function YE(t){const e=t&&t.bounds;return new XE(e)}const qE={equals:mx,isValid:Zn,setBounds:oh,reset:ch,addPoint:ic,addPoints:uh,addBounds:Sx,setMinPoint:wx,setMaxPoint:Cx,inflate:Mx,scale:fh,scaleAboutCenter:PE,getCenter:lh,getLength:qi,getLengths:Nc,getMaxLength:Ox,getDiagonalLength:Dx,getMinPoint:hh,getMaxPoint:gh,getXRange:Ex,getYRange:_x,getZRange:Rx,getCorners:ph,computeCornerPoints:bx,computeLocalBounds:Fx,transformBounds:Lx,computeScale3:Vx,cutWithPlane:Ux,intersectBox:Bx,intersectPlane:kx,intersect:Nx,intersects:ac,containsPoint:oc,contains:KE,INIT_BOUNDS:kc};var be={newInstance:YE,...qE};const ZE={DISPLAY:0,WORLD:1};var Gx={CoordinateSystem:ZE};const{CoordinateSystem:Pf}=Gx;function tp(t){return()=>C.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function QE(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const s=e.textures[r].getMTime();s>n&&(n=s)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=tp("pick"),t.hasKey=tp("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(s=>s!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(Pf.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(Pf.DISPLAY)}const JE={allocatedRenderTime:10,coordinateSystem:Pf.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function Ax(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JE,n),C.obj(t,e),C.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),C.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),C.moveToProtected(t,e,["parentProp"]),QE(t,e)}const e_=C.newInstance(Ax,"vtkProp");var Ma={newInstance:e_,extend:Ax,...Gx};const t_=1e-6;function n_(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((s,i)=>s+r[i]),t.modified()},t.getOrientationWXYZ=()=>{const r=gs();Mf(r,e.rotation);const s=new Float64Array(3),i=b2(s,r);return[ha(i),s[0],s[1],s[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Mf(r,e.rotation)},t.rotateX=r=>{r!==0&&(Wl(e.rotation,e.rotation,Ge(r)),t.modified())},t.rotateY=r=>{r!==0&&(Hl(e.rotation,e.rotation,Ge(r)),t.modified())},t.rotateZ=r=>{r!==0&&(Il(e.rotation,e.rotation,Ge(r)),t.modified())},t.rotateWXYZ=(r,s,i,a)=>{if(r===0||s===0&&i===0&&a===0)return;const o=Ge(r),c=gs();Pl(c,[s,i,a],o);const u=new Float64Array(16);Ko(u,c),Ye(e.rotation,e.rotation,u),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-t_)return;const s=Ko(new Float64Array(16),r);Ye(e.rotation,e.rotation,s),t.modified()},t.setOrientation=(r,s,i)=>r===e.orientation[0]&&s===e.orientation[1]&&i===e.orientation[2]?!1:(e.orientation=[r,s,i],ce(e.rotation),t.rotateZ(i),t.rotateX(r),t.rotateY(s),t.modified(),!0),t.setUserMatrix=r=>cx(e.userMatrix,r)?!1:(it(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){ce(e.matrix),e.userMatrix&&Ye(e.matrix,e.matrix,e.userMatrix),Ae(e.matrix,e.matrix,e.origin),Ae(e.matrix,e.matrix,e.position),Ye(e.matrix,e.matrix,e.rotation),hs(e.matrix,e.matrix,e.scale),Ae(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),Le(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let s=0;s<4;++s)(r===s?1:0)!==e.matrix[r+s*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>be.getCenter(e.bounds),t.getLength=()=>be.getLength(e.bounds),t.getXRange=()=>be.getXRange(e.bounds),t.getYRange=()=>be.getYRange(e.bounds),t.getZRange=()=>be.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n)}const r_={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function zx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,r_,n),Ma.extend(t,e,n),e.matrixMTime={},C.obj(e.matrixMTime),C.get(t,e,["bounds","isIdentity"]),C.getArray(t,e,["orientation"]),C.setGetArray(t,e,["origin","position","scale"],3),e.matrix=ce(new Float64Array(16)),e.rotation=ce(new Float64Array(16)),e.userMatrix=ce(new Float64Array(16)),e.transform=null,n_(t,e)}const s_=C.newInstance(zx,"vtkProp3D");var i_={newInstance:s_,extend:zx};const $x={FLAT:0,GOURAUD:1,PHONG:2},Gt={POINTS:0,WIREFRAME:1,SURFACE:2},a_=$x;var Wx={Shading:$x,Representation:Gt,Interpolation:a_};const{Representation:zi,Interpolation:$i}=Wx;function np(t){return()=>C.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function o_(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,s)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==s)&&(e.color[0]=n,e.color[1]=r,e.color[2]=s,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=np("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=np("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation($i.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation($i.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation($i.PHONG),t.getInterpolationAsString=()=>C.enumToString($i,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(zi.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(zi.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(zi.POINTS),t.getRepresentationAsString=()=>C.enumToString(zi,e.representation)}const c_={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:$i.GOURAUD,representation:zi.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null,ORMTexture:null,RMTexture:null};function Hx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,c_,n),C.obj(t,e),C.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture","ORMTexture","RMTexture"]),C.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),o_(t,e)}const u_=C.newInstance(Hx,"vtkProperty");var xi={newInstance:u_,extend:Hx,...Wx};const{vtkDebugMacro:f_}=C;function l_(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=xi.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;if(!e.mapperBounds||r[0]!==e.mapperBounds[0]||r[1]!==e.mapperBounds[1]||r[2]!==e.mapperBounds[2]||r[3]!==e.mapperBounds[3]||r[4]!==e.mapperBounds[4]||r[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){f_("Recomputing bounds..."),e.mapperBounds=r.concat();const s=[];be.getCorners(r,s),t.computeMatrix();const i=new Float64Array(16);Le(i,e.matrix),s.forEach(a=>we(a,a,i)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((a,o)=>o%2===0?s.reduce((c,u)=>c>u[o/2]?u[o/2]:c,a):s.reduce((c,u)=>c<u[(o-1)/2]?u[(o-1)/2]:c,a)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let r=n.getMTime();if(e.property!==null){const s=e.property.getMTime();r=s>r?s:r}if(e.backfaceProperty!==null){const s=e.backfaceProperty.getMTime();r=s>r?s:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let s=e.mapper.getMTime();r=s>r?s:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),s=e.mapper.getInput().getMTime(),r=s>r?s:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,s)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,s)}}const h_={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function Ix(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,h_,n),i_.extend(t,e,n),e.boundsMTime={},C.obj(e.boundsMTime),C.set(t,e,["property"]),C.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),l_(t,e)}const g_=C.newInstance(Ix,"vtkActor");var ps={newInstance:g_,extend:Ix};const jx={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},tt={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},p_=tt.FLOAT;var Px={DefaultDataType:p_,DataTypeByteSize:jx,VtkDataTypes:tt};const{vtkErrorMacro:d_}=On,{DefaultDataType:y_}=Px,x_=1e-6;function Kf(t,e,n){const r=t.length;let s=Number.MAX_VALUE,i=-Number.MAX_VALUE,a,o;for(o=e;o<r;o+=n)if(!Number.isNaN(t[o])){s=t[o],i=s;break}for(;o<r;o+=n)a=t[o],a<s?s=a:a>i&&(i=a);return{min:s,max:i}}function T_(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(s){t>s&&(t=s),e<s&&(e=s),n++,r+=s},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function Kx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const s=t.length/n,i=new Float64Array(s);for(let a=0,o=0;a<s;++a){for(let c=o+n;o<c;++o)i[a]+=t[o]*t[o];i[a]**=.5}return Kf(i,0,1)}return Kf(t,e<0?0:e,n)}function rp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function dh(t){return Object.prototype.toString.call(t).slice(8,-1)}function v_(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let s=0;s<t.getNumberOfTuples();++s){t.getTuple(s,r);const i=ox(r,e);i>n&&(n=i)}return n}const m_={computeRange:Kx,createRangeHelper:T_,fastComputeRange:Kf,getDataType:dh,getMaxNorm:v_};function S_(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const s=t.getNumberOfComponents(),i=e.values.length/(s>0?s:1);if(r===i)return!0;if(r>i){const a=e.values;return e.values=pi(e.dataType,(r+i)*s),e.values.set(a),!0}return e.size>r*s&&(e.size=r*s,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=r=>{n(r);const s=r*t.getNumberOfComponents();return e.size!==s?(e.size=s,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+s]},t.setComponent=(r,s,i)=>{i!==e.values[r*e.numberOfComponents+s]&&(e.values[r*e.numberOfComponents+s]=i,t.dataChange())},t.getValue=r=>{const s=r/e.numberOfComponents,i=r%e.numberOfComponents;return t.getComponent(s,i)},t.setValue=(r,s)=>{const i=r/e.numberOfComponents,a=r%e.numberOfComponents;t.setComponent(i,a,s)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,s=r;s<0&&(s=e.numberOfComponents===1?0:e.numberOfComponents);let i=null;return e.ranges||(e.ranges=rp(e.ranges,e.numberOfComponents)),i=e.ranges[s],i?(e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple):(i=Kx(t.getData(),r,e.numberOfComponents),e.ranges[s]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple)},t.setRange=(r,s)=>{e.ranges||(e.ranges=rp(e.ranges,e.numberOfComponents));const i={min:r.min,max:r.max};return e.ranges[s]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple},t.getRanges=function(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0))return structuredClone(e.ranges);const s=[];for(let i=0;i<e.numberOfComponents;i++){const[a,o]=t.getRange(i),c={min:a,max:o};s.push(c)}if(e.numberOfComponents>1){const[i,a]=t.getRange(-1),o={min:i,max:a};s.push(o)}return s},t.setTuple=(r,s)=>{const i=r*e.numberOfComponents;for(let a=0;a<e.numberOfComponents;a++)e.values[i+a]=s[a]},t.setTuples=(r,s)=>{let i=r*e.numberOfComponents;const a=Math.min(s.length,e.size-i);for(let o=0;o<a;)e.values[i++]=s[o++]},t.insertTuple=(r,s)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,s),r),t.insertTuples=(r,s)=>{const i=r+s.length/e.numberOfComponents;return e.size<i*e.numberOfComponents&&(e.size=i*e.numberOfComponents,n(i)),t.setTuples(r,s),i},t.insertNextTuple=r=>{const s=e.size/e.numberOfComponents;return t.insertTuple(s,r)},t.insertNextTuples=r=>{const s=e.size/e.numberOfComponents;return t.insertTuples(s,r)},t.findTuple=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:x_;for(let i=0;i<e.size;i+=e.numberOfComponents)if(Math.abs(r[0]-e.values[i])<=s){let a=!0;for(let o=1;o<e.numberOfComponents;++o)if(Math.abs(r[o]-e.values[i+o])>s){a=!1;break}if(a)return i/e.numberOfComponents}return-1},t.getTuple=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=e.numberOfComponents||1,a=r*i;switch(i){case 4:s[3]=e.values[a+3];case 3:s[2]=e.values[a+2];case 2:s[1]=e.values[a+1];case 1:s[0]=e.values[a];break;default:for(let o=i-1;o>=0;--o)s[o]=e.values[a+o]}return s},t.getTuples=(r,s)=>{const i=(r??0)*e.numberOfComponents,a=(s??t.getNumberOfTuples())*e.numberOfComponents,o=t.getData().subarray(i,a);return o.length>0?o:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>Yx({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,s)=>{e.values=r,e.size=r.length,e.dataType=dh(r),s&&(e.numberOfComponents=s),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(i=>{r[i]||delete r[i]});const s={};return Object.keys(r).sort().forEach(i=>{s[i]=r[i]}),s.mtime&&delete s.mtime,s},t.deepCopy=r=>{const s=t.getDataType(),i=e.values;t.shallowCopy(r),e.ranges=structuredClone(r.getRanges()),(i==null?void 0:i.length)>=r.getNumberOfValues()&&s===r.getDataType()?(i.set(r.getData()),e.values=i,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,s,i,a,o,c)=>{const u=e.numberOfComponents||1;(u!==s.getNumberOfComponents()||u!==a.getNumberOfComponents())&&d_("numberOfComponents must match");const l=s.getTuple(i),f=a.getTuple(o),h=[];switch(h.length=u,u){case 4:h[3]=l[3]+(f[3]-l[3])*c;case 3:h[2]=l[2]+(f[2]-l[2])*c;case 2:h[1]=l[1]+(f[1]-l[1])*c;case 1:h[0]=l[0]+(f[0]-l[0])*c;break;default:for(let g=0;g<u;g++)h[g]=l[g]+(f[g]-l[g])*c}return t.insertTuple(r,h)}}const w_={name:"",numberOfComponents:1,dataType:y_,rangeTuple:[0,0]};function Xx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,w_,n),Array.isArray(n.values)&&n.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=Kl(e.dataType,e.values)):e.values=pi(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=dh(e.values)),st(t,e),Sa(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");S_(t,e)}const Yx=Re(Xx,"vtkDataArray");var ve={newInstance:Yx,extend:Xx,...m_,...Px};function C_(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let s=0;s<r&&s<6;s++)t.addClippingPlane(n[s])}},t.getClippingPlaneInDataCoords=(n,r,s)=>{const i=e.clippingPlanes,a=n;if(i){const o=i.length;if(r>=0&&r<o){const c=i[r],u=c.getNormal(),l=c.getOrigin(),f=u[0],h=u[1],g=u[2],d=-(f*l[0]+h*l[1]+g*l[2]);s[0]=f*a[0]+h*a[4]+g*a[8]+d*a[12],s[1]=f*a[1]+h*a[5]+g*a[9]+d*a[13],s[2]=f*a[2]+h*a[6]+g*a[10]+d*a[14],s[3]=f*a[3]+h*a[7]+g*a[11]+d*a[15];return}}C.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const M_={clippingPlanes:[]};function E_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,M_,n),C.obj(t,e),C.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),C_(t,e)}var qx={extend:E_};function __(t,e){t.getBounds=()=>(C.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),ah()),t.getCenter=()=>{var r;const n=t.getBounds();return e.center=be.isValid(n)?be.getCenter(n):null,(r=e.center)==null?void 0:r.slice()},t.getLength=()=>{const n=t.getBounds();return be.getDiagonalLength(n)}}const R_=t=>({bounds:[...be.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function O_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,R_(n)),qx.extend(t,e,n),C.setGet(t,e,["viewSpecificProperties"]),__(t,e)}var D_={extend:O_};const{vtkErrorMacro:sp,vtkWarningMacro:b_}=C;function L_(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:an(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(s=>s),e.arrays=r.arrays().map(s=>({array:s}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const s=r.getName(),{array:i,index:a}=t.getArrayWithIndex(s);return i!=null?(e.arrays[a]={data:r},a):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const s=e.arrays.findIndex(i=>i.data.getName()===r);return t.removeArrayByIndex(s)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((s,i,a)=>i.data.getName()===r?i.data:s,null),t.getArrayWithIndex=r=>{const s=e.arrays.findIndex(i=>i.data.getName()===r);return{array:s!==-1?e.arrays[s].data:null,index:s}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const s=e.arrays[r];return s?s.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(a=>{const o=t.getFlag(a.getName());if(o!==!1&&!(e.doCopyAllOff&&o!==!0)&&a){let c=t.getArrayByName(a.getName());if(c)if(a.getNumberOfComponents()===c.getNumberOfComponents())if(s>-1&&s<a.getNumberOfTuples()){const u=i>-1?i:s;c.insertTuple(u,a.getTuple(s))}else c.insertTuples(0,a.getTuples());else sp("Unhandled case in passData");else if(s<0||s>a.getNumberOfTuples())t.addArray(a),r.getAttributes(a).forEach(u=>{t.setAttribute(a,u)});else{const u=a.getNumberOfComponents();let l=a.getNumberOfValues();const f=i>-1?i:s;l<=f*u&&(l=(f+1)*u),c=ve.newInstance({name:a.getName(),dataType:a.getDataType(),numberOfComponents:u,values:C.newTypedArray(a.getDataType(),l),size:0}),c.insertTuple(f,a.getTuple(s)),t.addArray(c),r.getAttributes(a).forEach(h=>{t.setAttribute(c,h)})}}})},t.interpolateData=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const u=t.getFlag(c.getName());if(u!==!1&&!(e.doCopyAllOff&&u!==!0)&&c){let l=t.getArrayByName(c.getName());if(l)if(c.getNumberOfComponents()===l.getNumberOfComponents())if(s>-1&&s<c.getNumberOfTuples()){const f=a>-1?a:s;l.interpolateTuple(f,c,s,c,i,o),b_("Unexpected case in interpolateData")}else l.insertTuples(c.getTuples());else sp("Unhandled case in interpolateData");else if(s<0||i<0||s>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(f=>{t.setAttribute(c,f)});else{const f=c.getNumberOfComponents();let h=c.getNumberOfValues();const g=a>-1?a:s;h<=g*f&&(h=(g+1)*f),l=ve.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:f,values:C.newTypedArray(c.getDataType(),h),size:0}),l.interpolateTuple(g,c,s,c,i,o),t.addArray(l),r.getAttributes(c).forEach(d=>{t.setAttribute(l,d)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(s=>{const i=s.newClone();return i.deepCopy(s),{data:i}})},t.copyFlags=r=>r.getCopyFieldFlags().map(s=>s),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,s)=>s.data.getMTime()>r?s.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,s)=>r+s.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(s=>({data:s.data.getState()}))),r}}const V_={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function Zx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V_,n),C.obj(t,e),L_(t,e)}const F_=C.newInstance(Zx,"vtkFieldData");var B_={newInstance:F_,extend:Zx};const k_={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},N_={MAX:0,EXACT:1,NOLIMIT:2},U_={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},G_={DUPLICATEPOINT:1,HIDDENPOINT:2},A_={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},z_="vtkGhostType",$_={DEFAULT:0,SINGLE:1,DOUBLE:2};var Qx={AttributeCopyOperations:A_,AttributeLimitTypes:N_,AttributeTypes:k_,CellGhostTypes:U_,DesiredOutputPrecision:$_,PointGhostTypes:G_,ghostArrayName:z_};const{AttributeTypes:rr,AttributeCopyOperations:Nr}=Qx,{vtkWarningMacro:Wa}=C;function W_(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(a){let o=n.find(c=>rr[c.toUpperCase()]===a||typeof a!="number"&&c.toLowerCase()===a.toLowerCase());return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes");const s={...t};t.checkNumberOfComponents=a=>!0,t.setAttribute=(a,o)=>{const c=r(o);if(a&&c.toUpperCase()==="PEDIGREEIDS"&&!a.isA("vtkDataArray"))return Wa(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(a&&!t.checkNumberOfComponents(a,c))return Wa(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let u=e[`active${c}`];if(u>=0&&u<e.arrays.length){if(e.arrays[u]===a)return u;t.removeArrayByIndex(u)}return a?(u=t.addArray(a),e[`active${c}`]=u):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=a=>n.filter(o=>t[`get${o}`]()===a),t.setActiveAttributeByName=(a,o)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(a).index,o),t.setActiveAttributeByIndex=(a,o)=>{const c=r(o);if(a>=0&&a<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const u=t.getArrayByIndex(a);if(!u.isA("vtkDataArray"))return Wa(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(u,c))return Wa(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=a,t.modified(),a}return a===-1&&(e[`active${c}`]=a,t.modified()),-1},t.getActiveAttribute=a=>{const o=r(a);return t[`get${o}`]()},t.removeAllArrays=()=>{n.forEach(a=>{e[`active${a}`]=-1}),s.removeAllArrays()},t.removeArrayByIndex=a=>(a!==-1&&n.forEach(o=>{a===e[`active${o}`]?e[`active${o}`]=-1:a<e[`active${o}`]&&(e[`active${o}`]-=1)}),s.removeArrayByIndex(a)),n.forEach(a=>{const o=`active${a}`;t[`get${a}`]=()=>t.getArrayByIndex(e[o]),t[`set${a}`]=c=>t.setAttribute(c,a),t[`setActive${a}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,a),t[`copy${a}Off`]=()=>{const c=a.toUpperCase();e.copyAttributeFlags[Nr.PASSDATA][rr[c]]=!1},t[`copy${a}On`]=()=>{const c=a.toUpperCase();e.copyAttributeFlags[Nr.PASSDATA][rr[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(Nr).filter(a=>a!=="ALLCOPY").forEach(a=>{e.copyAttributeFlags[Nr[a]]=Object.keys(rr).filter(o=>o!=="NUM_ATTRIBUTES").reduce((o,c)=>(o[rr[c]]=!0,o),[])}),e.copyAttributeFlags[Nr.COPYTUPLE][rr.GLOBALIDS]=!1,e.copyAttributeFlags[Nr.INTERPOLATE][rr.GLOBALIDS]=!1,e.copyAttributeFlags[Nr.COPYTUPLE][rr.PEDIGREEIDS]=!1},t.initialize=C.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(a=>{!e.dataArrays[a].ref&&e.dataArrays[a].type==="vtkDataArray"&&t.addArray(ve.newInstance(e.dataArrays[a]))});const i=t.shallowCopy;t.shallowCopy=(a,o)=>{i(a,o),e.arrays=a.getArrays().map(c=>{const u=c.newClone();return u.shallowCopy(c,o),{data:u}})},t.initializeAttributeCopyFlags()}const H_={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function Jx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,H_,n),B_.extend(t,e,n),C.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),W_(t,e)}const I_=C.newInstance(Jx,"vtkDataSetAttributes");var ip={newInstance:I_,extend:Jx,...Qx};const j_={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},P_={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var K_={FieldDataTypes:j_,FieldAssociations:P_};const Xf=["pointData","cellData","fieldData"];function X_(t,e){e.classHierarchy.push("vtkDataSet"),Xf.forEach(r=>{e[r]?e[r]=an(e[r]):e[r]=ip.newInstance()});const n=t.shallowCopy;t.shallowCopy=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,s),Xf.forEach(i=>{e[i]=ip.newInstance(),e[i].shallowCopy(r.getReferenceByName(i))})}}const Y_={};function e1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Y_,n),C.obj(t,e),C.setGet(t,e,Xf),X_(t,e)}const q_=C.newInstance(e1,"vtkDataSet");var xs={newInstance:q_,extend:e1,...K_};const Kt={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var t1={StructuredType:Kt};const{StructuredType:Vn}=t1;function Z_(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?Vn.EMPTY:e===3?Vn.XYZ_GRID:e===2?t[0]===t[1]?Vn.YZ_PLANE:t[2]===t[3]?Vn.XZ_PLANE:Vn.XY_PLANE:e===1?t[0]<t[1]?Vn.X_LINE:t[2]<t[3]?Vn.Y_LINE:Vn.Z_LINE:Vn.SINGLE_POINT}var Q_={getDataDescriptionFromExtent:Z_,...t1};const{vtkErrorMacro:Ur}=C;function J_(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Ur("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];const i=r.length===1?r[0]:r;if(i.length!==6)return!1;const a=e.extent.some((o,c)=>o!==i[c]);return a&&(e.extent=i.slice(),e.dataDescription=Q_.getDataDescriptionFromExtent(e.extent),t.modified()),a},t.setDimensions=function(){let n,r,s;if(e.deleted){Ur("instance deleted - cannot call any method");return}if(arguments.length===1){const i=arguments.length<=0?void 0:arguments[0];n=i[0],r=i[1],s=i[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],s=arguments.length<=2?void 0:arguments[2];else{Ur("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,s-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let r=1;for(let s=0;s<3;s++){if(n[s]===0)return 0;n[s]>1&&(r*=n[s]-1)}return r},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return Ur("Requesting a point from an empty image."),null;const s=new Float64Array(3);switch(e.dataDescription){case Kt.EMPTY:return null;case Kt.SINGLE_POINT:break;case Kt.X_LINE:s[0]=n;break;case Kt.Y_LINE:s[1]=n;break;case Kt.Z_LINE:s[2]=n;break;case Kt.XY_PLANE:s[0]=n%r[0],s[1]=n/r[0];break;case Kt.YZ_PLANE:s[1]=n%r[1],s[2]=n/r[1];break;case Kt.XZ_PLANE:s[0]=n%r[0],s[2]=n/r[0];break;case Kt.XYZ_GRID:s[0]=n%r[0],s[1]=n/r[0]%r[1],s[2]=n/(r[0]*r[1]);break;default:Ur("Invalid dataDescription");break}const i=[0,0,0];return t.indexToWorld(s,i),i},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>be.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>be.inflate([...e.extent],.5),t.computeTransforms=()=>{ty(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],hs(e.indexToWorld,e.indexToWorld,e.spacing),wt(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return we(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return we(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return be.transformBounds(n,e.indexToWorld,r)},t.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return be.transformBounds(n,e.worldToIndex,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>be.getCenter(t.getBounds()),t.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const s=[0,0,0,0,0,0];t.worldToIndexBounds(n,s);const i=[0,0,0],a=[0,0,0];be.computeCornerPoints(s,i,a),Jg(i,i),Jg(a,a);const o=t.getDimensions();ep(i,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],i),ep(a,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],a);const c=o[0],u=o[0]*o[1],l=t.getPointData().getScalars().getData();let f=-1/0,h=1/0,g=0,d=0,p=0;for(let T=i[2];T<=a[2];T++)for(let v=i[1];v<=a[1];v++){let S=i[0]+v*c+T*u;for(let w=i[0];w<=a[0];w++){if(!r||r([w,v,T],s)){const M=l[S];M>f&&(f=M),M<h&&(h=M),g+=M*M,d+=M,p+=1}++S}}const y=p>0?d/p:0,x=p?Math.abs(g/p-y*y):0,m=Math.sqrt(x);return{minimum:h,maximum:f,average:y,variance:x,sigma:m,count:p}},t.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=[];let i=r;for(let a=0;a<3;++a)s[a]=i,i*=n[a*2+1]-n[a*2]+1;return s},t.computeOffsetIndex=n=>{let[r,s,i]=n;const a=t.getExtent(),o=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(a,o);return Math.floor((Math.round(r)-a[0])*c[0]+(Math.round(s)-a[2])*c[1]+(Math.round(i)-a[4])*c[2])},t.getOffsetIndexFromWorld=n=>{const r=t.getExtent(),s=t.worldToIndex(n);for(let i=0;i<3;++i)if(s[i]<r[i*2]||s[i]>r[i*2+1])return Ur(`GetScalarPointer: Pixel ${s} is not in memory. Current extent = ${r}`),NaN;return t.computeOffsetIndex(s)},t.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const s=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=s)return Ur(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${s}`),NaN;const i=t.getOffsetIndexFromWorld(n);return Number.isNaN(i)?i:t.getPointData().getScalars().getComponent(i,r)}}const eR={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Kt.EMPTY};function n1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eR,n),xs.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=ys(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),C.get(t,e,["indexToWorld","worldToIndex"]),C.setGetArray(t,e,["origin","spacing"],3),C.setGetArray(t,e,["direction"],9),C.getArray(t,e,["extent"],6),J_(t,e)}const tR=C.newInstance(n1,"vtkImageData");var nR={newInstance:tR,extend:n1};const rR={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},Yf={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},sR={LINEAR:0,LOG10:1};var yh={VectorMode:rR,ScalarMappingTarget:Yf,Scale:sR};const iR={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},aR={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},oR={BY_ID:0,BY_NAME:1};var Uc={ColorMode:iR,GetArray:oR,ScalarMode:aR};const{ScalarMappingTarget:ap,Scale:cR,VectorMode:vn}=yh,{VtkDataTypes:sr}=ve,{ColorMode:Ha}=Uc,{vtkErrorMacro:op}=C;function uR(t){return t}function cp(t){return Math.floor(t*255+.5)}function fR(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(vn.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(vn.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(vn.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){op("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const s=r.length;for(let i=0;i<s;i++)e.annotationArray.push({value:n[i],annotation:String(r[i])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let s=t.checkForAnnotatedValue(n),i=!1;return s>=0?e.annotationArray[s].annotation!==r&&(e.annotationArray[s].annotation=r,i=!0):(e.annotationArray.push({value:n,annotation:r}),s=e.annotationArray.length-1,i=!0),i&&(t.updateAnnotatedValueMap(),t.modified()),s},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),s=r>=0;return s&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),s},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const s=t.getAnnotatedValueIndex(n);t.getIndexedColor(s,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,s)=>{const i=n.getNumberOfComponents();let a=null;if(r===Ha.DEFAULT&&(n.getDataType()===sr.UNSIGNED_CHAR||n.getDataType()===sr.UNSIGNED_CHAR_CLAMPED)||r===Ha.DIRECT_SCALARS&&n)a=t.convertToRGBA(n,i,n.getNumberOfTuples());else{const o={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:sr.UNSIGNED_CHAR},c=C.newTypedArray(o.dataType,4*n.getNumberOfTuples());o.values=c,o.size=c.length,a=ve.newInstance(o);let u=s;u<0&&i>1?t.mapVectorsThroughTable(n,a,ap.RGBA,-1,-1):(u<0&&(u=0),u>=i&&(u=i-1),t.mapScalarsThroughTable(n,a,ap.RGBA,u))}return a},t.mapVectorsToMagnitude=(n,r,s)=>{const i=n.getNumberOfTuples(),a=n.getNumberOfComponents(),o=r.getData(),c=n.getData();for(let u=0;u<i;u++){let l=0;for(let f=0;f<s;f++)l+=c[u*a+f]*c[u*a+f];o[u]=Math.sqrt(l)}},t.mapVectorsThroughTable=(n,r,s,i,a)=>{let o=t.getVectorMode(),c=a,u=i;const l=n.getNumberOfComponents();o===vn.COMPONENT?(u===-1&&(u=t.getVectorComponent()),u<0&&(u=0),u>=l&&(u=l-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(u=0,c=l):(u<0&&(u=0),u>=l&&(u=l-1),u+c>l&&(c=l-u)),o===vn.MAGNITUDE&&(l===1||c===1)&&(o=vn.COMPONENT));let f=0;switch(u>0&&(f=u),o){case vn.COMPONENT:{t.mapScalarsThroughTable(n,r,s,f);break}case vn.RGBCOLORS:break;case vn.MAGNITUDE:default:{const h=ve.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,h,c),t.mapScalarsThroughTable(h,r,s,0);break}}},t.luminanceToRGBA=(n,r,s,i)=>{const a=i(s),o=r.getData(),c=n.getData(),u=o.length,l=0,f=1;let h=0;for(let g=l;g<u;g+=f){const d=i(o[g]);c[h*4]=d,c[h*4+1]=d,c[h*4+2]=d,c[h*4+3]=a,h++}},t.luminanceAlphaToRGBA=(n,r,s,i)=>{const a=r.getData(),o=n.getData(),c=a.length,u=0,l=2;let f=0;for(let h=u;h<c;h+=l){const g=i(a[h]);o[f]=g,o[f+1]=g,o[f+2]=g,o[f+3]=i(a[h+1])*s,f+=4}},t.rGBToRGBA=(n,r,s,i)=>{const a=cp(s),o=r.getData(),c=n.getData(),u=o.length,l=0,f=3;let h=0;for(let g=l;g<u;g+=f)c[h*4]=i(o[g]),c[h*4+1]=i(o[g+1]),c[h*4+2]=i(o[g+2]),c[h*4+3]=a,h++},t.rGBAToRGBA=(n,r,s,i)=>{const a=r.getData(),o=n.getData(),c=a.length,u=0,l=4;let f=0;for(let h=u;h<c;h+=l)o[f*4]=i(a[h]),o[f*4+1]=i(a[h+1]),o[f*4+2]=i(a[h+2]),o[f*4+3]=i(a[h+3])*s,f++},t.convertToRGBA=(n,r,s)=>{let{alpha:i}=e;if(r===4&&i>=1&&n.getDataType()===sr.UNSIGNED_CHAR)return n;const a=ve.newInstance({numberOfComponents:4,empty:!0,size:4*s,dataType:sr.UNSIGNED_CHAR});if(s<=0)return a;i=i>0?i:0,i=i<1?i:1;let o=uR;switch((n.getDataType()===sr.FLOAT||n.getDataType()===sr.DOUBLE)&&(o=cp),r){case 1:t.luminanceToRGBA(a,n,i,o);break;case 2:t.luminanceAlphaToRGBA(a,n,o);break;case 3:t.rGBToRGBA(a,n,i,o);break;case 4:t.rGBAToRGBA(a,n,i,o);break;default:return op("Cannot convert colors"),null}return a},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,s)=>{if(!n)return t.isOpaque();const i=n.getNumberOfComponents();return r===Ha.DEFAULT&&n.getDataType()===sr.UNSIGNED_CHAR||r===Ha.DIRECT_SCALARS?i===3||i===1?e.alpha>=1:n.getRange(i-1)[0]===255:!0}}const lR={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:vn.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1,scale:cR.LINEAR};function r1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lR,n),C.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],C.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),C.setArray(t,e,["mappingRange"],2),C.getArray(t,e,["mappingRange"]),fR(t,e)}const hR=C.newInstance(r1,"vtkScalarsToColors");var s1={newInstance:hR,extend:r1,...yh};const{vtkErrorMacro:up}=C,fp=0,lp=1,uu=2;function gR(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(n,r)=>{let s=0;const i=Number(n);return i<r.range[0]?s=r.maxIndex+fp+1.5:i>r.range[1]?s=r.maxIndex+lp+1.5:(s=(i+r.shift)*r.scale,s=s<r.maxIndex?s:r.maxIndex),Math.floor(s)},t.linearLookup=(n,r,s)=>{let i=0;ux(n)?i=Math.floor(s.maxIndex+1.5+uu):i=t.linearIndexLookup(n,s);const a=4*i;return r.slice(a,a+4)},t.indexedLookupFunction=(n,r,s)=>{let i=t.getAnnotatedValueIndexInternal(n);i===-1&&(i=e.numberOfColors+uu);const a=4*i;return[r[a],r[a+1],r[a+2],r[a+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,s,i)=>{let a=t.linearLookup;e.indexedLookup&&(a=t.indexedLookupFunction);const o=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:o,shift:0,scale:0};t.lookupShiftAndScale(o,c);const u=t.getAlpha(),l=n.getNumberOfTuples(),f=n.getNumberOfComponents(),h=r.getData(),g=n.getData();if(u>=1){if(s===Yf.RGBA)for(let d=0;d<l;d++){const p=a(g[d*f+i],e.table,c);h[d*4]=p[0],h[d*4+1]=p[1],h[d*4+2]=p[2],h[d*4+3]=p[3]}}else if(s===Yf.RGBA)for(let d=0;d<l;d++){const p=a(g[d*f+i],e.table,c);h[d*4]=p[0],h[d*4+1]=p[1],h[d*4+2]=p[2],h[d*4+3]=Math.floor(p[3]*u+.5)}},t.forceBuild=()=>{let n=0,r=0,s=0,i=0;const a=e.numberOfColors-1;a&&(n=(e.hueRange[1]-e.hueRange[0])/a,r=(e.saturationRange[1]-e.saturationRange[0])/a,s=(e.valueRange[1]-e.valueRange[0])/a,i=(e.alphaRange[1]-e.alphaRange[0])/a),e.table.length=4*a+16;const o=[],c=[];for(let u=0;u<=a;u++)o[0]=e.hueRange[0]+u*n,o[1]=e.saturationRange[0]+u*r,o[2]=e.valueRange[0]+u*s,kE(o,c),c[3]=e.alphaRange[0]+u*i,e.table[u*4]=c[0]*255+.5,e.table[u*4+1]=c[1]*255+.5,e.table[u*4+2]=c[2]*255+.5,e.table[u*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const s=n[0].length;e.numberOfColors=n.length;const i=4-s;let a=0;for(let o=0;o<e.numberOfColors;o++)e.table[o*4]=255,e.table[o*4+1]=255,e.table[o*4+2]=255,e.table[o*4+3]=255;for(let o=0;o<n.length;o++){const c=n[o];for(let u=0;u<s;u++)e.table[a++]=c[u];a+=i}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return up("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==tt.UNSIGNED_CHAR)return up("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let s=0;s<r.length;s++)e.table[s]=r[s];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let s=(n+fp)*4;e.useBelowRangeColor||n===0?(r[s]=e.belowRangeColor[0]*255+.5,r[s+1]=e.belowRangeColor[1]*255+.5,r[s+2]=e.belowRangeColor[2]*255+.5,r[s+3]=e.belowRangeColor[3]*255+.5):(r[s]=r[0],r[s+1]=r[1],r[s+2]=r[2],r[s+3]=r[3]),s=(n+lp)*4,e.useAboveRangeColor||n===0?(r[s]=e.aboveRangeColor[0]*255+.5,r[s+1]=e.aboveRangeColor[1]*255+.5,r[s+2]=e.aboveRangeColor[2]*255+.5,r[s+3]=e.aboveRangeColor[3]*255+.5):(r[s]=r[4*(n-1)+0],r[s+1]=r[4*(n-1)+1],r[s+2]=r[4*(n-1)+2],r[s+3]=r[4*(n-1)+3]),s=(n+uu)*4,r[s]=e.nanColor[0]*255+.5,r[s+1]=e.nanColor[1]*255+.5,r[s+2]=e.nanColor[2]*255+.5,r[s+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const pR={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function i1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pR,n),s1.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},C.obj(e.buildTime),e.opaqueFlagBuildTime={},C.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},C.obj(e.insertTime,{mtime:0}),C.get(t,e,["buildTime"]),C.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),C.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),C.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),C.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),gR(t,e)}const dR=C.newInstance(i1,"vtkLookupTable");var a1={newInstance:dR,extend:i1};const br={Off:0,PolygonOffset:1};let qf=br.PolygonOffset,cc=br.Off;const yR=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function xR(){return qf}function TR(t){const e=qf===t;return qf=t,e}function vR(){return cc}function Gc(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=cc===t;return cc=t,e}function mR(){return Gc(br.Off)}function SR(){return Gc(br.Off)}function wR(){return Gc(br.PolygonOffset)}function CR(){return yR[cc]}var Zf={Resolve:br,getResolveCoincidentTopologyAsString:CR,getResolveCoincidentTopologyPolygonOffsetFaces:xR,getResolveCoincidentTopology:vR,setResolveCoincidentTopology:Gc,setResolveCoincidentTopologyPolygonOffsetFaces:TR,setResolveCoincidentTopologyToDefault:mR,setResolveCoincidentTopologyToOff:SR,setResolveCoincidentTopologyToPolygonOffset:wR};function o1(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=C.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const xh=["Polygon","Line","Point"],MR={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},ER=()=>{},es={modified:ER};o1(es,MR,xh.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function _R(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),C.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(Zf).forEach(n=>{t[n]=Zf[n]}),Object.keys(es).filter(n=>n!=="modified").forEach(n=>{t[n]=es[n]}),o1(t,e.topologyOffset,xh.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=es.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=es.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=es.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var c1={implementCoincidentTopologyMethods:_R,staticOffsetAPI:es,otherStaticMethods:Zf,CATEGORIES:xh,Resolve:br};const mt={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var u1={PassTypes:mt};const{FieldAssociations:hp}=xs,{staticOffsetAPI:RR,otherStaticMethods:OR}=c1,{ColorMode:Ia,ScalarMode:Gr,GetArray:fu}=Uc,{VectorMode:DR}=yh,{VtkDataTypes:bR}=ve;function _i(t){return()=>C.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function LR(t,e){const n=t[1]%2===0?1:-1;if(t[0]+=n,t[0]>=e[0]||t[0]<0){const r=t[2]%2===0?1:-1;t[0]-=n,t[1]+=r,(t[1]>=e[1]||t[1]<0)&&(t[1]-=r,t[2]++)}}function VR(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function gp(t,e,n){const r=Math.floor(e),s=r%(2*n[0]);let i,a;s<n[0]?(t[0]=s,i=1,a=t[0]===n[0]-1):(t[0]=2*n[0]-1-s,i=-1,a=t[0]===0);const o=Math.floor(r/n[0]),c=o%(2*n[1]);let u,l;c<n[1]?(t[1]=c,u=1,l=t[1]===n[1]-1):(t[1]=2*n[1]-1-c,u=-1,l=t[1]===0),t[2]=Math.floor(o/n[1]);const f=e-r;a?l?t[2]+=f:t[1]+=u*f:t[0]+=i*f,t[0]=(t[0]+.5)/n[0],t[1]=(t[1]+.5)/n[1],t[2]=(t[2]+.5)/n[2]}const pp=new WeakMap;function FR(t,e,n,r,s,i,a){var V;const o=new Array(arguments.length);for(let L=0;L<arguments.length;++L){const F=arguments[L];o[L]=((V=F.getMTime)==null?void 0:V.call(F))??F}const c=o.join("/"),u=pp.get(t);if(u&&u.stringHash===c)return u.textureCoordinates;const l=(n[1]-n[0])/(s-1),[f,h]=[n[0]-l,n[1]+l],g=f-.5*l,d=1/(h-f+l),p=f,y=(s+1)/(h-f),x=t.getData(),m=t.getNumberOfTuples(),T=t.getNumberOfComponents(),v=e<0||e>=T,S=i[2]<=1?2:3,w=ve.newInstance({numberOfComponents:S,values:new Float32Array(m*S)}),M=w.getData(),E=[0,0,0];gp(E,s+2,i);let D=0,O=0;const _=[.5,.5,.5];for(let L=0;L<m;++L){let F;if(v){let G=0;for(let A=0;A<T;++A){const H=x[D+A];G+=H*H}F=Math.sqrt(G)}else F=x[D+e];if(r&&(F=Math.log10(F)),D+=T,ux(F))_[0]=E[0],_[1]=E[1],_[2]=E[2];else if(a){let G=(F-p)*y;G<1?G=0:G>s&&(G=s+1),gp(_,G,i)}else{_[1]=.49;const G=(F-g)*d;G>1e3?_[0]=1e3:G<-1e3?_[0]=-1e3:_[0]=G}for(let G=0;G<S;++G)M[O++]=_[G]}return pp.set(t,{stringHash:c,textureCoordinates:w}),w}function BR(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=ah(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=a1.newInstance()},t.getColorModeAsString=()=>C.enumToString(Ia,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>C.enumToString(Gr,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,s,i,a)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let o=null,c=!1;if(r===Gr.DEFAULT)o=n.getPointData().getScalars(),o||(o=n.getCellData().getScalars(),c=!0);else if(r===Gr.USE_POINT_DATA)o=n.getPointData().getScalars();else if(r===Gr.USE_CELL_DATA)o=n.getCellData().getScalars(),c=!0;else if(r===Gr.USE_POINT_FIELD_DATA){const u=n.getPointData();s===fu.BY_ID?o=u.getArrayByIndex(i):o=u.getArrayByName(a)}else if(r===Gr.USE_CELL_FIELD_DATA){const u=n.getCellData();c=!0,s===fu.BY_ID?o=u.getArrayByIndex(i):o=u.getArrayByName(a)}else if(r===Gr.USE_FIELD_DATA){const u=n.getFieldData();s===fu.BY_ID?o=u.getArrayByIndex(i):o=u.getArrayByName(a)}return{scalars:o,cellFlag:c}},t.mapScalars=(n,r)=>{const{scalars:s,cellFlag:i}=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=i,!s){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const a=`${t.getMTime()}${s.getMTime()}${r}`;if(e.colorBuildString!==a){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(s,i))e.mapScalarsToTexture(s,i,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(s,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${s.getMTime()}${r}`}},e.mapScalarsToTexture=(n,r,s)=>{const i=e.lookupTable.getRange(),a=e.lookupTable.usingLogScale(),o=e.lookupTable.getAlpha(),c=a?[Math.log10(i[0]),Math.log10(i[1])]:i;if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==s){e.lookupTable.setAlpha(s),e.colorTextureMap=null,e.lookupTable.build();const l=e.lookupTable.getNumberOfAvailableColors(),f=2048,h=f**3-3,d=4096-2,p=2,y=r?h:d;e.numberOfColorsInRange=Math.min(Math.max(l,p),y);const x=e.numberOfColorsInRange+3,m=e.numberOfColorsInRange+2,T=r?[Math.min(Math.ceil(x/f**0),f),Math.min(Math.ceil(x/f**1),f),Math.min(Math.ceil(x/f**2),f)]:[m,2,1],v=T[0]*T[1]*T[2],S=new Float64Array(v);S.fill(NaN);const w=e.numberOfColorsInRange,M=w+2,E=[0,0,0],D=c[0],O=c[1]-c[0];for(let L=0;L<M;++L){const F=VR(E,T),G=D+O*(L-1)/(w-1),A=a?10**G:G;S[F]=A,LR(E,T)}const _=ve.newInstance({numberOfComponents:1,values:S}),V=e.lookupTable.mapScalars(_,e.colorMode,0);e.colorTextureMap=nR.newInstance(),e.colorTextureMap.setDimensions(T),e.colorTextureMap.getPointData().setScalars(V),e.lookupTable.setAlpha(o)}const u=e.lookupTable.getVectorMode()===DR.MAGNITUDE&&n.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=FR(n,u,c,a,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),r)},t.getIsOpaque=()=>{const n=t.getInputData(),s=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||s==null)return!0;const i=t.getLookupTable();return i?(i.build(),i.areScalarsOpaque(s,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(n,r)=>r&&e.colorMode!==Ia.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!n||e.colorMode===Ia.DEFAULT&&n.getDataType()===bR.UNSIGNED_CHAR||e.colorMode===Ia.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=_i("AcquireInvertibleLookupTable"),t.valueToColor=_i("ValueToColor"),t.colorToValue=_i("ColorToValue"),t.useInvertibleColorFor=_i("UseInvertibleColorFor"),t.clearInvertibleColor=_i("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const s=n.getRawPixelBuffer(mt.ID_LOW24),i=n.getRawPixelBuffer(mt.ID_HIGH24),a=n.getCurrentPass(),o=n.getFieldAssociation();let c=null;o===hp.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:o===hp.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(u=>{if(a===mt.ID_LOW24){let l=0;i&&(l+=i[u],l*=256),l+=s[u+2],l*=256,l+=s[u+1],l*=256,l+=s[u];const f=c[l],h=n.getPixelBuffer(mt.ID_LOW24);h[u]=f&255,h[u+1]=(f&65280)>>8,h[u+2]=(f&16711680)>>16}else if(a===mt.ID_HIGH24&&i){let l=0;l+=i[u],l*=256,l+=s[u+2],l*=256,l+=s[u+1],l*=256,l+=s[u];const f=c[l],h=n.getPixelBuffer(mt.ID_HIGH24);h[u]=(f&4278190080)>>24}})}}const kR={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function f1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kR,n),D_.extend(t,e,n),C.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),C.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),C.setGetArray(t,e,["scalarRange"],2),c1.implementCoincidentTopologyMethods(t,e),BR(t,e)}const NR=C.newInstance(f1,"vtkMapper");var ds={newInstance:NR,extend:f1,...RR,...OR,...Uc};function l1(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function h1(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const UR={extractCellSizes:l1,getNumberOfCells:h1};function GR(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=h1(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=l1(t.getData())),e.cellSizes),t.resize=r=>{const s=t.getNumberOfTuples();n.resize(r);const i=t.getNumberOfTuples();i<s&&(i===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let s=r;const i=e.values[s++];return e.values.subarray(s,s+i)},t.insertNextCell=r=>{const s=t.getNumberOfCells();return t.insertNextTuples([r.length,...r]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(r.length),s}}function AR(t){return{empty:!0,numberOfComponents:1,dataType:tt.UNSIGNED_INT,...t}}function g1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ve.extend(t,e,AR(n)),GR(t,e)}const zR=C.newInstance(g1,"vtkCellArray");var dp={newInstance:zR,extend:g1,...UR};const{vtkErrorMacro:$R}=C,WR=[1,-1,1,-1,1,-1];function HR(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=C.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];t.setTuple(n,s)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(n,r,s)=>t.insertNextTuple([n,r,s]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const s=t.getRange(0);e.bounds[0]=s[0],e.bounds[1]=s[1];const i=t.getRange(1);e.bounds[2]=i[0],e.bounds[3]=i[1];const a=t.getRange(2);return e.bounds[4]=a[0],e.bounds[5]=a[1],e.bounds}if(t.getNumberOfComponents()!==2)return $R(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),WR;const n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];const r=t.getRange(1);return e.bounds[2]=r[0],e.bounds[3]=r[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const IR={empty:!0,numberOfComponents:3,dataType:tt.FLOAT,bounds:[1,-1,1,-1,1,-1]};function p1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IR,n),ve.extend(t,e,n),HR(t,e)}const jR=C.newInstance(p1,"vtkPoints");var uc={newInstance:jR,extend:p1};function PR(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let s=e.points.getData();s.length!==3*e.pointsIds.length&&(s=C.newTypedArray(n.getDataType(),3*e.pointsIds.length));const i=n.getData();e.pointsIds.forEach((a,o)=>{let c=3*a,u=3*o;s[u]=i[c],s[++u]=i[++c],s[++u]=i[++c]}),e.points.setData(s)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let s=n.getNumberOfPoints()-1;s>=0;--s)e.pointsIds[s]=s}},t.getBounds=()=>{const n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(let s=1;s<n;s++)e.points.getPoint(s,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else ih(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let n=0,r=0;for(let s=0;s<3;s++)r=e.bounds[2*s+1]-e.bounds[2*s],n+=r*r;return n},t.getParametricDistance=n=>{let r,s=0;for(let i=0;i<3;i++)n[i]<0?r=-n[i]:n[i]>1?r=n[i]-1:r=0,r>s&&(s=r);return s},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,s,i,a,o,c)=>{},t.evaluatePosition=(n,r,s,i,a,o)=>{C.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const KR={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function d1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KR,n),C.obj(t,e),e.points||(e.points=uc.newInstance()),C.get(t,e,["points","pointsIds"]),PR(t,e)}const XR=C.newInstance(d1,"vtkCell");var fc={newInstance:XR,extend:d1};function YR(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function qR(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),s=n.getNumberOfCells(),i=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let a=0;a<s;++a){const{cellPointIds:o}=n.getCellPoints(a);o.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let a=0;a<s;++a){const{cellPointIds:o}=n.getCellPoints(a);o.forEach(c=>{t.insertCellReference(c,i[c]++,a)})}}else{for(let a=0;a<s;a++)fc.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let a=0;a<s;++a)fc.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,i[c]++,a)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(s=>s!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{YR(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,s)=>{e.array[n].cells[r]=s}}const ZR={array:null,maxId:0,extend:0};function y1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZR,n),C.obj(t,e),qR(t,e)}const QR=C.newInstance(y1,"vtkCellLinks");var JR={newInstance:QR,extend:y1};const De={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},Qf=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function eO(t){return t<Qf.length?Qf[t]:"UnknownClass"}function tO(t){return Qf.findIndex(t)}function nO(t){return t<De.VTK_QUADRATIC_EDGE||t===De.VTK_CONVEX_POINT_SET||t===De.VTK_POLYHEDRON}function rO(t){return t===De.VTK_TRIANGLE_STRIP||t===De.VTK_POLY_LINE||t===De.VTK_POLY_VERTEX}const sO={getClassNameFromTypeId:eO,getTypeIdFromClassName:tO,isLinear:nO,hasSubCells:rO};function iO(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,s)=>{e.typeArray[n]=r,e.locationArray[n]=s,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,s)=>{e.size=n,e.typeArray=r,e.locationArray=s,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=De.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let s=0;s<r;++s)if(n===t.getCellType(s))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const aO={size:0,maxId:-1,extend:1e3};function x1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aO,n),C.obj(t,e),C.get(t,e,["size","maxId","extend"]),C.getArray(t,e,["typeArray","locationArray"]),iO(t,e)}const oO=C.newInstance(x1,"vtkCellTypes");var cO={newInstance:oO,extend:x1,...sO};const uO={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var T1={IntersectionState:uO};const{IntersectionState:Ao}=T1;function Is(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const s={t:Number.MIN_VALUE,distance:0},i=[];let a;i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2];const o=i[0]*(t[0]-e[0])+i[1]*(t[1]-e[1])+i[2]*(t[2]-e[2]),c=pe(i,i);let u=1e-5*o;return c!==0&&(s.t=o/c),u<0&&(u=-u),-u<c&&c<u||c<=0||s.t<0?a=e:s.t>1?a=n:(a=i,i[0]=e[0]+s.t*i[0],i[1]=e[1]+s.t*i[1],i[2]=e[2]+s.t*i[2]),r&&(r[0]=a[0],r[1]=a[1],r[2]=a[2]),s.distance=mn(a,t),s}function v1(t,e,n,r,s,i){const a=[],o=[],c=[];s[0]=0,i[0]=0,Rr(e,t,a),Rr(r,n,o),Rr(n,t,c);const u=[pe(a,a),-pe(a,o),-pe(a,o),pe(o,o)],l=[];if(l[0]=pe(a,c),l[1]=-pe(o,c),BE(u,l,2)===0){let f=Number.MAX_VALUE;const h=[t,e,n,r],g=[n,n,t,t],d=[r,r,e,e];i[0],i[0],s[0],s[0],s[0],s[0],i[0],i[0];let p;for(let y=0;y<4;y++)p=Is(h[y],g[y],d[y]),p.distance<f&&(f=p.distance,p.t);return Ao.ON_LINE}return s[0]=l[0],i[0]=l[1],s[0]>=0&&s[0]<=1&&i[0]>=0&&i[0]<=1?Ao.YES_INTERSECTION:Ao.NO_INTERSECTION}const fO={distanceToLine:Is,intersection:v1};function lO(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,s,i,a,o)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;const u=[],l=[],f=[];e.points.getPoint(0,l),e.points.getPoint(1,f);const h=[],g=[],d=v1(r,s,l,f,h,g);if(c.t=h[0],c.betweenPoints=n(c.t),o[0]=g[0],d===Ao.YES_INTERSECTION){for(let p=0;p<3;p++)a[p]=l[p]+o[0]*(f[p]-l[p]),u[p]=r[p]+c.t*(s[p]-r[p]);if(mn(a,u)<=i*i)return c.intersect=1,c}else{let p;if(c.t<0)return p=Is(r,l,f,a),p.distance<=i*i&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return p=Is(s,l,f,a),p.distance<=i*i&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(o[0]<0)return o[0]=0,p=Is(l,r,s,a),c.t=p.t,p.distance<=i*i&&(c.intersect=1),c;if(o[0]>1)return o[0]=1,p=Is(f,r,s,a),c.t=p.t,p.distance<=i*i&&(c.intersect=1),c}return c},t.evaluateLocation=(r,s,i)=>{const a=[],o=[];e.points.getPoint(0,a),e.points.getPoint(1,o);for(let c=0;c<3;c++)s[c]=a[c]+r[0]*(o[c]-a[c]);i[0]=1-r[0],i[1]=r[0]},t.evaluateOrientation=(r,s,i)=>e.orientations?(ko(s,e.orientations[0],e.orientations[1],r[0]),i[0]=1-r[0],i[1]=r[0],!0):!1}const hO={orientations:null};function m1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hO,n),fc.extend(t,e,n),C.setGet(t,e,["orientations"]),lO(t,e)}const gO=C.newInstance(m1,"vtkLine");var kt={newInstance:gO,extend:m1,...fO,...T1};function pO(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=an(e.points):e.points=uc.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,s),e.points=uc.newInstance(),e.points.shallowCopy(r.getPoints())}}const dO={};function S1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dO,n),xs.extend(t,e,n),C.setGet(t,e,["points"]),pO(t,e)}const yO=C.newInstance(S1,"vtkPointSet");var xO={newInstance:yO,extend:S1};function Th(t,e,n,r){const s=n[0]-e[0],i=n[1]-e[1],a=n[2]-e[2],o=t[0]-e[0],c=t[1]-e[1],u=t[2]-e[2];r[0]=i*u-a*c,r[1]=a*o-s*u,r[2]=s*c-i*o}function lc(t,e,n,r){Th(t,e,n,r);const s=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);s!==0&&(r[0]/=s,r[1]/=s,r[2]/=s)}function TO(t,e,n,r,s,i){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,o=!1;const c=[],u=[],l=[],f=[],h=[];lc(t,e,n,f),lc(r,s,i,h);const g=-pe(f,t),d=-pe(h,r),p=[pe(h,t)+d,pe(h,e)+d,pe(h,n)+d];if(p[0]*p[1]>a&&p[0]*p[2]>a)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:l};const y=[pe(f,r)+g,pe(f,s)+g,pe(f,i)+g];if(y[0]*y[1]>a&&y[0]*y[2]>a)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:l};if(Math.abs(f[0]-h[0])<1e-9&&Math.abs(f[1]-h[1])<1e-9&&Math.abs(f[2]-h[2])<1e-9&&Math.abs(g-d)<1e-9)return o=!0,{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:l};const x=[t,e,n],m=[r,s,i],T=pe(f,h),v=(g-d*T)/(T*T-1),S=(d-g*T)/(T*T-1),w=[v*f[0]+S*h[0],v*f[1]+S*h[1],v*f[2]+S*h[2]],M=ga(f,h,[]);pa(M);let E=0,D=0;const O=[],_=[];let V=50,L=50;for(let A=0;A<3;A++){const H=A,P=(A+1)%3,U=ii.intersectWithLine(x[H],x[P],r,h);U.intersection&&U.t>0-a&&U.t<1+a&&(U.t<1+a&&U.t>1-a&&(V=E),O[E++]=pe(U.x,M)-pe(w,M));const Y=ii.intersectWithLine(m[H],m[P],t,f);Y.intersection&&Y.t>0-a&&Y.t<1+a&&(Y.t<1+a&&Y.t>1-a&&(L=D),_[D++]=pe(Y.x,M)-pe(w,M))}if(E>2){E--;const A=O[2];O[2]=O[V],O[V]=A}if(D>2){D--;const A=_[2];_[2]=_[L],_[L]=A}if(E!==2||D!==2)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:l};if(Number.isNaN(O[0])||Number.isNaN(O[1])||Number.isNaN(_[0])||Number.isNaN(_[1]))return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:l};if(O[0]>O[1]){const A=O[1];O[1]=O[0],O[0]=A}if(_[0]>_[1]){const A=_[1];_[1]=_[0],_[0]=A}let F,G;return O[1]<_[0]||_[1]<O[0]?{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:l}:(O[0]<_[0]?O[1]<_[1]?(l[0]=2,l[1]=1,F=_[0],G=O[1]):(l[0]=2,l[1]=2,F=_[0],G=_[1]):O[1]<_[1]?(l[0]=1,l[1]=1,F=O[0],G=O[1]):(l[0]=1,l[1]=2,F=O[0],G=_[1]),Qg(w,M,F,c),Qg(w,M,G,u),{intersect:!0,coplanar:o,pt1:c,pt2:u,surfaceId:l})}const vO={computeNormalDirection:Th,computeNormal:lc,intersectWithTriangle:TO};function mO(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,s,i,a)=>{const o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};a[2]=0;const c=[],u=s*s,l=[],f=[],h=[];e.points.getPoint(0,l),e.points.getPoint(1,f),e.points.getPoint(2,h);const g=[],d=[];if(lc(l,f,h,g),g[0]!==0||g[1]!==0||g[2]!==0){const T=ii.intersectWithLine(n,r,l,g);if(o.betweenPoints=T.betweenPoints,o.t=T.t,i[0]=T.x[0],i[1]=T.x[1],i[2]=T.x[2],!T.intersection)return a[0]=0,a[1]=0,o.intersect=0,o;const v=t.evaluatePosition(i,c,a,d);if(v.evaluation>=0)return v.dist2<=u?(o.intersect=1,o):(o.intersect=v.evaluation,o)}const p=mn(l,f),y=mn(f,h),x=mn(h,l);e.line||(e.line=kt.newInstance()),p>y&&p>x?(e.line.getPoints().setPoint(0,l),e.line.getPoints().setPoint(1,f)):y>x&&y>p?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,h)):(e.line.getPoints().setPoint(0,h),e.line.getPoints().setPoint(1,l));const m=e.line.intersectWithLine(n,r,s,i,a);if(o.betweenPoints=m.betweenPoints,o.t=m.t,m.intersect){const T=[],v=[],S=[];for(let w=0;w<3;w++)T[w]=l[w]-h[w],v[w]=f[w]-h[w],S[w]=i[w]-h[w];return a[0]=pe(S,T)/x,a[1]=pe(S,v)/y,o.intersect=1,o}return a[0]=0,a[1]=0,o.intersect=0,o},t.evaluatePosition=(n,r,s,i)=>{const a={subId:0,dist2:0,evaluation:-1};let o,c;const u=[],l=[],f=[],h=[];let g;const d=[],p=[],y=[];let x=0,m=0;const T=[];let v,S,w,M=[];const E=[],D=[],O=[];a.subId=0,s[2]=0,e.points.getPoint(1,u),e.points.getPoint(2,l),e.points.getPoint(0,f),Th(u,l,f,h),ii.generalizedProjectPoint(n,u,h,O);let _=0;for(o=0;o<3;o++)h[o]<0?g=-h[o]:g=h[o],g>_&&(_=g,m=o);for(c=0,o=0;o<3;o++)o!==m&&(T[c++]=o);for(o=0;o<2;o++)d[o]=O[T[o]]-f[T[o]],p[o]=u[T[o]]-f[T[o]],y[o]=l[T[o]]-f[T[o]];if(x=Go(p,y),x===0)return s[0]=0,s[1]=0,a.evaluation=-1,a;if(s[0]=Go(d,y)/x,s[1]=Go(p,d)/x,i[0]=1-(s[0]+s[1]),i[1]=s[0],i[2]=s[1],i[0]>=0&&i[0]<=1&&i[1]>=0&&i[1]<=1&&i[2]>=0&&i[2]<=1)r&&(a.dist2=mn(O,n),r[0]=O[0],r[1]=O[1],r[2]=O[2]),a.evaluation=1;else{let V;if(r){if(i[1]<0&&i[2]<0)for(v=mn(n,f),S=kt.distanceToLine(n,u,f,V,E),w=kt.distanceToLine(n,f,l,V,D),v<S?(a.dist2=v,M=f):(a.dist2=S,M=E),w<a.dist2&&(a.dist2=w,M=D),o=0;o<3;o++)r[o]=M[o];else if(i[2]<0&&i[0]<0)for(v=mn(n,u),S=kt.distanceToLine(n,u,f,V,E),w=kt.distanceToLine(n,u,l,V,D),v<S?(a.dist2=v,M=u):(a.dist2=S,M=E),w<a.dist2&&(a.dist2=w,M=D),o=0;o<3;o++)r[o]=M[o];else if(i[1]<0&&i[0]<0)for(v=mn(n,l),S=kt.distanceToLine(n,l,f,V,E),w=kt.distanceToLine(n,u,l,V,D),v<S?(a.dist2=v,M=l):(a.dist2=S,M=E),w<a.dist2&&(a.dist2=w,M=D),o=0;o<3;o++)r[o]=M[o];else if(i[0]<0){const L=kt.distanceToLine(n,u,l,r);a.dist2=L.distance}else if(i[1]<0){const L=kt.distanceToLine(n,l,f,r);a.dist2=L.distance}else if(i[2]<0){const L=kt.distanceToLine(n,u,f,r);a.dist2=L.distance}}a.evaluation=0}return a},t.evaluateLocation=(n,r,s)=>{const i=[],a=[],o=[];e.points.getPoint(0,i),e.points.getPoint(1,a),e.points.getPoint(2,o);const c=1-n[0]-n[1];for(let u=0;u<3;u++)r[u]=i[u]*c+a[u]*n[0]+o[u]*n[1];s[0]=c,s[1]=n[0],s[2]=n[1]},t.getParametricDistance=n=>{let r,s=0;const i=[];i[0]=n[0],i[1]=n[1],i[2]=1-n[0]-n[1];for(let a=0;a<3;a++)i[a]<0?r=-i[a]:i[a]>1?r=i[a]-1:r=0,r>s&&(s=r);return s}}const SO={};function w1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SO,n),fc.extend(t,e,n),mO(t,e)}const wO=C.newInstance(w1,"vtkTriangle");var CO={newInstance:wO,extend:w1,...vO};const lu=["verts","lines","polys","strips"],{vtkWarningMacro:yp}=C,MO={[De.VTK_LINE]:kt,[De.VTK_POLY_LINE]:kt,[De.VTK_TRIANGLE]:CO};function EO(t,e){e.classHierarchy.push("vtkPolyData");function n(s){return s.replace(/(?:^\w|[A-Z]|\b\w)/g,i=>i.toUpperCase()).replace(/\s+/g,"")}lu.forEach(s=>{t[`getNumberOf${n(s)}`]=()=>e[s].getNumberOfCells(),e[s]?e[s]=an(e[s]):e[s]=dp.newInstance()}),t.getNumberOfCells=()=>lu.reduce((s,i)=>s+e[i].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(s,i),lu.forEach(a=>{e[a]=dp.newInstance(),e[a].shallowCopy(s.getReferenceByName(a))})},t.buildCells=()=>{const s=t.getNumberOfVerts(),i=t.getNumberOfLines(),a=t.getNumberOfPolys(),o=t.getNumberOfStrips(),c=s+i+a+o,u=new Uint8Array(c);let l=u;const f=new Uint32Array(c);let h=f;if(s){let g=0;e.verts.getCellSizes().forEach((d,p)=>{h[p]=g,l[p]=d>1?De.VTK_POLY_VERTEX:De.VTK_VERTEX,g+=d+1}),h=h.subarray(s),l=l.subarray(s)}if(i){let g=0;e.lines.getCellSizes().forEach((d,p)=>{h[p]=g,l[p]=d>2?De.VTK_POLY_LINE:De.VTK_LINE,d===1&&yp("Building VTK_LINE ",p," with only one point, but VTK_LINE needs at least two points. Check the input."),g+=d+1}),h=h.subarray(i),l=l.subarray(i)}if(a){let g=0;e.polys.getCellSizes().forEach((d,p)=>{switch(h[p]=g,d){case 3:l[p]=De.VTK_TRIANGLE;break;case 4:l[p]=De.VTK_QUAD;break;default:l[p]=De.VTK_POLYGON;break}d<3&&yp("Building VTK_TRIANGLE ",p," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),g+=d+1}),h+=h.subarray(a),l+=l.subarray(a)}if(o){let g=0;l.fill(De.VTK_TRIANGLE_STRIP,0,o),e.strips.getCellSizes().forEach((d,p)=>{h[p]=g,g+=d+1})}e.cells=cO.newInstance(),e.cells.setCellTypes(c,u,f)},t.buildLinks=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=JR.newInstance(),s>0?e.links.allocate(s):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=s=>e.cells.getCellType(s),t.getCellPoints=s=>{const i=t.getCellType(s);let a=null;switch(i){case De.VTK_VERTEX:case De.VTK_POLY_VERTEX:a=e.verts;break;case De.VTK_LINE:case De.VTK_POLY_LINE:a=e.lines;break;case De.VTK_TRIANGLE:case De.VTK_QUAD:case De.VTK_POLYGON:a=e.polys;break;case De.VTK_TRIANGLE_STRIP:a=e.strips;break;default:return a=null,{type:0,cellPointIds:null}}const o=e.cells.getCellLocation(s),c=a.getCell(o);return{cellType:i,cellPointIds:c}},t.getPointCells=s=>e.links.getCells(s),t.getCellEdgeNeighbors=(s,i,a)=>{const o=e.links.getLink(i),c=e.links.getLink(a);return o.cells.filter(u=>u!==s&&c.cells.indexOf(u)!==-1)},t.getCell=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const a=t.getCellPoints(s),o=i||MO[a.cellType].newInstance();return o.initialize(t.getPoints(),a.cellPointIds),o}}const _O={};function C1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_O,n),xO.extend(t,e,n),C.get(t,e,["cells","links"]),C.setGet(t,e,["verts","lines","polys","strips"]),EO(t,e)}const RO=C.newInstance(C1,"vtkPolyData");var hn={newInstance:RO,extend:C1};function OO(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=n=>{e.jsImageData!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null),e.jsImageData=n,e.imageLoaded=!0,t.modified())},t.setCanvas=n=>{e.canvas!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.jsImageData=null),e.canvas=n,t.modified())},t.setImage=n=>{e.image!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null),e.image=n,e.imageLoaded=!1,n.complete?t.imageLoaded():n.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let n=0,r=0,s=1;if(t.getInputData()){const a=t.getInputData();n=a.getDimensions()[0],r=a.getDimensions()[1],s=a.getDimensions()[2]}return e.jsImageData&&(n=e.jsImageData.width,r=e.jsImageData.height),e.canvas&&(n=e.canvas.width,r=e.canvas.height),e.image&&(n=e.image.width,r=e.image.height),(n>1)+(r>1)+(s>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData();if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const n=document.createElement("canvas");n.width=e.image.width,n.height=e.image.height;const r=n.getContext("2d");return r.translate(0,n.height),r.scale(1,-1),r.drawImage(e.image,0,0,e.image.width,e.image.height),r.getImageData(0,0,n.width,n.height)}return null}}const DO=(t,e,n,r)=>{const s=[1,2,1],i=4,a=s,o=i,c=t.length/(e*n);let u=e,l=n,f=t;const h=[f];for(let g=0;g<r;g++){const d=[...f];u/=2,l/=2,f=new Uint8ClampedArray(u*l*c);const p=c*u;let y=0;for(let m=0;m<f.length;m+=c){m%p===0&&(y+=2*c*u);for(let T=0;T<c;T++){let v=d[y+T];v+=d[y+c+T],v+=d[y-2*p+T],v+=d[y-2*p+c+T],v/=4,f[m+T]=v}y+=2*c}let x=[...f];for(let m=0;m<f.length;m+=c)for(let T=0;T<c;T++){let v=-(a.length-1)/2,S=o,w=0;for(let M=0;M<a.length;M++){let E=m+T+v*c;const D=E%p-(m+T)%p;D>c&&(E+=p),D<-c&&(E-=p),x[E]?w+=x[E]*a[M]:S-=a[M],v+=1}f[m+T]=w/S}x=[...f];for(let m=0;m<f.length;m+=c)for(let T=0;T<c;T++){let v=-(a.length-1)/2,S=o,w=0;for(let M=0;M<a.length;M++){const E=m+T+v*p;x[E]?w+=x[E]*a[M]:S-=a[M],v+=1}f[m+T]=w/S}h.push(f)}return h},bO={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function M1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bO,n),C.obj(t,e),C.algo(t,e,6,0),C.get(t,e,["canvas","image","jsImageData","imageLoaded","resizable"]),C.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),OO(t,e)}const LO=C.newInstance(M1,"vtkTexture"),VO={generateMipmaps:DO};var Ac={newInstance:LO,extend:M1,...VO};const FO=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],xp=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],ja=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],Tp=[0,1,0,1,0,1,0,1,2,2,2,2],Ve=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],ne=new Float64Array(3),Pa=new Float64Array(3),Ce=new Float64Array(3),ts=new Float64Array(3),Ar=new Float64Array(3),Ka=new Float64Array(3),hu=new Float64Array(16);function gu(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function E1(t){const e=[],n=[];for(let r=0;r<3;r++){const s=sh().domain([t[r*2],t[r*2+1]]);e[r]=s.ticks(5);const i=s.tickFormat(5);n[r]=e[r].map(i)}return{ticks:e,tickStrings:n}}function BO(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=n=>{e.renderable!==n&&(e.renderable=n,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(n.getProperty()),e.tmActor.setParentProp(n),t.modified())},t.createPolyDataForOneLabel=(n,r,s,i,a,o,c)=>{const u=e.renderable.get_tmAtlas().get(n);if(!u)return;const l=e.renderable.getTextPolyData().getPoints().getData(),f=e.lastSize;ne[0]=l[r*3],ne[1]=l[r*3+1],ne[2]=l[r*3+2],we(Ce,ne,s),Ce[0]+=.1,we(Pa,Ce,i),wr(Ar,Pa,ne),Ce[0]-=.1,Ce[1]+=.1,we(Pa,Ce,i),wr(Ka,Pa,ne);for(let d=0;d<3;d++)Ar[d]/=.5*.1*f[0],Ka[d]/=.5*.1*f[1];let h=c.ptIdx,g=c.cellIdx;ne[0]=l[r*3],ne[1]=l[r*3+1],ne[2]=l[r*3+2],a[0]<-.5?dr(Ce,Ar,a[0]*o-u.width):a[0]>.5?dr(Ce,Ar,a[0]*o):dr(Ce,Ar,a[0]*o-u.width/2),Ai(ne,ne,Ce),dr(Ce,Ka,a[1]*o-u.height/2),Ai(ne,ne,Ce),c.points[h*3]=ne[0],c.points[h*3+1]=ne[1],c.points[h*3+2]=ne[2],c.tcoords[h*2]=u.tcoords[0],c.tcoords[h*2+1]=u.tcoords[1],h++,dr(Ce,Ar,u.width),Ai(ne,ne,Ce),c.points[h*3]=ne[0],c.points[h*3+1]=ne[1],c.points[h*3+2]=ne[2],c.tcoords[h*2]=u.tcoords[2],c.tcoords[h*2+1]=u.tcoords[3],h++,dr(Ce,Ka,u.height),Ai(ne,ne,Ce),c.points[h*3]=ne[0],c.points[h*3+1]=ne[1],c.points[h*3+2]=ne[2],c.tcoords[h*2]=u.tcoords[4],c.tcoords[h*2+1]=u.tcoords[5],h++,dr(Ce,Ar,u.width),wr(ne,ne,Ce),c.points[h*3]=ne[0],c.points[h*3+1]=ne[1],c.points[h*3+2]=ne[2],c.tcoords[h*2]=u.tcoords[6],c.tcoords[h*2+1]=u.tcoords[7],h++,c.polys[g*4]=3,c.polys[g*4+1]=h-4,c.polys[g*4+2]=h-3,c.polys[g*4+3]=h-2,g++,c.polys[g*4]=3,c.polys[g*4+1]=h-4,c.polys[g*4+2]=h-2,c.polys[g*4+3]=h-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{const n=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);Le(n,n);const r=e.renderable.getTextValues().length,s=r*4,i=r*2,a=new Float64Array(s*3),o=new Uint16Array(i*4),c=new Float32Array(s*2);wt(hu,n);const u={ptIdx:0,cellIdx:0,polys:o,points:a,tcoords:c};let l=0,f=0,h=0;const g=e.renderable.getTextPolyData().getPoints().getData(),d=e.renderable.getTextValues();for(;l<g.length/3;){ne[0]=g[l*3],ne[1]=g[l*3+1],ne[2]=g[l*3+2],we(Ce,ne,n),ne[0]=g[l*3+3],ne[1]=g[l*3+4],ne[2]=g[l*3+5],we(ts,ne,n),wr(Ce,Ce,ts);const y=[Ce[0],Ce[1]];bE(y),t.createPolyDataForOneLabel(d[f],l,n,hu,y,e.renderable.getAxisTitlePixelOffset(),u),l+=2,f++;for(let x=0;x<e.renderable.getTickCounts()[h];x++)t.createPolyDataForOneLabel(d[f],l,n,hu,y,e.renderable.getTickLabelPixelOffset(),u),l++,f++;h++}const p=ve.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(p),e.tmPolyData.getPoints().setData(a,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(o,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(n,r,s)=>{(e.lastSize[0]!==n[0]||e.lastSize[1]!==n[1])&&(e.lastSize[0]=n[0],e.lastSize[1]=n[1],e.lastAspectRatio=n[0]/n[1],e.forceUpdate=!0),e.camera=r,t.updateTexturePolyData()}}const kO=C.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),C.obj(t,e),e.tmPolyData=hn.newInstance(),e.tmMapper=ds.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=ps.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),C.setGet(t,e,["renderable"]),C.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},C.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},C.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],BO(t,e)},"vtkCubeAxesActorHelper");function NO(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=r=>{e.camera!==r&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=r,r&&(e.cameraModifiedSub=r.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const r=e.camera.getViewMatrix();Le(r,r);let s=!1;const i=be.getDiagonalLength(e.dataBounds),a=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let o=0;o<6;o++){let c=!1;const u=Math.floor(o/2),l=(u+1)%3,f=(u+2)%3;e.dataBounds[l*2]!==e.dataBounds[l*2+1]&&e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&(ne[u]=e.dataBounds[o]-.1*i*FO[o][u],ne[l]=.5*(e.dataBounds[l*2]+e.dataBounds[l*2+1]),ne[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),we(Ce,ne,r),ne[u]=e.dataBounds[o],we(ts,ne,r),wr(Ce,ts,Ce),_r(Ce,Ce),c=Ce[2]>a,e.camera.getParallelProjection()||(_r(ts,ts),c=jl(ts,Ce)>a)),c!==e.lastFacesToDraw[o]&&(e.lastFacesToDraw[o]=c,s=!0)}return s},t.updatePolyData=(r,s,i)=>{let a=0,o=0;a+=8;let c=0;for(let g=0;g<12;g++)s[g]>0&&c++;if(o+=c,e.gridLines)for(let g=0;g<6;g++)r[g]&&(a+=i[Ve[g][0]].length*2+i[Ve[g][1]].length*2,o+=i[Ve[g][0]].length+i[Ve[g][1]].length);const u=new Float64Array(a*3),l=new Uint32Array(o*3);let f=0,h=0;for(let g=0;g<2;g++)for(let d=0;d<2;d++)for(let p=0;p<2;p++)u[f*3]=e.dataBounds[p],u[f*3+1]=e.dataBounds[2+d],u[f*3+2]=e.dataBounds[4+g],f++;for(let g=0;g<12;g++)s[g]>0&&(l[h*3]=2,l[h*3+1]=ja[g][0],l[h*3+2]=ja[g][1],h++);if(e.gridLines){for(let g=0;g<6;g++)if(r[g]){const d=Math.floor(g/2);let p=i[Ve[g][0]];for(let y=0;y<p.length;y++)u[f*3+d]=e.dataBounds[g],u[f*3+Ve[g][0]]=p[y],u[f*3+Ve[g][1]]=e.dataBounds[Ve[g][1]*2],f++,u[f*3+d]=e.dataBounds[g],u[f*3+Ve[g][0]]=p[y],u[f*3+Ve[g][1]]=e.dataBounds[Ve[g][1]*2+1],f++,l[h*3]=2,l[h*3+1]=f-2,l[h*3+2]=f-1,h++;p=i[Ve[g][1]];for(let y=0;y<p.length;y++)u[f*3+d]=e.dataBounds[g],u[f*3+Ve[g][1]]=p[y],u[f*3+Ve[g][0]]=e.dataBounds[Ve[g][0]*2],f++,u[f*3+d]=e.dataBounds[g],u[f*3+Ve[g][1]]=p[y],u[f*3+Ve[g][0]]=e.dataBounds[Ve[g][0]*2+1],f++,l[h*3]=2,l[h*3+1]=f-2,l[h*3+2]=f-1,h++}}e.polyData.getPoints().setData(u,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(l,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(r,s,i,a)=>{let o=0;for(let g=0;g<12;g++)s[g]===1&&(o+=2,o+=i[Tp[g]].length);const c=e.polyData.getPoints().getData(),u=new Float64Array(o*3);let l=0,f=0,h=0;for(let g=0;g<6;g++)if(r[g])for(let d=0;d<4;d++){const p=xp[g][d];if(s[p]===1){const y=Tp[p],x=ja[p][0]*3,m=ja[p][1]*3;u[l*3]=.5*(c[x]+c[m]),u[l*3+1]=.5*(c[x+1]+c[m+1]),u[l*3+2]=.5*(c[x+2]+c[m+2]),l++;const T=Math.floor(g/2);u[l*3+T]=e.dataBounds[g],u[l*3+Ve[g][0]]=.5*(e.dataBounds[Ve[g][0]*2]+e.dataBounds[Ve[g][0]*2+1]),u[l*3+Ve[g][1]]=.5*(e.dataBounds[Ve[g][1]*2]+e.dataBounds[Ve[g][1]*2+1]),l++,e.textValues[f]=e.axisLabels[y],f++;const v=(y+1)%3,S=(y+2)%3,w=i[y],M=a[y];e.tickCounts[h]=w.length;for(let E=0;E<w.length;E++)u[l*3+y]=w[E],u[l*3+v]=c[x+v],u[l*3+S]=c[x+S],l++,e.textValues[f]=M[E],f++;h++}}e.textPolyData.getPoints().setData(u,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const r=t.computeFacesToDraw(),s=e.lastFacesToDraw;let i=!1;for(let a=0;a<6;a++)e.dataBounds[a]!==e.lastTickBounds[a]&&(i=!0,e.lastTickBounds[a]=e.dataBounds[a]);if(r||i||e.forceUpdate){const a=new Array(12).fill(0);for(let c=0;c<6;c++)if(s[c])for(let u=0;u<4;u++)a[xp[c][u]]++;const o=e.generateTicks(e.dataBounds);t.updatePolyData(s,a,o.ticks),t.updateTextData(s,a,o.ticks,o.tickStrings),(i||e.forceUpdate)&&t.updateTextureAtlas(o.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=r=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let s=0,i=1;for(let a=0;a<3;a++){if(!e._tmAtlas.has(e.axisLabels[a])){gu(e.tmContext,e.axisTextStyle);const o=e.tmContext.measureText(e.axisLabels[a]),c={height:o.actualBoundingBoxAscent+2,startingHeight:i,width:o.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[a],c),i+=c.height,s<c.width&&(s=c.width)}gu(e.tmContext,e.tickTextStyle);for(let o=0;o<r[a].length;o++)if(!e._tmAtlas.has(r[a][o])){const c=e.tmContext.measureText(r[a][o]),u={height:c.actualBoundingBoxAscent+2,startingHeight:i,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(r[a][o],u),i+=u.height,s<u.width&&(s=u.width)}}s=qt(s),i=qt(i),e._tmAtlas.forEach(a=>{a.tcoords=[0,(i-a.startingHeight-a.height)/i,a.width/s,(i-a.startingHeight-a.height)/i,a.width/s,(i-a.startingHeight)/i,0,(i-a.startingHeight)/i]}),e.tmCanvas.width=s,e.tmCanvas.height=i,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,s,i),e._tmAtlas.forEach((a,o)=>{gu(e.tmContext,a.textStyle),e.tmContext.fillText(o,1,a.startingHeight+a.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),be.setBounds(e.bounds,e.gridActor.getBounds()),be.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const n=C.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=r=>n(r)[0]}function UO(t,e,n){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...be.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:E1,...n,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...n==null?void 0:n.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...n==null?void 0:n.tickTextStyle}}}function _1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ps.extend(t,e,UO(t,e,n)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=Ac.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=ds.newInstance(),e.polyData=hn.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=ps.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=hn.newInstance(),C.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),C.setGetArray(t,e,["dataBounds"],6),C.setGetArray(t,e,["axisLabels"],3),C.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),NO(t,e)}const GO=C.newInstance(_1,"vtkCubeAxesActor");var R1={newInstance:GO,extend:_1,newCubeAxesActorHelper:kO,defaultGenerateTicks:E1};function AO(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const s=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,i=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([i.usize,i.vsize],s,e._openGLRenderWindow.getRenderable())}}}const zO={};function $O(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zO,n),Ne.extend(t,e,n),e.CubeAxesActorHelper=R1.newCubeAxesActorHelper(),AO(t,e)}const WO=Re($O,"vtkOpenGLCubeAxesActor");At("vtkCubeAxesActor",WO);const Zi={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var O1={ObjectType:Zi};const{ObjectType:zo}=O1,HO={};function IO(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(o){switch(o){case zo.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case zo.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case zo.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,s=null,i=!0,a="";t.getType=()=>r,t.setType=o=>{r=o},t.getHandle=()=>s,t.isReady=()=>i===!1,t.generateBuffer=o=>{const c=n(o);return s===null&&(s=e.context.createBuffer(),r=o),n(r)===c},t.upload=(o,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),s),e.context.bufferData(n(r),o,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,i=!1,!0):(a="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>s?(e.context.bindBuffer(n(r),s),!0):!1,t.release=()=>s?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{s!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(s),s=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=o=>{e._openGLRenderWindow!==o&&(t.releaseGraphicsResources(),e._openGLRenderWindow=o,e.context=null,o&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>a}const jO={objectType:zo.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function D1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jO,n),C.obj(t,e),C.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),C.moveToProtected(t,e,["openGLRenderWindow"]),IO(t,e)}const PO=C.newInstance(D1);var b1={newInstance:PO,extend:D1,...HO,...O1};function KO(t){let e=0,n=0;for(let s=0;s<3;++s){const i=t.getRange(s),a=i[1]-i[0];e+=a*a;const o=.5*(i[1]+i[0]);n+=o*o}const r=e>0&&(Math.abs(n)/e>1e6||Math.abs(Math.log10(e))>3||e===0&&n>1e6);if(r){const s=new Float64Array(3),i=new Float64Array(3);for(let a=0;a<3;++a){const o=t.getRange(a),c=o[1]-o[0];s[a]=.5*(o[1]+o[0]),i[a]=c>0?1/c:1}return{useShiftAndScale:r,coordShift:s,coordScale:i}}return{useShiftAndScale:r,coordShift:new Float32Array([0,0,0]),coordScale:new Float32Array([1,1,1])}}const{vtkErrorMacro:vp}=C;function XO(t,e){const n=new Float64Array(3);_2(n,e);const r=new Float64Array(16);return ay(r,gs(),t,n),r}function YO(t,e){return t===null||e===null?!1:!(mg(t,[0,0,0])&&mg(e,[1,1,1]))}function qO(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(Zi.ARRAY_BUFFER),t.createVBO=function(n,r,s,i){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const o=i.points.getData();let c=null,u=null,l=null;const f=i.colors?i.colors.getNumberOfComponents():0,h=i.tcoords?i.tcoords.getNumberOfComponents():0;i.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=i.normals.getData()),i.customAttributes&&i.customAttributes.forEach(U=>{U&&(e.customData.push({data:U.getData(),offset:4*e.blockSize,components:U.getNumberOfComponents(),name:U.getName()}),e.blockSize+=U.getNumberOfComponents())}),i.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=h,e.blockSize+=h,u=i.tcoords.getData()),i.colors?(e.colorComponents=i.colors.getNumberOfComponents(),e.colorOffset=0,l=i.colors.getData(),e.colorBO||(e.colorBO=b1.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let g=0,d=0,p=0,y=0,x=0,m=0,T;const v={anythingToPoints(U,Y,ee,te){for(let q=0;q<U;++q)T(Y[ee+q],te)},linesToWireframe(U,Y,ee,te){for(let q=0;q<U-1;++q)T(Y[ee+q],te),T(Y[ee+q+1],te)},polysToWireframe(U,Y,ee,te){if(U>2)for(let q=0;q<U;++q)T(Y[ee+q],te),T(Y[ee+(q+1)%U],te)},stripsToWireframe(U,Y,ee,te){if(U>2){for(let q=0;q<U-1;++q)T(Y[ee+q],te),T(Y[ee+q+1],te);for(let q=0;q<U-2;q++)T(Y[ee+q],te),T(Y[ee+q+2],te)}},polysToSurface(U,Y,ee,te){for(let q=0;q<U-2;q++)T(Y[ee+0],te),T(Y[ee+q+1],te),T(Y[ee+q+2],te)},stripsToSurface(U,Y,ee,te){for(let q=0;q<U-2;q++)T(Y[ee+q],te),T(Y[ee+q+1+q%2],te),T(Y[ee+q+1+(q+1)%2],te)}},S={anythingToPoints(U,Y){return U},linesToWireframe(U,Y){return U>1?(U-1)*2:0},polysToWireframe(U,Y){return U>2?U*2:0},stripsToWireframe(U,Y){return U>2?U*4-6:0},polysToSurface(U,Y){return U>2?(U-2)*3:0},stripsToSurface(U,Y,ee){return U>2?(U-2)*3:0}};let w=null,M=null;s===Gt.POINTS||r==="verts"?(w=v.anythingToPoints,M=S.anythingToPoints):s===Gt.WIREFRAME||r==="lines"?(w=v[`${r}ToWireframe`],M=S[`${r}ToWireframe`]):(w=v[`${r}ToSurface`],M=S[`${r}ToSurface`]);const E=n.getData(),D=E.length;let O=0;for(let U=0;U<D;)O+=M(E[U],E),U+=E[U]+1;let _=null;const V=new Float32Array(O*e.blockSize);l&&(_=new Uint8Array(O*4));let L=0,F=0;const{useShiftAndScale:G,coordShift:A,coordScale:H}=KO(i.points);if(G?t.setCoordShiftAndScale(A,H):e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null),a)if(!a.points&&!a.cells)a.points=new Int32Array(O),a.cells=new Int32Array(O);else{const U=new Int32Array(O+a.points.length);U.set(a.points),a.points=U;const Y=new Int32Array(O+a.cells.length);Y.set(a.cells),a.cells=Y}let P=i.vertexOffset;T=function(Y,ee){if(a&&(a.points[P]=Y,a.cells[P]=m+i.cellOffset),++P,g=Y*3,e.coordShiftAndScaleEnabled?(V[L++]=(o[g++]-e.coordShift[0])*e.coordScale[0],V[L++]=(o[g++]-e.coordShift[1])*e.coordScale[1],V[L++]=(o[g++]-e.coordShift[2])*e.coordScale[2]):(V[L++]=o[g++],V[L++]=o[g++],V[L++]=o[g++]),c!==null&&(i.haveCellNormals?d=(m+i.cellOffset)*3:d=Y*3,V[L++]=c[d++],V[L++]=c[d++],V[L++]=c[d++]),e.customData.forEach(te=>{x=Y*te.components;for(let q=0;q<te.components;++q)V[L++]=te.data[x++]}),u!==null){i.useTCoordsPerCell?p=ee*h:p=Y*h;for(let te=0;te<h;++te)V[L++]=u[p++]}l!==null&&(i.haveCellScalars?y=(m+i.cellOffset)*f:y=Y*f,_[F++]=l[y++],_[F++]=l[y++],_[F++]=l[y++],_[F++]=f===4?l[y++]:255)};for(let U=0;U<D;U+=E[U]+1,m++)w(E[U],E,U+1,m+i.cellOffset);return e.elementCount=O,t.upload(V,Zi.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(_,Zi.ARRAY_BUFFER)),m},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){vp("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){vp("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!Sg(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!Sg(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=YO(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=XO(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const ZO={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function L1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZO,n),b1.extend(t,e,n),C.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),C.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),qO(t,e)}const QO=C.newInstance(L1);var JO={newInstance:QO,extend:L1};const{vtkErrorMacro:eD}=C;function tD(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const s=e.context.getShaderInfoLog(e.handle);return eD(`Error compiling shader '${e.source}': ${s}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const nD={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function V1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nD,n),C.obj(t,e),C.setGet(t,e,["shaderType","source","error","handle","context"]),tD(t,e)}const rD=C.newInstance(V1,"vtkShader");var pu={newInstance:rD,extend:V1};const{vtkErrorMacro:xn}=C;function sD(t,e,n,r){const s=typeof n=="string"?n:n.join(`
`),i=r===!1?e:new RegExp(e,"g"),a=t.replace(i,s);return{replace:a!==s,result:a}}function iD(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(xn(e.error),0):t.link()?(t.setCompiled(!0),1):(xn(`Links failed: ${e.error}`),0):(xn(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),xn(e.fragmentShader.getError()),0):(xn(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),xn(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return xn(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const i=new Float32Array(r);return e.context.uniformMatrix4fv(s,!1,i),!0},t.setUniformMatrix3x3=(n,r)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const i=new Float32Array(r);return e.context.uniformMatrix3fv(s,!1,i),!0},t.setUniformf=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(s,r),!0)},t.setUniformfv=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(s,r),!0)},t.setUniformi=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(s,r),!0)},t.setUniformiv=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(s,r),!0)},t.setUniform2f=(n,r,s)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(s===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(i,r,s),!0},t.setUniform2fv=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(s,r),!0)},t.setUniform2i=(n,r,s)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(s===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(i,r,s),!0},t.setUniform2iv=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(s,r),!0)},t.setUniform3f=(n,r,s,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,r,s,i),!0},t.setUniform3fArray=(n,r)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(s,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(s,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,o[0],o[1],o[2]),!0},t.setUniform3iv=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(s,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4fv=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(s,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4iv=(n,r)=>{const s=t.findUniform(n);return s===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(s,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(xn("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return xn("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const aD={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function F1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aD,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=pu.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=pu.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=pu.newInstance(),e.geometryShader.setShaderType("Geometry"),C.obj(t,e),C.get(t,e,["lastCameraMTime"]),C.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),iD(t,e)}const oD=C.newInstance(F1,"vtkShaderProgram");var N={newInstance:oD,extend:F1,substitute:sD};function cD(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const s=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,s.buffer);for(let i=0;i<s.attributes.length;++i){const a=s.attributes[i],o=a.isMatrix?a.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(a.index+c),n.vertexAttribPointer(a.index+c,a.size,a.type,a.normalize,a.stride,a.offset+a.stride*c/a.size),a.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(a.index+c,1):n.vertexAttribDivisor(a.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const s=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,s.buffer);for(let i=0;i<s.attributes.length;++i){const a=s.attributes[i],o=a.isMatrix?a.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(a.index+c),n.vertexAttribPointer(a.index+c,a.size,a.type,a.normalize,a.stride,a.offset+a.stride*c/a.size),a.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(a.index+c,0):n.vertexAttribDivisor(a.index+c,0)),n.disableVertexAttribArray(a.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,s,i,a,o,c,u)=>t.addAttributeArrayWithDivisor(n,r,s,i,a,o,c,u,0,!1),t.addAttributeArrayWithDivisor=(n,r,s,i,a,o,c,u,l,f)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==Zi.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const h=e.context,g={};if(g.name=s,g.index=h.getAttribLocation(e.handleProgram,s),g.offset=i,g.stride=a,g.type=o,g.size=c,g.normalize=u,g.isMatrix=f,g.divisor=l,g.Index===-1)return!1;if(r.bind(),h.enableVertexAttribArray(g.index),h.vertexAttribPointer(g.index,g.size,g.type,g.normalize,g.stride,g.offset),l>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(g.index,1):h.vertexAttribDivisor(g.index,1)),g.buffer=r.getHandle(),!e.supported){let d=!1;for(let p=0;p<e.buffers.length;++p){const y=e.buffers[p];if(y.buffer===g.buffer){d=!0;let x=!1;for(let m=0;m<y.attributes.length;++m)y.attributes[m].name===s&&(x=!0,y.attributes[m]=g);x||y.attributes.push(g)}}d||e.buffers.push({buffer:g.buffer,attributes:[g]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,s,i,a,o,c,u,l)=>{const f=t.addAttributeArrayWithDivisor(n,r,s,i,a,o,c,u,l,!0);if(!f)return f;const h=e.context,g=h.getAttribLocation(e.handleProgram,s);for(let d=1;d<c;d++)h.enableVertexAttribArray(g+d),h.vertexAttribPointer(g+d,c,o,u,a,i+a*d/c),l>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(g+d,1):h.vertexAttribDivisor(g+d,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const s=e.buffers[r];for(let i=0;i<s.attributes.length;++i)if(s.attributes[i].name===n)return s.attributes.splice(i,1),s.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const uD={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function B1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uD,n),e.buffers=[],C.obj(t,e),C.get(t,e,["supported"]),C.setGet(t,e,["forceEmulation"]),cD(t,e)}const fD=C.newInstance(B1,"vtkOpenGLVertexArrayObject");var k1={newInstance:fD,extend:B1};const yr={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function lD(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,s,i)=>{if(e.CABO.getElementCount()){const a=t.getOpenGLMode(s),o=t.haveWideLines(n,r),c=e.context,u=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),a===c.LINES&&o?(t.updateShaders(n,r,i),c.drawArraysInstanced(a,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,i),c.drawArrays(a,0,e.CABO.getElementCount()),c.lineWidth(1));const f=(a===c.POINTS?1:0)||(a===c.LINES?2:3);return e.pointPicking&&c.depthMask(u),e.CABO.getElementCount()/f}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===Gt.POINTS||r===yr.Points?e.context.POINTS:n===Gt.WIREFRAME||r===yr.Lines||r===yr.TrisEdges||r===yr.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,s)=>!!(s.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<s.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,s)=>{if(t.getNeedToRebuildShaders(n,r,s)){const i={Vertex:null,Fragment:null,Geometry:null};s.buildShaders(i,n,r);const a=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);a!==t.getProgram()&&(t.setProgram(a),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),s.setMapperShaderParameters(t,n,r),s.setPropertyShaderParameters(t,n,r),s.setCameraShaderParameters(t,n,r),s.setLightingShaderParameters(t,n,r),s.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,s)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",s.usize,s.vsize);const i=parseFloat(r.getProperty().getLineWidth()),a=i/2;t.getProgram().setUniformf("lineWidthStepSize",i/Math.ceil(i)),t.getProgram().setUniformf("halfLineWidth",a)}e.primitiveType===yr.Points||r.getProperty().getRepresentation()===Gt.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,s)=>{let i=n.Vertex;i=N.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,i=N.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(s.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,s)&&(i=N.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,i=N.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=i},t.getPointPickingPrimitiveSize=()=>e.primitiveType===yr.Points?2:e.primitiveType===yr.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const hD={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function N1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hD,n),C.obj(t,e),e.shaderSourceTime={},C.obj(e.shaderSourceTime),e.attributeUpdateTime={},C.obj(e.attributeUpdateTime),C.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=N.newInstance(),e.VAO=k1.newInstance(),e.CABO=JO.newInstance(),lD(t,e)}const gD=C.newInstance(N1);var Ti={newInstance:gD,extend:N1,primTypes:yr};const pD={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Jf={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var U1={Wrap:pD,Filter:Jf};const G1=new Float32Array(1),dD=new Int32Array(G1.buffer);function yD(t){G1[0]=t;const e=dD[0];let n=e>>16&32768,r=e>>12&2047;const s=e>>23&255;return s<103?n:s>142?(n|=31744,n|=(s===255?0:1)&&e&8388607,n):s<113?(r|=2048,n|=(r>>114-s)+(r>>113-s&1),n):(n|=s-112<<10|r>>1,n+=r&1,n)}function xD(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var en={fromHalf:xD,toHalf:yD};function TD(){try{const r=new Int16Array([0,32767]),s=[1,1],i=document.createElement("canvas");i.width=4,i.height=4;const a=i.getContext("webgl2");if(!a)return!1;const o=a.getExtension("EXT_texture_norm16");if(!o)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,u=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,l=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(l,c),a.compileShader(l),!a.getShaderParameter(l,a.COMPILE_STATUS))return!1;const f=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(f,u),a.compileShader(f),!a.getShaderParameter(f,a.COMPILE_STATUS))return!1;const h=a.createProgram();if(a.attachShader(h,l),a.attachShader(h,f),a.linkProgram(h),!a.getProgramParameter(h,a.LINK_STATUS))return!1;const g=a.createTexture();a.bindTexture(a.TEXTURE_2D,g),a.texImage2D(a.TEXTURE_2D,0,o.R16_SNORM_EXT,2,1,0,a.RED,a.SHORT,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.useProgram(h),a.drawArrays(a.POINTS,0,1);const d=new Uint8Array(4);a.readPixels(s[0],s[1],1,1,a.RGBA,a.UNSIGNED_BYTE,d);const[p,y,x]=d,m=a.getExtension("WEBGL_lose_context");return m&&m.loseContext(),p===y&&y===x&&p!==0}catch{return!1}}let du;function vD(){return du===void 0&&(du=TD()),du}const{Wrap:Hn,Filter:Ke}=U1,{VtkDataTypes:de}=ve,{vtkDebugMacro:yu,vtkErrorMacro:Ss,vtkWarningMacro:mp}=On,{toHalf:mD}=en;function SD(t,e){e.classHierarchy.push("vtkOpenGLTexture");function n(){return{internalFormat:e.internalFormat,format:e.format,openGLDataType:e.openGLDataType,width:e.width,height:e.height}}t.render=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(d?e._openGLRenderWindow=d:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(Ke.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(Ke.LINEAR),t.setMagnificationFilter(Ke.LINEAR)):(t.setMinificationFilter(Ke.NEAREST),t.setMagnificationFilter(Ke.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Hn.REPEAT),t.setWrapS(Hn.REPEAT),t.setWrapT(Hn.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Ke.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Ke.LINEAR_MIPMAP_LINEAR));const y=e.renderable.getCanvas();t.create2DFromRaw(y.width,y.height,4,de.UNSIGNED_CHAR,y,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const y=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Ke.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(y.width,y.height,4,de.UNSIGNED_CHAR,y.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const p=e.renderable.getInputData(0);if(p&&p.getPointData().getScalars()){const y=p.getExtent(),x=p.getPointData().getScalars(),m=[];for(let T=0;T<e.renderable.getNumberOfInputPorts();++T){const v=e.renderable.getInputData(T),S=v?v.getPointData().getScalars().getData():null;S&&m.push(S)}e.renderable.getInterpolate()&&x.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(Ke.LINEAR_MIPMAP_LINEAR)),m.length%6===0?t.createCubeFromRaw(y[1]-y[0]+1,y[3]-y[2]+1,x.getNumberOfComponents(),x.getDataType(),m):t.create2DFromRaw(y[1]-y[0]+1,y[3]-y[2]+1,x.getNumberOfComponents(),x.getDataType(),x.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const r=()=>{if(!((e.minificationFilter===Ke.LINEAR||e.magnificationFilter===Ke.LINEAR)&&!vD()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=d=>{d&&e.handle&&(d.activateTexture(t),d.deactivateTexture(t),e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(d),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let d=!1;if(e.context&&e.handle){let p=0;switch(e.target){case e.context.TEXTURE_2D:p=e.context.TEXTURE_BINDING_2D;break;default:mp("impossible case");break}d=e.context.getIntegerv(p)===e.handle}return d},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(d,p)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(d,p)),e.internalFormat||yu(`Unable to find suitable internal format for T=${d} NC= ${p}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&mp("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(d,p)=>{let y=0;return y=e._openGLRenderWindow.getDefaultTextureInternalFormat(d,p,r(),t.useHalfFloat()),y||(y||(yu("Unsupported internal texture type!"),yu(`Unable to find suitable internal format for T=${d} NC= ${p}`)),y)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=d=>{e._forceInternalFormat=!0,d!==e.internalFormat&&(e.internalFormat=d,t.modified())},t.getFormat=(d,p)=>(e.format=t.getDefaultFormat(d,p),e.format),t.getDefaultFormat=(d,p)=>{if(e._openGLRenderWindow.getWebgl2())switch(p){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(p){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e._prevTexParams=null,e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=d=>{const p=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(d){case de.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(r()&&!p&&de.SHORT):return e.context.SHORT;case(r()&&!p&&de.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(p&&de.SHORT):return e.context.HALF_FLOAT;case(p&&de.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case de.FLOAT:case de.VOID:default:return e.context.FLOAT}switch(d){case de.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case de.FLOAT:case de.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const y=e.context.getExtension("OES_texture_half_float");if(y&&e.context.getExtension("OES_texture_half_float_linear"))return y.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(d){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||p)&&(e.openGLDataType=t.getDefaultDataType(d)),e.openGLDataType},t.getShiftAndScale=()=>{let d=0,p=1;switch(e.openGLDataType){case e.context.BYTE:p=127.5,d=p-128;break;case e.context.UNSIGNED_BYTE:p=255,d=0;break;case e.context.SHORT:p=32767.5,d=p-32768;break;case e.context.UNSIGNED_SHORT:p=65536,d=0;break;case e.context.INT:p=21474836475e-1,d=p-2147483648;break;case e.context.UNSIGNED_INT:p=4294967295,d=0;break;case e.context.FLOAT:}return{shift:d,scale:p}},t.getOpenGLFilterMode=d=>{switch(d){case Ke.NEAREST:return e.context.NEAREST;case Ke.LINEAR:return e.context.LINEAR;case Ke.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case Ke.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case Ke.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case Ke.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=d=>{switch(d){case Hn.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Hn.REPEAT:return e.context.REPEAT;case Hn.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function s(d){const[p,y,x,m,T,v]=d;return[y-p+1,m-x+1,v-T+1]}function i(d){const[p,y,x]=s(d);return p*y*x}function a(d,p,y,x,m){const[T,v,S,w,M,E]=y,[D,O]=p,_=D*O;let V=m;for(let L=M;L<=E;L++){const F=L*_;for(let G=S;G<=w;G++){const A=F+G*D;for(let H=A+T,P=A+v;H<=P;H++,V++)x[V]=d[H]}}}function o(d,p){const x=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||d.constructor,m=p.reduce((w,M)=>w+i(M),0),T=new x(m),v=[e.width,e.height,e.depth];let S=0;return p.forEach(w=>{a(d,v,w,T,S),S+=i(w)}),T}t.updateArrayDataTypeForGL=function(d,p){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];const m=[];let T=e.width*e.height*e.components;y&&(T*=e.depth);const v=!!x.length;if(d!==de.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let w=0;w<p.length;w++)if(p[w])if(v)m.push(o(p[w],x,Float32Array));else{const M=p[w].length>T?p[w].subarray(0,T):p[w];m.push(new Float32Array(M))}else m.push(null);if(d!==de.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let w=0;w<p.length;w++)if(p[w])if(v)m.push(o(p[w],x,Uint8Array));else{const M=p[w].length>T?p[w].subarray(0,T):p[w];m.push(new Uint8Array(M))}else m.push(null);let S=!1;if(e._openGLRenderWindow.getWebgl2())S=e.openGLDataType===e.context.HALF_FLOAT;else{const w=e.context.getExtension("OES_texture_half_float");S=w&&e.openGLDataType===w.HALF_FLOAT_OES}if(S)for(let w=0;w<p.length;w++)if(p[w]){const M=v?o(p[w],x):p[w],E=new Uint16Array(v?M.length:T),D=E.length;for(let O=0;O<D;O++)E[O]=mD(M[O]);m.push(E)}else m.push(null);if(m.length===0)for(let w=0;w<p.length;w++)m.push(v&&p[w]?o(p[w],x):p[w]);return m};function c(d){if(e._openGLRenderWindow.getWebgl2())return d;const p=[],y=e.width,x=e.height,m=e.components;if(d&&(!za(y)||!za(x))){const T=e.context.getExtension("OES_texture_half_float"),v=qt(y),S=qt(x),w=v*S*e.components;for(let M=0;M<d.length;M++)if(d[M]!==null){let E=null;const D=x/S,O=y/v;let _=!1;e.openGLDataType===e.context.FLOAT?E=new Float32Array(w):T&&e.openGLDataType===T.HALF_FLOAT_OES?(E=new Uint16Array(w),_=!0):E=new Uint8Array(w);for(let V=0;V<S;V++){const L=V*v*m,F=V*D;let G=Math.floor(F),A=Math.ceil(F);A>=x&&(A=x-1);const H=F-G,P=1-H;G=G*y*m,A=A*y*m;for(let U=0;U<v;U++){const Y=U*m,ee=U*O;let te=Math.floor(ee),q=Math.ceil(ee);q>=y&&(q=y-1);const Mt=ee-te;te*=m,q*=m;for(let Qe=0;Qe<m;Qe++)_?E[L+Y+Qe]=en.toHalf(en.fromHalf(d[M][G+te+Qe])*P*(1-Mt)+en.fromHalf(d[M][G+q+Qe])*P*Mt+en.fromHalf(d[M][A+te+Qe])*H*(1-Mt)+en.fromHalf(d[M][A+q+Qe])*H*Mt):E[L+Y+Qe]=d[M][G+te+Qe]*P*(1-Mt)+d[M][G+q+Qe]*P*Mt+d[M][A+te+Qe]*H*(1-Mt)+d[M][A+q+Qe]*H*Mt}}p.push(E),e.width=v,e.height=S}else p.push(null)}if(p.length===0)for(let T=0;T<d.length;T++)p.push(d[T]);return p}function u(d){var p;return e._openGLRenderWindow?e.resizable||(p=e.renderable)!=null&&p.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&r()&&(d===de.UNSIGNED_SHORT||d===de.SHORT)):!1:!1}t.create2DFromRaw=function(d,p,y,x,m){let T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(x,!0),t.getInternalFormat(x,y),t.getFormat(x,y),!e.internalFormat||!e.format||!e.openGLDataType)return Ss("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=y,e.width=d,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const v=[m],S=t.updateArrayDataTypeForGL(x,v),w=c(S);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,T),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(x)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),w[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,w[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,w[0]),e.generateMipmap&&e.context.generateMipmap(e.target),T&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*y*e._openGLRenderWindow.getDefaultTextureByteSize(x,r(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(d,p,y,x,m)=>{if(t.getOpenGLDataType(x),t.getInternalFormat(x,y),t.getFormat(x,y),!e.internalFormat||!e.format||!e.openGLDataType)return Ss("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=y,e.width=d,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=m.length/6-1,t.createTexture(),t.bind();const T=t.updateArrayDataTypeForGL(x,m),v=c(T),S=[];let w=e.width,M=e.height;for(let E=0;E<v.length;E++){E%6===0&&E!==0&&(w/=2,M/=2),S[E]=pi(x,M*w*e.components);for(let D=0;D<M;++D){const O=D*w*e.components,_=(M-D-1)*w*e.components;S[E].set(v[E].slice(_,_+w*e.components),O)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(x)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let E=0;E<6;E++){let D=0,O=e.width,_=e.height;for(;O>=1&&_>=1;){let V=null;D<=e.maxLevel&&(V=S[6*D+E]),u(x)?V!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+E,D,0,0,O,_,e.format,e.openGLDataType,V):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+E,D,e.internalFormat,O,_,0,e.format,e.openGLDataType,V),D++,O/=2,_/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*y*e._openGLRenderWindow.getDefaultTextureByteSize(x,r(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(d,p,y,x)=>(t.getOpenGLDataType(y),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?y===de.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Ss("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=d,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(y)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),x!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,x)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,x),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(y,r(),t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=d=>{if(t.getOpenGLDataType(de.UNSIGNED_CHAR),t.getInternalFormat(de.UNSIGNED_CHAR,4),t.getFormat(de.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Ss("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const p=!e._openGLRenderWindow.getWebgl2()&&(!za(d.width)||!za(d.height)),y=document.createElement("canvas");y.width=p?qt(d.width):d.width,y.height=p?qt(d.height):d.height,e.width=y.width,e.height=y.height;const x=y.getContext("2d");x.translate(0,y.height),x.scale(1,-1),x.drawImage(d,0,0,d.width,d.height,0,0,y.width,y.height);const m=y;return u(de.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),m!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,m)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,m),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(de.UNSIGNED_CHAR,r(),t.useHalfFloat()),t.deactivate(),!0};function l(d,p,y){const x=new Array(y),m=new Array(y);for(let T=0;T<y;++T)x[T]=d[T],m[T]=p[T]-d[T]||1;return{scale:m,offset:x}}function f(d,p){for(let y=0;y<d.length;y++){const x=d[y],m=p[y]+x;if(x<-2048||x>2048||m<-2048||m>2048)return!1}return!0}function h(d,p,y,x){t.getOpenGLDataType(d);const m=f(p,y)||x;let T=!1;if(e._openGLRenderWindow.getWebgl2())T=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&m||e.openGLDataType===e.context.HALF_FLOAT;else{const v=e.context.getExtension("OES_texture_half_float");T=v&&e.openGLDataType===v.HALF_FLOAT_OES}e.canUseHalfFloat=T&&m}function g(d,p){const y=d.getNumberOfComponents(),x=d.getDataType(),m=d.getData(),T=new Array(y),v=new Array(y);for(let w=0;w<y;++w){const[M,E]=d.getRange(w);T[w]=M,v[w]=E}const S=l(T,v,y);return h(x,S.offset,S.scale,p),t.useHalfFloat()||t.getOpenGLDataType(x,!0),{numComps:y,dataType:x,data:m,scaleOffsets:S}}t.create2DFilterableFromRaw=function(d,p,y,x,m){let T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0;return t.create2DFilterableFromDataArray(d,p,ve.newInstance({numberOfComponents:y,dataType:x,values:m,ranges:v}),T)},t.create2DFilterableFromDataArray=function(d,p,y){let x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:m,dataType:T,data:v}=g(y,x);t.create2DFromRaw(d,p,m,T,v)},t.updateVolumeInfoForGL=(d,p)=>{var m,T;let y=!1;const x=t.useHalfFloat();(!((m=e.volumeInfo)!=null&&m.scale)||!((T=e.volumeInfo)!=null&&T.offset))&&(e.volumeInfo={scale:new Array(p),offset:new Array(p)});for(let v=0;v<p;++v)e.volumeInfo.scale[v]=1,e.volumeInfo.offset[v]=0;if(r()&&!x&&d===de.SHORT){for(let v=0;v<p;++v)e.volumeInfo.scale[v]=32767;y=!0}if(r()&&!x&&d===de.UNSIGNED_SHORT){for(let v=0;v<p;++v)e.volumeInfo.scale[v]=65535;y=!0}if(d===de.UNSIGNED_CHAR){for(let v=0;v<p;++v)e.volumeInfo.scale[v]=255;y=!0}return(d===de.FLOAT||x&&(d===de.SHORT||d===de.UNSIGNED_SHORT))&&(y=!0),y},t.create3DFromRaw=function(d,p,y,x,m,T){let v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[],S=m,w=T;if(!t.updateVolumeInfoForGL(S,x)&&w){const L=d*p*y,F=structuredClone(e.volumeInfo),G=new Float32Array(L*x);e.volumeInfo.offset=F.offset,e.volumeInfo.scale=F.scale;let A=0;const H=F.scale.map(P=>1/P);for(let P=0;P<L;P++)for(let U=0;U<x;U++)G[A]=(w[A]-F.offset[U])*H[U],A++;S=de.FLOAT,w=G}if(t.getOpenGLDataType(S),t.getInternalFormat(S,x),t.getFormat(S,x),!e.internalFormat||!e.format||!e.openGLDataType)return Ss("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=x,e.width=d,e.height=p,e.depth=y,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const M=v.length>0,E=!M||!dy(e._prevTexParams,n()),D=[w],O=!0,_=t.updateArrayDataTypeForGL(S,D,O,E?[]:v),V=c(_);if(e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),E)u(S)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),V[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,V[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,V[0]),e._prevTexParams=n();else if(M){const L=V[0];let F=0;for(let G=0;G<v.length;G++){const A=v[G],H=s(A),P=i(A),U=new L.constructor(L.buffer,F,P);F+=U.byteLength,e.context.texSubImage3D(e.target,0,A[0],A[2],A[4],H[0],H[1],H[2],e.format,e.openGLDataType,U)}}return e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(S,r(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(d,p,y,x,m,T){let v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,S=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0,w=arguments.length>8&&arguments[8]!==void 0?arguments[8]:[];return t.create3DFilterableFromDataArray(d,p,y,ve.newInstance({numberOfComponents:x,dataType:m,values:T,ranges:S}),v,w)},t.create3DFilterableFromDataArray=function(d,p,y,x){let m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];const{numComps:v,dataType:S,data:w,scaleOffsets:M}=g(x,m),E=[],D=[];for(let Se=0;Se<v;++Se)E[Se]=0,D[Se]=1;if(e.volumeInfo={scale:D,offset:E,dataComputedScale:M.scale,dataComputedOffset:M.offset,width:d,height:p,depth:y},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(d,p,y,v,S,w,T);const O=d*p*y,_=structuredClone(M);let V=(Se,Pe,zt,$e,ct)=>{Se[Pe]=zt},L=de.UNSIGNED_CHAR;if(S===de.UNSIGNED_CHAR)for(let Se=0;Se<v;++Se)_.offset[Se]=0,_.scale[Se]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(L=de.FLOAT,V=(Se,Pe,zt,$e,ct)=>{Se[Pe]=(zt-$e)/ct}):(L=de.UNSIGNED_CHAR,V=(Se,Pe,zt,$e,ct)=>{Se[Pe]=255*(zt-$e)/ct});if(t.getOpenGLDataType(L),t.getInternalFormat(L,v),t.getFormat(L,v),!e.internalFormat||!e.format||!e.openGLDataType)return Ss("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=v,e.depth=1,e.numberOfDimensions=2;let F=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);F>4096&&(L===de.FLOAT||v>=3)&&(F=4096);let G=1,A=1;O>F*F&&(G=Math.ceil(Math.sqrt(O/(F*F))),A=G);let H=Math.sqrt(O)/G;H=qt(H);const P=Math.floor(H*G/d),U=Math.ceil(y/P),Y=qt(p*U/A);e.width=H,e.height=Y,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=P,e.volumeInfo.yreps=U,e.volumeInfo.xstride=G,e.volumeInfo.ystride=A,e.volumeInfo.offset=_.offset,e.volumeInfo.scale=_.scale;let ee;const te=H*Y*v;L===de.FLOAT?ee=new Float32Array(te):ee=new Uint8Array(te);let q=0;const Mt=Math.floor(d/G),Qe=Math.floor(p/A);for(let Se=0;Se<U;Se++){const Pe=Math.min(P,y-Se*P),zt=v*(e.width-Pe*Math.floor(d/G));for(let $e=0;$e<Qe;$e++){for(let ct=0;ct<Pe;ct++){const $t=v*((Se*P+ct)*d*p+A*$e*d);for(let R=0;R<Mt;R++)for(let b=0;b<v;b++)V(ee,q,w[$t+G*R*v+b],_.offset[b],_.scale[b]),q++}q+=zt}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(L)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),ee!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,ee)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,ee),t.deactivate(),!0},t.setOpenGLRenderWindow=d=>{e._openGLRenderWindow!==d&&(t.releaseGraphicsResources(),e._openGLRenderWindow=d,e.context=null,d&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=d=>d&&d.isCurrent()?d.getIntegerv(d.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=d=>{e.enableUseHalfFloat=d}}const wD={_openGLRenderWindow:null,_forceInternalFormat:!1,_prevTexParams:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Hn.CLAMP_TO_EDGE,wrapT:Hn.CLAMP_TO_EDGE,wrapR:Hn.CLAMP_TO_EDGE,minificationFilter:Ke.NEAREST,magnificationFilter:Ke.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function A1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wD,n),Ne.extend(t,e,n),e.sendParametersTime={},st(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},st(e.textureBuildTime,{mtime:0}),Sa(t,e,["format","openGLDataType"]),Ze(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Ct(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),wa(t,e,["openGLRenderWindow"]),SD(t,e)}const z1=Re(A1,"vtkOpenGLTexture");var us={newInstance:z1,extend:A1,...U1};At("vtkTexture",z1);var CD=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,MD=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function ED(t,e){t.replaceShaderCoincidentOffset=(n,r,s)=>{const i=t.getCoincidentParameters(r,s);if(i&&(i.factor!==0||i.offset!==0)){let a=n.Fragment;a=N.substitute(a,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(i.factor!==0?(a=N.substitute(a,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,a=N.substitute(a,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):a=N.substitute(a,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(i.factor!==0?(a=N.substitute(a,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,a=N.substitute(a,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):a=N.substitute(a,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=a}}}function _D(t,e){t.applyShaderReplacements=(n,r,s)=>{let i=null;if(r&&(i=r.ShaderReplacements),i)for(let a=0;a<i.length;a++){const o=i[a];if(s&&o.replaceFirst||!s&&!o.replaceFirst){const c=o.shaderType,u=n[c],l=N.substitute(u,o.originalValue,o.replacementValue,o.replaceAll);n[c]=l.result}}},t.buildShaders=(n,r,s)=>{t.getReplacedShaderTemplate(n,r,s),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const i=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,i,!0),t.replaceShaderValues(n,r,s),t.applyShaderReplacements(n,i)},t.getReplacedShaderTemplate=(n,r,s)=>{const i=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,s);let a=n.Vertex;if(i){const u=i.VertexShaderCode;u!==void 0&&u!==""&&(a=u)}n.Vertex=a;let o=n.Fragment;if(i){const u=i.FragmentShaderCode;u!==void 0&&u!==""&&(o=u)}n.Fragment=o;let c=n.Geometry;if(i){const u=i.GeometryShaderCode;u!==void 0&&(c=u)}n.Geometry=c}}var hc={implementReplaceShaderCoincidentOffset:ED,implementBuildShadersWithReplacements:_D};const{FieldAssociations:xu}=xs,{primTypes:Xe}=Ti,{Representation:ws,Shading:Sp}=xi,{ScalarMode:Xa}=ds,{Filter:wp,Wrap:Cp}=us,{vtkErrorMacro:zr}=On,RD={type:"StartEvent"},OD={type:"EndEvent"},{CoordinateSystem:DD}=Ma;function bD(t){const e=t.getSelector();return e?e.getCurrentPass():mt.MIN_KNOWN_PASS-1}function LD(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,s)=>{r&&(e.currentRenderPass=s,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let a=Xe.Start;a<Xe.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}const s=e.openGLActor.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,s)},t.getShaderTemplate=(r,s,i)=>{r.Vertex=CD,r.Fragment=MD,r.Geometry=""},t.replaceShaderColor=(r,s,i)=>{let a=r.Vertex,o=r.Geometry,c=r.Fragment;const u=e.lastBoundBO.getReferenceByName("lastLightComplexity");let l=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];u&&(l=l.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let f=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];u&&(f=f.concat(["  vec3 specularColor;","  float specularPower;"])),f=f.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),u&&(f=f.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(l=l.concat(["varying vec4 vertexColorVSOutput;"]),a=N.substitute(a,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,a=N.substitute(a,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=N.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=N.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=N.substitute(c,"//VTK::Color::Impl",f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=N.substitute(c,"//VTK::Color::Impl",f.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(i.getBackfaceProperty()&&!e.drawingEdges&&(l=l.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),u?(l=l.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(l=l.concat(["uniform samplerBuffer texture1;"])),c=N.substitute(c,"//VTK::Color::Impl",f).result),c=N.substitute(c,"//VTK::Color::Dec",l).result,r.Vertex=a,r.Geometry=o,r.Fragment=c},t.replaceShaderLight=(r,s,i)=>{let a=r.Fragment;const o="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),u=e.lastBoundBO.getReferenceByName("lastLightCount");let l=[];switch(c){case 0:a=N.substitute(a,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:a=N.substitute(a,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let f=0;f<u;++f)l=l.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`]);a=N.substitute(a,"//VTK::Light::Dec",l).result,l=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let f=0;f<u;++f)l=l.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${f}));`,`  diffuseL += ((df${o}) * lightColor${f});`,`  if (dot(normalVCVSOutput, lightDirectionVC${f}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${f},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${o} * lightColor${f});`,"    }"]);l=l.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),a=N.substitute(a,"//VTK::Light::Impl",l,!1).result;break;case 3:for(let f=0;f<u;++f)l=l.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`,`uniform vec3 lightPositionVC${f};`,`uniform vec3 lightAttenuation${f};`,`uniform float lightConeAngle${f};`,`uniform float lightExponent${f};`,`uniform int lightPositional${f};`]);a=N.substitute(a,"//VTK::Light::Dec",l).result,l=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let f=0;f<u;++f)l=l.concat(["  attenuation = 1.0;",`  if (lightPositional${f} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${f};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${f};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${f}.x`,`       + lightAttenuation${f}.y * distanceVC`,`       + lightAttenuation${f}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${f} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${f});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${f})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${f});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${o}) * lightColor${f});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${f},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${o}) * lightColor${f});`,"    }"]);l=l.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),a=N.substitute(a,"//VTK::Light::Impl",l,!1).result;break;default:zr("bad light complexity")}r.Fragment=a},t.replaceShaderNormal=(r,s,i)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let o=r.Vertex,c=r.Geometry,u=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(o=N.substitute(o,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,o=N.substitute(o,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=N.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=N.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,u=N.substitute(u,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,u=N.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(u=N.substitute(u,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,u=N.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES?(u=N.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=N.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(u=N.substitute(u,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,u=N.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=N.substitute(u,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=o,r.Geometry=c,r.Fragment=u}},t.replaceShaderPositionVC=(r,s,i)=>{e.lastBoundBO.replaceShaderPositionVC(r,s,i);let a=r.Vertex,o=r.Geometry,c=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(a=N.substitute(a,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,a=N.substitute(a,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,a=N.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,o=N.substitute(o,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,o=N.substitute(o,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=N.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=N.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(a=N.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=N.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=a,r.Geometry=o,r.Fragment=c},t.replaceShaderTCoord=(r,s,i)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let a=r.Vertex,o=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;a=N.substitute(a,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const u=e.openGLActor.getActiveTextures();let l=2,f=2;if(u&&u.length>0&&(l=u[0].getComponents(),u[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(f=3)),e.renderable.getColorTextureMap()&&(l=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),f=2),f===2){if(a=N.substitute(a,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,o=N.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,o=N.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=N.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,u&&u.length>=1)switch(l){case 1:c=N.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=N.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=N.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(a=N.substitute(a,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,o=N.substitute(o,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,o=N.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=N.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,l){case 1:c=N.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=N.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=N.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=a,r.Geometry=o,r.Fragment=c}},t.replaceShaderClip=(r,s,i)=>{let a=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();a=N.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,a=N.substitute(a,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=N.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,o=N.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=a,r.Fragment=o},t.getCoincidentParameters=(r,s)=>{let i={factor:0,offset:0};const a=s.getProperty();if(e.renderable.getResolveCoincidentTopology()==br.PolygonOffset||a.getEdgeVisibility()&&a.getRepresentation()===ws.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===Xe.Points||a.getRepresentation()===ws.POINTS?i=e.renderable.getCoincidentTopologyPointOffsetParameter():c===Xe.Lines||a.getRepresentation()===ws.WIREFRAME?i=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===Xe.Tris||c===Xe.TriStrips)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===Xe.TrisEdges||c===Xe.TriStripsEdges)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),i.factor/=2,i.offset/=2)}const o=e._openGLRenderer.getSelector();return o&&o.getFieldAssociation()===xu.FIELD_ASSOCIATION_POINTS&&(i.offset-=2),i},t.replaceShaderPicking=(r,s,i)=>{let a=r.Fragment,o=r.Vertex;if(a=N.substitute(a,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===mt.ID_LOW24||e.lastSelectionState===mt.ID_HIGH24)&&(o=N.substitute(o,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,o=N.substitute(o,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,a=N.substitute(a,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,a=N.substitute(a,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case mt.ID_LOW24:a=N.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case mt.ID_HIGH24:a=N.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:a=N.substitute(a,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,a=N.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=a,r.Vertex=o}},t.replaceShaderValues=(r,s,i)=>{if(t.replaceShaderColor(r,s,i),t.replaceShaderNormal(r,s,i),t.replaceShaderLight(r,s,i),t.replaceShaderTCoord(r,s,i),t.replaceShaderPicking(r,s,i),t.replaceShaderClip(r,s,i),t.replaceShaderCoincidentOffset(r,s,i),t.replaceShaderPositionVC(r,s,i),e.haveSeenDepthRequest){let a=r.Fragment;a=N.substitute(a,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,a=N.substitute(a,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=a}},t.getNeedToRebuildShaders=(r,s,i)=>{let a=0,o=0;const c=r.getPrimitiveType(),u=e.currentInput;let l=!1;const f=u.getPointData().getNormals(),h=u.getCellData().getNormals(),g=i.getProperty().getInterpolation()===Sp.FLAT,d=i.getProperty().getRepresentation(),p=r.getOpenGLMode(d,c);if((p===e.context.TRIANGLES||h&&!f||!g&&f||!g&&p===e.context.LINES)&&(l=!0),i.getProperty().getLighting()&&l){a=0;const T=s.getLightsByReference();for(let v=0;v<T.length;++v){const S=T[v];S.getSwitch()>0&&(o++,a===0&&(a=1)),a===1&&(o>1||S.getIntensity()!==1||!S.lightTypeIsHeadLight())&&(a=2),a<3&&S.getPositional()&&(a=3)}}let y=!1;const x=e.lastBoundBO.getReferenceByName("lastLightComplexity"),m=e.lastBoundBO.getReferenceByName("lastLightCount");return(x!==a||m!==o)&&(e.lastBoundBO.set({lastLightComplexity:a},!0),e.lastBoundBO.set({lastLightCount:o},!0),y=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(y=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||y?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,s,i)=>{const a=e.renderable.getViewSpecificProperties().ShadersCallbacks;a&&a.forEach(o=>{o.callback(o.userData,r,s,i)})},t.setMapperShaderParameters=(r,s,i)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||zr("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&c>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||zr("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((u,l)=>{r.getProgram().isAttributeUsed(`${u}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${u}MC`,r.getCABO().getCustomData()[l].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[l].components,!1)||zr(`Error setting ${u}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||zr("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||zr("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),u=[],f=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,h=f?it(e.tmpMat4,i.getMatrix()):i.getMatrix();f&&(Le(h,h),Ye(h,h,f),Le(h,h));for(let g=0;g<c;g++){const d=[];e.renderable.getClippingPlaneInDataCoords(h,g,d);for(let p=0;p<4;p++)u.push(d[p])}r.getProgram().setUniformi("numClipPlanes",c),r.getProgram().setUniform4fv("clipPlanes",u)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const a=e.openGLActor.getActiveTextures();if(a)for(let c=0;c<a.length;++c){const l=a[c].getTextureUnit(),f=`texture${l+1}`;r.getProgram().isUniformUsed(f)&&r.getProgram().setUniformi(f,l)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(s,i);r.getProgram().setUniformf("coffset",c.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",c.factor)}r.setMapperShaderParameters(s,i,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,s,i)=>{const a=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(a<2)return;const o=r.getProgram();let c=0;const u=s.getLightsByReference();for(let h=0;h<u.length;++h){const g=u[h];if(g.getSwitch()>0){const p=g.getColorByReference(),y=g.getIntensity();e.lightColor[0]=p[0]*y,e.lightColor[1]=p[1]*y,e.lightColor[2]=p[2]*y;const x=g.getDirection(),m=s.getActiveCamera().getViewMatrix(),T=[...x];g.lightTypeIsSceneLight()&&(T[0]=m[0]*x[0]+m[1]*x[1]+m[2]*x[2],T[1]=m[4]*x[0]+m[5]*x[1]+m[6]*x[2],T[2]=m[8]*x[0]+m[9]*x[1]+m[10]*x[2],pa(T)),e.lightDirection[0]=T[0],e.lightDirection[1]=T[1],e.lightDirection[2]=T[2],pa(e.lightDirection),o.setUniform3fArray(`lightColor${c}`,e.lightColor),o.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(a<3)return;const f=s.getActiveCamera().getViewMatrix();Le(f,f),c=0;for(let h=0;h<u.length;++h){const g=u[h];if(g.getSwitch()>0){const p=g.getTransformedPosition(),y=new Float64Array(3);we(y,p,f),o.setUniform3fArray(`lightAttenuation${c}`,g.getAttenuationValuesByReference()),o.setUniformi(`lightPositional${c}`,g.getPositional()),o.setUniformf(`lightExponent${c}`,g.getExponent()),o.setUniformf(`lightConeAngle${c}`,g.getConeAngle()),o.setUniform3fArray(`lightPositionVC${c}`,[y[0],y[1],y[2]]),c++}}};function n(r,s,i){return s.identity(i),r.reduce((a,o,c)=>c===0?o?s.copy(a,o):s.identity(a):o?s.multiply(a,a,o):a,i)}t.setCameraShaderParameters=(r,s,i)=>{const a=r.getProgram(),o=e.openGLCamera.getKeyMatrices(s),c=s.getActiveCamera(),u=e.openGLCamera.getKeyMatrixTime().getMTime(),l=a.getLastCameraMTime(),h=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,g=i.getIsIdentity(),d=g?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(i.getCoordinateSystem()===DD.DISPLAY){const p=e._openGLRenderer.getTiledSizeAndOrigin();ce(e.tmpMat4),e.tmpMat4[0]=2/p.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/p.vsize,e.tmpMat4[13]=-1,Ye(e.tmpMat4,e.tmpMat4,h),a.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else a.setUniformMatrix("MCPCMatrix",n([o.wcpc,d.mcwc,h],_f,e.tmpMat4));a.isUniformUsed("MCVCMatrix")&&a.setUniformMatrix("MCVCMatrix",n([o.wcvc,d.mcwc,h],_f,e.tmpMat4)),a.isUniformUsed("normalMatrix")&&a.setUniformMatrix3x3("normalMatrix",n([o.normalMatrix,d.normalMatrix],e2,e.tmpMat3)),l!==u&&(a.isUniformUsed("cameraParallel")&&a.setUniformi("cameraParallel",c.getParallelProjection()),a.setLastCameraMTime(u)),g||a.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,s,i)=>{const a=r.getProgram();let o=i.getProperty(),c=o.getOpacity(),u=e.drawingEdges?o.getEdgeColorByReference():o.getAmbientColorByReference(),l=e.drawingEdges?o.getEdgeColorByReference():o.getDiffuseColorByReference(),f=e.drawingEdges?1:o.getAmbient(),h=e.drawingEdges?0:o.getDiffuse(),g=e.drawingEdges?0:o.getSpecular();const d=o.getSpecularPower();a.setUniformf("opacityUniform",c),a.setUniform3fArray("ambientColorUniform",u),a.setUniform3fArray("diffuseColorUniform",l),a.setUniformf("ambient",f),a.setUniformf("diffuse",h);const p=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(p<1)return;let y=o.getSpecularColorByReference();if(a.setUniform3fArray("specularColorUniform",y),a.setUniformf("specularPowerUniform",d),a.setUniformf("specular",g),a.isUniformUsed("ambientIntensityBF")){if(o=i.getBackfaceProperty(),c=o.getOpacity(),u=o.getAmbientColor(),f=o.getAmbient(),l=o.getDiffuseColor(),h=o.getDiffuse(),y=o.getSpecularColor(),g=o.getSpecular(),a.setUniformf("ambientIntensityBF",f),a.setUniformf("diffuseIntensityBF",h),a.setUniformf("opacityUniformBF",c),a.setUniform3fArray("ambientColorUniformBF",u),a.setUniform3fArray("diffuseColorUniformBF",l),p<1)return;a.setUniformf("specularIntensityBF",g),a.setUniform3fArray("specularColorUniformBF",y),a.setUniformf("specularPowerUniformBF",d)}},t.updateMaximumPointCellIds=(r,s)=>{var o,c,u,l;const i=e._openGLRenderer.getSelector();if(!i)return;if((c=(o=e.selectionWebGLIdsToVTKIds)==null?void 0:o.points)!=null&&c.length){const f=e.selectionWebGLIdsToVTKIds.points.length;i.setMaximumPointId(f-1)}if((l=(u=e.selectionWebGLIdsToVTKIds)==null?void 0:u.cells)!=null&&l.length){const f=e.selectionWebGLIdsToVTKIds.cells.length;i.setMaximumCellId(f-1)}i.getFieldAssociation()===xu.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,s)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const i=bD(e._openGLRenderer);if(e.lastSelectionState!==i&&(e.selectionStateChanged.modified(),e.lastSelectionState=i),e._openGLRenderer.getSelector())switch(i){default:e._openGLRenderer.getSelector().renderProp(s)}t.updateBufferObjects(r,s),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,s)=>{const i=s.getProperty().getRepresentation(),a=s.getProperty().getEdgeVisibility()&&i===ws.SURFACE,o=e._openGLRenderer.getSelector(),c=o&&o.getFieldAssociation()===xu.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===mt.ID_LOW24||e.lastSelectionState===mt.ID_HIGH24);for(let u=Xe.Start;u<Xe.End;u++)e.primitives[u].setPointPicking(c),e.primitives[u].getCABO().getElementCount()&&(e.drawingEdges=a&&(u===Xe.TrisEdges||u===Xe.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[u],e.primitiveIDOffset+=e.primitives[u].drawArrays(r,s,i,t),e.vertexIDOffset+=e.primitives[u].getCABO().getElementCount()))},t.renderPieceFinish=(r,s)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,s)=>{if(t.invokeEvent(RD),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(OD),!e.currentInput){zr("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const i=e.context,a=s.getProperty().getBackfaceCulling(),o=s.getProperty().getFrontfaceCulling();!a&&!o?e._openGLRenderWindow.disableCullFace():o?(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)),t.renderPieceStart(r,s),t.renderPieceDraw(r,s),t.renderPieceFinish(r,s)},t.computeBounds=(r,s)=>{if(!t.getInput()){ih(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,s)=>{t.getNeedToRebuildBufferObjects(r,s)&&t.buildBufferObjects(r,s),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(r,s)=>{const i=e.VBOBuildTime.getMTime();return i<t.getMTime()||i<e.renderable.getMTime()||i<s.getMTime()||i<e.currentInput.getMTime()},t.buildBufferObjects=(r,s)=>{const i=e.currentInput;if(i===null)return;e.renderable.mapScalars(i,1);const a=e.renderable.getColorMapColors();e.haveCellScalars=!1;const o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===Xa.USE_CELL_DATA||o===Xa.USE_CELL_FIELD_DATA||o===Xa.USE_FIELD_DATA||!i.getPointData().getScalars())&&o!==Xa.USE_POINT_FIELD_DATA&&a&&(e.haveCellScalars=!0);let c=s.getProperty().getInterpolation()!==Sp.FLAT?i.getPointData().getNormals():null;c===null&&i.getCellData().getNormals()&&(e.haveCellNormals=!0,c=i.getCellData().getNormals());const u=s.getProperty().getRepresentation();let l=i.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(l=null);let f=!1;if(e.renderable.getColorCoordinates()){l=e.renderable.getColorCoordinates(),f=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=us.newInstance({resizable:!0}));const g=e.internalColorTexture;g.setMinificationFilter(wp.NEAREST),g.setMagnificationFilter(wp.NEAREST),g.setWrapS(Cp.CLAMP_TO_EDGE),g.setWrapT(Cp.CLAMP_TO_EDGE),g.setOpenGLRenderWindow(e._openGLRenderWindow);const d=e.renderable.getColorTextureMap(),p=d.getExtent(),y=d.getPointData().getScalars();g.create2DFromRaw(p[1]-p[0]+1,p[3]-p[2]+1,y.getNumberOfComponents(),y.getDataType(),y.getData()),g.activate(),g.sendParameters(),g.deactivate()}const h=`${i.getMTime()}A${u}B${i.getMTime()}C${c?c.getMTime():1}D${a?a.getMTime():1}E${s.getProperty().getEdgeVisibility()}F${l?l.getMTime():1}`;if(e.VBOBuildString!==h){const d={points:i.getPoints(),normals:c,tcoords:l,colors:a,cellOffset:0,vertexOffset:0,useTCoordsPerCell:f,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(x=>i.getPointData().getArrayByName(x))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const p=[{inRep:"verts",cells:i.getVerts()},{inRep:"lines",cells:i.getLines()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()}],y=s.getProperty().getEdgeVisibility()&&u===ws.SURFACE;for(let x=Xe.Start;x<Xe.End;x++)x!==Xe.TrisEdges&&x!==Xe.TriStripsEdges?(d.cellOffset+=e.primitives[x].getCABO().createVBO(p[x].cells,p[x].inRep,u,d,e.selectionWebGLIdsToVTKIds),d.vertexOffset+=e.primitives[x].getCABO().getElementCount()):y?e.primitives[x].getCABO().createVBO(p[x].cells,p[x].inRep,ws.WIREFRAME,{...d,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[x].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=h}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(s=>{r+=s.getAllocatedGPUMemoryInBytes()}),r}}const VD={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:mt.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function FD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VD,n),Ne.extend(t,e,n),hc.implementReplaceShaderCoincidentOffset(t,e,n),hc.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=Xe,e.tmpMat3=ys(new Float64Array(9)),e.tmpMat4=ce(new Float64Array(16));for(let r=Xe.Start;r<Xe.End;r++)e.primitives[r]=Ti.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Ze(t,e,["context"]),e.VBOBuildTime={},st(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},st(e.selectionStateChanged,{mtime:0}),LD(t,e)}const BD=Re(FD,"vtkOpenGLPolyDataMapper");At("vtkMapper",BD);const{ColorMode:kD,ScalarMode:$r,GetArray:Tu}=Uc;function ND(t,e){e.classHierarchy.push("vtkMapper2D"),t.createDefaultLookupTable=()=>{e.lookupTable=a1.newInstance()},t.getColorModeAsString=()=>C.enumToString(kD,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>C.enumToString($r,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,s,i,a)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFLag:!1};let o=null,c=!1;if(r===$r.DEFAULT)o=n.getPointData().getScalars(),o||(o=n.getCellData().getScalars(),c=!0);else if(r===$r.USE_POINT_DATA)o=n.getPointData().getScalars();else if(r===$r.USE_CELL_DATA)o=n.getCellData().getScalars(),c=!0;else if(r===$r.USE_POINT_FIELD_DATA){const u=n.getPointData();s===Tu.BY_ID?o=u.getArrayByIndex(i):o=u.getArrayByName(a)}else if(r===$r.USE_CELL_FIELD_DATA){const u=n.getCellData();c=!0,s===Tu.BY_ID?o=u.getArrayByIndex(i):o=u.getArrayByName(a)}else if(r===$r.USE_FIELD_DATA){const u=n.getFieldData();s===Tu.BY_ID?o=u.getArrayByIndex(i):o=u.getArrayByName(a)}return{scalars:o,cellFlag:c}},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.mapScalars=(n,r)=>{const s=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!s){e.colorMapColors=null;return}const i=`${t.getMTime()}${s.getMTime()}${r}`;if(e.colorBuildString===i)return;e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]);const a=t.getLookupTable();a&&(a.build(),e.colorMapColors=a.mapScalars(s,e.colorMode,e.fieldDataTupleId)),e.colorBuildString=`${t.getMTime()}${s.getMTime()}${r}`},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}}}const UD={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function $1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UD,n),qx.extend(t,e,n),C.get(t,e,["colorMapColors"]),C.setGet(t,e,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),C.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),ND(t,e)}const GD=C.newInstance($1,"vtkMapper2D");var AD={newInstance:GD,extend:$1},zD=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,$D=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const W1={BACKGROUND:0,FOREGROUND:1};var H1={DisplayLocation:W1};const{primTypes:Xt}=Ti,{ScalarMode:Ya}=AD,{vtkErrorMacro:qa}=On,WD={type:"StartEvent"},HD={type:"EndEvent"};function ID(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=r=>{r&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=r=>{r&&t.render()},t.getShaderTemplate=(r,s,i)=>{r.Vertex=$D,r.Fragment=zD,r.Geometry=""},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let a=Xt.Start;a<Xt.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}const s=e.openGLActor2D.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,s)},t.renderPiece=(r,s)=>{if(t.invokeEvent(WD),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(HD),!e.currentInput){qa("No input!");return}!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues()||(t.renderPieceStart(r,s),t.renderPieceDraw(r,s),t.renderPieceFinish(r,s))},t.renderPieceStart=(r,s)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(s)}t.updateBufferObjects(r,s),e.lastBoundBO=null},t.getNeedToRebuildShaders=(r,s,i)=>r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(r,s)=>{t.getNeedToRebuildBufferObjects(r,s)&&t.buildBufferObjects(r,s)},t.getNeedToRebuildBufferObjects=(r,s)=>{const i=e.VBOBuildTime.getMTime();return!!(i<t.getMTime()||i<e._openGLRenderWindow.getMTime()||i<e.renderable.getMTime()||i<s.getMTime()||i<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&i<r.getMTime())},t.buildBufferObjects=(r,s)=>{const i=e.currentInput;if(i===null)return;e.renderable.mapScalars(i,s.getProperty().getOpacity());const a=e.renderable.getColorMapColors();e.haveCellScalars=!1;const o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===Ya.USE_CELL_DATA||o===Ya.USE_CELL_FIELD_DATA||o===Ya.USE_FIELD_DATA||!i.getPointData().getScalars())&&o!==Ya.USE_POINT_FIELD_DATA&&a&&(e.haveCellScalars=!0);const c=s.getProperty().getRepresentation();let u=i.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(u=null);const l=e.renderable.getTransformCoordinate(),h=r.getRenderWindow().getViews()[0].getViewportSize(r),g=`${i.getMTime()}A${c}B${i.getMTime()}C${a?a.getMTime():1}D${u?u.getMTime():1}E${l?r.getMTime():1}F${h}`;if(e.VBOBuildString!==g){let d=i.getPoints();if(l){const y=uc.newInstance(),x=d.getNumberOfPoints();y.setNumberOfPoints(x);const m=[];for(let T=0;T<x;++T){d.getPoint(T,m),l.setValue(m);const v=l.getComputedDoubleViewportValue(r);y.setPoint(T,v[0],v[1],0)}d=y}const p={points:d,tcoords:u,colors:a,cellOffset:0,haveCellScalars:e.haveCellSCalars,customAttributes:e.renderable.getCustomShaderAttributes().map(y=>i.getPointData().getArrayByName(y))};p.cellOffset+=e.primitives[Xt.Points].getCABO().createVBO(i.getVerts(),"verts",c,p),p.cellOffset+=e.primitives[Xt.Lines].getCABO().createVBO(i.getLines(),"lines",c,p),p.cellOffset+=e.primitives[Xt.Tris].getCABO().createVBO(i.getPolys(),"polys",c,p),p.cellOffset+=e.primitives[Xt.TriStrips].getCABO().createVBO(i.getStrips(),"strips",c,p),e.VBOBuildTime.modified(),e.VBOBuildString=g}},t.renderPieceDraw=(r,s)=>{const i=s.getProperty().getRepresentation();e.context.depthMask(!0);for(let o=Xt.Start;o<Xt.End;o++)e.primitives[o].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[o],e.primitiveIDOffset+=e.primitives[o].drawArrays(r,s,i,t))},t.renderPieceFinish=(r,s)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release()},t.replaceShaderValues=(r,s,i)=>{t.replaceShaderColor(r,s,i),t.replaceShaderTCoord(r,s,i),t.replaceShaderPicking(r,s,i),t.replaceShaderPositionVC(r,s,i)},t.replaceShaderColor=(r,s,i)=>{let a=r.Vertex,o=r.Geometry,c=r.Fragment;e.haveCellScalars&&(c=N.substitute(c,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,c=N.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0?(a=N.substitute(a,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,a=N.substitute(a,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,o=N.substitute(o,"//VTK::Color::Dec",[`in vec4 fcolorVSOutput[];
`,"out vec4 fcolorGSOutput;"]).result,o=N.substitute(o,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,c=N.substitute(c,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,c=N.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(c=N.substitute(c,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,c=N.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),r.Vertex=a,r.Geometry=o,r.Fragment=c},t.replaceShaderTCoord=(r,s,i)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let a=r.Vertex,o=r.Geometry,c=r.Fragment;const u=e.lastBoundBO.getCABO().getTCoordComponents();u===1?(a=N.substitute(a,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,a=N.substitute(a,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=N.substitute(o,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,o=N.substitute(o,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=N.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=N.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):u===2&&(a=N.substitute(a,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,a=N.substitute(a,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=N.substitute(o,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,o=N.substitute(o,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=N.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=N.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.haveCellScalars&&(o=N.substitute(o,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),r.Vertex=a,r.Geometry=o,r.Fragment=c}},t.replaceShaderPicking=(r,s,i)=>{let a=r.Fragment;a=N.substitute(a,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,a=N.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,r.Fragment=a},t.replaceShaderPositionVC=(r,s,i)=>{e.lastBoundBO.replaceShaderPositionVC(r,s,i)},t.invokeShaderCallbacks=(r,s,i)=>{const a=e.renderable.getViewSpecificProperties().ShadersCallbacks;a&&a.forEach(o=>{o.callback(o.userData,r,s,i)})},t.setMapperShaderParameters=(r,s,i)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isAttributeUsed("vertexWC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexWC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||qa("Error setting vertexWC in shader VAO.")),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,u)=>{r.getProgram().isAttributeUsed(`${c}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${c}MC`,r.getCABO().getCustomData()[u].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[u].components,!1)||qa(`Error setting ${c}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||qa("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const a=e.openGLActor2D.getActiveTextures();if(a)for(let c=0;c<a.length;++c){const l=a[c].getTextureUnit(),f=`texture${l+1}`;r.getProgram().isUniformUsed(f)&&r.getProgram().setUniformi(f,l)}r.setMapperShaderParameters(s,i,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(r,s,i)=>{const a=e.renderable.getColorMapColors();if(!a||a.getNumberOfComponents()===0){const o=r.getProgram(),c=i.getProperty(),u=c.getOpacity(),l=c.getColor(),f=[l[0],l[1],l[2],u];o.setUniform4f("diffuseColor",f)}},t.setLightingShaderParameters=(r,s,i)=>{};function n(r,s,i){return s.identity(i),r.reduce((a,o,c)=>c===0?o?s.copy(a,o):s.identity(a):o?s.multiply(a,a,o):a,i)}t.setCameraShaderParameters=(r,s,i)=>{const a=r.getProgram(),c=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,l=s.getRenderWindow().getViews()[0].getViewportSize(s),f=s.getViewport(),h=i.getActualPositionCoordinate().getComputedDoubleViewportValue(s),g=[0,0,1,1],d=[0,0,1,1];if(d[0]=f[0]>=g[0]?f[0]:g[0],d[1]=f[1]>=g[1]?f[1]:g[1],d[2]=f[2]<=g[2]?f[2]:g[2],d[3]=f[3]<=g[3]?f[3]:g[3],d[0]>=d[2]||d[1]>=d[3])return;l[0]=Aa(l[0]*(d[2]-d[0])/(f[2]-f[0])),l[1]=Aa(l[1]*(d[3]-d[1])/(f[3]-f[1]));const p=e._openGLRenderer.getParent().getSize(),y=Aa(h[0]-(d[0]-f[0])*p[0]),x=Aa(h[1]-(d[1]-f[1])*p[1]),m=-y;let T=-y+l[0];const v=-x;let S=-x+l[1];m===T&&(T=m+1),v===S&&(S=v+1);const w=ce(new Float64Array(16));w[0]=2/(T-m),w[1*4+1]=2/(S-v),w[0*4+3]=-1*(T+m)/(T-m),w[1*4+3]=-1*(S+v)/(S-v),w[2*4+2]=0,w[2*4+3]=i.getProperty().getDisplayLocation()===W1.FOREGROUND?-1:1,w[3*4+3]=1,Le(w,w),a.setUniformMatrix("WCVCMatrix",n([w,c],_f,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(s=>{r+=s.getAllocatedGPUMemoryInBytes()}),r}}const jD={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function PD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jD,n),Ne.extend(t,e,n),hc.implementReplaceShaderCoincidentOffset(t,e,n),hc.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=Xt,e.tmpMat4=ce(new Float64Array(16));for(let r=Xt.Start;r<Xt.End;r++)e.primitives[r]=Ti.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Ze(t,e,["context"]),e.VBOBuildTime={},st(e.VBOBuildTime,{mtime:0}),ID(t,e)}const KD=Re(PD,"vtkOpenGLPolyDataMapper2D");At("vtkMapper2D",KD);const{VectorMode:XD}=s1;function vu(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function I1(t,e){return n=>{const r=n.getLastSize(),s=(r[0]/700)**.8,i=(r[1]/700)**.8,a=Math.min(s,i),o=n.getAxisTextStyle(),c=n.getTickTextStyle();Object.assign(o,e.axisTextStyle),Object.assign(c,e.tickTextStyle),o.fontSize=Math.max(24*a,12),n.getLastAspectRatio()>1?c.fontSize=Math.max(20*a,10):c.fontSize=Math.max(16*a,10);const u=n.updateTextureAtlas();n.setTopTitle(!1);const l=n.getBoxSizeByReference();if(n.getLastAspectRatio()>1)n.setTickLabelPixelOffset(.3*c.fontSize),u.titleWidth<=u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize?(n.setTopTitle(!0),n.setAxisTitlePixelOffset(.2*c.fontSize),l[0]=2*(u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.98-l[0],-.92])):(n.setAxisTitlePixelOffset(.2*c.fontSize),l[0]=2*(u.titleHeight+n.getAxisTitlePixelOffset()+u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.99-l[0],-.92])),l[1]=Math.max(1.2,Math.min(1.84/i,1.84));else{n.setAxisTitlePixelOffset(1.2*c.fontSize),n.setTickLabelPixelOffset(.1*c.fontSize);const f=2*(.8*c.fontSize+u.titleHeight+n.getAxisTitlePixelOffset())/r[1],h=2*u.tickWidth/r[0];l[0]=Math.min(1.9,Math.max(1.4,1.4*h*(n.getTicks().length+3))),l[1]=f,n.setBoxPosition([-.5*l[0],-.97])}n.recomputeBarSegments(u)}}function j1(t,e){return n=>{const r=n.getLastTickBounds(),s=sh().domain([r[0],r[1]]),i=s.ticks(5),a=s.tickFormat(5);n.setTicks(i),n.setTickStrings(i.map(a))}}function YD(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=s=>{e.renderable!==s&&(e.renderable=s,e.barActor.setProperty(s.getProperty()),e.barActor.setParentProp(s),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(s.getProperty()),e.tmActor.setParentProp(s),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=s.generateTicks,e.axisTextStyle={...s.getAxisTextStyle()},e.tickTextStyle={...s.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(s,i,a)=>{(e.lastSize[0]!==s[0]||e.lastSize[1]!==s[1])&&(e.lastSize[0]=s[0],e.lastSize[1]=s[1],e.lastAspectRatio=s[0]/s[1],e.forceUpdate=!0);const o=e.renderable.getScalarsToColors();if(!(!o||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(o),e.camera=i,e.renderWindow=a,e.forceUpdate||Math.max(o.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const c=o.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const u=t.updateTextureAtlas();t.recomputeBarSegments(u)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const s={},i=new Map;let a=0,o=1;vu(e.tmContext,e.axisTextStyle);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),u={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.axisTextStyle};i.set(e.renderable.getAxisLabel(),u),o+=u.height,a=u.width,s.titleWidth=u.width,s.titleHeight=u.height,s.tickWidth=0,s.tickHeight=0,vu(e.tmContext,e.tickTextStyle);const l=[...t.getTickStrings(),"NaN","Below","Above"];for(let f=0;f<l.length;f++)i.has(l[f])||(c=e.tmContext.measureText(l[f]),u={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.tickTextStyle},i.set(l[f],u),o+=u.height,a<u.width&&(a=u.width),s.tickWidth<u.width&&(s.tickWidth=u.width),s.tickHeight<u.height&&(s.tickHeight=u.height));return a=qt(a),o=qt(o),i.forEach(f=>{f.tcoords=[0,(o-f.startingHeight-f.height)/o,f.width/a,(o-f.startingHeight-f.height)/o,f.width/a,(o-f.startingHeight)/o,0,(o-f.startingHeight)/o]}),e.tmCanvas.width=a,e.tmCanvas.height=o,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,a,o),i.forEach((f,h)=>{vu(e.tmContext,f.textStyle),e.tmContext.fillText(h,1,f.startingHeight+f.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=i,s},t.computeBarSize=s=>{e.vertical=e.boxSize[1]>e.boxSize[0];const i=2*s.tickHeight/e.lastSize[1],a=[1,1];if(e.vertical){const o=2*(s.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const c=2*(s.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-o,e.barSize[1]=e.boxSize[1]-c}else{const c=2*(s.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-o,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+o,e.barPosition[1]=e.boxPosition[1],a[1]=i}else{const o=(2*s.tickWidth-8)/e.lastSize[0],c=2*(s.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],a[0]=o}return a},t.recomputeBarSegments=s=>{var h,g,d,p;const i=t.computeBarSize(s);e.barSegments=[];const a=[0,0],o=e.vertical?1:0,c=e.vertical?.01:.02;function u(y,x){e.barSegments.push({corners:[[...a],[a[0]+i[0],a[1]],[a[0]+i[0],a[1]+i[1]],[a[0],a[1]+i[1]]],scalars:x,title:y}),a[o]+=i[o]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&u("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&((g=(h=e.renderable.getScalarsToColors()).getUseBelowRangeColor)!=null&&g.call(h))&&u("Below",[-.1,-.1,-.1,-.1]);const l=(p=(d=e.renderable.getScalarsToColors()).getUseAboveRangeColor)==null?void 0:p.call(d);a[o]+=c;const f=i[o];i[o]=l?1-2*c-i[o]-a[o]:1-c-a[o],u("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&l&&(i[o]=f,a[o]+=c,u("Above",[1.1,1.1,1.1,1.1]))};const n=new Float64Array(3);t.createPolyDataForOneLabel=(s,i,a,o,c,u)=>{const l=e._tmAtlas.get(s);if(!l)return;let f=u.ptIdx,h=u.cellIdx;n[0]=(.5*i[0]+.5)*e.lastSize[0],n[1]=(.5*i[1]+.5)*e.lastSize[1],n[2]=i[2],n[0]+=c[0],n[1]+=c[1];const g=[],d=o==="vertical"?[1,0]:[0,1];o==="vertical"?(g[0]=l.width,g[1]=-l.height,a[0]==="middle"?n[1]-=l.width/2:a[0]==="right"&&(n[1]-=l.width),a[1]==="middle"?n[0]+=l.height/2:a[1]==="top"&&(n[0]+=l.height)):(g[0]=l.width,g[1]=l.height,a[0]==="middle"?n[0]-=l.width/2:a[0]==="right"&&(n[0]-=l.width),a[1]==="middle"?n[1]-=l.height/2:a[1]==="top"&&(n[1]-=l.height)),u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=l.tcoords[0],u.tcoords[f*2+1]=l.tcoords[1],f++,n[d[0]]+=g[0],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=l.tcoords[2],u.tcoords[f*2+1]=l.tcoords[3],f++,n[d[1]]+=g[1],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=l.tcoords[4],u.tcoords[f*2+1]=l.tcoords[5],f++,n[d[0]]-=g[0],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=l.tcoords[6],u.tcoords[f*2+1]=l.tcoords[7],f++,u.polys[h*4]=3,u.polys[h*4+1]=f-4,u.polys[h*4+2]=f-3,u.polys[h*4+3]=f-2,h++,u.polys[h*4]=3,u.polys[h*4+1]=f-4,u.polys[h*4+2]=f-2,u.polys[h*4+3]=f-1,u.ptIdx+=4,u.cellIdx+=2};const r=new Float64Array(3);t.updatePolyDataForLabels=()=>{const s=t.getTickStrings().length+e.barSegments.length,i=s*4,a=s*2,o=new Float64Array(i*3),c=new Uint16Array(a*4),u=new Float32Array(i*2),l={ptIdx:0,cellIdx:0,polys:c,points:o,tcoords:u},f=e.vertical?0:1,h=e.vertical?1:0;r[2]=-.99;const g=e.vertical?["right","middle"]:["middle","bottom"];let d=[0,1];const p=[0,0];e.vertical?(p[0]=-e.tickLabelPixelOffset,e.topTitle?(r[0]=e.boxPosition[0]+.5*e.boxSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],l)):(r[0]=e.barPosition[0]+e.barSize[0],r[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],l)),d=[-1,0]):(p[1]=e.tickLabelPixelOffset,r[0]=e.barPosition[0]+.5*e.barSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],l)),r[f]=e.barPosition[f]+(.5*d[f]+.5)*e.barSize[f],r[h]=e.barPosition[h]+e.barSize[h]*.5;let y=null;for(let M=0;M<e.barSegments.length;M++){const E=e.barSegments[M];E.title==="ticks"?y=E:(r[h]=e.barPosition[h]+.5*e.barSize[h]*(E.corners[2][h]+E.corners[0][h]),t.createPolyDataForOneLabel(E.title,r,g,"horizontal",p,l))}const x=e.barPosition[h]+e.barSize[h]*y.corners[0][h],m=e.barSize[h]*(y.corners[2][h]-y.corners[0][h]),T=t.getTicks(),v=t.getTickStrings(),S=t.getTickPositions();for(let M=0;M<T.length;M++){const E=S?S[M]:(T[M]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);r[h]=x+m*E,t.createPolyDataForOneLabel(v[M],r,g,"horizontal",p,l)}const w=ve.newInstance({numberOfComponents:2,values:u,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(w),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{var p,y;const s=e.renderable.getScalarsToColors();let i=0;e.renderable.getDrawNanAnnotation()&&s.getNanColor()&&(i+=1),e.renderable.getDrawBelowRangeSwatch()&&((p=s.getUseBelowRangeColor)!=null&&p.call(s))&&(i+=1),e.renderable.getDrawAboveRangeSwatch()&&((y=s.getUseAboveRangeColor)!=null&&y.call(s))&&(i+=1);const a=4*(1+i),o=a;let c=1;s.getVectorMode()===XD.COMPONENT&&(c=s.getVectorComponent()+1);const u=new Float64Array(a*3),l=new Uint16Array(o*5),f=new Float32Array(a*c);let h=0,g=0;for(let x=0;x<e.barSegments.length;x++){const m=e.barSegments[x];for(let T=0;T<4;T++){r[0]=e.barPosition[0]+m.corners[T][0]*e.barSize[0],r[1]=e.barPosition[1]+m.corners[T][1]*e.barSize[1],u[h*3]=(.5*r[0]+.5)*e.lastSize[0],u[h*3+1]=(.5*r[1]+.5)*e.lastSize[1],u[h*3+2]=r[2];for(let v=0;v<c;v++)f[h*c+v]=e.lastTickBounds[0]+m.scalars[T]*(e.lastTickBounds[1]-e.lastTickBounds[0]);h++}l[g*5]=4,l[g*5+1]=h-4,l[g*5+2]=h-3,l[g*5+3]=h-2,l[g*5+4]=h-1,g++}const d=ve.newInstance({numberOfComponents:c,values:f,name:"Scalars"});e.polyData.getPointData().setScalars(d),e.polyData.getPoints().setData(u,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(l,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const qD=C.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),C.obj(t,e),C.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings","tickPositions"]),C.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),C.getArray(t,e,["boxPosition","boxSize"]),C.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},C.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=ds.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=hn.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=ps.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=hn.newInstance(),e.tmMapper=ds.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=Ac.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=ps.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],YD(t,e)},"vtkScalarBarActorHelper");function ZD(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(I1(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(j1())}}function QD(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function P1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QD(n)),e.autoLayout||(e.autoLayout=I1(t,e)),e.generateTicks||(e.generateTicks=j1()),ps.extend(t,e,n),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),C.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),C.get(t,e,["axisTextStyle","tickTextStyle"]),C.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),C.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),ZD(t,e)}const JD=C.newInstance(P1,"vtkScalarBarActor");var K1={newInstance:JD,extend:P1,newScalarBarActorHelper:qD};function eb(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const s=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,i=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([i.usize,i.vsize],s,e._openGLRenderWindow.getRenderable())}}}const tb={};function nb(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tb,n),Ne.extend(t,e,n),e.scalarBarActorHelper=K1.newScalarBarActorHelper(),eb(t,e)}const rb=Re(nb,"vtkOpenGLScalarBarActor");At("vtkScalarBarActor",rb);const{vtkErrorMacro:Mp}=On;function sb(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const s=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",s);const i=e._openGLRenderer.getRenderable(),a=e.openGLCamera.getKeyMatrices(i),o=new Float64Array(16);if(wt(o,a.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",o),e.lastFormat==="box"){const c=i.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let o=0;o<4;o++)r[o*3]=o%2*2-1,r[o*3+1]=o>1?1:-1,r[o*3+2]=1;const s=ve.newInstance({numberOfComponents:3,values:r});s.setName("points");const i=new Uint16Array(8);i[0]=3,i[1]=0,i[2]=1,i[3]=3,i[4]=3,i[5]=0,i[6]=3,i[7]=2;const a=ve.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(a,"polys",Gt.SURFACE,{points:s,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Mp("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||Mp("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const ib={context:null};function ab(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ib,n),Ne.extend(t,e,n),e.openGLTexture=us.newInstance(),e.tris=Ti.newInstance(),e.keyMatrixTime={},st(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:ys(new Float64Array(9)),mcwc:ce(new Float64Array(16))},Ze(t,e,["context"]),Ct(t,e,["activeTextures"]),sb(t,e)}const ob=Re(ab);At("vtkSkybox",ob);const{vtkDebugMacro:cb}=On;function ub(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const s=e._openGLRenderer.getAspectRatio(),i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();let o=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),u=Math.floor(c.getWidth()),l=Math.floor(c.getHeight()),f=e._openGLRenderWindow.getContext();c.bind();const h=r.getFramebuffer();h?h.saveCurrentBindingsAndBuffers():cb("No framebuffer to save/restore");const g=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,g),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c.getHandle(),0),f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(o=new Uint8Array(u*l*4),f.viewport(0,0,u,l),f.readPixels(0,0,u,l,f.RGBA,f.UNSIGNED_BYTE,o)),h&&h.restorePreviousBindingsAndBuffers(),f.deleteFramebuffer(g)}e.renderable.invokeCallback(e.renderable.getInputData(),i,s,a,o)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const fb={};function lb(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fb,n),Ne.extend(t,e,n),ub(t,e)}const hb=Re(lb,"vtkOpenGLPixelSpaceCallbackMapper");At("vtkPixelSpaceCallbackMapper",hb);const X1=Object.create(null);function Dn(t,e){X1[t]=e}function gb(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const pb={};function Y1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pb,n),e.overrides=X1,Zy.extend(t,e,n),gb(t,e)}const db=C.newInstance(Y1,"vtkWebGPUViewNodeFactory");var yb={newInstance:db,extend:Y1};function xb(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,s,i)=>{if(ce(n),e.renderable.getParallelProjection()){const a=e.renderable.getParallelScale(),o=a*r,c=a,u=(i[0]-1)*o,l=(i[0]+1)*o,f=(i[1]-1)*c,h=(i[1]+1)*c,g=1/(l-u),d=1/(h-f);n[0]=2*g,n[5]=2*d,n[10]=1/(s[1]-s[0]),n[12]=(l+u)*g,n[13]=(h+f)*d,n[14]=s[1]/(s[1]-s[0])}else{const a=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let o,c;e.renderable.getUseHorizontalViewAngle()===!0?(o=s[0]*a,c=s[0]*a/r):(o=s[0]*a*r,c=s[0]*a);const u=(i[0]-1)*o,l=(i[0]+1)*o,f=(i[1]-1)*c,h=(i[1]+1)*c;n[0]=2*s[0]/(l-u),n[5]=2*s[0]/(h-f),n[12]=(u+l)/(l-u),n[13]=(f+h)/(h-f),n[10]=0,n[14]=s[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let s=-r[0]/n;return s=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(s*(r[1]-r[0])),.5*s+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),s=n.getParent();if(Math.max(s.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const i=e.renderable.getViewMatrix();it(e.keyMatrices.normalMatrix,i),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,wt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Le(e.keyMatrices.wcvc,i);const a=n.getStabilizedCenterByReference();Ae(e.keyMatrices.scvc,e.keyMatrices.wcvc,a);const o=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,o,c,e.renderable.getWindowCenterByReference()),Ye(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),wt(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const Tb={keyMatrixTime:null,keyMatrices:null};function vb(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Tb,n),Ne.extend(t,e,n),e.keyMatrixTime={},C.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},C.setGet(t,e,["keyMatrixTime"]),xb(t,e)}const mb=C.newInstance(vb);Dn("vtkCamera",mb);function Sb(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let s=0;s<e.bindables.length;s++)e.bindables[s]!==n[s]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let s=0;s<e.bindables.length;s++){const i=e.bindables[s].getBindGroupLayoutEntry();i.binding=s,r.push(i)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let i=0;i<e.bindables.length;i++){const a=e.bindables[i].getBindGroupTime().getMTime();r=a>r?a:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const s=[];for(let i=0;i<e.bindables.length;i++){const a=e.bindables[i].getBindGroupEntry();a.binding=i,s.push(a)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:s,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],s=n.getBindGroupLayoutCount(e.label);for(let i=0;i<e.bindables.length;i++)r.push(e.bindables[i].getShaderCode(i,s));return r.join(`
`)}}const wb={device:null,handle:null,label:null};function q1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wb,n),C.obj(t,e),e.bindables=[],e.bindGroupTime={},C.obj(e.bindGroupTime,{mtime:0}),C.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),C.setGet(t,e,["label","device","arrayInformation"]),Sb(t,e)}const Cb=C.newInstance(q1);var Z1={newInstance:Cb,extend:q1};function Mb(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const Eb={device:null,handle:null};function Q1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Eb,n),C.obj(t,e),C.get(t,e,["lastCameraMTime"]),C.setGet(t,e,["device","handle"]),Mb(t,e)}const _b=C.newInstance(Q1,"vtkWebGPUShaderModule");var Rb={newInstance:_b,extend:Q1};function Ob(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const s=Array.isArray(n)?n.join(`
`):n;let i=!1;t.search(e)!==-1&&(i=!0);let a="";r&&(a="g");const o=new RegExp(e,a),c=t.replace(o,s);return{replace:i,result:c}}function Db(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),s=n.getHash(),i=e._shaderModules.keys();for(let o=0;o<i.length;o++){const c=i[o];if(c.getHash()===s&&c.getType()===r)return e._shaderModules.get(c)}const a=Rb.newInstance();return a.initialize(e.device,n),e._shaderModules.set(n,a),a}}const bb={shaderModules:null,device:null,window:null};function J1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bb,n),e._shaderModules=new Map,C.obj(t,e),C.setGet(t,e,["device","window"]),Db(t,e)}const Lb=C.newInstance(J1,"vtkWebGPUShaderCache");var ie={newInstance:Lb,extend:J1,substitute:Ob};function Vb(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const s=[];for(let i=0;i<e.layouts.length;i++)s.push(e.layouts[i].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:s}),e.pipelineDescription.layout=e.pipelineLayout;for(let i=0;i<e.shaderDescriptions.length;i++){const a=e.shaderDescriptions[i],o=n.getShaderModule(a);a.getType()==="vertex"&&(e.pipelineDescription.vertex.module=o.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),a.getType()==="fragment"&&(e.pipelineDescription.fragment.module=o.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const Fb={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function eT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fb,n),st(t,e),e.layouts=[],e.shaderDescriptions=[],Ct(t,e,["handle","pipelineDescription"]),Ze(t,e,["device","renderEncoder","topology","vertexState"]),Vb(t,e)}const Bb=Re(eT,"vtkWebGPUPipeline");var kb={newInstance:Bb,extend:eT};function Nb(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(s)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const s=[];let i=[];if(r&&s.push(r.getShaderCode()),n||e.builtinInputNames.length){const a=[];if(a.push(`struct ${e.type}Input
{`),n){const o=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),u=n.getOutputInterpolationsByReference();for(let l=0;l<o.length;l++)u[l]!==void 0?a.push(`  @location(${l}) @interpolate(${u[l]}) ${o[l]} : ${c[l]},`):a.push(`  @location(${l}) ${o[l]} : ${c[l]},`)}for(let o=0;o<e.builtinInputNames.length;o++)a.push(`  ${e.builtinInputNames[o]} : ${e.builtinInputTypes[o]},`);a.length>1&&(a.push("};"),i=a,s[s.length-1]+=",",s.push(`input: ${e.type}Input`))}if(s.length&&(e.code=ie.substitute(e.code,"//VTK::IOStructs::Input",s).result),e.outputNames.length+e.builtinOutputNames.length){const a=[`struct ${e.type}Output
{`];for(let o=0;o<e.outputNames.length;o++)e.outputInterpolations[o]!==void 0?a.push(`  @location(${o}) @interpolate(${e.outputInterpolations[o]}) ${e.outputNames[o]} : ${e.outputTypes[o]},`):a.push(`  @location(${o}) ${e.outputNames[o]} : ${e.outputTypes[o]},`);for(let o=0;o<e.builtinOutputNames.length;o++)a.push(`  ${e.builtinOutputNames[o]} : ${e.builtinOutputTypes[o]},`);a.push("};"),i=i.concat(a),e.code=ie.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=ie.substitute(e.code,"//VTK::IOStructs::Dec",i).result}}const Ub={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function tT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ub,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],C.obj(t,e),C.setGet(t,e,["type","hash","code"]),C.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),Nb(t,e)}const Gb=C.newInstance(tT,"vtkWebGPUShaderDescription");var Ep={newInstance:Gb,extend:tT};const _p={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function Ab(t){return!t||t.length<6?0:t in _p?_p[t]:(oe(`unknown format ${t}`),null)}function zb(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return oe(`unknown format ${t}`),0;const s=5-r/2;return e*s}function $b(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function Wb(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{oe(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){oe(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function Hb(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{oe(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function Ib(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function jb(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";oe(`unknown format ${t}`)}}var nt={getDetailsFromTextureFormat:Ab,getByteStrideFromBufferFormat:zb,getNumberOfComponentsFromBufferFormat:$b,getNativeTypeFromBufferFormat:Wb,getShaderTypeFromBufferFormat:Hb,getByteStrideFromShaderFormat:Ib,getNativeTypeFromShaderFormat:jb};function Pb(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function Kb(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",i=r;Array.isArray(i)||(i=[i]);for(let a=0;a<e.inputs.length;a++)if(Pb(e.inputs[a].names,i)){if(e.inputs[a].buffer===n)return;e.inputs[a].buffer=n;return}e.inputs.push({buffer:n,stepMode:s,names:i}),e.inputs=e.inputs.sort((a,o)=>a.names[0]<o.names[0]?-1:a.names[0]>o.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let s=0;s<e.inputs.length;s++)for(let i=0;i<e.inputs[s].names.length;i++){const a=e.inputs[s].buffer.getArrayInformation()[i],o=nt.getShaderTypeFromBufferFormat(a.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[s].names[i]} : ${o}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let s=0;for(let i=0;i<e.inputs.length;i++){const a=e.inputs[i].buffer,o={arrayStride:a.getStrideInBytes(),stepMode:e.inputs[i].stepMode,attributes:[]},c=a.getArrayInformation();for(let u=0;u<e.inputs[i].names.length;u++)o.attributes.push({shaderLocation:s,offset:c[u].offset,format:c[u].format}),s++;r.push(o)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const Xb={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function nT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xb,n),st(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Ze(t,e,["created","device","handle","indexBuffer"]),Kb(t,e)}const Yb=Re(nT,"vtkWebGPUVertexInput");var qb={newInstance:Yb,extend:nT};const Zb=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,Qb=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function Jb(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,s)=>{const i=Ep.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),a=Ep.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),o=r.getShaderDescriptions();o.push(i),o.push(a);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,u=new RegExp("//VTK::[^:]*::","g"),f=c.match(u).filter((h,g,d)=>d.indexOf(h)===g).map(h=>`replaceShader${h.substring(7,h.length-2)}`);for(let h=0;h<f.length;h++){const g=f[h];g!=="replaceShaderIOStructs"&&e.shaderReplacements.has(g)&&e.shaderReplacements.get(g)(n,r,s)}t.replaceShaderIOStructs(n,r,s)},t.replaceShaderIOStructs=(n,r,s)=>{const i=r.getShaderDescription("vertex");i.replaceShaderCode(null,s),r.getShaderDescription("fragment").replaceShaderCode(i)},t.replaceShaderRenderEncoder=(n,r,s)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,s)=>{if(!e.WebGPURenderer)return;const i=e.WebGPURenderer.getBindGroup().getShaderCode(r),a=r.getShaderDescription("vertex");let o=a.getCode();o=ie.substitute(o,"//VTK::Renderer::Dec",[i]).result,a.setCode(o);const c=r.getShaderDescription("fragment");o=c.getCode(),o=ie.substitute(o,"//VTK::Renderer::Dec",[i]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,s)=>{const i=e.bindGroup.getShaderCode(r),a=r.getShaderDescription("vertex");let o=a.getCode();o=ie.substitute(o,"//VTK::Mapper::Dec",[i]).result,a.setCode(o);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),o=c.getCode(),o=ie.substitute(o,"//VTK::Mapper::Dec",[i]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,s)=>{const i=r.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let a=i.getCode();a=ie.substitute(a,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,i.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,s)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const s=e.vertexInput.getIndexBuffer();s?n.drawIndexed(s.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const s=e.textureViews[r].getSampler();s&&n.push(s)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=kb.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const eL={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function rT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eL,n),Ne.extend(t,e,n),e.textureViews=[],e.vertexInput=qb.newInstance(),e.bindGroup=Z1.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||Qb,e.vertexShaderTemplate=e.vertexShaderTemplate||Zb,e.shaderReplacements=new Map,C.get(t,e,["pipeline","vertexInput"]),C.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),Jb(t,e)}const tL=C.newInstance(rT,"vtkWebGPUSimpleMapper");var vh={newInstance:tL,extend:rT};function nL(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,s)=>{const i=r.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),i.addOutput("vec4<f32>","vertexVC");let a=i.getCode();a=ie.substitute(a,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,i.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const rL={};function sT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rL,n),vh.extend(t,e,n),nL(t,e)}const sL=C.newInstance(sT,"vtkWebGPUFullScreenQuad");var ai={newInstance:sL,extend:sT};const iL={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},aL={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var Ea={BufferUsage:iL,PrimitiveTypes:aL};const mu=["getMappedRange","mapAsync","unmap"];function oL(t,e,n,r){const s=r.byteLength,i=t.createBuffer({size:s,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),a=i.getMappedRange(0,s);new Uint8Array(a).set(new Uint8Array(r)),i.unmap();const o=t.createCommandEncoder();o.copyBufferToBuffer(i,0,e,n,s);const c=o.finish();t.queue.submit([c]),i.destroy()}function cL(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{oL(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{const s=Math.ceil(n.byteLength/4)*4;e.handle=e.device.getHandle().createBuffer({size:s,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=s,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<mu.length;n++)t[mu[n]]=function(){return e.handle[mu[n]](...arguments)}}const uL={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function iT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uL,n),C.obj(t,e),C.get(t,e,["handle","sizeInBytes","usage"]),C.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),cL(t,e)}const fL=C.newInstance(iT);var oi={newInstance:fL,extend:iT,...Ea};const{Representation:Rp}=xi,{PrimitiveTypes:mr}=Ea;class lL{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function hL(t){switch(t){case mr.Points:return"points";case mr.Lines:return"lines";case mr.Triangles:case mr.TriangleEdges:return"polys";case mr.TriangleStripEdges:case mr.TriangleStrips:return"strips";default:return""}}function Za(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function gL(t,e,n){const r=t.length;for(let a=0;a<r;a++){let o=t[a];if(n.cellProvokedMap.has(o)){n.ibo[n.iboId++]=n.cellProvokedMap.get(o);for(let c=a+1;c<a+r;c++){o=t[c%r];const u=Za(n,o,e);n.ibo[n.iboId++]=u}return}}for(let a=0;a<r;a++){let o=t[a];if(!n.provokedPointIds[o]){let c=Za(n,o,e);n.provokedPointIds[o]=1,n.cellProvokedMap.set(o,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let u=a+1;u<a+r;u++)o=t[u%r],c=Za(n,o,e),n.ibo[n.iboId++]=c;return}}let s=t[0],i=n.flatId;n.cellProvokedMap.set(s,i),n.flatIdToPointId[n.flatId]=s,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=i;for(let a=1;a<r;a++)s=t[a],i=Za(n,s,e),n.ibo[n.iboId++]=i}function pL(t,e,n){const r=t.length;n.iboSize+=r;for(let s=0;s<r;s++){const i=t[s];if(n.cellProvokedMap.has(i))return}for(let s=0;s<r;s++){const i=t[s];if(!n.provokedPointIds[i]){n.provokedPointIds[i]=1,n.cellProvokedMap.set(i,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let zn;const Op=new Uint32Array(1),Ft=new Uint32Array(2),ir=new Uint32Array(3),Su={anythingToPoints(t,e,n,r,s){for(let i=0;i<t;++i)Op[0]=e[n+i],zn(Op,r,s)},linesToWireframe(t,e,n,r,s){for(let i=0;i<t-1;++i)Ft[0]=e[n+i],Ft[1]=e[n+i+1],zn(Ft,r,s)},polysToWireframe(t,e,n,r,s){if(t>2)for(let i=0;i<t;++i)Ft[0]=e[n+i],Ft[1]=e[n+(i+1)%t],zn(Ft,r,s)},stripsToWireframe(t,e,n,r,s){if(t>2){for(let i=0;i<t-1;++i)Ft[0]=e[n+i],Ft[1]=e[n+i+1],zn(Ft,r,s);for(let i=0;i<t-2;i++)Ft[0]=e[n+i],Ft[1]=e[n+i+2],zn(Ft,r,s)}},polysToSurface(t,e,n,r,s){for(let i=0;i<t-2;i++)ir[0]=e[n],ir[1]=e[n+i+1],ir[2]=e[n+i+2],zn(ir,r,s)},stripsToSurface(t,e,n,r,s){for(let i=0;i<t-2;i++)ir[0]=e[n+i],ir[1]=e[n+i+1+i%2],ir[2]=e[n+i+1+(i+1)%2],zn(ir,r,s)}};function dL(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,s=n.primitiveType,i=n.representation,a=n.cellOffset,o=r.getData(),c=o.length,u=hL(s),l=n.numberOfPoints,f={provokedPointIds:new Uint8Array(l),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new lL};let h=null;i===Rp.POINTS||s===mr.Points?h=Su.anythingToPoints:i===Rp.WIREFRAME||s===mr.Lines?h=Su[`${u}ToWireframe`]:h=Su[`${u}ToSurface`],zn=pL;let g=a||0;for(let d=0;d<c;)f.cellProvokedMap.clear(),h(o[d],o,d+1,g,f),d+=o[d]+1,g++;l<=65535?f.flatIdToPointId=new Uint16Array(l+f.extraPoints):f.flatIdToPointId=new Uint32Array(l+f.extraPoints),l+f.extraPoints<36863?f.pointIdToFlatId=new Int16Array(l):f.pointIdToFlatId=new Int32Array(l),l+f.extraPoints<=65535?(f.ibo=new Uint16Array(f.iboSize),n.format="uint16"):(f.ibo=new Uint32Array(f.iboSize),n.format="uint32"),g<=65535?f.flatIdToCellId=new Uint16Array(l+f.extraPoints):f.flatIdToCellId=new Uint32Array(l+f.extraPoints),f.pointIdToFlatId.fill(-1),f.provokedPointIds.fill(0),zn=gL,g=a||0;for(let d=0;d<c;)f.cellProvokedMap.clear(),h(o[d],o,d+1,g,f),d+=o[d]+1,g++;delete f.provokedPointIds,delete f.pointIdToFlatId,n.nativeArray=f.ibo,e.flatIdToPointId=f.flatIdToPointId,e.flatIdToCellId=f.flatIdToCellId,e.flatSize=f.flatId,e.indexCount=f.iboId}}const yL={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function aT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yL,n),oi.extend(t,e,n),C.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),dL(t,e)}const xL=C.newInstance(aT);var TL={newInstance:xL,extend:aT,...Ea};const{BufferUsage:ar}=Ea,{vtkErrorMacro:vL}=On,{VtkDataTypes:Wr}=ve,mL={};function SL(t){let e;switch(t.getDataType()){case Wr.UNSIGNED_CHAR:e="uint8";break;case Wr.FLOAT:e="float32";break;case Wr.UNSIGNED_INT:e="uint32";break;case Wr.INT:e="sint32";break;case Wr.DOUBLE:e="float32";break;case Wr.UNSIGNED_SHORT:e="uint16";break;case Wr.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||vL(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function Dp(t,e,n,r,s){const i={},a=t.getFlatSize();if(!a)return i;let o=[0,0,0,0];s.shift&&(s.shift.length?o=s.shift:o.fill(s.shift));let c=[1,1,1,1];s.scale&&(s.scale.length?c=s.scale:c.fill(s.scale));const u=Object.prototype.hasOwnProperty.call(s,"packExtra")?s.packExtra:!1;let l,f=0;const h=n+(u?1:0),g=pi(r,a*h);let d=t.getFlatIdToPointId();s.cellData&&(d=t.getFlatIdToCellId()),n===1?l=function(y){g[f++]=c[0]*e[y]+o[0]}:n===2?l=function(y){g[f++]=c[0]*e[y]+o[0],g[f++]=c[1]*e[y+1]+o[1]}:n===3&&!u?l=function(y){g[f++]=c[0]*e[y]+o[0],g[f++]=c[1]*e[y+1]+o[1],g[f++]=c[2]*e[y+2]+o[2]}:n===3&&u?l=function(y){g[f++]=c[0]*e[y]+o[0],g[f++]=c[1]*e[y+1]+o[1],g[f++]=c[2]*e[y+2]+o[2],g[f++]=c[3]*1+o[3]}:n===4&&(l=function(y){g[f++]=c[0]*e[y]+o[0],g[f++]=c[1]*e[y+1]+o[1],g[f++]=c[2]*e[y+2]+o[2],g[f++]=c[3]*e[y+3]+o[3]});for(let p=0;p<a;p++){const y=n*d[p];l(y)}return i.nativeArray=g,i}function wL(t,e,n,r){const s=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],i=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],a=[];return ga(s,i,a),pa(a),a}function CL(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const s=new Int8Array(t.getNumberOfCells()*4),i=r.length;let a=0;for(let o=0;o<i;){const c=wL(n,r[o+1],r[o+2],r[o+3]);s[a++]=127*c[0],s[a++]=127*c[1],s[a++]=127*c[2],s[a++]=127,o+=r[o]+1}return s}function ML(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let s,i;if(r.usage===ar.Index&&(s=TL.newInstance({label:r.label}),s.setDevice(e.device),i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,s.buildIndexBuffer(r),s.createAndWrite(r.nativeArray,i),s.setArrayInformation([{format:r.format}])),s||(s=oi.newInstance({label:r.label}),s.setDevice(e.device)),r.usage===ar.UniformArray&&(i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,s.createAndWrite(r.nativeArray,i)),r.usage===ar.Storage&&(i=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,s.createAndWrite(r.nativeArray,i)),r.usage===ar.Texture&&(i=GPUBufferUsage.COPY_SRC,s.createAndWrite(r.nativeArray,i)),r.usage===ar.PointArray){i=GPUBufferUsage.VERTEX;const a=nt.getNativeTypeFromBufferFormat(r.format),o=Dp(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),a,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});s.createAndWrite(o.nativeArray,i),s.setStrideInBytes(nt.getByteStrideFromBufferFormat(r.format)),s.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===ar.NormalsFromPoints){i=GPUBufferUsage.VERTEX;const a=nt.getNativeTypeFromBufferFormat(r.format),o=CL(r.cells,r.dataArray),c=Dp(r.indexBuffer,o,4,a,{cellData:!0});s.createAndWrite(c.nativeArray,i),s.setStrideInBytes(nt.getByteStrideFromBufferFormat(r.format)),s.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===ar.RawVertex&&(i=GPUBufferUsage.VERTEX,s.createAndWrite(r.nativeArray,i),s.setStrideInBytes(nt.getByteStrideFromBufferFormat(r.format)),s.setArrayInformation([{offset:0,format:r.format}])),s.setSourceTime(r.time),s}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,s)=>{const i=SL(r),a={hash:`${r.getMTime()}I${s.getMTime()}${i}`,usage:ar.PointArray,format:i,dataArray:r,indexBuffer:s};return t.getBuffer(a)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=oi.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const EL={device:null,fullScreenQuadBuffer:null};function oT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EL,n),st(t,e),Ze(t,e,["device"]),ML(t,e)}const _L=Re(oT);var Lr={newInstance:_L,extend:oT,...mL,...Ea};const{BufferUsage:RL}=Lr,{vtkErrorMacro:Cs}=C;function OL(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Cs(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const s=nt.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:s,offset:e.sizeInBytes,nativeType:nt.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=s},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:RL.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=C.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,s)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Cs(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];o[(a.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT]=s},t.setArray=(n,r,s)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Cs(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],c=(a.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let u=0;u<s.length;u++)o[c+u]=s[u]},t.setAllInstancesFromArray=(n,r)=>{const s=e._bufferEntryNames.get(n);if(s===void 0){Cs(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const a=e[i.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(i.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let l=0;l<o;l++)a[u+l]=r[c*o+l]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const s=e._bufferEntryNames.get(n);if(s===void 0){Cs(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const a=e[i.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(i.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let l=0;l<o;l++)a[u+l]=r[c*o+l]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const s=e._bufferEntryNames.get(n);if(s===void 0){Cs(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const a=e[i.nativeType],o=9;for(let c=0;c<e.numberOfInstances;c++){const u=(i.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let l=0;l<3;l++)for(let f=0;f<3;f++)a[u+l*4+f]=r[c*o+l*3+f]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const s=[`struct ${e.label}StructEntry
{`];for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];s.push(`  ${a.name}: ${a.type},`)}return s.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),s.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const DL={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function cT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DL,n),C.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},C.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},C.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},C.get(t,e,["bindGroupTime"]),C.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),OL(t,e)}const bL=C.newInstance(cT,"vtkWebGPUStorageBuffer");var el={newInstance:bL,extend:cT};const{BufferUsage:LL}=Lr,{vtkErrorMacro:wu}=C;function VL(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){wu(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:nt.getByteStrideFromShaderFormat(r),offset:-1,nativeType:nt.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let s=4;for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];a.sizeInBytes%16===0&&(s=Math.max(16,s)),a.sizeInBytes%8===0&&(s=Math.max(8,s))}for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];a.packed===!1&&a.sizeInBytes%16===0&&(a.packed=!0,a.offset=n,r.push(a),n+=a.sizeInBytes)}for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];if(a.packed===!1&&a.sizeInBytes===12)for(let o=0;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(c.packed===!1&&c.sizeInBytes===4){a.packed=!0,a.offset=n,r.push(a),n+=a.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];if(!a.packed&&a.sizeInBytes%8===0)for(let o=i+1;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(!c.packed&&c.sizeInBytes%8===0){a.packed=!0,a.offset=n,r.push(a),n+=a.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];if(!a.packed&&a.sizeInBytes%8===0){let o=!1;for(let c=0;!o&&c<e.bufferEntries.length;c++){const u=e.bufferEntries[c];if(!u.packed&&u.sizeInBytes===4)for(let l=c+1;l<e.bufferEntries.length;l++){const f=e.bufferEntries[l];if(!f.packed&&f.sizeInBytes===4){a.packed=!0,a.offset=n,r.push(a),n+=a.sizeInBytes,u.packed=!0,u.offset=n,r.push(u),n+=u.sizeInBytes,f.packed=!0,f.offset=n,r.push(f),n+=f.sizeInBytes,o=!0;break}}}}}for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];!a.packed&&a.sizeInBytes>4&&(a.packed=!0,a.offset=n,r.push(a),n+=a.sizeInBytes)}for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];a.packed||(a.packed=!0,a.offset=n,r.push(a),n+=a.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let i=0;i<e.bufferEntries.length;i++)e._bufferEntryNames.set(e.bufferEntries[i].name,i);e.sizeInBytes=n,e.sizeInBytes=s*Math.ceil(e.sizeInBytes/s),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:LL.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=C.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const s=e._bufferEntryNames.get(n);if(s===void 0){wu(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const a=e[i.nativeType];i.lastValue!==r&&(a[i.offset/a.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),i.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const s=e._bufferEntryNames.get(n);if(s===void 0){wu(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const a=e[i.nativeType];let o=!1;for(let c=0;c<r.length;c++)(!i.lastValue||i.lastValue[c]!==r[c])&&(a[i.offset/a.BYTES_PER_ELEMENT+c]=r[c],o=!0);o&&(e.sendDirty=!0,i.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const s=[`struct ${e.label}Struct
{`];for(let i=0;i<e.bufferEntries.length;i++){const a=e.bufferEntries[i];s.push(`  ${a.name}: ${a.type},`)}return s.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),s.join(`
`)}}const FL={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function uT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FL,n),C.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},C.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},C.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,C.get(t,e,["binding","bindGroupTime"]),C.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),VL(t,e)}const BL=C.newInstance(uT,"vtkWebGPUUniformBuffer");var fs={newInstance:BL,extend:uT};const{vtkDebugMacro:kL}=On,bp=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,NL=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,Qa=new Float64Array(16),Lp=new Float64Array(16);function UL(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function GL(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),s=e.camera.getDirectionOfProjectionByReference(),i=[],a=[];dr(a,s,.5*(n[0]+n[1])),Ai(i,r,a),Of(a,i,e.stabilizedCenter),gy(a)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=i,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let s=0;s<r.length;++s)r[s].getSwitch()>0&&n++;return n||(kL("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{var r;const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const s=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",s.wcvc),e.UBO.setArray("SCPCMatrix",s.scpc),e.UBO.setArray("PCSCMatrix",s.pcsc),e.UBO.setArray("SCVCMatrix",s.scvc),e.UBO.setArray("VCPCMatrix",s.vcpc),e.UBO.setArray("WCVCNormals",s.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(r=e.renderable.getEnvironmentTexture())==null?void 0:r.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const i=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[i.usize,i.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const a=e._parent.getDevice();e.UBO.sendIfNeeded(a)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let s=`${e.renderable.getMTime()}`;for(let i=0;i<n.length;i++)s+=n[i].getMTime();if(s!==e.lightTimeString){const i=new Float32Array(n.length*4),a=new Float32Array(n.length*4),o=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let l=0;l<n.length;l++){const f=l*4,h=n[l].getPosition();we(h,h,r.wcvc),i[f]=h[0],i[f+1]=h[1],i[f+2]=h[2],i[f+3]=0,a[f]=-n[l].getDirection()[0],a[f+1]=-n[l].getDirection()[1],a[f+2]=-n[l].getDirection()[2],a[f+3]=0,o[f]=n[l].getColor()[0],o[f+1]=n[l].getColor()[1],o[f+2]=n[l].getColor()[2],o[f+3]=n[l].getIntensity()*5,c[f]=UL(n[l]),c[f+1]=Math.cos(Ge(n[l].getConeAngle())),c[f+2]=Math.cos(Ge(n[l].getConeAngle()+n[l].getConeFalloff())),c[f+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",i),e.SSBO.setAllInstancesFromArray("LightDir",a),e.SSBO.setAllInstancesFromArray("LightColor",o),e.SSBO.setAllInstancesFromArray("LightData",c);const u=e._parent.getDevice();e.SSBO.send(u)}e.lightTimeString=s},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var i;if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=ai.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(bp);const a=fs.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((i=e.backgroundTex)!=null&&i.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(NL);const a=fs.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a);const o=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(o.getReady()){const c=o.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const u=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:u,magFilter:u,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=ai.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(bp);const a=fs.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a)}const r=e.webgpuCamera.getKeyMatrices(t),s=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",s),Le(Lp,r.normalMatrix),Ef(Qa,r.scvc,r.pcsc),Ef(Qa,Lp,Qa),e.clearFSQ.getUBO().setArray("FSQMatrix",Qa),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],s=n[0]-r[0],i=n[1]-r[1],a=e._parent.normalizedDisplayToDisplay(s,i),o=Math.round(a[0]),c=Math.round(a[1]),u=n[2]-r[0],l=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(u,l);let h=Math.round(f[0])-o,g=Math.round(f[1])-c;return h<0&&(h=0),g<0&&(g=0),{usize:h,vsize:g,lowerLeftU:o,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const AL={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function zL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AL,n),Ne.extend(t,e,n),e.UBO=fs.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=el.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=Z1.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=ce(new Float64Array(16)),e.stabilizedTime={},st(e.stabilizedTime,{mtime:0}),Ct(t,e,["bindGroup","stabilizedTime"]),di(t,e,["stabilizedCenter"]),Ze(t,e,["renderEncoder","selector","suppressClear","UBO"]),GL(t,e)}const $L=Re(zL,"vtkWebGPURenderer");Dn("vtkRenderer",$L);const{CoordinateSystem:Vp}=Ma;function WL(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix();e.bufferShift[0]=r[3],e.bufferShift[1]=r[7],e.bufferShift[2]=r[11];const s=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===Vp.WORLD&&(e.bufferShift[0]-=s[0],e.bufferShift[1]-=s[1],e.bufferShift[2]-=s[2]),Le(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?ce(e.keyMatrices.normalMatrix):(it(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,wt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Le(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Ae(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===Vp.WORLD?Ae(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-s[0],-s[1],-s[2]]):it(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const HL={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function IL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HL,n),Ne.extend(t,e,n),e.keyMatricesTime={},C.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},C.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],WL(t,e)}const jL=C.newInstance(IL);Dn("vtkActor",jL);const{CoordinateSystem:Fp}=Ma;function PL(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const r=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===Fp.WORLD&&(e.bufferShift[0]-=r[0],e.bufferShift[1]-=r[1],e.bufferShift[2]-=r[2]),ce(e.keyMatrices.bcwc),ce(e.keyMatrices.normalMatrix),Ae(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===Fp.WORLD?Ae(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]):it(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const KL={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function XL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KL,n),Ne.extend(t,e,n),e.keyMatricesTime={},C.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},C.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],PL(t,e)}const YL=C.newInstance(XL);Dn("vtkActor2D",YL);function qL(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const s=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,i=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([i.usize,i.vsize],s,e.WebGPURenderWindow.getRenderable())}}}const ZL={};function QL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZL,n),Ne.extend(t,e,n),e.CubeAxesActorHelper=R1.newCubeAxesActorHelper(),qL(t,e)}const JL=Re(QL,"vtkWebGPUCubeAxesActor");Dn("vtkCubeAxesActor",JL);const{DisplayLocation:tl}=H1;function e3(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(tl.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(tl.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(Gt.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Gt.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Gt.POINTS),t.getRepresentationAsString=()=>C.enumToString(Gt,e.representation)}const t3={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:Gt.SURFACE,displayLocation:tl.FOREGROUND};function fT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,t3,n),C.obj(t,e),C.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),C.setGetArray(t,e,["color"],3),e3(t,e)}const n3=C.newInstance(fT,"vtkProperty2D");var r3={newInstance:n3,extend:fT,...H1};const{BufferUsage:Je,PrimitiveTypes:dt}=Lr,{Representation:Ja}=xi,{ScalarMode:eo}=ds,{CoordinateSystem:s3}=Ma,{DisplayLocation:i3}=r3,a3=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,o3=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var pi: f32 = 3.14159265359; 
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var pi: f32 = 3.14159265359; 

  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;
  
  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, ior: f32, roughness: f32, metallic: f32, direction: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {  
  var L: vec3<f32> = normalize(direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf*incoming*angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V); 
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// TODO: find some way to reduce the number of arguments going in here
fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = color * (1.0 / (dist*dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, direction: vec3<f32>, cones: vec2<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  
  // Cones.x is the inner phi and cones.y is the outer phi
  var theta: f32 = mdot(normalize(direction), L);
  var epsilon: f32 = cones.x - cones.y;
  var intensity: f32 = (theta - cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist*dist;

  var incoming: vec3<f32> = color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function Bp(t){return t.indexOf("edge")>=0}function c3(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=n=>{n&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==s3.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{var i;const r=e.WebGPUActor.getRenderable().getProperty(),s=e.UBO.getSendTime();if(t.getMTime()>s||r.getMTime()>s||e.renderable.getMTime()>s){const a=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",a.bcwc),e.UBO.setArray("BCSCMatrix",a.bcsc),e.UBO.setArray("MCWCNormals",a.normalMatrix),e.is2D){e.UBO.setValue("ZValue",e.WebGPUActor.getRenderable().getProperty().getDisplayLocation()===i3.FOREGROUND?1:0);const u=r.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[u[0],u[1],u[2],1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else{let u=r.getAmbientColorByReference();e.UBO.setValue("AmbientIntensity",r.getAmbient()),e.UBO.setArray("AmbientColor",[u[0],u[1],u[2],1]),e.UBO.setValue("DiffuseIntensity",r.getDiffuse()),u=r.getDiffuseColorByReference(),e.UBO.setArray("DiffuseColor",[u[0],u[1],u[2],1]),e.UBO.setValue("Roughness",r.getRoughness()),e.UBO.setValue("BaseIOR",r.getBaseIOR()),e.UBO.setValue("Metallic",r.getMetallic()),e.UBO.setValue("NormalStrength",r.getNormalStrength()),e.UBO.setValue("Emission",r.getEmission()),e.UBO.setValue("SpecularIntensity",r.getSpecular()),u=r.getSpecularColorByReference(),e.UBO.setArray("SpecularColor",[u[0],u[1],u[2],1])}const o=(i=r.getEdgeColorByReference)==null?void 0:i.call(r);o&&e.UBO.setArray("EdgeColor",[o[0],o[1],o[2],1]),e.UBO.setValue("LineWidth",r.getLineWidth()),e.UBO.setValue("Opacity",r.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID());const c=e.WebGPURenderWindow.getDevice();e.UBO.sendIfNeeded(c)}},t.haveWideLines=()=>{const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();return n.getProperty().getLineWidth()<=1||e.primitiveType===dt.Verts?!1:e.primitiveType===dt.Triangles||e.primitiveType===dt.TriangleStrips?r===Ja.WIREFRAME:!0},t.replaceShaderPosition=(n,r,s)=>{const i=r.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),i.hasOutput("vertexVC")||i.addOutput("vec4<f32>","vertexVC");let a=i.getCode();e.useRendererMatrix?(a=ie.substitute(a,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(a=ie.substitute(a,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(a=ie.substitute(a,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(a=ie.substitute(a,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(i.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),a=ie.substitute(a,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),a=ie.substitute(a,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,i.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(n,r,s)=>{const i=s.getBuffer("normalMC"),a=e.WebGPUActor.getRenderable();if(i){const o=r.getShaderDescription("vertex");o.hasOutput("normalVC")||o.addOutput("vec3<f32>","normalVC",i.getArrayInformation()[0].interpolation),o.hasOutput("tangentVC")||o.addOutput("vec3<f32>","tangentVC",i.getArrayInformation()[0].interpolation),o.hasOutput("bitangentVC")||o.addOutput("vec3<f32>","bitangentVC",i.getArrayInformation()[0].interpolation);let c=o.getCode();c=ie.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,o.setCode(c);const u=r.getShaderDescription("fragment");c=u.getCode(),a.getProperty().getNormalTexture()?c=ie.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=ie.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,u.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(n,r,s)=>{var u;if(n.includes("sel"))return;const i=r.getShaderDescription("vertex");i.hasOutput("vertexVC")||i.addOutput("vec4<f32>","vertexVC");const a=e.WebGPURenderer.getRenderable(),o=r.getShaderDescription("fragment");let c=o.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!Bp(n)&&!e.is2D&&!n.includes("sel")){const l=["  var pi: f32 = 3.14159265359;","  var fragPos: vec3<f32> = vec3<f32>(input.vertexVC.xyz);","  var V: vec3<f32> = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  var baseColor: vec3<f32> = _diffuseMap.rgb * diffuseColor.rgb;","  var roughness: f32 = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  var metallic: f32 = mapperUBO.Metallic * _metallicMap.r;","  var alpha: f32 = roughness*roughness;","  var ior: f32 = mapperUBO.BaseIOR;","  var k: f32 = alpha*alpha / 2;","  var diffuse: vec3<f32> = vec3<f32>(0.);","  var specular: vec3<f32> = vec3<f32>(0.);","  var emission: vec3<f32> = _emissionMap.rgb * mapperUBO.Emission;","  {","    var i: i32 = 0;","    loop {","      if !(i < rendererUBO.LightCount) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var calculated: PBRData = calcPointLight(normal, V, fragPos, ior, roughness, metallic, pos, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","          }","         // Directional light","         case 1 {","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var calculated: PBRData = calcDirectionalLight(normal, V, ior, roughness, metallic, dir, color, baseColor); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         // Spot Light","         case 2 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var cones: vec2<f32> = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           var calculated: PBRData = calcSpotLight(normal, V, fragPos, ior, roughness, metallic, pos, dir, cones, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  var fresnel: f32 = schlickFresnelIOR(V, normal, ior, k); // Fresnel","  fresnel = min(1.0, fresnel);","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  var fresnelMetallic: vec3<f32> = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  var kS: vec3<f32> = mix(vec3<f32>(fresnel), fresnelMetallic, metallic);","  kS = min(vec3<f32>(1.0), kS);","  var kD: vec3<f32> = (1.0 - kS) * (1.0 - metallic);","  var PBR: vec3<f32> = mapperUBO.DiffuseIntensity*kD*diffuse + kS*specular;","  PBR += emission;","  computedColor = vec4<f32>(PBR, mapperUBO.Opacity);"];(u=a.getEnvironmentTexture())!=null&&u.getImageLoaded()&&l.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  var diffuseIBLCoords: vec3<f32> = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  var diffuseCoords: vec2<f32> = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  var VreflN: vec3<f32> = normalize(reflect(-V, normal));","  var reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  var specularCoords: vec2<f32> = vecToRectCoord(reflectionIBLCoords);","  var diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  var level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  var specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  var specularIBLContribution: vec3<f32> = specularIBL.rgb*rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution*kS, 0);","  var diffuseIBLContribution: vec3<f32> = diffuseIBL.rgb*rendererUBO.BackgroundDiffuseStrength;","  diffuseIBLContribution *= baseColor * _ambientOcclusionMap.rgb;","  computedColor += vec4<f32>(diffuseIBLContribution*kD, 0);"),c=ie.substitute(c,"//VTK::Light::Impl",l).result,o.setCode(c)}else c=ie.substitute(c,"//VTK::Light::Impl",["  var diffuse: vec3<f32> = diffuseColor.rgb;","  var specular: vec3<f32> = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,o.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(n,r,s)=>{if(Bp(n)){const u=r.getShaderDescription("fragment");let l=u.getCode();l=ie.substitute(l,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,u.setCode(l);return}const i=s.getBuffer("colorVI");if(!i)return;const a=r.getShaderDescription("vertex");a.addOutput("vec4<f32>","color",i.getArrayInformation()[0].interpolation);let o=a.getCode();o=ie.substitute(o,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,a.setCode(o);const c=r.getShaderDescription("fragment");o=c.getCode(),o=ie.substitute(o,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(n,r,s)=>{var w,M,E,D,O,_,V,L;if(!s.hasAttribute("tcoord"))return;const i=r.getShaderDescription("vertex"),a=s.getBuffer("tcoord"),o=nt.getNumberOfComponentsFromBufferFormat(a.getArrayInformation()[0].format);let c=i.getCode();i.addOutput(`vec${o}<f32>`,"tcoordVS"),c=ie.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,i.setCode(c);const u=r.getShaderDescription("fragment");c=u.getCode();const l=e.WebGPUActor.getRenderable(),f=l.getProperty(),h=F=>F?F.getDimensionality()===o:!1,g=[],d=(w=f.getDiffuseTexture)==null?void 0:w.call(f);(d!=null&&d.getImageLoaded()||l.getTextures()[0]||e.colorTexture)&&(h(d)||h(l.getTextures()[0])||h(e.colorTexture))&&g.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);");const p=(M=f.getORMTexture)==null?void 0:M.call(f),y=(E=f.getRMTexture)==null?void 0:E.call(f),x=(D=f.getRoughnessTexture)==null?void 0:D.call(f),m=(O=f.getMetallicTexture)==null?void 0:O.call(f),T=(_=f.getAmbientOcclusionTexture)==null?void 0:_.call(f),v=(V=f.getEmissionTexture)==null?void 0:V.call(f),S=(L=f.getNormalTexture)==null?void 0:L.call(f);p!=null&&p.getImageLoaded()?h(p)&&g.push("_ambientOcclusionMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).rrra;","_roughnessMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).bbba;"):y!=null&&y.getImageLoaded()?h(y)&&g.push("_roughnessMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).bbba;"):(x!=null&&x.getImageLoaded()&&h(x)&&g.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS);"),m!=null&&m.getImageLoaded()&&h(m)&&g.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS);"),T!=null&&T.getImageLoaded()&&h(T)&&g.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS);")),v!=null&&v.getImageLoaded()&&h(v)&&g.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),S!=null&&S.getImageLoaded()&&h(S)&&g.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),c=ie.substitute(c,"//VTK::TCoord::Impl",g).result,u.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(n,r,s)=>{if(n.includes("sel")){const i=r.getShaderDescription("fragment");let a=i.getCode();a=ie.substitute(a,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,i.setCode(a)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(n,r)=>n===Ja.POINTS||r===dt.Points?Je.Verts:r===dt.Lines?Je.Lines:n===Ja.WIREFRAME?r===dt.Triangles?Je.LinesFromTriangles:Je.LinesFromStrips:r===dt.Triangles?Je.Triangles:r===dt.TriangleStrips?Je.Strips:r===dt.TriangleEdges?Je.LinesFromTriangles:Je.LinesFromStrips,t.getHashFromUsage=n=>`pt${n}`,t.getTopologyFromUsage=n=>{switch(n){case Je.Triangles:return"triangle-list";case Je.Verts:return"point-list";case Je.Lines:default:return"line-list"}},t.buildVertexInput=()=>{var p,y;const n=e.currentInput,r=e.cellArray,s=e.primitiveType;let a=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const o=e.WebGPURenderWindow.getDevice();let c=!1;s===dt.TriangleEdges&&(c=!0,a=Ja.WIREFRAME);const u=e.vertexInput,l=n.getPoints();let f;if(r){const x={hash:`R${a}P${s}${r.getMTime()}`,usage:Je.Index,cells:r,numberOfPoints:l.getNumberOfPoints(),primitiveType:s,representation:a};f=o.getBufferManager().getBuffer(x),u.setIndexBuffer(f)}else u.setIndexBuffer(null);if(l){const x=e.WebGPUActor.getBufferShift(e.WebGPURenderer),m={hash:`${l.getMTime()}I${f.getMTime()}${x.join()}float32x4`,usage:Je.PointArray,format:"float32x4",dataArray:l,indexBuffer:f,shift:x,packExtra:!0},T=o.getBufferManager().getBuffer(m);u.addBuffer(T,["vertexBC"])}else u.removeBufferIfPresent("vertexBC");const h=t.getUsage(a,s);if(e._usesCellNormals=!1,!e.is2D&&(h===Je.Triangles||h===Je.Strips)){const x=n.getPointData().getNormals(),m={format:"snorm8x4",indexBuffer:f,packExtra:!0,shift:0,scale:127};if(x){m.hash=`${x.getMTime()}I${f.getMTime()}snorm8x4`,m.dataArray=x,m.usage=Je.PointArray;const T=o.getBufferManager().getBuffer(m);u.addBuffer(T,["normalMC"])}else if(s===dt.Triangles){e._usesCellNormals=!0,m.hash=`PFN${l.getMTime()}I${f.getMTime()}snorm8x4`,m.dataArray=l,m.cells=r,m.usage=Je.NormalsFromPoints;const T=o.getBufferManager().getBuffer(m);u.addBuffer(T,["normalMC"])}else u.removeBufferIfPresent("normalMC")}else u.removeBufferIfPresent("normalMC");let g=!1;if(e.renderable.getScalarVisibility()){const x=e.renderable.getColorMapColors();if(x&&!c){const m=e.renderable.getScalarMode();let T=!1;(m===eo.USE_CELL_DATA||m===eo.USE_CELL_FIELD_DATA||m===eo.USE_FIELD_DATA||!n.getPointData().getScalars())&&m!==eo.USE_POINT_FIELD_DATA&&x&&(T=!0);const v={usage:Je.PointArray,format:"unorm8x4",hash:`${T}${x.getMTime()}I${f.getMTime()}unorm8x4`,dataArray:x,indexBuffer:f,cellData:T,cellOffset:0},S=o.getBufferManager().getBuffer(v);u.addBuffer(S,["colorVI"]),g=!0}}g||u.removeBufferIfPresent("colorVI");let d=null;if((y=(p=e.renderable).getInterpolateScalarsBeforeMapping)!=null&&y.call(p)&&e.renderable.getColorCoordinates()?d=e.renderable.getColorCoordinates():d=n.getPointData().getTCoords(),d&&!c){const x=o.getBufferManager().getBufferForPointArray(d,u.getIndexBuffer());u.addBuffer(x,["tcoord"])}else u.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{var c,u,l,f,h,g,d,p,y,x,m,T,v,S,w,M,E,D,O;const n=[],r=[],s=(u=(c=e.renderable).getColorTextureMap)==null?void 0:u.call(c);s&&(e.colorTexture||(e.colorTexture=Ac.newInstance({label:"polyDataColor"})),e.colorTexture.setInputData(s),r.push(["Diffuse",e.colorTexture]));const i=e.WebGPUActor.getRenderable(),a=e.WebGPURenderer.getRenderable(),o=[];if((f=(l=i.getProperty()).getDiffuseTexture)!=null&&f.call(l)){const _=["Diffuse",i.getProperty().getDiffuseTexture()];o.push(_)}if(i.getTextures()[0]){const _=["Diffuse",i.getTextures()[0]];o.push(_)}if(e.colorTexture){const _=["Diffuse",e.colorTexture];o.push(_)}if((g=(h=i.getProperty()).getORMTexture)!=null&&g.call(h)){const _=["ORM",i.getProperty().getORMTexture()];o.push(_)}if((p=(d=i.getProperty()).getRMTexture)!=null&&p.call(d)){const _=["RM",i.getProperty().getRMTexture()];o.push(_)}if((x=(y=i.getProperty()).getRoughnessTexture)!=null&&x.call(y)){const _=["Roughness",i.getProperty().getRoughnessTexture()];o.push(_)}if((T=(m=i.getProperty()).getMetallicTexture)!=null&&T.call(m)){const _=["Metallic",i.getProperty().getMetallicTexture()];o.push(_)}if((S=(v=i.getProperty()).getNormalTexture)!=null&&S.call(v)){const _=["Normal",i.getProperty().getNormalTexture()];o.push(_)}if((M=(w=i.getProperty()).getAmbientOcclusionTexture)!=null&&M.call(w)){const _=["AmbientOcclusion",i.getProperty().getAmbientOcclusionTexture()];o.push(_)}if((D=(E=i.getProperty()).getEmissionTexture)!=null&&D.call(E)){const _=["Emission",i.getProperty().getEmissionTexture()];o.push(_)}if((O=a.getEnvironmentTexture)!=null&&O.call(a)){const _=["Environment",a.getEnvironmentTexture()];o.push(_)}for(let _=0;_<o.length;_++)(o[_][1].getInputData()||o[_][1].getJsImageData()||o[_][1].getCanvas())&&r.push(o[_]),o[_][1].getImage()&&o[_][1].getImageLoaded()&&r.push(o[_]);for(let _=0;_<r.length;_++){const V=r[_][1],L=r[_][0],F=e.device.getTextureManager().getTextureForVTKTexture(V);if(F.getReady()){let G=!1;for(let A=0;A<e.textures.length;A++)e.textures[A]===F&&(G=!0,n[A]=!0);if(!G){n[e.textures.length]=!0;const A=F.createView(`${L}Texture`);e.textures.push(F),e.textureViews.push(A);const H=V.getInterpolate()?"linear":"nearest";let P=null;!P&&V.getEdgeClamp()&&V.getRepeat()&&(P="mirror-repeat"),!P&&V.getEdgeClamp()&&(P="clamp-to-edge"),!P&&V.getRepeat()&&(P="repeat"),L!=="Environment"?A.addSampler(e.device,{addressModeU:P,addressModeV:P,addressModeW:P,minFilter:H,magFilter:H}):A.addSampler(e.device,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:H,magFilter:H,mipmapFilter:"linear"})}}}for(let _=e.textures.length-1;_>=0;_--)n[_]||(e.textures.splice(_,1),e.textureViews.splice(_,1))},t.computePipelineHash=()=>{let n=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===dt.TriangleEdges||e.primitiveType===dt.TriangleStripEdges)n+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(n+="n"),e.vertexInput.hasAttribute("colorVI")&&(n+="c"),e.vertexInput.hasAttribute("tcoord")){const s=e.vertexInput.getBuffer("tcoord"),i=nt.getNumberOfComponentsFromBufferFormat(s.getArrayInformation()[0].format);n+=`t${i}`}e.textures.length&&(n+=`tx${e.textures.length}`)}e._usesCellNormals&&(n+="cn"),e.SSBO&&(n+="ssbo");const r=t.getHashFromUsage(e.usage);n+=r,n+=e.renderEncoder.getPipelineHash(),e.pipelineHash=n},t.updateBuffers=()=>{e.primitiveType!==dt.TriangleEdges&&e.primitiveType!==dt.TriangleStripEdges&&t.updateTextures();const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();e.usage=t.getUsage(r,e.primitiveType),t.buildVertexInput();const s=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(s.getSizeInBytes()/s.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const i=n.getProperty();t.setNumberOfInstances(Math.ceil(i.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const u3={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function lT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,u3,n),vh.extend(t,e,n),e.fragmentShaderTemplate=o3,e.vertexShaderTemplate=a3,e._tmpMat3=ys(new Float64Array(9)),e._tmpMat4=ce(new Float64Array(16)),e.UBO=fs.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),Ze(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],c3(t,e)}const f3=Re(lT,"vtkWebGPUCellArrayMapper");var hT={newInstance:f3,extend:lT};const{PrimitiveTypes:to}=Lr;function l3(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>hT.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{if(!n){oe("No input!");return}const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],s=[];let i=0;for(let a=to.Points;a<=to.Triangles;a++)if(r[a].getNumberOfValues()>0){e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const o=e.primitives[a];o.setCellArray(r[a]),o.setCurrentInput(n),o.setCellOffset(i),o.setPrimitiveType(a),o.setRenderable(e.renderable),i+=r[a].getNumberOfCells(),s.push(o)}else e.primitives[a]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility())for(let a=to.TriangleEdges;a<=to.TriangleStripEdges;a++)if(r[a-2].getNumberOfValues()>0){e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const o=e.primitives[a];o.setCellArray(r[a-2]),o.setCurrentInput(n),o.setCellOffset(e.primitives[a-2].getCellOffset()),o.setPrimitiveType(a),o.setRenderable(e.renderable),s.push(o)}else e.primitives[a]=null;t.prepareNodes(),t.addMissingChildren(s),t.removeUnusedNodes()}}const h3={primitives:null};function g3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,h3,n),Ne.extend(t,e,n),e.primitives=[],l3(t,e)}const p3=Re(g3,"vtkWebGPUPolyDataMapper");Dn("vtkMapper",p3);const{PrimitiveTypes:kp}=Lr;function d3(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>hT.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],s=[];let i=0;for(let a=kp.Points;a<=kp.Triangles;a++)if(r[a].getNumberOfValues()>0){e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const o=e.primitives[a];o.setCellArray(r[a]),o.setCurrentInput(n),o.setCellOffset(i),o.setPrimitiveType(a),o.setRenderable(e.renderable),o.setIs2D(!0),i+=r[a].getNumberOfCells(),s.push(o)}else e.primitives[a]=null;t.prepareNodes(),t.addMissingChildren(s),t.removeUnusedNodes()}}function y3(t){return{primitives:[],...t}}function x3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,y3(n)),Ne.extend(t,e,n),e.primitives=[],d3(t,e)}const T3=Re(x3,"vtkWebGPUPolyDataMapper2D");Dn("vtkMapper2D",T3);function v3(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const s=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,i=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([i.usize,i.vsize],s,e.WebGPURenderWindow.getRenderable())}}}const m3={};function S3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,m3,n),Ne.extend(t,e,n),e.scalarBarActorHelper=K1.newScalarBarActorHelper(),v3(t,e)}const w3=Re(S3,"vtkWebGPUScalarBarActor");Dn("vtkScalarBarActor",w3);function C3(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const M3={device:null,handle:null,label:null,options:null};function gT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,M3,n),C.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},C.obj(e.bindGroupTime,{mtime:0}),C.get(t,e,["bindGroupTime","handle","options"]),C.setGet(t,e,["bindGroupLayoutEntry","device","label"]),C3(t,e)}const E3=C.newInstance(gT);var mh={newInstance:E3,extend:gT};function _3(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(n,r)=>{e.texture=n,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const s=nt.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=s.sampleType},t.createFromTextureHandle=(n,r)=>{e.texture=null,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const s=nt.getDetailsFromTextureFormat(r.format);e.bindGroupLayoutEntry.texture.sampleType=s.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(n,r)=>{let s="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?s="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(s="u32");let i=`@binding(${n}) @group(${r}) var ${e.label}: texture_${e.options.dimension}<${s}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(i=`@binding(${n}) @group(${r}) var ${e.label}: texture_depth_${e.options.dimension};`),i},t.addSampler=(n,r)=>{const s=mh.newInstance({label:`${e.label}Sampler`});s.create(n,r),t.setSampler(s)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const R3={texture:null,handle:null,sampler:null,label:null};function pT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,R3,n),C.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},C.obj(e.bindGroupTime,{mtime:0}),C.get(t,e,["bindGroupTime","texture"]),C.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),_3(t,e)}const O3=C.newInstance(pT);var dT={newInstance:O3,extend:pT};const{BufferUsage:Np}=Lr;function D3(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(n,r)=>{e.device=n,e.width=r.width,e.height=r.height,e.depth=r.depth?r.depth:1;const s=e.depth===1?"2d":"3d";e.format=r.format?r.format:"rgba8unorm",e.mipLevel=r.mipLevel?r.mipLevel:0,e.usage=r.usage?r.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:s,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(n,r,s)=>{e.device=n,e.handle=r,e.width=s.width,e.height=s.height,e.depth=s.depth?s.depth:1,e.format=s.format?s.format:"rgba8unorm",e.usage=s.usage?s.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=n=>{let r=[];if(n.canvas){e.device.getHandle().queue.copyExternalImageToTexture({source:n.canvas,flipY:n.flip},{texture:e.handle,premultipliedAlpha:!0},[e.width,e.height,e.depth]),e.ready=!0;return}n.jsImageData&&!n.nativeArray&&(n.width=n.jsImageData.width,n.height=n.jsImageData.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,n.nativeArray=n.jsImageData.data);const s=nt.getDetailsFromTextureFormat(e.format);let i=e.width*s.stride;const a=(c,u,l)=>{const f=c.length/(u*l)*c.BYTES_PER_ELEMENT,h=s.elementSize===2&&s.sampleType==="float";if(h||f%256){const g=c,d=f/g.BYTES_PER_ELEMENT,p=s.elementSize,y=256*Math.floor((d*p+255)/256),x=y/p,m=C.newTypedArray(h?"Uint16Array":g.constructor.name,x*u*l);for(let T=0;T<u*l;T++)if(h)for(let v=0;v<d;v++)m[T*x+v]=en.toHalf(g[T*d+v]);else m.set(g.subarray(T*d,(T+1)*d),T*x);return[m,y]}return[c,f]};if(n.nativeArray&&(r=n.nativeArray),n.image){const c=document.createElement("canvas");c.width=n.image.width,c.height=n.image.height;const u=c.getContext("2d");u.translate(0,c.height),u.scale(1,-1),u.drawImage(n.image,0,0,n.image.width,n.image.height,0,0,c.width,c.height),r=u.getImageData(0,0,n.image.width,n.image.height).data}const o=e.device.createCommandEncoder();if(t.getDimensionality()!==3){const c=Ac.generateMipmaps(r,e.width,e.height,e.mipLevel);let u=e.width,l=e.height;for(let f=0;f<=e.mipLevel;f++){const h=a(c[f],l,1);i=h[1];const g={dataArray:n.dataArray?n.dataArray:null,nativeArray:h[0],usage:Np.Texture},d=e.device.getBufferManager().getBuffer(g);o.copyBufferToTexture({buffer:d.getHandle(),offset:0,bytesPerRow:i,rowsPerImage:l},{texture:e.handle,mipLevel:f},[u,l,1]),u/=2,l/=2}e.device.submitCommandEncoder(o),e.ready=!0}else{const c=a(r,e.height,e.depth);i=c[1];const u={dataArray:n.dataArray?n.dataArray:null,usage:Np.Texture};u.nativeArray=c[0];const l=e.device.getBufferManager().getBuffer(u);o.copyBufferToTexture({buffer:l.getHandle(),offset:0,bytesPerRow:i,rowsPerImage:e.height},{texture:e.handle},[e.width,e.height,e.depth]),e.device.submitCommandEncoder(o),e.ready=!0}},t.getScale=()=>{const n=nt.getDetailsFromTextureFormat(e.format);return n.elementSize===2&&n.sampleType==="float"?1:255},t.getNumberOfComponents=()=>nt.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let n=0;return e.width>1&&n++,e.height>1&&n++,e.depth>1&&n++,n},t.resizeToMatch=n=>{(n.getWidth()!==e.width||n.getHeight()!==e.height||n.getDepth()!==e.depth)&&(e.width=n.getWidth(),e.height=n.getHeight(),e.depth=n.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(n,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(n!==e.width||r!==e.height||s!==e.depth)&&(e.width=n,e.height=r,e.depth=s,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r.dimension||(r.dimension=e.depth===1?"2d":"3d");const s=dT.newInstance({label:n});return s.create(t,r),s}}const b3={device:null,handle:null,buffer:null,ready:!1,label:null};function yT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,b3,n),C.obj(t,e),C.get(t,e,["handle","ready","width","height","depth","format","usage"]),C.setGet(t,e,["device","label"]),D3(t,e)}const L3=C.newInstance(yT);var Rn={newInstance:L3,extend:yT};function V3(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const s=e.WebGPURenderer.getAspectRatio(),i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin(),o=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),i,s,a,o)}}const F3={};function B3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,F3,n),Ne.extend(t,e,n),V3(t,e)}const k3=C.newInstance(B3,"vtkWebGPUPixelSpaceCallbackMapper");Dn("vtkPixelSpaceCallbackMapper",k3);const{vtkDebugMacro:no}=C;function N3(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),s=new Float64Array([0,1,0]),i=ce(new Float64Array(16)),a=ce(new Float64Array(16)),o=new Float64Array(3),c=new Float64Array(3),u=new Float64Array(3),l=ce(new Float64Array(16)),f=ce(new Float64Array(16)),h=new Float64Array(3),g=new Float64Array(3);function d(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const p=t.getViewMatrix();e.viewUp[0]=p[4],e.viewUp[1]=p[5],e.viewUp[2]=p[6],t.modified()},t.setPosition=(p,y,x)=>{p===e.position[0]&&y===e.position[1]&&x===e.position[2]||(e.position[0]=p,e.position[1]=y,e.position[2]=x,t.computeDistance(),t.modified())},t.setFocalPoint=(p,y,x)=>{p===e.focalPoint[0]&&y===e.focalPoint[1]&&x===e.focalPoint[2]||(e.focalPoint[0]=p,e.focalPoint[1]=y,e.focalPoint[2]=x,t.computeDistance(),t.modified())},t.setDistance=p=>{if(e.distance===p)return;e.distance=p,e.distance<1e-20&&(e.distance=1e-20,no("Distance is set to minimum."));const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance,t.modified()},t.computeDistance=()=>{const p=e.focalPoint[0]-e.position[0],y=e.focalPoint[1]-e.position[1],x=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(p*p+y*y+x*x),e.distance<1e-20){e.distance=1e-20,no("Distance is set to minimum.");const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance}e.directionOfProjection[0]=p/e.distance,e.directionOfProjection[1]=y/e.distance,e.directionOfProjection[2]=x/e.distance,d()},t.dolly=p=>{if(p<=0)return;const y=e.distance/p;t.setPosition(e.focalPoint[0]-y*e.directionOfProjection[0],e.focalPoint[1]-y*e.directionOfProjection[1],e.focalPoint[2]-y*e.directionOfProjection[2])},t.roll=p=>{const y=e.position,x=e.focalPoint,m=e.viewUp,T=new Float64Array([m[0],m[1],m[2],0]);ce(l);const v=new Float64Array([x[0]-y[0],x[1]-y[1],x[2]-y[2]]);Pt(l,l,Ge(p),v),Ba(T,T,l),e.viewUp[0]=T[0],e.viewUp[1]=T[1],e.viewUp[2]=T[2],t.modified()},t.azimuth=p=>{const y=e.focalPoint;ce(f),Ae(f,f,y),Pt(f,f,Ge(p),e.viewUp),Ae(f,f,[-y[0],-y[1],-y[2]]),we(h,e.position,f),t.setPosition(h[0],h[1],h[2])},t.yaw=p=>{const y=e.position;ce(f),Ae(f,f,y),Pt(f,f,Ge(p),e.viewUp),Ae(f,f,[-y[0],-y[1],-y[2]]),we(g,e.focalPoint,f),t.setFocalPoint(g[0],g[1],g[2])},t.elevation=p=>{const y=e.focalPoint,x=t.getViewMatrix(),m=[-x[0],-x[1],-x[2]];ce(f),Ae(f,f,y),Pt(f,f,Ge(p),m),Ae(f,f,[-y[0],-y[1],-y[2]]),we(h,e.position,f),t.setPosition(h[0],h[1],h[2])},t.pitch=p=>{const y=e.position,x=t.getViewMatrix(),m=[x[0],x[1],x[2]];ce(f),Ae(f,f,y),Pt(f,f,Ge(p),m),Ae(f,f,[-y[0],-y[1],-y[2]]),we(g,e.focalPoint,f),t.setFocalPoint(...g)},t.zoom=p=>{p<=0||(e.parallelProjection?e.parallelScale/=p:e.viewAngle/=p,t.modified())},t.translate=(p,y,x)=>{const m=[p,y,x];If(e.position,m,e.position),If(e.focalPoint,m,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=p=>{const y=[...e.viewUp,1],x=[],m=[],T=[];y[0]+=e.position[0],y[1]+=e.position[1],y[2]+=e.position[2],Ba(x,[...e.position,1],p),Ba(m,[...e.focalPoint,1],p),Ba(T,y,p),T[0]-=x[0],T[1]-=x[1],T[2]-=x[2],t.setPosition(...x.slice(0,3)),t.setFocalPoint(...m.slice(0,3)),t.setViewUp(...T.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=p=>{let y=p;y<1e-20&&(y=1e-20,no("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+y)},t.setThicknessFromFocalPoint=p=>{let y=p;y<1e-20&&(y=1e-20,no("Thickness is set to minimum.")),t.setClippingRange(e.distance-y/2,e.distance+y/2)},t.setRoll=p=>{},t.getRoll=()=>{},t.setObliqueAngles=(p,y)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=p=>{},t.getCameraLightTransformMatrix=p=>(it(p,e.cameraLightTransform),p),t.computeCameraLightTransform=()=>{it(i,t.getViewMatrix()),wt(i,i),ny(a,[e.distance,e.distance,e.distance]),Ye(i,i,a),ce(e.cameraLightTransform),Ae(e.cameraLightTransform,i,[0,0,-1])},t.deepCopy=p=>{},t.physicalOrientationToWorldDirection=p=>{const y=Cg(p[0],p[1],p[2],p[3]),x=gs(),m=Cg(0,0,1,0);return L2(x,y),wg(m,y,m),wg(m,m,x),[m[0],m[1],m[2]]},t.getPhysicalToWorldMatrix=p=>{t.getWorldToPhysicalMatrix(p),wt(p,p)},t.getWorldToPhysicalMatrix=p=>{ce(p);const y=[3];ga(e.physicalViewNorth,e.physicalViewUp,y),p[0]=y[0],p[1]=y[1],p[2]=y[2],p[4]=e.physicalViewUp[0],p[5]=e.physicalViewUp[1],p[6]=e.physicalViewUp[2],p[8]=-e.physicalViewNorth[0],p[9]=-e.physicalViewNorth[1],p[10]=-e.physicalViewNorth[2],Le(p,p),Cn(o,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),hs(p,p,o),Ae(p,p,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=p=>{wt(i,p),we(o,n,i),t.computeDistance();const y=e.distance;t.setPosition(o[0],o[1],o[2]),we(c,r,i),wr(c,c,o),_r(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),we(u,s,i),wr(u,u,o),_r(u,u),t.setViewUp(u[0],u[1],u[2]),t.setDistance(y)},t.computeViewParametersFromPhysicalMatrix=p=>{t.getWorldToPhysicalMatrix(i),Ye(i,p,i),t.computeViewParametersFromViewMatrix(i)},t.setViewMatrix=p=>{e.viewMatrix=p,e.viewMatrix&&(it(i,e.viewMatrix),t.computeViewParametersFromViewMatrix(i),Le(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;fy(i,e.position,e.focalPoint,e.viewUp),Le(i,i);const p=new Float64Array(16);return it(p,i),p},t.setProjectionMatrix=p=>{e.projectionMatrix=p},t.getProjectionMatrix=(p,y,x)=>{const m=new Float64Array(16);if(ce(m),e.projectionMatrix){const S=1/e.physicalScale;return Cn(o,S,S,S),it(m,e.projectionMatrix),hs(m,m,o),Le(m,m),m}ce(i);const T=e.clippingRange[1]-e.clippingRange[0],v=[e.clippingRange[0]+(y+1)*T/2,e.clippingRange[0]+(x+1)*T/2];if(e.parallelProjection){const S=e.parallelScale*p,w=e.parallelScale,M=(e.windowCenter[0]-1)*S,E=(e.windowCenter[0]+1)*S,D=(e.windowCenter[1]-1)*w,O=(e.windowCenter[1]+1)*w;uy(i,M,E,D,O,v[0],v[1]),Le(i,i)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const S=Math.tan(Ge(e.viewAngle)/2);let w,M;e.useHorizontalViewAngle===!0?(w=e.clippingRange[0]*S,M=e.clippingRange[0]*S/p):(w=e.clippingRange[0]*S*p,M=e.clippingRange[0]*S);const E=(e.windowCenter[0]-1)*w,D=(e.windowCenter[0]+1)*w,O=(e.windowCenter[1]-1)*M,_=(e.windowCenter[1]+1)*M,V=v[0],L=v[1];i[0]=2*V/(D-E),i[5]=2*V/(_-O),i[2]=(E+D)/(D-E),i[6]=(O+_)/(_-O),i[10]=-(V+L)/(L-V),i[14]=-1,i[11]=-2*V*L/(L-V),i[15]=0}}return it(m,i),m},t.getCompositeProjectionMatrix=(p,y,x)=>{const m=t.getViewMatrix(),T=t.getProjectionMatrix(p,y,x);return Ye(T,m,T),T},t.setDirectionOfProjection=(p,y,x)=>{if(e.directionOfProjection[0]===p&&e.directionOfProjection[1]===y&&e.directionOfProjection[2]===x)return;e.directionOfProjection[0]=p,e.directionOfProjection[1]=y,e.directionOfProjection[2]=x;const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,d()},t.setDeviceAngles=(p,y,x,m)=>{const T=[3];ga(e.physicalViewNorth,e.physicalViewUp,T);const v=ce(new Float64Array(16));Pt(v,v,Ge(p),e.physicalViewUp),Pt(v,v,Ge(y),T),Pt(v,v,Ge(x),e.physicalViewNorth),Pt(v,v,Ge(-m),e.physicalViewUp);const S=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),w=new Float64Array(e.physicalViewNorth);we(S,S,v),we(w,w,v),t.setDirectionOfProjection(S[0],S[1],S[2]),t.setViewUp(w[0],w[1],w[2]),t.modified()},t.setOrientationWXYZ=(p,y,x,m)=>{const T=ce(new Float64Array(16));if(p!==0&&(y!==0||x!==0||m!==0)){const w=Ge(p),M=gs();Pl(M,[y,x,m],w),Ko(T,M)}const v=new Float64Array(3);we(v,[0,0,-1],T);const S=new Float64Array(3);we(S,[0,1,0],T),t.setDirectionOfProjection(...v),t.setViewUp(...S),t.modified()},t.computeClippingRange=p=>{let y=null,x=null;y=e.viewPlaneNormal,x=e.position;const m=-y[0],T=-y[1],v=-y[2],S=-(m*x[0]+T*x[1]+v*x[2]),w=[m*p[0]+T*p[2]+v*p[4]+S,1e-18];for(let M=0;M<2;M++)for(let E=0;E<2;E++)for(let D=0;D<2;D++){const O=m*p[D]+T*p[2+E]+v*p[4+M]+S;w[0]=O<w[0]?O:w[0],w[1]=O>w[1]?O:w[1]}return w}}const U3={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:$l(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function xT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,U3,n),C.obj(t,e),C.get(t,e,["distance"]),C.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),C.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),C.setGetArray(t,e,["clippingRange","windowCenter"],2),C.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),N3(t,e)}const G3=C.newInstance(xT,"vtkCamera");var A3={newInstance:G3,extend:xT};const z3=["HeadLight","CameraLight","SceneLight"];function $3(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?we(n,e.position,e.transformMatrix):Cn(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?we(n,e.focalPoint,e.transformMatrix):Cn(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(Of(e.direction,e.focalPoint,e.position),pa(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const s=new Float64Array(3);Of(s,e.position,r),e.focalPoint=s},t.setDirectionAngle=(r,s)=>{const i=Ge(r),a=Ge(s);t.setPosition(Math.cos(i)*Math.sin(a),Math.sin(i),Math.cos(i)*Math.cos(a)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const W3={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function TT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,W3,n),C.obj(t,e),C.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),C.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),$3(t,e)}const H3=C.newInstance(TT,"vtkLight");var I3={newInstance:H3,extend:TT,LIGHT_TYPES:z3};const{vtkErrorMacro:$o}=C;function j3(t){return()=>$o(`vtkViewport::${t} - NOT IMPLEMENTED`)}function P3(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const s=e.props.filter(i=>i!==r);e.props.length!==s.length&&(e.props=s)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];s.push(r);const i=r.getNestedProps();if(i&&i.length)for(let a=0;a<i.length;a++)n(i[a],s);return s}t.getViewPropsWithNestedProps=()=>{let r=[];const s=t.getActors2D();s.sort((a,o)=>a.getLayerNumber()-o.getLayerNumber());const i=e.props.filter(a=>!s.includes(a));for(let a=0;a<i.length;a++)n(i[a],r);return r=r.concat(s),r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>$o("call displayToView on your view instead"),t.viewToDisplay=()=>$o("callviewtodisplay on your view instead"),t.getSize=()=>$o("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,s,i)=>{const a=t.normalizedDisplayToNormalizedViewport(r,s,i);return t.normalizedViewportToProjection(a[0],a[1],a[2])},t.normalizedDisplayToNormalizedViewport=(r,s,i)=>{const a=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/a[0],(s-e.viewport[1])/a[1],i]},t.normalizedViewportToProjection=(r,s,i)=>[r*2-1,s*2-1,i*2-1],t.projectionToNormalizedDisplay=(r,s,i)=>{const a=t.projectionToNormalizedViewport(r,s,i);return t.normalizedViewportToNormalizedDisplay(a[0],a[1],a[2])},t.normalizedViewportToNormalizedDisplay=(r,s,i)=>{const a=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*a[0]+e.viewport[0],s*a[1]+e.viewport[1],i]},t.projectionToNormalizedViewport=(r,s,i)=>[(r+1)*.5,(s+1)*.5,(i+1)*.5],t.PickPropFrom=j3("PickPropFrom")}const K3={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function vT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,K3,n),C.obj(t,e),C.event(t,e,"event"),C.setGetArray(t,e,["viewport"],4),C.setGetArray(t,e,["background","background2"],3),P3(t,e)}const X3=C.newInstance(vT,"vtkViewport");var Y3={newInstance:X3,extend:vT};const{vtkDebugMacro:Ri,vtkErrorMacro:xr,vtkWarningMacro:q3}=On;function Up(t){return()=>xr(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function Z3(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},s={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(Ri("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const i=t.getActiveCameraAndResetIfCreated();e.lights.forEach(a=>{a.lightTypeIsSceneLight()||(a.lightTypeIsHeadLight()?(a.setPositionFrom(i.getPositionByReference()),a.setFocalPointFrom(i.getFocalPointByReference()),a.modified(i.getMTime())):a.lightTypeIsCameraLight()?a.setTransformMatrix(i.getCameraLightTransformMatrix($l())):xr("light has unknown light type",a.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=Up("allocateTime"),t.updateGeometry=Up("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=i=>{Ri(t.getClassName(),t,"setting Layer to ",i),e.layer!==i&&(e.layer=i,t.modified()),t.setPreserveColorBuffer(!!i)},t.setActiveCamera=i=>e.activeCamera===i?!1:(e.activeCamera=i,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:i}),!0),t.makeCamera=()=>{const i=A3.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:i}),i},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(i=>{e.actors=e.actors.concat(i.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=i=>{e.actors=e.actors.filter(a=>a!==i),t.removeViewProp(i),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(a=>{t.removeViewProp(a)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(i=>{e.volumes=e.volumes.concat(i.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=i=>{e.volumes=e.volumes.filter(a=>a!==i),t.removeViewProp(i),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(a=>{t.removeViewProp(a)}),e.volumes=[],t.modified()},t.hasLight=i=>e.lights.includes(i),t.addLight=i=>{i&&!t.hasLight(i)&&(e.lights.push(i),t.modified())},t.removeLight=i=>{e.lights=e.lights.filter(a=>a!==i),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=i=>{e.lights=i,t.modified()},t.makeLight=I3.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(i,a,o,c)=>{let u=t.normalizedDisplayToProjection(i,a,o);return u=t.projectionToView(u[0],u[1],u[2],c),t.viewToWorld(u[0],u[1],u[2])},t.worldToNormalizedDisplay=(i,a,o,c)=>{let u=t.worldToView(i,a,o);return u=t.viewToProjection(u[0],u[1],u[2],c),t.projectionToNormalizedDisplay(u[0],u[1],u[2])},t.viewToWorld=(i,a,o)=>{if(e.activeCamera===null)return xr("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();wt(c,c),Le(c,c);const u=new Float64Array([i,a,o]);return we(u,u,c),u},t.projectionToView=(i,a,o,c)=>{if(e.activeCamera===null)return xr("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);wt(u,u),Le(u,u);const l=new Float64Array([i,a,o]);return we(l,l,u),l},t.worldToView=(i,a,o)=>{if(e.activeCamera===null)return xr("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Le(c,c);const u=new Float64Array([i,a,o]);return we(u,u,c),u},t.viewToProjection=(i,a,o,c)=>{if(e.activeCamera===null)return xr("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);Le(u,u);const l=new Float64Array([i,a,o]);return we(l,l,u),l},t.computeVisiblePropBounds=()=>{e.allBounds[0]=be.INIT_BOUNDS[0],e.allBounds[1]=be.INIT_BOUNDS[1],e.allBounds[2]=be.INIT_BOUNDS[2],e.allBounds[3]=be.INIT_BOUNDS[3],e.allBounds[4]=be.INIT_BOUNDS[4],e.allBounds[5]=be.INIT_BOUNDS[5];let i=!0;t.invokeEvent(n);for(let a=0;a<e.props.length;++a){const o=e.props[a];if(o.getVisibility()&&o.getUseBounds()){const c=o.getBounds();c&&ou(c)&&(i=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return i&&(ih(e.allBounds),Ri("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),o=[0,0,0];if(!ou(a))return Ri("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return xr("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),o[0]=(a[0]+a[1])/2,o[1]=(a[2]+a[3])/2,o[2]=(a[4]+a[5])/2;let u=a[1]-a[0],l=a[3]-a[2],f=a[5]-a[4];u*=u,l*=l,f*=f;let h=u+l+f;h=h===0?1:h,h=Math.sqrt(h)*.5;const g=Ge(e.activeCamera.getViewAngle()),d=h,p=h/Math.sin(g*.5),y=e.activeCamera.getViewUp();return Math.abs(pe(y,c))>.999&&(q3("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-y[2],y[0],y[1])),e.activeCamera.setFocalPoint(o[0],o[1],o[2]),e.activeCamera.setPosition(o[0]+p*c[0],o[1]+p*c[1],o[2]+p*c[2]),t.resetCameraClippingRange(a),e.activeCamera.setParallelScale(d),e.activeCamera.setPhysicalScale(h),e.activeCamera.setPhysicalTranslation(-o[0],-o[1],-o[2]),t.invokeEvent(s),!0},t.resetCameraClippingRange=function(){const a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!ou(a))return Ri("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return xr("Trying to reset clipping range of non-existent camera"),!1;const o=e.activeCamera.computeClippingRange(a);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const u=Ge(e.activeCamera.getViewAngle());c=.2*Math.tan(u/2)*o[1]}return o[1]-o[0]<c&&(c=c-o[1]+o[0],o[1]+=c/2,o[0]-=c/2),o[0]<0&&(o[0]=0),o[0]=.99*o[0]-(o[1]-o[0])*e.clippingRangeExpansion,o[1]=1.01*o[1]+(o[1]-o[0])*e.clippingRangeExpansion,o[0]=o[0]>=o[1]?.01*o[1]:o[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),o[0]<e.nearClippingPlaneTolerance*o[1]&&(o[0]=e.nearClippingPlaneTolerance*o[1]),e.activeCamera.setClippingRange(o[0],o[1]),t.invokeEvent(r),!1},t.setRenderWindow=i=>{i!==e._renderWindow&&(e._vtkWindow=i,e._renderWindow=i)},t.visibleActorCount=()=>e.props.filter(i=>i.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let i=e.mtime;const a=e.activeCamera?e.activeCamera.getMTime():0;a>i&&(i=a);const o=e._createdLight?e._createdLight.getMTime():0;return o>i&&(i=o),i},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const Q3={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:ah(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function mT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,Q3,n),Y3.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),Ct(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Ze(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),di(t,e,["actors","volumes","lights"]),ql(t,e,["background"],4,1),wa(t,e,["renderWindow"]),Z3(t,e)}const J3=Re(mT,"vtkRenderer");var eV={newInstance:J3,extend:mT};const tV="WebGL",gc=Object.create(null);function Sh(t,e){gc[t]=e}function nV(){return Object.keys(gc)}function ST(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return gc[t]&&gc[t](e)}function rV(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ST(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const s=r.getViewProps(),i=e._views[0].getViewNodeFor(r);s.forEach(a=>{if(a.getVisibility()){n.propCount+=1;const o=a.getMapper&&a.getMapper();if(o&&o.getPrimitiveCount){const c=i.getViewNodeFor(o);if(c){c.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const u=o.getPrimitiveCount();Object.keys(u).forEach(l=>{n[l]||(n[l]=0),n[l]+=u[l]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return C.setImmediate(t.render),e._views.map(s=>s.captureNextImage?s.captureNextImage(n,r):void 0).filter(s=>!!s)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0),t.removeRenderWindow=n=>{const r=e.childRenderWindows.findIndex(s=>s===n);return r<0?!1:(e.childRenderWindows.splice(r,1),t.modified(),!0)}}const sV={defaultViewAPI:tV,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function wT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sV,n),C.obj(t,e),C.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),C.get(t,e,["neverRendered"]),C.getArray(t,e,["renderers","childRenderWindows"]),C.moveToProtected(t,e,["views"]),C.event(t,e,"completion"),rV(t,e)}const iV=C.newInstance(wT,"vtkRenderWindow");var aV={newInstance:iV,extend:wT,registerViewConstructor:Sh,listViewAPIs:nV,newAPISpecificView:ST};const nl={Unknown:0,LeftController:1,RightController:2},Wi={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},oV={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},cV={LeftButton:1,MiddleButton:2,RightButton:3};var CT={Device:nl,Input:Wi,Axis:oV,MouseButton:cV};const{Device:ro,Input:qr}=CT,{vtkWarningMacro:so,vtkErrorMacro:io,normalizeWheel:uV,vtkOnceErrorMacro:fV}=C,Ms={ctrlKey:!1,altKey:!1,shiftKey:!1},Cu={"xr-standard":[qr.Trigger,qr.Grip,qr.TrackPad,qr.Thumbstick,qr.A,qr.B]},wh=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function Oi(t){t.cancelable&&t.preventDefault()}function ao(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:s}=n;e[r]=s}),e}function lV(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,s=new Map;let i=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=p=>{io("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=p=>{e.interactorStyle!==p&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=p,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>so("empty event loop");function a(p,y){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(p,y))}t.getCurrentRenderer=()=>(e.currentRenderer||a(0,0),e.currentRenderer);function o(p){const y=e._view.getCanvas(),x=y.getBoundingClientRect(),m=y.width/x.width,T=y.height/x.height,v={x:m*(p.clientX-x.left),y:T*(x.height-p.clientY+x.top),z:0,movementX:m*p.movementX,movementY:T*p.movementY};return(s.size<=1||!e.currentRenderer)&&a(v.x,v.y),v}const c=e._getScreenEventPositionFor||o;function u(p){return{controlKey:p.ctrlKey,altKey:p.altKey,shiftKey:p.shiftKey}}function l(p){const y=u(p);return{key:p.key,keyCode:p.charCode,...y}}function f(p){return p.pointerType||""}const h=()=>{if(e.container===null)return;const{container:p}=e;p.addEventListener("contextmenu",Oi),p.addEventListener("wheel",t.handleWheel),p.addEventListener("DOMMouseScroll",t.handleWheel),p.addEventListener("pointerenter",t.handlePointerEnter),p.addEventListener("pointerleave",t.handlePointerLeave),p.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.addEventListener("pointerup",t.handlePointerUp),p.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),p.style.touchAction="none",p.style.userSelect="none",p.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=p=>{if(p===null)return;n.setContainer(p)&&h()};const g=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,i=1;const{container:p}=e;p&&(p.removeEventListener("contextmenu",Oi),p.removeEventListener("wheel",t.handleWheel),p.removeEventListener("DOMMouseScroll",t.handleWheel),p.removeEventListener("pointerenter",t.handlePointerEnter),p.removeEventListener("pointerleave",t.handlePointerLeave),p.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.removeEventListener("pointerup",t.handlePointerUp),p.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),s.clear()};t.unbindEvents=()=>{g(),n.setContainer(null)},t.handleKeyPress=p=>{const y=l(p);t.keyPressEvent(y)},t.handleKeyDown=p=>{const y=l(p);t.keyDownEvent(y)},t.handleKeyUp=p=>{const y=l(p);t.keyUpEvent(y)},t.handlePointerEnter=p=>{const y={...u(p),position:c(p),deviceType:f(p)};t.pointerEnterEvent(y),y.deviceType==="mouse"&&t.mouseEnterEvent(y)},t.handlePointerLeave=p=>{const y={...u(p),position:c(p),deviceType:f(p)};t.pointerLeaveEvent(y),y.deviceType==="mouse"&&t.mouseLeaveEvent(y)},t.handlePointerDown=p=>{if(!(p.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&Oi(p),p.target.hasPointerCapture(p.pointerId)&&p.target.releasePointerCapture(p.pointerId),e.container.setPointerCapture(p.pointerId),s.has(p.pointerId)&&so("[RenderWindowInteractor] duplicate pointerId detected"),s.set(p.pointerId,{pointerId:p.pointerId,position:c(p)}),p.pointerType){case"pen":case"touch":t.handleTouchStart(p);break;case"mouse":default:t.handleMouseDown(p);break}},t.handlePointerUp=p=>{if(s.has(p.pointerId))switch(e.preventDefaultOnPointerUp&&Oi(p),s.delete(p.pointerId),e.container.releasePointerCapture(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerCancel=p=>{if(s.has(p.pointerId))switch(s.delete(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerMove=p=>{if(s.has(p.pointerId)){const y=s.get(p.pointerId);y.position=c(p)}switch(p.pointerType){case"pen":case"touch":t.handleTouchMove(p);break;case"mouse":default:t.handleMouseMove(p);break}},t.handleMouseDown=p=>{const y={...u(p),position:c(p),deviceType:f(p)};switch(p.button){case 0:t.leftButtonPressEvent(y);break;case 1:t.middleButtonPressEvent(y);break;case 2:t.rightButtonPressEvent(y);break;default:io(`Unknown mouse button pressed: ${p.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var p;return(p=document.exitPointerLock)==null?void 0:p.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function d(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=p=>{if(p===void 0){io("undefined requester, can not start animating");return}if(r.has(p)){so("requester is already registered for animating");return}r.add(p),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=p=>{const y=Date.now()+p;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,y),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(p){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(p)){if(!y){const x=p&&p.getClassName?p.getClassName():p;so(`${x} did not request an animation`)}return}r.delete(p),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(p,y,x)=>{p.inputSources.forEach(m=>{const T=m.gripSpace==null?null:y.getPose(m.gripSpace,x),v=m.gripSpace==null?null:y.getPose(m.targetRaySpace,x),S=m.gamepad,w=m.handedness;if(S){S.index in e.lastGamepadValues||(e.lastGamepadValues[S.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let M=0;M<S.buttons.length;++M)M in e.lastGamepadValues[S.index][w].buttons||(e.lastGamepadValues[S.index][w].buttons[M]=!1),e.lastGamepadValues[S.index][w].buttons[M]!==S.buttons[M].pressed&&T!=null&&(t.button3DEvent({gamepad:S,position:T.transform.position,orientation:T.transform.orientation,targetPosition:v.transform.position,targetOrientation:v.transform.orientation,pressed:S.buttons[M].pressed,device:m.handedness==="left"?ro.LeftController:ro.RightController,input:Cu[S.mapping]&&Cu[S.mapping][M]?Cu[S.mapping][M]:qr.Trigger}),e.lastGamepadValues[S.index][w].buttons[M]=S.buttons[M].pressed),e.lastGamepadValues[S.index][w].buttons[M]&&T!=null&&t.move3DEvent({gamepad:S,position:T.transform.position,orientation:T.transform.orientation,targetPosition:v.transform.position,targetOrientation:v.transform.orientation,device:m.handedness==="left"?ro.LeftController:ro.RightController})}})},t.handleMouseMove=p=>{const y={...u(p),position:c(p),deviceType:f(p)};e.moveTimeoutID===0?t.startMouseMoveEvent(y):(t.mouseMoveEvent(y),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const p=Date.now();e._animationFrameCount++,p-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(p-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=p,e._animationFrameCount=1),t.animationEvent(),d(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=p=>{Oi(p);const y={...uV(p),...u(p),position:c(p),deviceType:f(p)};e.wheelTimeoutID===0&&(Math.abs(y.spinY)>=.3?i=Math.abs(y.spinY):i=1),y.spinY/=i,e.wheelTimeoutID===0?(t.startMouseWheelEvent(y),t.mouseWheelEvent(y)):(t.mouseWheelEvent(y),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=p=>{const y={...u(p),position:c(p),deviceType:f(p)};switch(p.button){case 0:t.leftButtonReleaseEvent(y);break;case 1:t.middleButtonReleaseEvent(y);break;case 2:t.rightButtonReleaseEvent(y);break;default:io(`Unknown mouse button released: ${p.button}`);break}},t.handleTouchStart=p=>{const y=[...s.values()];if(e.recognizeGestures&&y.length>1){const x=ao(s);if(y.length===2){const m={...u(Ms),position:y[0].position,deviceType:f(p)};t.leftButtonReleaseEvent(m)}t.recognizeGesture("TouchStart",x)}else if(y.length===1){const x={...u(Ms),position:c(p),deviceType:f(p)};t.leftButtonPressEvent(x)}},t.handleTouchMove=p=>{const y=[...s.values()];if(e.recognizeGestures&&y.length>1){const x=ao(s);t.recognizeGesture("TouchMove",x)}else if(y.length===1){const x={...u(Ms),position:y[0].position,deviceType:f(p)};t.mouseMoveEvent(x)}},t.handleTouchEnd=p=>{const y=[...s.values()];if(e.recognizeGestures)if(y.length===0){const x={...u(Ms),position:c(p),deviceType:f(p)};t.leftButtonReleaseEvent(x)}else if(y.length===1){const x=ao(s);t.recognizeGesture("TouchEnd",x);const m={...u(Ms),position:y[0].position,deviceType:f(p)};t.leftButtonPressEvent(m)}else{const x=ao(s);t.recognizeGesture("TouchMove",x)}else if(y.length===1){const x={...u(Ms),position:y[0].position,deviceType:f(p)};t.leftButtonReleaseEvent(x)}},t.setView=p=>{e._view!==p&&(e._view=p,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var p,y,x;return(x=(y=(p=e._view)==null?void 0:p.getRenderable())==null?void 0:y.getRenderersByReference())==null?void 0:x[0]},t.findPokedRenderer=function(){var w,M;let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const x=(M=(w=e._view)==null?void 0:w.getRenderable())==null?void 0:M.getRenderers();if(!x||x.length===0)return null;x.sort((E,D)=>E.getLayer()-D.getLayer());let m=null,T=null,v=null,S=x.length;for(;S--;){const E=x[S];if(e._view.isInViewport(p,y,E)&&E.getInteractive()){v=E;break}m===null&&E.getInteractive()&&(m=E),T===null&&e._view.isInViewport(p,y,E)&&(T=E)}return v===null&&(v=m),v===null&&(v=T),v==null&&(v=x[0]),v},t.render=()=>{!t.isAnimating()&&!e.inRender&&d()},wh.forEach(p=>{const y=p.charAt(0).toLowerCase()+p.slice(1);t[`${y}Event`]=x=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){fV(`
          Can not forward events without a current renderer on the interactor.
        `);return}const T={type:p,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...x};t[`invoke${p}`](T)}}),t.recognizeGesture=(p,y)=>{if(Object.keys(y).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),p==="TouchStart"){Object.keys(y).forEach(O=>{e.startingEventPositions[O]=y[O]}),e.currentGesture="Start";return}if(p==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let x=0;const m=[],T=[];Object.keys(y).forEach(O=>{m[x]=y[O],T[x]=e.startingEventPositions[O],x++});const v=Math.sqrt((T[0].x-T[1].x)*(T[0].x-T[1].x)+(T[0].y-T[1].y)*(T[0].y-T[1].y)),S=Math.sqrt((m[0].x-m[1].x)*(m[0].x-m[1].x)+(m[0].y-m[1].y)*(m[0].y-m[1].y));let w=ha(Math.atan2(T[1].y-T[0].y,T[1].x-T[0].x)),M=ha(Math.atan2(m[1].y-m[0].y,m[1].x-m[0].x)),E=M-w;M=M+180>=360?M-180:M+180,w=w+180>=360?w-180:w+180,Math.abs(M-w)<Math.abs(E)&&(E=M-w);const D=[];if(D[0]=(m[0].x-T[0].x+m[1].x-T[1].x)/2,D[1]=(m[0].y-T[0].y+m[1].y-T[1].y)/2,p==="TouchMove")if(e.currentGesture==="Start"){let O=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);O<15&&(O=15);const _=Math.abs(S-v),V=S*3.1415926*Math.abs(E)/360,L=Math.sqrt(D[0]*D[0]+D[1]*D[1]);if(_>O&&_>V&&_>L){e.currentGesture="Pinch";const F={scale:1,touches:y};t.startPinchEvent(F)}else if(V>O&&V>L){e.currentGesture="Rotate";const F={rotation:0,touches:y};t.startRotateEvent(F)}else if(L>O){e.currentGesture="Pan";const F={translation:[0,0],touches:y};t.startPanEvent(F)}}else{if(e.currentGesture==="Rotate"){const O={rotation:E,touches:y};t.rotateEvent(O)}if(e.currentGesture==="Pinch"){const O={scale:S/v,touches:y};t.pinchEvent(O)}if(e.currentGesture==="Pan"){const O={translation:D,touches:y};t.panEvent(O)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=p=>{e._forcedRenderer=!!p,e.currentRenderer=p},t.setContainer=p=>{g();const y=n.setContainer(p??null);return y&&h(),y},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const hV={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function MT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hV,n),C.obj(t,e),e._animationExtendedEnd=0,C.event(t,e,"RenderEvent"),wh.forEach(r=>C.event(t,e,r)),C.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),C.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),C.moveToProtected(t,e,["view"]),lV(t,e)}const gV=C.newInstance(MT,"vtkRenderWindowInteractor");var ET={newInstance:gV,extend:MT,handledEvents:wh,...CT};const{vtkErrorMacro:pV,VOID:dV}=C;function yV(t,e,n,r){return t.getRenderWindow().getViews()[0].worldToDisplay(e,n,r,t)}function xV(t,e,n,r){return t.getRenderWindow().getViews()[0].displayToWorld(e,n,r,t)}const TV={computeWorldToDisplay:yV,computeDisplayToWorld:xV};function vV(t,e){e.classHierarchy.push("vtkInteractorObserver");const n={...t};function r(){for(;e.subscribedEvents.length;)e.subscribedEvents.pop().unsubscribe()}function s(){ET.handledEvents.forEach(i=>{t[`handle${i}`]&&e.subscribedEvents.push(e._interactor[`on${i}`](a=>e.processEvents?t[`handle${i}`](a):dV,e.priority))})}t.setInteractor=i=>{i!==e._interactor&&(r(),e._interactor=i,i&&e.enabled&&s(),t.modified())},t.setEnabled=i=>{i!==e.enabled&&(r(),i&&(e._interactor?s():pV(`
          The interactor must be set before subscribing to events
        `)),e.enabled=i,t.modified())},t.computeDisplayToWorld=(i,a,o,c)=>i?e._interactor.getView().displayToWorld(a,o,c,i):null,t.computeWorldToDisplay=(i,a,o,c)=>i?e._interactor.getView().worldToDisplay(a,o,c,i):null,t.setPriority=i=>{n.setPriority(i)&&e._interactor&&(r(),s())}}const mV={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function _T(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mV,n),C.obj(t,e),C.event(t,e,"InteractionEvent"),C.event(t,e,"StartInteractionEvent"),C.event(t,e,"EndInteractionEvent"),C.get(t,e,["_interactor","enabled"]),C.setGet(t,e,["priority","processEvents"]),C.moveToProtected(t,e,["interactor"]),vV(t,e)}const SV=C.newInstance(_T,"vtkInteractorObserver");var wV={newInstance:SV,extend:_T,...TV};const CV={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025};var Ch={States:CV};const{States:Sn}=Ch,Mu={Rotate:Sn.IS_ROTATE,Pan:Sn.IS_PAN,Spin:Sn.IS_SPIN,Dolly:Sn.IS_DOLLY,CameraPose:Sn.IS_CAMERA_POSE,WindowLevel:Sn.IS_WINDOW_LEVEL,Slice:Sn.IS_SLICE};function MV(t,e){e.classHierarchy.push("vtkInteractorStyle"),Object.keys(Mu).forEach(n=>{C.event(t,e,`Start${n}Event`),t[`start${n}`]=()=>{e.state===Sn.IS_NONE&&(e.state=Mu[n],e._interactor.requestAnimation(t),t.invokeStartInteractionEvent({type:"StartInteractionEvent"}),t[`invokeStart${n}Event`]({type:`Start${n}Event`}))},C.event(t,e,`End${n}Event`),t[`end${n}`]=()=>{e.state===Mu[n]&&(e.state=Sn.IS_NONE,e._interactor.cancelAnimation(t),t.invokeEndInteractionEvent({type:"EndInteractionEvent"}),t[`invokeEnd${n}Event`]({type:`End${n}Event`}),e._interactor.render())}}),e.getRenderer=n=>e.focusedRenderer||n.pokedRenderer,t.handleKeyPress=n=>{const r=e._interactor;let s=null;switch(n.key){case"r":case"R":e.getRenderer(n).resetCamera(),r.render();break;case"w":case"W":s=e.getRenderer(n).getActors(),s.forEach(i=>{const a=i.getProperty();a.setRepresentationToWireframe&&a.setRepresentationToWireframe()}),r.render();break;case"s":case"S":s=e.getRenderer(n).getActors(),s.forEach(i=>{const a=i.getProperty();a.setRepresentationToSurface&&a.setRepresentationToSurface()}),r.render();break;case"v":case"V":s=e.getRenderer(n).getActors(),s.forEach(i=>{const a=i.getProperty();a.setRepresentationToPoints&&a.setRepresentationToPoints()}),r.render();break}}}const EV={state:Sn.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function RT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EV,n),wV.extend(t,e,n),C.setGet(t,e,["focusedRenderer"]),MV(t,e)}const _V=C.newInstance(RT,"vtkInteractorStyle");var RV={newInstance:_V,extend:RT,...Ch};const{States:Tn}=Ch;function OV(t,e){e.classHierarchy.push("vtkInteractorStyleTrackballCamera"),t.handleMouseMove=n=>{const r=n.position,s=e.getRenderer(n);switch(e.state){case Tn.IS_ROTATE:t.handleMouseRotate(s,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case Tn.IS_PAN:t.handleMousePan(s,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case Tn.IS_DOLLY:t.handleMouseDolly(s,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case Tn.IS_SPIN:t.handleMouseSpin(s,r),t.invokeInteractionEvent({type:"InteractionEvent"});break}e.previousPosition=r},t.handleButton3D=n=>{if(n&&n.pressed&&n.device===nl.RightController&&(n.input===Wi.Trigger||n.input===Wi.TrackPad)){t.startCameraPose();return}n&&!n.pressed&&n.device===nl.RightController&&(n.input===Wi.Trigger||n.input===Wi.TrackPad)&&e.state===Tn.IS_CAMERA_POSE&&t.endCameraPose()},t.handleMove3D=n=>{switch(e.state){case Tn.IS_CAMERA_POSE:t.updateCameraPose(n);break}},t.updateCameraPose=n=>{const r=e.getRenderer(n).getActiveCamera(),s=r.getPhysicalTranslation(),a=.5*.05*r.getPhysicalScale(),o=r.physicalOrientationToWorldDirection([n.orientation.x,n.orientation.y,n.orientation.z,n.orientation.w]);r.setPhysicalTranslation(s[0]+o[0]*a,s[1]+o[1]*a,s[2]+o[2]*a)},t.handleLeftButtonPress=n=>{const r=n.position;e.previousPosition=r,n.shiftKey?n.controlKey||n.altKey?t.startDolly():t.startPan():n.controlKey||n.altKey?t.startSpin():t.startRotate()},t.handleLeftButtonRelease=()=>{switch(e.state){case Tn.IS_DOLLY:t.endDolly();break;case Tn.IS_PAN:t.endPan();break;case Tn.IS_SPIN:t.endSpin();break;case Tn.IS_ROTATE:t.endRotate();break}},t.handleStartMouseWheel=()=>{t.startDolly()},t.handleEndMouseWheel=()=>{t.endDolly()},t.handleStartPinch=n=>{e.previousScale=n.scale,t.startDolly()},t.handleEndPinch=()=>{t.endDolly()},t.handleStartRotate=n=>{e.previousRotation=n.rotation,t.startRotate()},t.handleEndRotate=()=>{t.endRotate()},t.handleStartPan=n=>{e.previousTranslation=n.translation,t.startPan()},t.handleEndPan=()=>{t.endPan()},t.handlePinch=n=>{t.dollyByFactor(e.getRenderer(n),n.scale/e.previousScale),e.previousScale=n.scale},t.handlePan=n=>{const r=e.getRenderer(n).getActiveCamera();let s=r.getFocalPoint();s=t.computeWorldToDisplay(e.getRenderer(n),s[0],s[1],s[2]);const i=s[2],a=n.translation,o=e.previousTranslation,c=t.computeDisplayToWorld(e.getRenderer(n),s[0]+a[0]-o[0],s[1]+a[1]-o[1],i),u=t.computeDisplayToWorld(e.getRenderer(n),s[0],s[1],i),l=[];l[0]=u[0]-c[0],l[1]=u[1]-c[1],l[2]=u[2]-c[2],s=r.getFocalPoint();const f=r.getPosition();r.setFocalPoint(l[0]+s[0],l[1]+s[1],l[2]+s[2]),r.setPosition(l[0]+f[0],l[1]+f[1],l[2]+f[2]),e._interactor.getLightFollowCamera()&&e.getRenderer(n).updateLightsGeometryToFollowCamera(),r.orthogonalizeViewUp(),e.previousTranslation=n.translation},t.handleRotate=n=>{const r=e.getRenderer(n).getActiveCamera();r.roll(n.rotation-e.previousRotation),r.orthogonalizeViewUp(),e.previousRotation=n.rotation},t.handleMouseRotate=(n,r)=>{if(!e.previousPosition)return;const s=e._interactor,i=r.x-e.previousPosition.x,a=r.y-e.previousPosition.y,o=s.getView().getViewportSize(n);let c=-.1,u=-.1;o[0]&&o[1]&&(c=-20/o[1],u=-20/o[0]);const l=i*u*e.motionFactor,f=a*c*e.motionFactor,h=n.getActiveCamera();!Number.isNaN(l)&&!Number.isNaN(f)&&(h.azimuth(l),h.elevation(f),h.orthogonalizeViewUp()),e.autoAdjustCameraClippingRange&&n.resetCameraClippingRange(),s.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()},t.handleMouseSpin=(n,r)=>{if(!e.previousPosition)return;const s=e._interactor,i=n.getActiveCamera(),a=s.getView().getViewportCenter(n),o=ha(Math.atan2(e.previousPosition.y-a[1],e.previousPosition.x-a[0])),c=ha(Math.atan2(r.y-a[1],r.x-a[0]))-o;Number.isNaN(c)||(i.roll(c),i.orthogonalizeViewUp())},t.handleMousePan=(n,r)=>{if(!e.previousPosition)return;const s=n.getActiveCamera();let i=s.getFocalPoint();i=t.computeWorldToDisplay(n,i[0],i[1],i[2]);const a=i[2],o=t.computeDisplayToWorld(n,r.x,r.y,a),c=t.computeDisplayToWorld(n,e.previousPosition.x,e.previousPosition.y,a),u=[];u[0]=c[0]-o[0],u[1]=c[1]-o[1],u[2]=c[2]-o[2],i=s.getFocalPoint();const l=s.getPosition();s.setFocalPoint(u[0]+i[0],u[1]+i[1],u[2]+i[2]),s.setPosition(u[0]+l[0],u[1]+l[1],u[2]+l[2]),e._interactor.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()},t.handleMouseDolly=(n,r)=>{if(!e.previousPosition)return;const s=r.y-e.previousPosition.y,a=e._interactor.getView().getViewportCenter(n),o=e.motionFactor*s/a[1];t.dollyByFactor(n,1.1**o)},t.handleMouseWheel=n=>{const r=1-n.spinY/e.zoomFactor;t.dollyByFactor(e.getRenderer(n),r)},t.dollyByFactor=(n,r)=>{if(Number.isNaN(r))return;const s=n.getActiveCamera();s.getParallelProjection()?s.setParallelScale(s.getParallelScale()/r):(s.dolly(r),e.autoAdjustCameraClippingRange&&n.resetCameraClippingRange()),e._interactor.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()}}const DV={motionFactor:10,zoomFactor:10};function OT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DV,n),RV.extend(t,e,n),C.setGet(t,e,["motionFactor","zoomFactor"]),OV(t,e)}const bV=C.newInstance(OT,"vtkInteractorStyleTrackballCamera");var LV={newInstance:bV,extend:OT};function VV(t){return t}function Mh(t){if(t===null||t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;if(!(t===void 0||t==="undefined"))return t[0]==="["&&t[t.length-1]==="]"?t.substring(1,t.length-1).split(",").map(e=>Mh(e.trim())):t===""||Number.isNaN(Number(t))?t:Number(t)}function FV(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:window.location.search;const n={},r=t?Mh:VV;return new URLSearchParams(e).forEach((i,a)=>{a&&(n[a]=i?r(i):!0)}),n}var BV={toNativeType:Mh,extractURLParameters:FV};function kV(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){oe("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){oe("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let s=0;s<e.colorBuffers.length;s++)e.colorBuffers[s].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){oe("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const s=e.context;if(!s){oe("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let i=s.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())i+=r;else{oe("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,s.framebufferTexture2D(s.FRAMEBUFFER,i,s.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){oe("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let s=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())s+=n;else{oe("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,s,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){oe("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else oe("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){oe("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else oe("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){oe("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=us.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(Jf.LINEAR),r.setMagnificationFilter(Jf.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,tt.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const NV={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function DT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NV,n),st(t,e),e.colorBuffers&&oe("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],di(t,e,["colorBuffers"]),kV(t,e)}const UV=Re(DT,"vtkFramebuffer");var Eh={newInstance:UV,extend:DT};function GV(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${C.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(s=>{t.setCurrentOperation(s),n.traverse(t)}),e.delegates.forEach(s=>{s.traverse(n,t)}),e.postDelegateOperations.forEach(s=>{t.setCurrentOperation(s),n.traverse(t)}))}}const AV={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function bT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AV,n),C.obj(t,e),C.get(t,e,["currentOperation"]),C.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),C.moveToProtected(t,e,["currentParent"]),GV(t,e)}const zV=C.newInstance(bT,"vtkRenderPass");var Jn={newInstance:zV,extend:bT};const{Representation:$V}=xi,{vtkErrorMacro:Gp}=C;function WV(t){const e=N.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const HV=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function IV(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),s=new Uint16Array([4,0,1,3,2]),i=ve.newInstance({numberOfComponents:3,values:n});i.setName("points");const a=ve.newInstance({numberOfComponents:2,values:r});a.setName("tcoords");const o=ve.newInstance({numberOfComponents:1,values:s});e.tris.getCABO().createVBO(o,"polys",$V.SURFACE,{points:i,tcoords:a,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),s=n.getContext();e.framebuffer=Eh.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=us.newInstance(),e.translucentRGBATexture.setInternalFormat(s.RGBA16F),e.translucentRGBATexture.setFormat(s.RGBA),e.translucentRGBATexture.setOpenGLDataType(s.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw(r[0],r[1],4,"Float32Array",null),e.translucentRTexture=us.newInstance(),e.translucentRTexture.setInternalFormat(s.R16F),e.translucentRTexture.setFormat(s.RED),e.translucentRTexture.setOpenGLDataType(s.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw(r[0],r[1],1,"Float32Array",null),e.translucentZTexture=us.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw(r[0],r[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),HV,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const s=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(s,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||Gp("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(s,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||Gp("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,s)=>{if(e.deleted)return;const i=n.getSize(),a=n.getContext();if(e._supported=!1,r.getSelector()||!a||!n.getWebgl2()||!a.getExtension("EXT_color_buffer_half_float")&&!a.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const c=e.framebuffer.getSize();c===null||c[0]!==i[0]||c[1]!==i[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}a.drawBuffers([a.COLOR_ATTACHMENT0]),a.clearBufferfv(a.COLOR,0,[0,0,0,0]),a.clearBufferfv(a.DEPTH,0,[1]),a.colorMask(!1,!1,!1,!1),s.getOpaqueActorCount()>0&&(s.setCurrentOperation("opaqueZBufferPass"),r.traverse(s)),a.colorMask(!0,!0,!0,!0),a.drawBuffers([a.COLOR_ATTACHMENT0,a.COLOR_ATTACHMENT1]),a.viewport(0,0,i[0],i[1]),a.scissor(0,0,i[0],i[1]),a.clearBufferfv(a.COLOR,0,[0,0,0,1]),a.clearBufferfv(a.COLOR,1,[0,0,0,0]),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFuncSeparate(a.ONE,a.ONE,a.ZERO,a.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),a.drawBuffers([a.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=k1.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),a.depthMask(!1),a.depthFunc(a.ALWAYS),a.viewport(0,0,i[0],i[1]),a.scissor(0,0,i[0],i[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),a.depthMask(!0),a.depthFunc(a.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const o=r.getTiledSizeAndOrigin();a.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),a.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize)},t.getShaderReplacement=()=>e._supported?WV:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const jV={framebuffer:null,copyShader:null,tris:null};function LT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jV,n),Jn.extend(t,e,n),e.VBOBuildTime={},C.obj(e.VBOBuildTime,{mtime:0}),e.tris=Ti.newInstance(),C.get(t,e,["framebuffer"]),IV(t,e)}const PV=C.newInstance(LT,"vtkOpenGLOrderIndependentTranslucentPass");var KV={newInstance:PV,extend:LT};function XV(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const s=n.getRenderable().getNumberOfLayers(),i=n.getRenderable().getRenderersByReference();for(let a=0;a<s;a++)for(let o=0;o<i.length;o++){const c=i[o],u=n.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===a){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),u.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const l=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=Eh.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const f=e.framebuffer.getSize();(f===null||f[0]!==l[0]||f[1]!==l[1])&&(e.framebuffer.create(l[0],l[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),u.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),u.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),u.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=KV.newInstance()),e.translucentPass.traverse(n,u,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),u.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),u.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const YV={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function VT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YV,n),Jn.extend(t,e,n),C.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),XV(t,e)}const qV=C.newInstance(VT,"vtkForwardPass");var ZV={newInstance:qV,extend:VT};const{FieldAssociations:QV}=xs;function JV(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,s,i,a)=>{},t.selectAsync=async(n,r,s,i,a)=>{const o=await t.getSourceDataAsync(n,r,s,i,a);return o?o.generateSelection(r,s,i,a):[]}}const eF={fieldAssociation:QV.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function FT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eF,n),C.obj(t,e),C.setGet(t,e,["fieldAssociation","captureZValues"]),JV(t,e)}const tF=C.newInstance(FT,"vtkHardwareSelector");var BT={newInstance:tF,extend:FT};const nF={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},rF={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var sF={SelectionContent:nF,SelectionField:rF};function iF(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const aF={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function kT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aF,n),C.obj(t,e),e.properties={},C.setGet(t,e,["contentType","fieldType","properties","selectionList"]),iF(t,e)}const oF=C.newInstance(kT,"vtkSelectionNode");var zc={newInstance:oF,extend:kT,...sF};const{PassTypes:Ue}=u1,{SelectionContent:cF,SelectionField:Ap}=zc,{FieldAssociations:Qi}=xs,{vtkErrorMacro:NT}=C,Sr=1;function UT(t){return`${t.propID} ${t.compositeID}`}function GT(t,e,n,r){if(!n)return 0;const s=(e*(r[2]-r[0]+1)+t)*4;return n[s+3]}function In(t,e,n,r){if(!n)return 0;const s=(e*(r[2]-r[0]+1)+t)*4,i=n[s],a=n[s+1];return(n[s+2]*256+a)*256+i}function AT(t,e){let n=e;return n<<=24,n|=t,n}function zs(t,e,n,r){const s=n<0?0:n;if(s===0){if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const c=[e[0]-t.area[0],e[1]-t.area[1]],u=In(c[0],c[1],t.pixBuffer[Ue.ACTOR_PASS],t.area);if(u<=0||u-Sr>=t.props.length)return null;const l={};l.valid=!0,l.propID=u-Sr,l.prop=t.props[l.propID];let f=In(c[0],c[1],t.pixBuffer[Ue.COMPOSITE_INDEX_PASS],t.area);if((f<0||f>16777215)&&(f=0),l.compositeID=f-Sr,t.captureZValues){const d=(c[1]*(t.area[2]-t.area[0]+1)+c[0])*4;l.zValue=(256*t.zBuffer[d]+t.zBuffer[d+1])/65535,l.displayPosition=e}if(t.pixBuffer[Ue.ID_LOW24]&&GT(c[0],c[1],t.pixBuffer[Ue.ID_LOW24],t.area)===0)return l;const h=In(c[0],c[1],t.pixBuffer[Ue.ID_LOW24],t.area),g=In(c[0],c[1],t.pixBuffer[Ue.ID_HIGH24],t.area);return l.attributeID=AT(h,g),l}const i=[e[0],e[1]],a=[0,0];let o=zs(t,e,0,r);if(o&&o.valid)return o;for(let c=1;c<s;++c){for(let u=i[1]>c?i[1]-c:0;u<=i[1]+c;++u)if(a[1]=u,i[0]>=c&&(a[0]=i[0]-c,o=zs(t,a,0,r),o&&o.valid)||(a[0]=i[0]+c,o=zs(t,a,0,r),o&&o.valid))return o;for(let u=i[0]>=c?i[0]-(c-1):0;u<=i[0]+(c-1);++u)if(a[0]=u,i[1]>=c&&(a[1]=i[1]-c,o=zs(t,a,0,r),o&&o.valid)||(a[1]=i[1]+c,o=zs(t,a,0,r),o&&o.valid))return o}return r[0]=e[0],r[1]=e[1],null}function zT(t,e,n,r,s){const i=[];let a=0;return e.forEach((o,c)=>{const u=zc.newInstance();switch(u.setContentType(cF.INDICES),t){case Qi.FIELD_ASSOCIATION_CELLS:u.setFieldType(Ap.CELL);break;case Qi.FIELD_ASSOCIATION_POINTS:u.setFieldType(Ap.POINT);break;default:NT("Unknown field association")}u.getProperties().propID=o.info.propID,u.getProperties().prop=o.info.prop,u.getProperties().compositeID=o.info.compositeID,u.getProperties().attributeID=o.info.attributeID,u.getProperties().pixelCount=o.pixelCount,n&&(u.getProperties().displayPosition=[o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue],u.getProperties().worldPosition=s.displayToWorld(o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue,r)),u.setSelectionList(o.attributeIDs),i[a]=u,a++}),i}function uF(t,e,n,r,s){const i=Math.floor(e),a=Math.floor(n),o=Math.floor(r),c=Math.floor(s),u=new Map,l=[0,0];for(let f=a;f<=c;f++)for(let h=i;h<=o;h++){const d=zs(t,[h,f],0,l);if(d&&d.valid){const p=UT(d);if(!u.has(p))u.set(p,{info:d,pixelCount:1,attributeIDs:[d.attributeID]});else{const y=u.get(p);y.pixelCount++,t.captureZValues&&d.zValue<y.info.zValue&&(y.info=d),y.attributeIDs.indexOf(d.attributeID)===-1&&y.attributeIDs.push(d.attributeID)}}}return zT(t.fieldAssociation,u,t.captureZValues,t.renderer,t.openGLRenderWindow)}function fF(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=Eh.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const s=e.framebuffer.getSize();!s||s[0]!==r[0]||s[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===Qi.FIELD_ASSOCIATION_POINTS){const s=e._openGLRenderWindow.getContext(),i=s.isEnabled(s.BLEND);s.disable(s.BLEND),e._openGLRenderWindow.traverseAllPasses(),i&&s.enable(s.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,s,i,a,o)=>{if(e._renderer=r,s===void 0){const u=e._openGLRenderWindow.getSize();t.setArea(0,0,u[0]-1,u[1]-1)}else t.setArea(s,i,a,o);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var u=arguments.length,l=new Array(u),f=0;f<u;f++)l[f]=arguments[f];return uF(c,...l)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return NT("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const s=[];for(e.currentPass=Ue.MIN_KNOWN_PASS;e.currentPass<=Ue.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Ue.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),s.push(e.currentPass));return s.forEach(i=>{e.currentPass=i,t.processPixelBuffers()}),e.currentPass=Ue.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,s)=>{t.isPropHit(s)&&r.processSelectorPixelBuffers(t,e.propPixels[s])})},t.passRequired=r=>{if(r===Ue.ID_HIGH24){if(e.fieldAssociation===Qi.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===Qi.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const s=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(s),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===Ue.ACTOR_PASS){if(e.captureZValues){const s=e._openGLRenderWindow.getRenderPasses();if(typeof s[0].requestDepth=="function"&&typeof s[0].getFramebuffer=="function"){const i=s[0].getFramebuffer();i.saveCurrentBindingsAndBuffers(),i.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),i.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let s=0;for(let i=0;i<=e.area[3]-e.area[1];i++)for(let a=0;a<=e.area[2]-e.area[0];a++){let o=In(a,i,r,e.area);o>0&&(o--,o in e.hitProps||(e.hitProps[o]=!0,e.propPixels[o]=[]),e.propPixels[o].push(s*4)),++s}},t.renderProp=r=>{e.currentPass===Ue.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Sr),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===Ue.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+Sr)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>C.enumToString(Ue,r),t.isPropHit=r=>Boolean(e.hitProps[r]),t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,s,i)=>{const a=s<0?0:s;if(a===0){if(i[0]=r[0],i[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;const l=[r[0]-e.area[0],r[1]-e.area[1]],f=In(l[0],l[1],e.pixBuffer[Ue.ACTOR_PASS],e.area);if(f<=0||f-Sr>=e.props.length)return null;const h={};h.valid=!0,h.propID=f-Sr,h.prop=e.props[h.propID];let g=In(l[0],l[1],e.pixBuffer[Ue.COMPOSITE_INDEX_PASS],e.area);if((g<0||g>16777215)&&(g=0),h.compositeID=g-Sr,e.captureZValues){const y=(l[1]*(e.area[2]-e.area[0]+1)+l[0])*4;h.zValue=(256*e.zBuffer[y]+e.zBuffer[y+1])/65535,h.displayPosition=r}if(e.pixBuffer[Ue.ID_LOW24]&&GT(l[0],l[1],e.pixBuffer[Ue.ID_LOW24],e.area)===0)return h;const d=In(l[0],l[1],e.pixBuffer[Ue.ID_LOW24],e.area),p=In(l[0],l[1],e.pixBuffer[Ue.ID_HIGH24],e.area);return h.attributeID=AT(d,p),h}const o=[r[0],r[1]],c=[0,0];let u=t.getPixelInformation(r,0,i);if(u&&u.valid)return u;for(let l=1;l<a;++l){for(let f=o[1]>l?o[1]-l:0;f<=o[1]+l;++f)if(c[1]=f,o[0]>=l&&(c[0]=o[0]-l,u=t.getPixelInformation(c,0,i),u&&u.valid)||(c[0]=o[0]+l,u=t.getPixelInformation(c,0,i),u&&u.valid))return u;for(let f=o[0]>=l?o[0]-(l-1):0;f<=o[0]+(l-1);++f)if(c[0]=f,o[1]>=l&&(c[1]=o[1]-l,u=t.getPixelInformation(c,0,i),u&&u.valid)||(c[1]=o[1]+l,u=t.getPixelInformation(c,0,i),u&&u.valid))return u}return i[0]=r[0],i[1]=r[1],null},t.generateSelection=(r,s,i,a)=>{const o=Math.floor(r),c=Math.floor(s),u=Math.floor(i),l=Math.floor(a),f=new Map,h=[0,0];for(let g=c;g<=l;g++)for(let d=o;d<=u;d++){const p=[d,g],y=t.getPixelInformation(p,0,h);if(y&&y.valid){const x=UT(y);if(!f.has(x))f.set(x,{info:y,pixelCount:1,attributeIDs:[y.attributeID]});else{const m=f.get(x);m.pixelCount++,e.captureZValues&&y.zValue<m.info.zValue&&(m.info=y),m.attributeIDs.indexOf(y.attributeID)===-1&&m.attributeIDs.push(y.attributeID)}}}return zT(e.fieldAssociation,f,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,s)=>{e._openGLRenderWindow=r,e._renderer=s};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const lF={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function $T(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lF,n),BT.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),C.setGetArray(t,e,["area"],4),C.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),C.setGetArray(t,e,["propColorValue"],3),C.moveToProtected(t,e,["renderer","openGLRenderWindow"]),C.event(t,e,"event"),fF(t,e)}const hF=C.newInstance($T,"vtkOpenGLHardwareSelector");var WT={newInstance:hF,extend:$T,...u1},rl={},gF={get exports(){return rl},set exports(t){rl=t}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function s(x,m){var T=x[0],v=x[1],S=x[2],w=x[3];T+=(v&S|~v&w)+m[0]-680876936|0,T=(T<<7|T>>>25)+v|0,w+=(T&v|~T&S)+m[1]-389564586|0,w=(w<<12|w>>>20)+T|0,S+=(w&T|~w&v)+m[2]+606105819|0,S=(S<<17|S>>>15)+w|0,v+=(S&w|~S&T)+m[3]-1044525330|0,v=(v<<22|v>>>10)+S|0,T+=(v&S|~v&w)+m[4]-176418897|0,T=(T<<7|T>>>25)+v|0,w+=(T&v|~T&S)+m[5]+1200080426|0,w=(w<<12|w>>>20)+T|0,S+=(w&T|~w&v)+m[6]-1473231341|0,S=(S<<17|S>>>15)+w|0,v+=(S&w|~S&T)+m[7]-45705983|0,v=(v<<22|v>>>10)+S|0,T+=(v&S|~v&w)+m[8]+1770035416|0,T=(T<<7|T>>>25)+v|0,w+=(T&v|~T&S)+m[9]-1958414417|0,w=(w<<12|w>>>20)+T|0,S+=(w&T|~w&v)+m[10]-42063|0,S=(S<<17|S>>>15)+w|0,v+=(S&w|~S&T)+m[11]-1990404162|0,v=(v<<22|v>>>10)+S|0,T+=(v&S|~v&w)+m[12]+1804603682|0,T=(T<<7|T>>>25)+v|0,w+=(T&v|~T&S)+m[13]-40341101|0,w=(w<<12|w>>>20)+T|0,S+=(w&T|~w&v)+m[14]-1502002290|0,S=(S<<17|S>>>15)+w|0,v+=(S&w|~S&T)+m[15]+1236535329|0,v=(v<<22|v>>>10)+S|0,T+=(v&w|S&~w)+m[1]-165796510|0,T=(T<<5|T>>>27)+v|0,w+=(T&S|v&~S)+m[6]-1069501632|0,w=(w<<9|w>>>23)+T|0,S+=(w&v|T&~v)+m[11]+643717713|0,S=(S<<14|S>>>18)+w|0,v+=(S&T|w&~T)+m[0]-373897302|0,v=(v<<20|v>>>12)+S|0,T+=(v&w|S&~w)+m[5]-701558691|0,T=(T<<5|T>>>27)+v|0,w+=(T&S|v&~S)+m[10]+38016083|0,w=(w<<9|w>>>23)+T|0,S+=(w&v|T&~v)+m[15]-660478335|0,S=(S<<14|S>>>18)+w|0,v+=(S&T|w&~T)+m[4]-405537848|0,v=(v<<20|v>>>12)+S|0,T+=(v&w|S&~w)+m[9]+568446438|0,T=(T<<5|T>>>27)+v|0,w+=(T&S|v&~S)+m[14]-1019803690|0,w=(w<<9|w>>>23)+T|0,S+=(w&v|T&~v)+m[3]-187363961|0,S=(S<<14|S>>>18)+w|0,v+=(S&T|w&~T)+m[8]+1163531501|0,v=(v<<20|v>>>12)+S|0,T+=(v&w|S&~w)+m[13]-1444681467|0,T=(T<<5|T>>>27)+v|0,w+=(T&S|v&~S)+m[2]-51403784|0,w=(w<<9|w>>>23)+T|0,S+=(w&v|T&~v)+m[7]+1735328473|0,S=(S<<14|S>>>18)+w|0,v+=(S&T|w&~T)+m[12]-1926607734|0,v=(v<<20|v>>>12)+S|0,T+=(v^S^w)+m[5]-378558|0,T=(T<<4|T>>>28)+v|0,w+=(T^v^S)+m[8]-2022574463|0,w=(w<<11|w>>>21)+T|0,S+=(w^T^v)+m[11]+1839030562|0,S=(S<<16|S>>>16)+w|0,v+=(S^w^T)+m[14]-35309556|0,v=(v<<23|v>>>9)+S|0,T+=(v^S^w)+m[1]-1530992060|0,T=(T<<4|T>>>28)+v|0,w+=(T^v^S)+m[4]+1272893353|0,w=(w<<11|w>>>21)+T|0,S+=(w^T^v)+m[7]-155497632|0,S=(S<<16|S>>>16)+w|0,v+=(S^w^T)+m[10]-1094730640|0,v=(v<<23|v>>>9)+S|0,T+=(v^S^w)+m[13]+681279174|0,T=(T<<4|T>>>28)+v|0,w+=(T^v^S)+m[0]-358537222|0,w=(w<<11|w>>>21)+T|0,S+=(w^T^v)+m[3]-722521979|0,S=(S<<16|S>>>16)+w|0,v+=(S^w^T)+m[6]+76029189|0,v=(v<<23|v>>>9)+S|0,T+=(v^S^w)+m[9]-640364487|0,T=(T<<4|T>>>28)+v|0,w+=(T^v^S)+m[12]-421815835|0,w=(w<<11|w>>>21)+T|0,S+=(w^T^v)+m[15]+530742520|0,S=(S<<16|S>>>16)+w|0,v+=(S^w^T)+m[2]-995338651|0,v=(v<<23|v>>>9)+S|0,T+=(S^(v|~w))+m[0]-198630844|0,T=(T<<6|T>>>26)+v|0,w+=(v^(T|~S))+m[7]+1126891415|0,w=(w<<10|w>>>22)+T|0,S+=(T^(w|~v))+m[14]-1416354905|0,S=(S<<15|S>>>17)+w|0,v+=(w^(S|~T))+m[5]-57434055|0,v=(v<<21|v>>>11)+S|0,T+=(S^(v|~w))+m[12]+1700485571|0,T=(T<<6|T>>>26)+v|0,w+=(v^(T|~S))+m[3]-1894986606|0,w=(w<<10|w>>>22)+T|0,S+=(T^(w|~v))+m[10]-1051523|0,S=(S<<15|S>>>17)+w|0,v+=(w^(S|~T))+m[1]-2054922799|0,v=(v<<21|v>>>11)+S|0,T+=(S^(v|~w))+m[8]+1873313359|0,T=(T<<6|T>>>26)+v|0,w+=(v^(T|~S))+m[15]-30611744|0,w=(w<<10|w>>>22)+T|0,S+=(T^(w|~v))+m[6]-1560198380|0,S=(S<<15|S>>>17)+w|0,v+=(w^(S|~T))+m[13]+1309151649|0,v=(v<<21|v>>>11)+S|0,T+=(S^(v|~w))+m[4]-145523070|0,T=(T<<6|T>>>26)+v|0,w+=(v^(T|~S))+m[11]-1120210379|0,w=(w<<10|w>>>22)+T|0,S+=(T^(w|~v))+m[2]+718787259|0,S=(S<<15|S>>>17)+w|0,v+=(w^(S|~T))+m[9]-343485551|0,v=(v<<21|v>>>11)+S|0,x[0]=T+x[0]|0,x[1]=v+x[1]|0,x[2]=S+x[2]|0,x[3]=w+x[3]|0}function i(x){var m=[],T;for(T=0;T<64;T+=4)m[T>>2]=x.charCodeAt(T)+(x.charCodeAt(T+1)<<8)+(x.charCodeAt(T+2)<<16)+(x.charCodeAt(T+3)<<24);return m}function a(x){var m=[],T;for(T=0;T<64;T+=4)m[T>>2]=x[T]+(x[T+1]<<8)+(x[T+2]<<16)+(x[T+3]<<24);return m}function o(x){var m=x.length,T=[1732584193,-271733879,-1732584194,271733878],v,S,w,M,E,D;for(v=64;v<=m;v+=64)s(T,i(x.substring(v-64,v)));for(x=x.substring(v-64),S=x.length,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=0;v<S;v+=1)w[v>>2]|=x.charCodeAt(v)<<(v%4<<3);if(w[v>>2]|=128<<(v%4<<3),v>55)for(s(T,w),v=0;v<16;v+=1)w[v]=0;return M=m*8,M=M.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(M[2],16),D=parseInt(M[1],16)||0,w[14]=E,w[15]=D,s(T,w),T}function c(x){var m=x.length,T=[1732584193,-271733879,-1732584194,271733878],v,S,w,M,E,D;for(v=64;v<=m;v+=64)s(T,a(x.subarray(v-64,v)));for(x=v-64<m?x.subarray(v-64):new Uint8Array(0),S=x.length,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=0;v<S;v+=1)w[v>>2]|=x[v]<<(v%4<<3);if(w[v>>2]|=128<<(v%4<<3),v>55)for(s(T,w),v=0;v<16;v+=1)w[v]=0;return M=m*8,M=M.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(M[2],16),D=parseInt(M[1],16)||0,w[14]=E,w[15]=D,s(T,w),T}function u(x){var m="",T;for(T=0;T<4;T+=1)m+=r[x>>T*8+4&15]+r[x>>T*8&15];return m}function l(x){var m;for(m=0;m<x.length;m+=1)x[m]=u(x[m]);return x.join("")}l(o("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function x(m,T){return m=m|0||0,m<0?Math.max(m+T,0):Math.min(m,T)}ArrayBuffer.prototype.slice=function(m,T){var v=this.byteLength,S=x(m,v),w=v,M,E,D,O;return T!==n&&(w=x(T,v)),S>w?new ArrayBuffer(0):(M=w-S,E=new ArrayBuffer(M),D=new Uint8Array(E),O=new Uint8Array(this,S,M),D.set(O),E)}}();function f(x){return/[\u0080-\uFFFF]/.test(x)&&(x=unescape(encodeURIComponent(x))),x}function h(x,m){var T=x.length,v=new ArrayBuffer(T),S=new Uint8Array(v),w;for(w=0;w<T;w+=1)S[w]=x.charCodeAt(w);return m?S:v}function g(x){return String.fromCharCode.apply(null,new Uint8Array(x))}function d(x,m,T){var v=new Uint8Array(x.byteLength+m.byteLength);return v.set(new Uint8Array(x)),v.set(new Uint8Array(m),x.byteLength),T?v:v.buffer}function p(x){var m=[],T=x.length,v;for(v=0;v<T-1;v+=2)m.push(parseInt(x.substr(v,2),16));return String.fromCharCode.apply(String,m)}function y(){this.reset()}return y.prototype.append=function(x){return this.appendBinary(f(x)),this},y.prototype.appendBinary=function(x){this._buff+=x,this._length+=x.length;var m=this._buff.length,T;for(T=64;T<=m;T+=64)s(this._hash,i(this._buff.substring(T-64,T)));return this._buff=this._buff.substring(T-64),this},y.prototype.end=function(x){var m=this._buff,T=m.length,v,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w;for(v=0;v<T;v+=1)S[v>>2]|=m.charCodeAt(v)<<(v%4<<3);return this._finish(S,T),w=l(this._hash),x&&(w=p(w)),this.reset(),w},y.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},y.prototype.setState=function(x){return this._buff=x.buff,this._length=x.length,this._hash=x.hash,this},y.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},y.prototype._finish=function(x,m){var T=m,v,S,w;if(x[T>>2]|=128<<(T%4<<3),T>55)for(s(this._hash,x),T=0;T<16;T+=1)x[T]=0;v=this._length*8,v=v.toString(16).match(/(.*?)(.{0,8})$/),S=parseInt(v[2],16),w=parseInt(v[1],16)||0,x[14]=S,x[15]=w,s(this._hash,x)},y.hash=function(x,m){return y.hashBinary(f(x),m)},y.hashBinary=function(x,m){var T=o(x),v=l(T);return m?p(v):v},y.ArrayBuffer=function(){this.reset()},y.ArrayBuffer.prototype.append=function(x){var m=d(this._buff.buffer,x,!0),T=m.length,v;for(this._length+=x.byteLength,v=64;v<=T;v+=64)s(this._hash,a(m.subarray(v-64,v)));return this._buff=v-64<T?new Uint8Array(m.buffer.slice(v-64)):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(x){var m=this._buff,T=m.length,v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S,w;for(S=0;S<T;S+=1)v[S>>2]|=m[S]<<(S%4<<3);return this._finish(v,T),w=l(this._hash),x&&(w=p(w)),this.reset(),w},y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.getState=function(){var x=y.prototype.getState.call(this);return x.buff=g(x.buff),x},y.ArrayBuffer.prototype.setState=function(x){return x.buff=h(x.buff,!0),y.prototype.setState.call(this,x)},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.hash=function(x,m){var T=c(new Uint8Array(x)),v=l(T);return m?p(v):v},y})})(gF);const pF=rl,dF=["lastShaderProgramBound","context","_openGLRenderWindow"];function yF(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,s)=>{let i=r;s.length>0&&(i=N.substitute(i,"VSOut","GSOut").result);const a=e._openGLRenderWindow.getWebgl2();let o=`
`,c=`#version 100
`;a?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(o=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(o+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),i=N.substitute(i,"//VTK::System::Dec",[`${c}
`,a?"":`#extension GL_OES_standard_derivatives : enable
`,o,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let u=N.substitute(n,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(a){u=N.substitute(u,"varying","out").result,i=N.substitute(i,"varying","in").result;let f="",h=0;for(;i.includes(`gl_FragData[${h}]`);)i=N.substitute(i,`gl_FragData\\[${h}\\]`,`fragOutput${h}`).result,f+=`layout(location = ${h}) out vec4 fragOutput${h};
`,h++;i=N.substitute(i,"//VTK::Output::Dec",f).result}const l=N.substitute(s,"//VTK::System::Dec",c).result;return{VSSource:u,FSSource:i,GSSource:l}},t.readyShaderProgramArray=(n,r,s)=>{const i=t.replaceShaderValues(n,r,s),a=t.getShaderProgram(i.VSSource,i.FSSource,i.GSSource);return t.readyShaderProgram(a)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,s)=>{const i=`${n}${r}${s}`,a=pF.hash(i);if(!(a in e.shaderPrograms)){const o=N.newInstance();return o.setContext(e.context),o.getVertexShader().setSource(n),o.getFragmentShader().setSource(r),s&&o.getGeometryShader().setSource(s),o.setMd5Hash(a),e.shaderPrograms[a]=o,o}return e.shaderPrograms[a]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const xF={lastShaderProgramBound:null,shaderPrograms:null,context:null};function HT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xF,n),e.shaderPrograms={},C.obj(t,e),C.setGet(t,e,dF),C.moveToProtected(t,e,["openGLRenderWindow"]),yF(t,e)}const TF=C.newInstance(HT,"vtkShaderCache");var vF={newInstance:TF,extend:HT};const{vtkErrorMacro:mF}=C;function SF(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&mF("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const wF={context:null,numberOfTextureUnits:0,textureUnits:0};function IT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wF,n),C.obj(t,e),e.textureUnits=[],C.get(t,e,["numberOfTextureUnits"]),C.setGet(t,e,["context"]),SF(t,e)}const CF=C.newInstance(IT,"vtkOpenGLTextureUnitManager");var MF={newInstance:CF,extend:IT};function EF(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,s)=>{const i=s.getViewportByReference(),a=t.getFramebufferSize();return i[0]*a[0]<=n&&i[2]*a[0]>=n&&i[1]*a[1]<=r&&i[3]*a[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),s=t.getFramebufferSize();return[(r[2]-r[0])*s[0],(r[3]-r[1])*s[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,s)=>{const i=t.getFramebufferSize();return[n/i[0],r/i[1],s]},t.normalizedDisplayToDisplay=(n,r,s)=>{const i=t.getFramebufferSize();return[n*i[0],r*i[1],s]},t.worldToView=(n,r,s,i)=>i.worldToView(n,r,s),t.viewToWorld=(n,r,s,i)=>i.viewToWorld(n,r,s),t.worldToDisplay=(n,r,s,i)=>{const a=i.worldToView(n,r,s),o=t.getViewportSize(i),c=i.viewToProjection(a[0],a[1],a[2],o[0]/o[1]),u=i.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(u[0],u[1],u[2])},t.displayToWorld=(n,r,s,i)=>{const a=t.displayToNormalizedDisplay(n,r,s),o=i.normalizedDisplayToProjection(a[0],a[1],a[2]),c=t.getViewportSize(i),u=i.projectionToView(o[0],o[1],o[2],c[0]/c[1]);return i.viewToWorld(u[0],u[1],u[2])},t.normalizedDisplayToViewport=(n,r,s,i)=>{let a=i.getViewportByReference();a=t.normalizedDisplayToDisplay(a[0],a[1],0);const o=t.normalizedDisplayToDisplay(n,r,s);return[o[0]-a[0]-.5,o[1]-a[1]-.5,s]},t.viewportToNormalizedViewport=(n,r,s,i)=>{const a=t.getViewportSize(i);return a&&a[0]!==0&&a[1]!==0?[n/(a[0]-1),r/(a[1]-1),s]:[n,r,s]},t.normalizedViewportToViewport=(n,r,s,i)=>{const a=t.getViewportSize(i);return[n*(a[0]-1),r*(a[1]-1),s]},t.displayToLocalDisplay=(n,r,s)=>{const i=t.getFramebufferSize();return[n,i[1]-r-1,s]},t.viewportToNormalizedDisplay=(n,r,s,i)=>{let a=i.getViewportByReference();a=t.normalizedDisplayToDisplay(a[0],a[1],0);const o=n+a[0]+.5,c=r+a[1]+.5;return t.displayToNormalizedDisplay(o,c,s)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{C.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,s,i)=>{C.vtkErrorMacro("not implemented")},t.createSelector=()=>{C.vtkErrorMacro("not implemented")}}const _F={size:void 0,selector:void 0};function jT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_F,n),e.size||(e.size=[300,300]),C.getArray(t,e,["size"],2),C.get(t,e,["selector"]),Ne.extend(t,e,n),EF(t,e)}const RF=C.newInstance(jT,"vtkRenderWindowViewNode");var PT={newInstance:RF,extend:jT};const OF="__getUnderlyingContext";function DF(){const t=new Map,e={apply(s,i,a){return t.has(a[0])?t.get(a[0]):s.apply(i,a)}};function n(s){return{apply(i,a,o){return t.set(s,o[0]),i.apply(a,o)}}}const r=Object.create(null);return r.getParameter=(s,i,a,o)=>new Proxy(o.bind(s),e),r.depthMask=(s,i,a,o)=>new Proxy(o.bind(s),n(s.DEPTH_WRITEMASK)),{get(s,i,a){if(i===OF)return()=>s;let o=Reflect.get(s,i,s);o instanceof Function&&(o=o.bind(s));const c=r[i];return c?c(s,i,a,o):o}}}const{vtkDebugMacro:zp,vtkErrorMacro:$p}=C,bF={position:"absolute",top:0,left:0,width:"100%",height:"100%"},LF=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function yt(t,e,n){const r=t.createFramebuffer(),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),i===t.FRAMEBUFFER_COMPLETE}let pc=0;const KT=[];function VF(){pc++,KT.forEach(t=>t(pc))}function FF(){pc--,KT.forEach(t=>t(pc))}function Wp(t){t.preventDefault()}function BF(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=DF()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",Wp,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const s=[0,0];function i(){e.renderable&&(e.size[0]!==s[0]||e.size[1]!==s[1])&&(s[0]=e.size[0],s[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(i),t.buildPass=f=>{if(f){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(h=>{var g;(g=h.setOpenGLRenderWindow)==null||g.call(h,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&VF(),e.textureUnitManager=MF.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const f=e.context;f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA),f.depthFunc(f.LEQUAL),f.enable(f.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=f=>{e.el&&e.el!==f&&(e.canvas.parentNode!==e.el&&$p("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==f&&(e.el=f,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:f,height:h}=e.el.getBoundingClientRect();e.containerSize=[f,h]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var h;return((h=e.activeFramebuffer)==null?void 0:h.getSize())||e.size},t.getPixelData=(f,h,g,d)=>{const p=new Uint8Array((g-f+1)*(d-h+1)*4);return e.context.readPixels(f,h,g-f+1,d-h+1,e.context.RGBA,e.context.UNSIGNED_BYTE,p),p},t.get3DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},h=null;const g=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&g&&(h=e.canvas.getContext("webgl2",f),h&&(e.webgl2=!0,zp("using webgl2"))),h||(zp("using webgl1"),h=e.canvas.getContext("webgl",f)||e.canvas.getContext("experimental-webgl",f)),new Proxy(h,r())},t.get2DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",f)},t.restoreContext=()=>{const f=Jn.newInstance();f.setCurrentOperation("Release"),f.traverse(t,null)},t.activateTexture=f=>{const h=e._textureResourceIds.get(f);if(h!==void 0){e.context.activeTexture(e.context.TEXTURE0+h);return}const g=t.getTextureUnitManager().allocate();if(g<0){$p("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(f,g),e.context.activeTexture(e.context.TEXTURE0+g)},t.deactivateTexture=f=>{const h=e._textureResourceIds.get(f);h!==void 0&&(t.getTextureUnitManager().free(h),e._textureResourceIds.delete(f))},t.getTextureUnitForTexture=f=>{const h=e._textureResourceIds.get(f);return h!==void 0?h:-1},t.getDefaultTextureByteSize=function(f){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(f){case tt.CHAR:case tt.SIGNED_CHAR:case tt.UNSIGNED_CHAR:return 1;case h:case g:case tt.UNSIGNED_SHORT:case tt.SHORT:case tt.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(f,h){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(f){case tt.UNSIGNED_CHAR:switch(h){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(g&&!d&&tt.UNSIGNED_SHORT):switch(h){case 1:return g.R16_EXT;case 2:return g.RG16_EXT;case 3:return g.RGB16_EXT;case 4:default:return g.RGBA16_EXT}case(g&&!d&&tt.SHORT):switch(h){case 1:return g.R16_SNORM_EXT;case 2:return g.RG16_SNORM_EXT;case 3:return g.RGB16_SNORM_EXT;case 4:default:return g.RGBA16_SNORM_EXT}case tt.UNSIGNED_SHORT:case tt.SHORT:case tt.FLOAT:default:switch(h){case 1:return d?e.context.R16F:e.context.R32F;case 2:return d?e.context.RG16F:e.context.RG32F;case 3:return d?e.context.RGB16F:e.context.RGB32F;case 4:default:return d?e.context.RGBA16F:e.context.RGBA32F}}switch(h){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=f=>{e.bgImage.src=f.src},t.setUseBackgroundImage=f=>{e.useBackgroundImage=f,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function a(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const h=document.createElement("canvas"),g=h.getContext("2d");h.width=e.canvas.width,h.height=e.canvas.height,g.drawImage(e.canvas,0,0);const d=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(m=>{m.getViewProps().forEach(v=>{if(v.getContainer){const w=v.getContainer().getElementsByTagName("canvas");for(let M=0;M<w.length;M++){const E=w[M],D=E.getBoundingClientRect(),O=D.x-d.x,_=D.y-d.y;g.drawImage(E,O,_)}}})});const x=h.toDataURL(f);h.remove(),t.invokeImageReady(x)}t.captureNextImage=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:h=!1,size:g=null,scale:d=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=f;const p=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:g||d!==1?g||e.size.map(y=>y*d):null},new Promise((y,x)=>{const m=t.onImageReady(T=>{var v;if(e._screenshot.size===null)e.notifyStartCaptureImage=p,m.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(S=>{let{restoreParamsFn:w,arg:M}=S;return w(M)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),y(T);else{const S=document.createElement("img");if(S.style=bF,S.src=T,e._screenshot.placeHolder=e.el.appendChild(S),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,(v=e.rootOpenGLRenderWindow)==null||v.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),h){const w=h!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(M=>{const E=M.getActiveCamera(),D=E.get("focalPoint","position","parallelScale");return{resetCameraArgs:w?{renderer:M}:void 0,resetCameraFn:w?h:M.resetCamera,restoreParamsFn:E.set,arg:JSON.parse(JSON.stringify(D))}}),e._screenshot.cameras.forEach(M=>{let{resetCameraFn:E,resetCameraArgs:D}=M;return E(D)})}t.traverseAllPasses()}})})};let o;t.getHardwareMaximumLineWidth=()=>{if(o!=null)return o;const f=t.get3DContext(),h=f.getParameter(f.ALIASED_LINE_WIDTH_RANGE);return o=h[1],h[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const f=t.get3DContext(),h=f.getExtension("OES_texture_float"),g=f.getExtension("OES_texture_half_float"),d=f.getExtension("WEBGL_debug_renderer_info"),p=f.getExtension("WEBGL_draw_buffers"),y=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),x=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",f.getParameter(f.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",f.getParameter(f.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",f.getParameter(f.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",f.getParameter(f.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",f.getParameter(f.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",f.getParameter(f.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",y&&f.getParameter(y.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",f.getParameter(f.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",f.getParameter(f.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",f.getParameter(f.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",f.getParameter(f.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",f.getParameter(f.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",f.getParameter(f.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",f.getParameter(f.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",f.getParameter(f.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",f.getParameter(f.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",f.getParameter(f.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",f.getParameter(f.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",f.getParameter(f.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",f.getParameter(f.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[h&&yt(f,f.RGBA,f.UNSIGNED_BYTE)?"RGBA":"",h&&yt(f,f.RGB,f.UNSIGNED_BYTE)?"RGB":"",h&&yt(f,f.LUMINANCE,f.UNSIGNED_BYTE)?"LUMINANCE":"",h&&yt(f,f.ALPHA,f.UNSIGNED_BYTE)?"ALPHA":"",h&&yt(f,f.LUMINANCE_ALPHA,f.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[g&&yt(f,f.RGBA,g.HALF_FLOAT_OES)?"RGBA":"",g&&yt(f,f.RGB,g.HALF_FLOAT_OES)?"RGB":"",g&&yt(f,f.LUMINANCE,g.HALF_FLOAT_OES)?"LUMINANCE":"",g&&yt(f,f.ALPHA,g.HALF_FLOAT_OES)?"ALPHA":"",g&&yt(f,f.LUMINANCE_ALPHA,g.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[h&&yt(f,f.RGBA,f.FLOAT)?"RGBA":"",h&&yt(f,f.RGB,f.FLOAT)?"RGB":"",h&&yt(f,f.LUMINANCE,f.FLOAT)?"LUMINANCE":"",h&&yt(f,f.ALPHA,f.FLOAT)?"ALPHA":"",h&&yt(f,f.LUMINANCE_ALPHA,f.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",p?f.getParameter(p.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",f.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",f.getParameter(f.RENDERER)],["WebGL Vendor","VENDOR",f.getParameter(f.VENDOR)],["WebGL Version","VERSION",f.getParameter(f.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",f.getParameter(f.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",d&&f.getParameter(d.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",d&&f.getParameter(d.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],m={};for(;x.length;){const[T,v,S]=x.pop();v&&(m[v]={label:T,value:S})}return e._glInformation=m,m},t.traverseAllPasses=()=>{var h;if(e.renderPasses)for(let g=0;g<e.renderPasses.length;++g)e.renderPasses[g].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&a();const f=e.renderable.getChildRenderWindowsByReference();for(let g=0;g<f.length;++g)(h=t.getViewNodeFor(f[g]))==null||h.traverseAllPasses()},t.copyParentContent=()=>{const f=e.rootOpenGLRenderWindow;if(!f||!e.context2D||e.children.some(d=>{var p;return!!((p=d.getSelector)!=null&&p.call(d))}))return;const h=f.getCanvas(),g=e.canvas;e.context2D.drawImage(h,0,h.height-g.height,g.width,g.height,0,0,g.width,g.height)},t.resizeFromChildRenderWindows=()=>{var h;const f=e.renderable.getChildRenderWindowsByReference();if(f.length>0){const g=[0,0];for(let d=0;d<f.length;++d){const p=(h=t.getViewNodeFor(f[d]))==null?void 0:h.getSize();p&&(g[0]=p[0]>g[0]?p[0]:g[0],g[1]=p[1]>g[1]?p[1]:g[1])}t.setSize(...g)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=f=>{if(e.viewStream===f)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=f,e.viewStream){const h=e.renderable.getRenderers()[0];h.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(g=>t.setBackgroundImage(g.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const f=WT.newInstance();return f.setOpenGLRenderWindow(t),f};function c(){e.canvas.removeEventListener("webglcontextlost",Wp),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=C.chain(()=>{e.context&&FF(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=f=>{e.activeFramebuffer=f};const u=t.setSize;t.setSize=(f,h)=>{const g=u(f,h);return g&&t.invokeWindowResizeEvent({width:f,height:h}),g},t.registerGraphicsResourceUser=(f,h)=>{e._graphicsResources.has(f)||t.setGraphicsResourceForObject(f,null,null);const g=e._graphicsResources.get(f);g==null||g.users.add(h)},t.unregisterGraphicsResourceUser=(f,h)=>{var d;const g=e._graphicsResources.get(f);g&&(g.users.delete(h),g.users.size||((d=g.oglObject)==null||d.releaseGraphicsResources(t),e._graphicsResources.delete(f)))},t.getGraphicsResourceForObject=f=>e._graphicsResources.get(f),t.setGraphicsResourceForObject=(f,h,g)=>{var p;if(!f)return;const d=e._graphicsResources.get(f);(p=d==null?void 0:d.oglObject)==null||p.releaseGraphicsResources(t),e._graphicsResources.set(f,{coreObject:f,oglObject:h,hash:g,users:(d==null?void 0:d.users)??new Set})},t.getGraphicsMemoryInfo=()=>{let f=0;return e._graphicsResources.forEach(h=>{let{oglObject:g}=h;f+=g.getAllocatedGPUMemoryInBytes()}),f},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(f=>{let{oglObject:h}=f;h.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(f=>{const h=t.getViewNodeFor(f);h==null||h.releaseGraphicsResources()})};const l={...t};LF.forEach(f=>{t[f]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[f](...arguments):l[f](...arguments)}})}const kF={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function NF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kF,n),PT.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=WT.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=HC.newInstance(),e.shaderCache=vF.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=ZV.newInstance(),C.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),C.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),C.setGetArray(t,e,["size"],2),C.event(t,e,"imageReady"),C.event(t,e,"windowResizeEvent"),BF(t,e)}const XT=C.newInstance(NF,"vtkOpenGLRenderWindow");Sh("WebGL",XT);At("vtkRenderWindow",XT);const Eu=["setBindGroup","setIndexBuffer","setVertexBuffer","draw","drawIndexed"];function UF(t,e){e.classHierarchy.push("vtkWebGPURenderEncoder"),t.begin=n=>{e.drawCallbacks=[],e.handle=n.beginRenderPass(e.description),e.label&&e.handle.pushDebugGroup(e.label)},t.end=()=>{for(let n=0;n<e.drawCallbacks.length;n++){const r=e.drawCallbacks[n],s=r.pipeline;t.setPipeline(s);for(let i=0;i<r.callbacks.length;i++)r.callbacks[i](t)}e.label&&e.handle.popDebugGroup(),e.handle.end(),e.boundPipeline=null},t.setPipeline=n=>{var s,i;if(e.boundPipeline===n)return;e.handle.setPipeline(n.getHandle());const r=n.getPipelineDescription();if(e.colorTextureViews.length!==r.fragment.targets.length)console.log(`mismatched attachment counts on pipeline ${r.fragment.targets.length} while encoder has ${e.colorTextureViews.length}`),console.trace();else for(let a=0;a<e.colorTextureViews.length;a++){const o=(s=e.colorTextureViews[a].getTexture())==null?void 0:s.getFormat();o&&o!==r.fragment.targets[a].format&&(console.log(`mismatched attachments for attachment ${a} on pipeline ${r.fragment.targets[a].format} while encoder has ${o}`),console.trace())}if(!e.depthTextureView!=!("depthStencil"in r))console.log("mismatched depth attachments"),console.trace();else if(e.depthTextureView){const a=(i=e.depthTextureView.getTexture())==null?void 0:i.getFormat();a&&a!==r.depthStencil.format&&(console.log(`mismatched depth attachments on pipeline ${r.depthStencil.format} while encoder has ${a}`),console.trace())}e.boundPipeline=n},t.replaceShaderCode=n=>{e.replaceShaderCodeFunction(n)},t.setColorTextureView=(n,r)=>{e.colorTextureViews[n]!==r&&(e.colorTextureViews[n]=r)},t.activateBindGroup=n=>{const r=e.boundPipeline.getDevice(),s=e.boundPipeline.getBindGroupLayoutCount(n.getLabel());e.handle.setBindGroup(s,n.getBindGroup(r));const i=r.getBindGroupLayoutDescription(n.getBindGroupLayout(r)),a=r.getBindGroupLayoutDescription(e.boundPipeline.getBindGroupLayout(s));i!==a&&(console.log(`renderEncoder ${e.pipelineHash} mismatched bind group layouts bind group has
${i}
 versus pipeline
${a}
`),console.trace())},t.attachTextureViews=()=>{for(let n=0;n<e.colorTextureViews.length;n++)e.description.colorAttachments[n]?e.description.colorAttachments[n].view=e.colorTextureViews[n].getHandle():e.description.colorAttachments[n]={view:e.colorTextureViews[n].getHandle()};e.depthTextureView&&(e.description.depthStencilAttachment.view=e.depthTextureView.getHandle())},t.registerDrawCallback=(n,r)=>{for(let s=0;s<e.drawCallbacks.length;s++)if(e.drawCallbacks[s].pipeline===n){e.drawCallbacks[s].callbacks.push(r);return}e.drawCallbacks.push({pipeline:n,callbacks:[r]})};for(let n=0;n<Eu.length;n++)t[Eu[n]]=function(){return e.handle[Eu[n]](...arguments)}}const GF={description:null,handle:null,boundPipeline:null,pipelineHash:null,pipelineSettings:null,replaceShaderCodeFunction:null,depthTextureView:null,label:null};function YT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GF,n),st(t,e),e.description={colorAttachments:[{view:void 0,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:void 0,depthLoadOp:"clear",depthClearValue:0,depthStoreOp:"store"}},e.replaceShaderCodeFunction=r=>{const s=r.getShaderDescription("fragment");s.addOutput("vec4<f32>","outColor");let i=s.getCode();i=ie.substitute(i,"//VTK::RenderEncoder::Impl",["output.outColor = computedColor;"]).result,s.setCode(i)},e.pipelineSettings={primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater-equal",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}},e.colorTextureViews=[],Ct(t,e,["boundPipeline","colorTextureViews"]),Ze(t,e,["depthTextureView","description","handle","label","pipelineHash","pipelineSettings","replaceShaderCodeFunction"]),UF(t,e)}const AF=Re(YT,"vtkWebGPURenderEncoder");var jn={newInstance:AF,extend:YT};function zF(t,e){e.classHierarchy.push("vtkWebGPUOpaquePass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r;const s=r.getDevice();if(e.renderEncoder)e.colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e.depthTexture.resize(r.getCanvas().width,r.getCanvas().height);else{t.createRenderEncoder(),e.colorTexture=Rn.newInstance({label:"opaquePassColor"}),e.colorTexture.create(s,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});const i=e.colorTexture.createView("opaquePassColorTexture");e.renderEncoder.setColorTextureView(0,i),e.depthFormat="depth32float",e.depthTexture=Rn.newInstance({label:"opaquePassDepth"}),e.depthTexture.create(s,{width:r.getCanvas().width,height:r.getCanvas().height,format:e.depthFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});const a=e.depthTexture.createView("opaquePassDepthTexture");e.renderEncoder.setDepthTextureView(a)}e.renderEncoder.attachTextureViews(),t.setCurrentOperation("opaquePass"),n.setRenderEncoder(e.renderEncoder),n.traverse(t)},t.getColorTextureView=()=>e.renderEncoder.getColorTextureViews()[0],t.getDepthTextureView=()=>e.renderEncoder.getDepthTextureView(),t.createRenderEncoder=()=>{e.renderEncoder=jn.newInstance({label:"OpaquePass"}),e.renderEncoder.setPipelineHash("op")}}const $F={renderEncoder:null,colorTexture:null,depthTexture:null};function qT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$F,n),Jn.extend(t,e,n),C.get(t,e,["colorTexture","depthTexture"]),zF(t,e)}const WF=C.newInstance(qT,"vtkWebGPUOpaquePass");var HF={newInstance:WF,extend:qT};const IF=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec2<i32> = vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y));
  var reveal: f32 = textureLoad(oitpAccumTexture, tcoord, 0).r;
  if (reveal == 1.0) { discard; }
  var tcolor: vec4<f32> = textureLoad(oitpColorTexture, tcoord, 0);
  var total: f32 = max(tcolor.a, 0.01);
  var computedColor: vec4<f32> = vec4<f32>(tcolor.r/total, tcolor.g/total, tcolor.b/total, 1.0 - reveal);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function jF(t,e){e.classHierarchy.push("vtkWebGPUOrderIndependentTranslucentPass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r;const s=r.getDevice();if(e.translucentRenderEncoder)e.translucentColorTexture.resizeToMatch(e.colorTextureView.getTexture()),e.translucentAccumulateTexture.resizeToMatch(e.colorTextureView.getTexture());else{t.createRenderEncoder(),t.createFinalEncoder(),e.translucentColorTexture=Rn.newInstance({label:"translucentPassColor"}),e.translucentColorTexture.create(s,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const i=e.translucentColorTexture.createView("oitpColorTexture");e.translucentRenderEncoder.setColorTextureView(0,i),e.translucentAccumulateTexture=Rn.newInstance({label:"translucentPassAccumulate"}),e.translucentAccumulateTexture.create(s,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const a=e.translucentAccumulateTexture.createView("oitpAccumTexture");e.translucentRenderEncoder.setColorTextureView(1,a),e.fullScreenQuad=ai.newInstance(),e.fullScreenQuad.setDevice(r.getDevice()),e.fullScreenQuad.setPipelineHash("oitpfsq"),e.fullScreenQuad.setTextureViews(e.translucentRenderEncoder.getColorTextureViews()),e.fullScreenQuad.setFragmentShaderTemplate(IF)}e.translucentRenderEncoder.setDepthTextureView(e.depthTextureView),e.translucentRenderEncoder.attachTextureViews(),t.setCurrentOperation("translucentPass"),n.setRenderEncoder(e.translucentRenderEncoder),n.traverse(t),t.finalPass(r,n)},t.finalPass=(n,r)=>{e.translucentFinalEncoder.setColorTextureView(0,e.colorTextureView),e.translucentFinalEncoder.attachTextureViews(),e.translucentFinalEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e.translucentFinalEncoder),e.fullScreenQuad.prepareAndDraw(e.translucentFinalEncoder),e.translucentFinalEncoder.end()},t.getTextures=()=>[e.translucentColorTexture,e.translucentAccumulateTexture],t.createRenderEncoder=()=>{e.translucentRenderEncoder=jn.newInstance({label:"translucentRender"});const n=e.translucentRenderEncoder.getDescription();n.colorAttachments=[{view:void 0,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:void 0,clearValue:[1,0,0,0],loadOp:"clear",storeOp:"store"}],n.depthStencilAttachment={view:void 0,depthLoadOp:"load",depthStoreOp:"store"},e.translucentRenderEncoder.setReplaceShaderCodeFunction(r=>{const s=r.getShaderDescription("fragment");s.addOutput("vec4<f32>","outColor"),s.addOutput("f32","outAccum"),s.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let i=s.getCode();i=ie.substitute(i,"//VTK::RenderEncoder::Impl",["var w: f32 = computedColor.a * pow(0.1 + input.fragPos.z, 2.0);","output.outColor = vec4<f32>(computedColor.rgb*w, w);","output.outAccum = computedColor.a;"]).result,s.setCode(i)}),e.translucentRenderEncoder.setPipelineHash("oitpr"),e.translucentRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!1,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one"},alpha:{srcFactor:"one",dstFactor:"one"}}},{format:"r16float",blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createFinalEncoder=()=>{e.translucentFinalEncoder=jn.newInstance({label:"translucentFinal"}),e.translucentFinalEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e.translucentFinalEncoder.setReplaceShaderCodeFunction(n=>{const r=n.getShaderDescription("fragment");r.addOutput("vec4<f32>","outColor"),r.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let s=r.getCode();s=ie.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,r.setCode(s)}),e.translucentFinalEncoder.setPipelineHash("oitpf"),e.translucentFinalEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})}}const PF={colorTextureView:null,depthTextureView:null};function ZT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PF,n),Jn.extend(t,e,n),C.setGet(t,e,["colorTextureView","depthTextureView"]),jF(t,e)}const KF=C.newInstance(ZT,"vtkWebGPUOrderIndependentTranslucentPass");var XF={newInstance:KF,extend:ZT};const Es={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6},YF=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Volume::TraverseDec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

fn getTextureValue(vTex: texture_3d<f32>, tpos: vec4<f32>) -> f32
{
  // todo multicomponent support
  return textureSampleLevel(vTex, clampSampler, tpos.xyz, 0.0).r;
}

fn getGradient(vTex: texture_3d<f32>, tpos: vec4<f32>, vNum: i32, scalar: f32) -> vec4<f32>
{
  var result: vec4<f32>;

  var tstep: vec4<f32> = volumeSSBO.values[vNum].tstep;
  result.x = getTextureValue(vTex, tpos + vec4<f32>(tstep.x, 0.0, 0.0, 1.0)) - scalar;
  result.y = getTextureValue(vTex, tpos + vec4<f32>(0.0, tstep.y, 0.0, 1.0)) - scalar;
  result.z = getTextureValue(vTex, tpos + vec4<f32>(0.0, 0.0, tstep.z, 1.0)) - scalar;
  result.w = 0.0;

  // divide by spacing as that is our delta
  result = result / volumeSSBO.values[vNum].spacing;
  // now we have a gradient in unit tcoords

  var grad: f32 = length(result.xyz);
  if (grad > 0.0)
  {
    // rotate to View Coords, needed for lighting and shading
    var nMat: mat4x4<f32> = rendererUBO.SCVCMatrix * volumeSSBO.values[vNum].planeNormals;
    result = nMat * result;
    result = result / length(result);
  }

  // store gradient magnitude in .w
  result.w = grad;

  return result;
}

fn processVolume(vTex: texture_3d<f32>, vNum: i32, cNum: i32, posSC: vec4<f32>, tfunRows: f32) -> vec4<f32>
{
  var outColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);

  // convert to tcoords and reject if outside the volume
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*posSC;
  if (tpos.x < 0.0 || tpos.y < 0.0 || tpos.z < 0.0 ||
      tpos.x > 1.0 || tpos.y > 1.0 || tpos.z > 1.0) { return outColor; }

  var scalar: f32 = getTextureValue(vTex, tpos);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);

  var gofactor: f32 = 1.0;
  var normal: vec4<f32> = vec4<f32>(0.0,0.0,0.0,0.0);
  if (componentSSBO.values[cNum].gomin <  1.0 || volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    normal = getGradient(vTex, tpos, vNum, scalar);
    if (componentSSBO.values[cNum].gomin <  1.0)
    {
      gofactor = clamp(normal.a*componentSSBO.values[cNum].goScale + componentSSBO.values[cNum].goShift,
      componentSSBO.values[cNum].gomin, componentSSBO.values[cNum].gomax);
    }
  }

  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;

  if (volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    color = color*abs(normal.z);
  }

  outColor = vec4<f32>(color.rgb, gofactor * opacity);

  return outColor;
}

// adjust the start and end point of a raycast such that it intersects the unit cube.
// This function is used to take a raycast starting point and step vector
// and numSteps and return the startijng and ending steps for intersecting the
// unit cube. Recall for a 3D texture, the unit cube is the range of texture coordsinates
// that have valid values. So this funtion can be used to take a ray in texture coordinates
// and bound it to intersecting the texture.
//
fn adjustBounds(tpos: vec4<f32>, tstep: vec4<f32>, numSteps: f32) -> vec2<f32>
{
  var result: vec2<f32> = vec2<f32>(0.0, numSteps);
  var tpos2: vec4<f32> = tpos + tstep*numSteps;

  // move tpos to the start of the volume
  var adjust: f32 =
    min(
      max(tpos.x/tstep.x, (tpos.x - 1.0)/tstep.x),
      min(
        max((tpos.y - 1.0)/tstep.y, tpos.y/tstep.y),
        max((tpos.z - 1.0)/tstep.z, tpos.z/tstep.z)));
  if (adjust < 0.0)
  {
    result.x = result.x - adjust;
  }

  // adjust length to the end
  adjust =
    max(
      min(tpos2.x/tstep.x, (tpos2.x - 1.0)/tstep.x),
      max(
        min((tpos2.y - 1.0)/tstep.y, tpos2.y/tstep.y),
        min((tpos2.z - 1.0)/tstep.z, tpos2.z/tstep.z)));
  if (adjust > 0.0)
  {
    result.y = result.y - adjust;
  }

  return result;
}

fn getSimpleColor(scalar: f32, vNum: i32, cNum: i32) -> vec4<f32>
{
  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);
  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;
  return vec4<f32>(color.rgb, opacity);
}

fn traverseMax(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var maxVal: f32 = -1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar > maxVal)
    {
      maxVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(maxVal, vNum, cNum);
}

fn traverseMin(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var minVal: f32 = 1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar < minVal)
    {
      minVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(minVal, vNum, cNum);
}

fn traverseAverage(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var avgVal: f32 = 0.0;
  var sampleCount: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      avgVal = avgVal + sample;
      sampleCount = sampleCount + 1.0;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  if (sampleCount <= 0.0)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(avgVal/sampleCount, vNum, cNum);
}

fn traverseAdditive(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var sumVal: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      sumVal = sumVal + sample;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(sumVal, vNum, cNum);
}

fn composite(rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>) -> vec4<f32>
{
  // initial ray position is at the beginning
  var rayPosSC: vec4<f32> = minPosSC;

  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var curDist: f32 = 0.0;
  var computedColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);
  var sampleColor: vec4<f32>;
//VTK::Volume::TraverseCalls

  loop
  {
    // for each volume, sample and accumulate color
//VTK::Volume::CompositeCalls

    // increment position
    curDist = curDist + mapperUBO.SampleDistance;
    rayPosSC = rayPosSC + rayStepSC;

    // check if we have reached a terminating condition
    if (curDist > rayLengthSC) { break; }
    if (computedColor.a > 0.98) { break; }
  }
  return computedColor;
}

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var rayMax: f32 = textureSampleLevel(maxTexture, clampSampler, input.tcoordVS, 0.0).r;
  var rayMin: f32 = textureSampleLevel(minTexture, clampSampler, input.tcoordVS, 0.0).r;

  // discard empty rays
  if (rayMax <= rayMin) { discard; }
  else
  {
    // compute start and end ray positions in view coordinates
    var minPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMax, 1.0);
    minPosSC = minPosSC * (1.0 / minPosSC.w);
    var maxPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMin, 1.0);
    maxPosSC = maxPosSC * (1.0 / maxPosSC.w);

    var rayLengthSC: f32 = distance(minPosSC.xyz, maxPosSC.xyz);
    var rayStepSC: vec4<f32> = (maxPosSC - minPosSC)*(mapperUBO.SampleDistance/rayLengthSC);
    rayStepSC.w = 0.0;

    var computedColor: vec4<f32>;

//VTK::Volume::Loop

//VTK::RenderEncoder::Impl
  }

  return output;
}
`,xt=new Float64Array(16),or=new Float64Array(16);function qF(t,e){e.classHierarchy.push("vtkWebGPUVolumePassFSQ"),t.replaceShaderPosition=(s,i,a)=>{const o=i.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=o.getCode();c=ie.substitute(c,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);"]).result,o.setCode(c),i.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderVolume=(s,i,a)=>{const o=i.getShaderDescription("fragment");let c=o.getCode();const u=[],l=[];for(let h=0;h<e.volumes.length;h++)e.volumes[h].getRenderable().getMapper().getBlendMode()===Es.COMPOSITE_BLEND?(u.push(`    sampleColor = processVolume(volTexture${h}, ${h}, ${e.rowStarts[h]}, rayPosSC, tfunRows);`),u.push(`    computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`)):(l.push(`  sampleColor = traverseVals[${h}];`),l.push(`  computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`));c=ie.substitute(c,"//VTK::Volume::CompositeCalls",u).result,c=ie.substitute(c,"//VTK::Volume::TraverseCalls",l).result,c=ie.substitute(c,"//VTK::Volume::TraverseDec",[`var<private> traverseVals: array<vec4<f32>,${e.volumes.length}>;`]).result;let f=!1;for(let h=0;h<e.volumes.length;h++){const g=e.volumes[h].getRenderable().getMapper().getBlendMode();g===Es.COMPOSITE_BLEND?f=!0:g===Es.MAXIMUM_INTENSITY_BLEND?c=ie.substitute(c,"//VTK::Volume::Loop",[`    traverseMax(volTexture${h}, ${h}, ${h}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${h}];`,"//VTK::Volume::Loop"]).result:g===Es.MINIMUM_INTENSITY_BLEND?c=ie.substitute(c,"//VTK::Volume::Loop",[`    traverseMin(volTexture${h}, ${h}, ${h}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${h}];`,"//VTK::Volume::Loop"]).result:g===Es.AVERAGE_INTENSITY_BLEND?c=ie.substitute(c,"//VTK::Volume::Loop",[`    traverseAverage(volTexture${h}, ${h}, ${h}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${h}];`,"//VTK::Volume::Loop"]).result:g===Es.ADDITIVE_INTENSITY_BLEND&&(c=ie.substitute(c,"//VTK::Volume::Loop",[`    traverseAdditive(volTexture${h}, ${h}, ${h}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${h}];`,"//VTK::Volume::Loop"]).result)}f&&(c=ie.substitute(c,"//VTK::Volume::Loop",["    computedColor = composite(rayLengthSC, minPosSC, rayStepSC);"]).result),o.setCode(c)},e.shaderReplacements.set("replaceShaderVolume",t.replaceShaderVolume),t.updateLUTImage=s=>{let i=t.getMTime();for(let f=0;f<e.volumes.length;f++){const h=e.volumes[f].getRenderable(),g=h.getMapper().getInputData();i=Math.max(i,h.getMTime(),g.getMTime())}if(i<e.lutBuildTime.getMTime())return;e.numRows=0,e.rowStarts=[];for(let f=0;f<e.volumes.length;f++){e.rowStarts.push(e.numRows);const g=e.volumes[f].getRenderable(),d=g.getMapper(),p=g.getProperty(),y=d.getInputData(),m=(y.getPointData()&&y.getPointData().getScalars()).getNumberOfComponents(),v=p.getIndependentComponents()?m:1;e.numRows+=v}const a=new Uint8ClampedArray(e.numRows*2*e.rowLength*4),o=new Float32Array(e.numRows*2*e.rowLength);let c=0;const u=new Float32Array(e.rowLength*3),l=e.rowLength;for(let f=0;f<e.volumes.length;f++){const g=e.volumes[f].getRenderable(),d=g.getMapper(),p=g.getProperty(),y=d.getInputData(),m=(y.getPointData()&&y.getPointData().getScalars()).getNumberOfComponents(),v=p.getIndependentComponents()?m:1;for(let S=0;S<v;++S){const w=p.getRGBTransferFunction(S),M=w.getRange();w.getTable(M[0],M[1],l,u,1);let E=c*l*4;for(let V=0;V<l;++V){a[E+V*4]=255*u[V*3],a[E+V*4+1]=255*u[V*3+1],a[E+V*4+2]=255*u[V*3+2],a[E+V*4+3]=255;for(let L=0;L<4;L++)a[E+(l+V)*4+L]=a[E+V*4+L]}const D=p.getScalarOpacity(S),O=e.sampleDist/p.getScalarOpacityUnitDistance(S),_=D.getRange();D.getTable(_[0],_[1],l,u,1),E=c*l;for(let V=0;V<l;++V)o[E+V]=1-(1-u[V])**O,o[E+V+l]=o[E+V];c+=2}}{const f={nativeArray:a,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},g=s.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[2]=g}{const f={nativeArray:o,width:e.rowLength,height:e.numRows*2,depth:1,format:"r16float"},g=s.getTextureManager().getTexture(f).createView("ofunTexture");e.textureViews[3]=g}e.lutBuildTime.modified()},t.updateSSBO=s=>{let i=Math.max(t.getMTime(),e.WebGPURenderer.getStabilizedTime());for(let w=0;w<e.volumes.length;w++){const M=e.volumes[w].getRenderable(),E=M.getMapper(),D=E.getInputData();i=Math.max(i,M.getMTime(),D.getMTime(),E.getMTime())}if(i<e.SSBO.getSendTime())return;const a=e.WebGPURenderer.getStabilizedCenterByReference();e.SSBO.clearData(),e.SSBO.setNumberOfInstances(e.volumes.length);const o=new Float64Array(e.volumes.length*16),c=new Float64Array(e.volumes.length*16),u=new Float64Array(e.volumes.length*4),l=new Float64Array(e.volumes.length*4),f=new Float64Array(e.volumes.length*4),h=new Float64Array(e.volumes.length*4);for(let w=0;w<e.volumes.length;w++){const E=e.volumes[w].getRenderable(),D=E.getMapper(),O=D.getInputData();ce(xt),Ae(xt,xt,a);const _=E.getMatrix();Le(or,_),wt(or,or),Ye(xt,or,xt);const V=O.getWorldToIndex();Ye(xt,V,xt);const L=O.getDimensions();ce(or),hs(or,or,[1/L[0],1/L[1],1/L[2]]),Ye(xt,or,xt);for(let H=0;H<16;H++)o[w*16+H]=xt[H];wt(xt,xt);for(let H=0;H<4;H++)c[w*16+H*4]=xt[H*4],c[w*16+H*4+1]=xt[H*4+1],c[w*16+H*4+2]=xt[H*4+2],c[w*16+H*4+3]=0;u[w*4]=1/L[0],u[w*4+1]=1/L[1],u[w*4+2]=1/L[2],u[w*4+3]=1,l[w*4]=E.getProperty().getShade()?1:0;const F=O.getSpacing();f[w*4]=F[0],f[w*4+1]=F[1],f[w*4+2]=F[2],f[w*4+3]=1;const G=e.textureViews[w+4].getTexture().getScale(),A=D.getIpScalarRange();h[w*4]=A[0]/G,h[w*4+1]=A[1]/G,h[w*4+2]=D.getFilterMode()}e.SSBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.SSBO.addEntry("planeNormals","mat4x4<f32>"),e.SSBO.addEntry("shade","vec4<f32>"),e.SSBO.addEntry("tstep","vec4<f32>"),e.SSBO.addEntry("spacing","vec4<f32>"),e.SSBO.addEntry("ipScalarRange","vec4<f32>"),e.SSBO.setAllInstancesFromArray("SCTCMatrix",o),e.SSBO.setAllInstancesFromArray("planeNormals",c),e.SSBO.setAllInstancesFromArray("shade",l),e.SSBO.setAllInstancesFromArray("tstep",u),e.SSBO.setAllInstancesFromArray("spacing",f),e.SSBO.setAllInstancesFromArray("ipScalarRange",h),e.SSBO.send(s),e.componentSSBO.clearData(),e.componentSSBO.setNumberOfInstances(e.numRows);const g=new Float64Array(e.numRows),d=new Float64Array(e.numRows),p=new Float64Array(e.numRows),y=new Float64Array(e.numRows),x=new Float64Array(e.numRows),m=new Float64Array(e.numRows),T=new Float64Array(e.numRows),v=new Float64Array(e.numRows);let S=0;for(let w=0;w<e.volumes.length;w++){const E=e.volumes[w].getRenderable(),D=E.getMapper(),O=E.getProperty(),_=D.getInputData(),L=(_.getPointData()&&_.getPointData().getScalars()).getNumberOfComponents(),F=O.getIndependentComponents(),G=e.textureViews[w+4].getTexture().getFormat(),A=nt.getDetailsFromTextureFormat(G),H=A.elementSize===2&&A.sampleType==="float",P={scale:[255],offset:[0]};H&&(P.scale[0]=1);for(let U=0;U<L;U++){const Y=F?U:0,ee=P.scale[U],q=O.getScalarOpacity(Y).getRange(),Mt=ee/(q[1]-q[0]),Qe=(P.offset[U]-q[0])/(q[1]-q[0]);y[S]=Qe,p[S]=Mt;const Pe=O.getRGBTransferFunction(Y).getRange();if(d[S]=(P.offset[U]-Pe[0])/(Pe[1]-Pe[0]),g[S]=ee/(Pe[1]-Pe[0]),O.getUseGradientOpacity(Y)){const $e=O.getGradientOpacityMinimumOpacity(Y),ct=O.getGradientOpacityMaximumOpacity(Y);x[S]=$e,m[S]=ct;const $t=[O.getGradientOpacityMinimumValue(Y),O.getGradientOpacityMaximumValue(Y)];v[S]=ee*(ct-$e)/($t[1]-$t[0]),T[S]=-$t[0]*(ct-$e)/($t[1]-$t[0])+$e}else x[S]=1,m[S]=1,v[S]=0,T[S]=1;S++}}e.componentSSBO.addEntry("cScale","f32"),e.componentSSBO.addEntry("cShift","f32"),e.componentSSBO.addEntry("oScale","f32"),e.componentSSBO.addEntry("oShift","f32"),e.componentSSBO.addEntry("goShift","f32"),e.componentSSBO.addEntry("goScale","f32"),e.componentSSBO.addEntry("gomin","f32"),e.componentSSBO.addEntry("gomax","f32"),e.componentSSBO.setAllInstancesFromArray("cScale",g),e.componentSSBO.setAllInstancesFromArray("cShift",d),e.componentSSBO.setAllInstancesFromArray("oScale",p),e.componentSSBO.setAllInstancesFromArray("oShift",y),e.componentSSBO.setAllInstancesFromArray("goScale",v),e.componentSSBO.setAllInstancesFromArray("goShift",T),e.componentSSBO.setAllInstancesFromArray("gomin",x),e.componentSSBO.setAllInstancesFromArray("gomax",m),e.componentSSBO.send(s)};const n=t.updateBuffers;t.updateBuffers=()=>{n();let s=e.volumes[0].getRenderable().getMapper().getSampleDistance();for(let i=0;i<e.volumes.length;i++){const c=e.volumes[i].getRenderable().getMapper().getSampleDistance();c<s&&(s=c)}e.sampleDist!==s&&(e.sampleDist=s,e.UBO.setValue("SampleDistance",s),e.UBO.sendIfNeeded(e.device));for(let i=0;i<e.volumes.length;i++){const u=e.volumes[i].getRenderable().getMapper().getInputData(),l=e.device.getTextureManager().getTextureForImageData(u);if(!e.textureViews[i+4]||e.textureViews[i+4].getTexture()!==l){const f=l.createView(`volTexture${i}`);e.textureViews[i+4]=f}}if(e.volumes.length<e.lastVolumeLength)for(let i=e.volumes.length;i<e.lastVolumeLength;i++)e.textureViews.pop();e.lastVolumeLength=e.volumes.length,t.updateLUTImage(e.device),t.updateSSBO(e.device),e.clampSampler||(e.clampSampler=mh.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:"linear",magFilter:"linear"}))},t.computePipelineHash=()=>{e.pipelineHash="volfsq";for(let s=0;s<e.volumes.length;s++){const i=e.volumes[s].getRenderable().getMapper().getBlendMode();e.pipelineHash+=`${i}`}},t.setVolumes=s=>{if(!e.volumes||e.volumes.length!==s.length){e.volumes=[...s],t.modified();return}for(let i=0;i<s.length;i++)if(s[i]!==e.volumes[i]){e.volumes=[...s],t.modified();return}};const r=t.getBindables;t.getBindables=()=>{const s=r();return s.push(e.componentSSBO),s.push(e.clampSampler),s}}const ZF={volumes:null,rowLength:1024,lastVolumeLength:0};function QT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZF,n),ai.extend(t,e,n),e.fragmentShaderTemplate=YF,e.UBO=fs.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SampleDistance","f32"),e.SSBO=el.newInstance({label:"volumeSSBO"}),e.componentSSBO=el.newInstance({label:"componentSSBO"}),e.lutBuildTime={},C.obj(e.lutBuildTime,{mtime:0}),qF(t,e)}const QF=C.newInstance(QT,"vtkWebGPUVolumePassFSQ");var JF={newInstance:QF,extend:QT};const{Representation:eB}=xi,{BufferUsage:Hp,PrimitiveTypes:tB}=Lr,_u=[[0,4,6],[0,6,2],[1,3,7],[1,7,5],[0,5,4],[0,1,5],[2,6,7],[2,7,3],[0,3,1],[0,2,3],[4,5,7],[4,7,6]],nB=`
//VTK::Renderer::Dec

//VTK::Select::Dec

//VTK::VolumePass::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Select::Impl

  //VTK::TCoord::Impl

  //VTK::VolumePass::Impl

  // use the maximum (closest) of the current value and the zbuffer
  // the blend func will then take the min to find the farthest stop value
  var stopval: f32 = max(input.fragPos.z, textureLoad(opaquePassDepthTexture, vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y)), 0));

  //VTK::RenderEncoder::Impl
  return output;
}
`,rB=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = textureSample(volumePassColorTexture,
    volumePassColorTextureSampler, mapperUBO.tscale*input.tcoordVS);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function sB(t,e){e.classHierarchy.push("vtkWebGPUVolumePass"),t.initialize=n=>{e._clearEncoder||t.createClearEncoder(n),e._mergeEncoder||t.createMergeEncoder(n),e._copyEncoder||t.createCopyEncoder(n),e._depthRangeEncoder||t.createDepthRangeEncoder(n),e.fullScreenQuad||(e.fullScreenQuad=JF.newInstance(),e.fullScreenQuad.setDevice(n.getDevice()),e.fullScreenQuad.setTextureViews([...e._depthRangeEncoder.getColorTextureViews()])),e._volumeCopyQuad||(e._volumeCopyQuad=ai.newInstance(),e._volumeCopyQuad.setPipelineHash("volpassfsq"),e._volumeCopyQuad.setDevice(n.getDevice()),e._volumeCopyQuad.setFragmentShaderTemplate(rB),e._copyUBO=fs.newInstance({label:"mapperUBO"}),e._copyUBO.addEntry("tscale","vec2<f32>"),e._volumeCopyQuad.setUBO(e._copyUBO),e._volumeCopyQuad.setTextureViews([e._colorTextureView]))},t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r,t.initialize(r),t.computeTiming(r),t.renderDepthBounds(n,r),e._firstGroup=!0;const s=r.getDevice(),i=s.getHandle().limits.maxSampledTexturesPerShaderStage-4;if(e.volumes.length>i){const a=n.getRenderable().getActiveCamera().getPosition(),o=[];for(let f=0;f<e.volumes.length;f++){const h=e.volumes[f].getRenderable().getBounds(),g=[.5*(h[1]+h[0]),.5*(h[3]+h[2]),.5*(h[5]+h[4])];o[f]=mn(g,a)}const c=[...Array(e.volumes.length).keys()];c.sort((f,h)=>o[h]-o[f]);let u=[],l=c.length%i;for(let f=0;f<c.length;f++)u.push(e.volumes[c[f]]),u.length>=l&&(t.rayCastPass(r,n,u),u=[],l=i,e._firstGroup=!1)}else t.rayCastPass(r,n,e.volumes);if(e._volumeCopyQuad.setWebGPURenderer(n),e._useSmallViewport){const a=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();e._copyUBO.setArray("tscale",[e._smallViewportWidth/a,e._smallViewportHeight/o])}else e._copyUBO.setArray("tscale",[1,1]);e._copyUBO.sendIfNeeded(s),e._copyEncoder.setColorTextureView(0,e.colorTextureView),e._copyEncoder.attachTextureViews(),e._copyEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e._copyEncoder),e._volumeCopyQuad.prepareAndDraw(e._copyEncoder),e._copyEncoder.end()},t.delete=C.chain(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.computeTiming=n=>{const r=n.getRenderable().getInteractor();if(e._lastScale==null){const s=e.volumes[0].getRenderable().getMapper();e._lastScale=s.getInitialInteractionScale()||1}e._useSmallViewport=!1,r.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e._animationRateSubscription||(e._animationRateSubscription=r.onAnimationFrameRateUpdate(()=>{const s=e.volumes[0].getRenderable().getMapper();if(s.getAutoAdjustSampleDistances()){const i=r.getRecentAnimationFrameRate(),a=e._lastScale*r.getDesiredUpdateRate()/i;e._lastScale=a,e._lastScale>400&&(e._lastScale=400)}else e._lastScale=s.getImageSampleDistance()*s.getImageSampleDistance();e._lastScale<1.5&&(e._lastScale=1.5)}))},t.rayCastPass=(n,r,s)=>{const i=e._firstGroup?e._clearEncoder:e._mergeEncoder;i.attachTextureViews(),i.begin(n.getCommandEncoder());let a=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();if(e._useSmallViewport){const c=n.getCanvas(),u=1/Math.sqrt(e._lastScale);e._smallViewportWidth=Math.ceil(u*c.width),e._smallViewportHeight=Math.ceil(u*c.height),a=e._smallViewportWidth,o=e._smallViewportHeight}i.getHandle().setViewport(0,0,a,o,0,1),i.getHandle().setScissorRect(0,0,a,o),e.fullScreenQuad.setWebGPURenderer(r),e.fullScreenQuad.setVolumes(s),e.fullScreenQuad.prepareAndDraw(i),i.end()},t.renderDepthBounds=(n,r)=>{t.updateDepthPolyData(n);const s=e._boundsPoly,i=s.getPoints(),a=s.getPolys();let o={hash:`vp${a.getMTime()}`,usage:Hp.Index,cells:a,numberOfPoints:i.getNumberOfPoints(),primitiveType:tB.Triangles,representation:eB.SURFACE};const c=r.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().setIndexBuffer(c),o={usage:Hp.PointArray,format:"float32x4",hash:`vp${i.getMTime()}${a.getMTime()}`,dataArray:i,indexBuffer:c,packExtra:!0};const u=r.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().addBuffer(u,["vertexBC"]),e._mapper.setNumberOfVertices(u.getSizeInBytes()/u.getStrideInBytes()),t.drawDepthRange(n,r)},t.updateDepthPolyData=n=>{let r=!1;for(let l=0;l<e.volumes.length;l++){const f=e.volumes[l].getMTime();(!e._lastMTimes[l]||f!==e._lastMTimes[l])&&(r=!0,e._lastMTimes[l]=f)}const s=n.getStabilizedTime();if((e._lastMTimes.length<=e.volumes.length||s!==e._lastMTimes[e.volumes.length])&&(r=!0,e._lastMTimes[e.volumes.length]=s),!r)return;const i=n.getStabilizedCenterByReference(),a=e.volumes.length*8,o=new Float64Array(a*3),c=e.volumes.length*12,u=new Uint16Array(c*4);for(let l=0;l<e.volumes.length;l++){e.volumes[l].getBoundingCubePoints(o,l*24);let f=l*12*4;const h=l*8;for(let g=0;g<12;g++)u[f++]=3,u[f++]=h+_u[g][0],u[f++]=h+_u[g][1],u[f++]=h+_u[g][2]}for(let l=0;l<o.length;l+=3)o[l]-=i[0],o[l+1]-=i[1],o[l+2]-=i[2];e._boundsPoly.getPoints().setData(o,3),e._boundsPoly.getPoints().modified(),e._boundsPoly.getPolys().setData(u,1),e._boundsPoly.getPolys().modified(),e._boundsPoly.modified()},t.drawDepthRange=(n,r)=>{e._depthRangeTexture.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeTexture2.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeEncoder.attachTextureViews(),t.setCurrentOperation("volumeDepthRangePass"),n.setRenderEncoder(e._depthRangeEncoder),n.volumeDepthRangePass(!0),e._mapper.setWebGPURenderer(n),e._mapper.prepareToDraw(e._depthRangeEncoder),e._mapper.registerDrawCallback(e._depthRangeEncoder),n.volumeDepthRangePass(!1)},t.createDepthRangeEncoder=n=>{const r=n.getDevice();e._depthRangeEncoder=jn.newInstance({label:"VolumePass DepthRange"}),e._depthRangeEncoder.setPipelineHash("volr"),e._depthRangeEncoder.setReplaceShaderCodeFunction(a=>{const o=a.getShaderDescription("fragment");o.addOutput("vec4<f32>","outColor1"),o.addOutput("vec4<f32>","outColor2");let c=o.getCode();c=ie.substitute(c,"//VTK::RenderEncoder::Impl",["output.outColor1 = vec4<f32>(input.fragPos.z, 0.0, 0.0, 0.0);","output.outColor2 = vec4<f32>(stopval, 0.0, 0.0, 0.0);"]).result,o.setCode(c)}),e._depthRangeEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:null,clearValue:[1,1,1,1],loadOp:"clear",storeOp:"store"}]}),e._depthRangeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"max"},alpha:{srcFactor:"one",dstFactor:"one",operation:"max"}}},{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"min"},alpha:{srcFactor:"one",dstFactor:"one",operation:"min"}}}]}}),e._depthRangeTexture=Rn.newInstance({label:"volumePassMaxDepth"}),e._depthRangeTexture.create(r,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const s=e._depthRangeTexture.createView("maxTexture");e._depthRangeEncoder.setColorTextureView(0,s),e._depthRangeTexture2=Rn.newInstance({label:"volumePassDepthMin"}),e._depthRangeTexture2.create(r,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const i=e._depthRangeTexture2.createView("minTexture");e._depthRangeEncoder.setColorTextureView(1,i),e._mapper.setDevice(n.getDevice()),e._mapper.setTextureViews([e.depthTextureView])},t.createClearEncoder=n=>{e._colorTexture=Rn.newInstance({label:"volumePassColor"}),e._colorTexture.create(n.getDevice(),{width:n.getCanvas().width,height:n.getCanvas().height,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),e._colorTextureView=e._colorTexture.createView("volumePassColorTexture"),e._colorTextureView.addSampler(n.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._clearEncoder=jn.newInstance({label:"VolumePass Clear"}),e._clearEncoder.setColorTextureView(0,e._colorTextureView),e._clearEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]}),e._clearEncoder.setPipelineHash("volpf"),e._clearEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createCopyEncoder=n=>{e._copyEncoder=jn.newInstance({label:"volumePassCopy"}),e._copyEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._copyEncoder.setPipelineHash("volcopypf"),e._copyEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createMergeEncoder=n=>{e._mergeEncoder=jn.newInstance({label:"volumePassMerge"}),e._mergeEncoder.setColorTextureView(0,e._colorTextureView),e._mergeEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._mergeEncoder.setReplaceShaderCodeFunction(r=>{const s=r.getShaderDescription("fragment");s.addOutput("vec4<f32>","outColor");let i=s.getCode();i=ie.substitute(i,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,s.setCode(i)}),e._mergeEncoder.setPipelineHash("volpf"),e._mergeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.setVolumes=n=>{if(!e.volumes||e.volumes.length!==n.length){e.volumes=[...n],t.modified();return}for(let r=0;r<n.length;r++)if(n[r]!==e.volumes[r]){e.volumes=[...n],t.modified();return}}}const iB={colorTextureView:null,depthTextureView:null,volumes:null};function JT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iB,n),Jn.extend(t,e,n),e._mapper=vh.newInstance(),e._mapper.setFragmentShaderTemplate(nB),e._mapper.getShaderReplacements().set("replaceShaderVolumePass",(r,s,i)=>{s.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")}),e._boundsPoly=hn.newInstance(),e._lastMTimes=[],C.setGet(t,e,["colorTextureView","depthTextureView"]),sB(t,e)}const aB=C.newInstance(JT,"vtkWebGPUVolumePass");var oB={newInstance:aB,extend:JT};const cB=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = clamp(textureSampleLevel(opaquePassColorTexture, finalPassSampler, input.tcoordVS, 0.0),vec4<f32>(0.0),vec4<f32>(1.0));

  //VTK::RenderEncoder::Impl
  return output;
}
`;function uB(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t),e.opaquePass||(e.opaquePass=HF.newInstance());const s=n.getRenderable().getNumberOfLayers(),i=n.getChildren();for(let a=0;a<s;a++)for(let o=0;o<i.length;o++){const c=i[o],u=n.getRenderable().getRenderers()[o];u.getDraw()&&u.getLayer()===a&&(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumes=[],t.setCurrentOperation("queryPass"),c.traverse(t),t.setCurrentOperation("cameraPass"),c.traverse(t),e.opaquePass.traverse(c,n),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=XF.newInstance()),e.translucentPass.setColorTextureView(e.opaquePass.getColorTextureView()),e.translucentPass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.translucentPass.traverse(c,n)),e.volumes.length>0&&(e.volumePass||(e.volumePass=oB.newInstance()),e.volumePass.setColorTextureView(e.opaquePass.getColorTextureView()),e.volumePass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.volumePass.setVolumes(e.volumes),e.volumePass.traverse(c,n)),t.finalPass(n,c))}},t.finalPass=(n,r)=>{e._finalBlitEncoder||t.createFinalBlitEncoder(n),e._finalBlitOutputTextureView.createFromTextureHandle(n.getCurrentTexture(),{depth:1,format:n.getPresentationFormat()}),e._finalBlitEncoder.attachTextureViews(),e._finalBlitEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e._finalBlitEncoder),e._fullScreenQuad.prepareAndDraw(e._finalBlitEncoder),e._finalBlitEncoder.end()},t.createFinalBlitEncoder=n=>{e._finalBlitEncoder=jn.newInstance({label:"forwardPassBlit"}),e._finalBlitEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._finalBlitEncoder.setPipelineHash("fpf"),e._finalBlitEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:n.getPresentationFormat(),blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}}),e._fsqSampler=mh.newInstance({label:"finalPassSampler"}),e._fsqSampler.create(n.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._fullScreenQuad=ai.newInstance(),e._fullScreenQuad.setDevice(n.getDevice()),e._fullScreenQuad.setPipelineHash("fpfsq"),e._fullScreenQuad.setTextureViews([e.opaquePass.getColorTextureView()]),e._fullScreenQuad.setAdditionalBindables([e._fsqSampler]),e._fullScreenQuad.setFragmentShaderTemplate(cB),e._finalBlitOutputTextureView=dT.newInstance(),e._finalBlitEncoder.setColorTextureView(0,e._finalBlitOutputTextureView)},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.addVolume=n=>{e.volumes.push(n)}}const fB={opaqueActorCount:0,translucentActorCount:0,volumes:null,opaqueRenderEncoder:null,translucentPass:null,volumePass:null};function ev(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fB,n),Jn.extend(t,e,n),C.setGet(t,e,["opaquePass","translucentPass","volumePass"]),uB(t,e)}const lB=C.newInstance(ev,"vtkForwardPass");var hB={newInstance:lB,extend:ev};const{VtkDataTypes:Hr}=ve;function gB(t,e){e.classHierarchy.push("vtkWebGPUTextureManager");function n(s){if(s.imageData){s.dataArray=s.imageData.getPointData().getScalars(),s.time=s.dataArray.getMTime(),s.nativeArray=s.dataArray.getData();const i=s.imageData.getDimensions();switch(s.width=i[0],s.height=i[1],s.depth=i[2],s.dataArray.getNumberOfComponents()){case 1:s.format="r";break;case 2:s.format="rg";break;case 3:case 4:default:s.format="rgba";break}switch(s.dataArray.getDataType()){case Hr.UNSIGNED_CHAR:s.format+="8unorm";break;case Hr.FLOAT:case Hr.UNSIGNED_INT:case Hr.INT:case Hr.DOUBLE:case Hr.UNSIGNED_SHORT:case Hr.SHORT:default:s.format+="16float";break}}s.image&&(s.width=s.image.width,s.height=s.image.height,s.depth=1,s.format="rgba8unorm"),s.jsImageData&&(s.width=s.jsImageData.width,s.height=s.jsImageData.height,s.depth=1,s.format="rgba8unorm",s.flip=!0,s.nativeArray=s.jsImageData.data),s.canvas&&(s.width=s.canvas.width,s.height=s.canvas.height,s.depth=1,s.format="rgba8unorm",s.flip=!0,s.usage=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT)}function r(s){const i=Rn.newInstance();return i.create(e.device,{width:s.width,height:s.height,depth:s.depth,format:s.format,usage:s.usage,mipLevel:s.mipLevel}),(s.nativeArray||s.image||s.canvas)&&i.writeImageData(s),i}t.getTexture=s=>s.hash?e.device.getCachedObject(s.hash,r,s):r(s),t.getTextureForImageData=s=>{const i={time:s.getMTime()};return i.imageData=s,n(i),i.hash=i.time+i.format+i.mipLevel,e.device.getTextureManager().getTexture(i)},t.getTextureForVTKTexture=s=>{const i={time:s.getMTime()};return s.getInputData()?i.imageData=s.getInputData():s.getImage()?i.image=s.getImage():s.getJsImageData()?i.jsImageData=s.getJsImageData():s.getCanvas()&&(i.canvas=s.getCanvas()),n(i),i.mipLevel=s.getMipLevel(),i.hash=i.time+i.format+i.mipLevel,e.device.getTextureManager().getTexture(i)}}const pB={handle:null,device:null};function tv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pB,n),C.obj(t,e),C.setGet(t,e,["device"]),gB(t,e)}const dB=C.newInstance(tv);var yB={newInstance:dB,extend:tv};class xB extends Map{constructor(){super(),this.registry=new FinalizationRegistry(e=>{const n=super.get(e);n&&n.deref&&n.deref()===void 0&&super.delete(e)})}getValue(e){const n=super.get(e);if(n){const r=n.deref();if(r!==void 0)return r;super.delete(e)}}setValue(e,n){let r;return n&&typeof n=="object"&&(r=new WeakRef(n),this.registry.register(n,e),super.set(e,r)),r}}function TB(t,e){e.classHierarchy.push("vtkWebGPUDevice"),t.initialize=n=>{e.handle=n},t.createCommandEncoder=()=>e.handle.createCommandEncoder(),t.submitCommandEncoder=n=>{e.handle.queue.submit([n.finish()])},t.getShaderModule=n=>e.shaderCache.getShaderModule(n),t.getBindGroupLayout=n=>{if(!n.entries)return null;for(let i=0;i<n.entries.length;i++){const a=n.entries[i];a.binding=a.binding||0,a.visibility=a.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}const r=JSON.stringify(n);for(let i=0;i<e.bindGroupLayouts.length;i++)if(e.bindGroupLayouts[i].sval===r)return e.bindGroupLayouts[i].layout;const s=e.handle.createBindGroupLayout(n);return e.bindGroupLayouts.push({sval:r,layout:s}),s},t.getBindGroupLayoutDescription=n=>{for(let r=0;r<e.bindGroupLayouts.length;r++)if(e.bindGroupLayouts[r].layout===n)return e.bindGroupLayouts[r].sval;return vtkErrorMacro("layout not found"),console.trace(),null},t.getPipeline=n=>n in e.pipelines?e.pipelines[n]:null,t.createPipeline=(n,r)=>{r.initialize(t,n),e.pipelines[n]=r},t.onSubmittedWorkDone=()=>e.handle.queue.onSubmittedWorkDone(),t.hasCachedObject=n=>e.objectCache.getValue(n),t.getCachedObject=function(n,r){if(!n)return vtkErrorMacro("attempt to cache an object without a hash"),null;const s=e.objectCache.getValue(n);if(s)return s;for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];const c=r(...a);return e.objectCache.setValue(n,c),c}}const vB={handle:null,pipelines:null,shaderCache:null,bindGroupLayouts:null,bufferManager:null,textureManager:null};function nv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vB,n),st(t,e),Ze(t,e,["handle"]),Ct(t,e,["bufferManager","shaderCache","textureManager"]),e.objectCache=new xB,e.shaderCache=ie.newInstance(),e.shaderCache.setDevice(t),e.bindGroupLayouts=[],e.bufferManager=Lr.newInstance(),e.bufferManager.setDevice(t),e.textureManager=yB.newInstance(),e.textureManager.setDevice(t),e.pipelines={},TB(t,e)}const mB=Re(nv,"vtkWebGPUDevice");var SB={newInstance:mB,extend:nv};function wB(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelectionPass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=null,t.setCurrentOperation("buildPass"),n.traverse(t);const s=n.getDevice();if(e.selectionRenderEncoder)e.colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e.depthTexture.resizeToMatch(e.colorTexture);else{t.createRenderEncoder(),e.colorTexture=Rn.newInstance({label:"hardwareSelectorColor"}),e.colorTexture.create(s,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba32uint",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const i=e.colorTexture.createView("hardwareSelectColorTexture");e.selectionRenderEncoder.setColorTextureView(0,i),e.depthTexture=Rn.newInstance({label:"hardwareSelectorDepth"}),e.depthTexture.create(s,{width:n.getCanvas().width,height:n.getCanvas().height,format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const a=e.depthTexture.createView("hardwareSelectDepthTexture");e.selectionRenderEncoder.setDepthTextureView(a)}e.selectionRenderEncoder.attachTextureViews(),r.setRenderEncoder(e.selectionRenderEncoder),t.setCurrentOperation("cameraPass"),r.traverse(t),t.setCurrentOperation("opaquePass"),r.traverse(t)},t.createRenderEncoder=()=>{e.selectionRenderEncoder=jn.newInstance({label:"HardwareSelectionPass"}),e.selectionRenderEncoder.setPipelineHash("sel"),e.selectionRenderEncoder.setReplaceShaderCodeFunction(r=>{const s=r.getShaderDescription("fragment");s.addOutput("vec4<u32>","outColor");let i=s.getCode();i=ie.substitute(i,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<u32>(mapperUBO.PropID, compositeID, 0u, 0u);"]).result,s.setCode(i)});const n=e.selectionRenderEncoder.getDescription();n.colorAttachments[0].clearValue=[0,0,0,0],e.selectionRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba32uint",blend:void 0}]}})}}const CB={selectionRenderEncoder:null,colorTexture:null,depthTexture:null};function rv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CB,n),Jn.extend(t,e,n),C.get(t,e,["colorTexture","depthTexture"]),wB(t,e)}const MB=C.newInstance(rv,"vtkWebGPUHardwareSelectionPass");var EB={newInstance:MB,extend:rv};const{SelectionContent:_B,SelectionField:Ip}=zc,{FieldAssociations:jp}=xs,{vtkErrorMacro:sv}=C;function RB(t){return`${t.propID} ${t.compositeID}`}function Pp(t,e,n,r){const s=((n.height-e-1)*n.colorBufferWidth+t)*4+r;return n.colorValues[s]}function $s(t,e,n,r){const s=n<0?0:n;if(s===0){if(r[0]=e[0],r[1]=e[1],e[0]<0||e[0]>=t.width||e[1]<0||e[1]>=t.height)return null;const c=Pp(e[0],e[1],t,0);if(c<=0)return null;const u={};u.propID=c;let l=Pp(e[0],e[1],t,1);if((l<0||l>16777215)&&(l=0),u.compositeID=l,t.captureZValues){const f=(t.height-e[1]-1)*t.zbufferBufferWidth+e[0];u.zValue=t.depthValues[f],u.zValue=t.webGPURenderer.convertToOpenGLDepth(u.zValue),u.displayPosition=e}return u}const i=[e[0],e[1]],a=[0,0];let o=$s(t,e,0,r);if(o)return o;for(let c=1;c<s;++c){for(let u=i[1]>c?i[1]-c:0;u<=i[1]+c;++u)if(a[1]=u,i[0]>=c&&(a[0]=i[0]-c,o=$s(t,a,0,r),o)||(a[0]=i[0]+c,o=$s(t,a,0,r),o))return o;for(let u=i[0]>=c?i[0]-(c-1):0;u<=i[0]+(c-1);++u)if(a[0]=u,i[1]>=c&&(a[1]=i[1]-c,o=$s(t,a,0,r),o)||(a[1]=i[1]+c,o=$s(t,a,0,r),o))return o}return r[0]=e[0],r[1]=e[1],null}function OB(t,e,n){const r=[];let s=0;return e.forEach((i,a)=>{const o=zc.newInstance();switch(o.setContentType(_B.INDICES),t){case jp.FIELD_ASSOCIATION_CELLS:o.setFieldType(Ip.CELL);break;case jp.FIELD_ASSOCIATION_POINTS:o.setFieldType(Ip.POINT);break;default:sv("Unknown field association")}o.getProperties().propID=i.info.propID;const c=n.webGPURenderer.getPropFromID(i.info.propID);o.getProperties().prop=c.getRenderable(),o.getProperties().compositeID=i.info.compositeID,o.getProperties().pixelCount=i.pixelCount,n.captureZValues&&(o.getProperties().displayPosition=[i.info.displayPosition[0],i.info.displayPosition[1],i.info.zValue],o.getProperties().worldPosition=n.webGPURenderWindow.displayToWorld(i.info.displayPosition[0],i.info.displayPosition[1],i.info.zValue,n.renderer)),o.setSelectionList(i.attributeIDs),r[s]=o,s++}),r}function DB(t,e,n,r,s){const i=Math.floor(e),a=Math.floor(n),o=Math.floor(r),c=Math.floor(s),u=new Map,l=[0,0];for(let f=a;f<=c;f++)for(let h=i;h<=o;h++){const d=$s(t,[h,f],0,l);if(d){const p=RB(d);if(!u.has(p))u.set(p,{info:d,pixelCount:1,attributeIDs:[d.attributeID]});else{const y=u.get(p);y.pixelCount++,t.captureZValues&&d.zValue<y.info.zValue&&(y.info=d),y.attributeIDs.indexOf(d.attributeID)===-1&&y.attributeIDs.push(d.attributeID)}}}return OB(t.fieldAssociation,u,t)}function bB(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelector"),t.endSelection=()=>{e.WebGPURenderer.setSelector(null)},t.getSourceDataAsync=async n=>{if(!n||!e._WebGPURenderWindow)return sv("Renderer and view must be set before calling Select."),!1;e._WebGPURenderWindow.getRenderable().preRender(),e._WebGPURenderWindow.getInitialized()||(e._WebGPURenderWindow.initialize(),await new Promise(g=>{e._WebGPURenderWindow.onInitialized(g)}));const r=e._WebGPURenderWindow.getViewNodeFor(n);if(!r)return!1;const s=r.getSuppressClear();r.setSuppressClear(!0),e._selectionPass.traverse(e._WebGPURenderWindow,r),r.setSuppressClear(s);const i=e._WebGPURenderWindow.getDevice(),a=e._selectionPass.getColorTexture(),o=e._selectionPass.getDepthTexture(),c={area:[0,0,a.getWidth()-1,a.getHeight()-1],captureZValues:e.captureZValues,fieldAssociation:e.fieldAssociation,renderer:n,webGPURenderer:r,webGPURenderWindow:e._WebGPURenderWindow,width:a.getWidth(),height:a.getHeight()};c.colorBufferWidth=16*Math.floor((c.width+15)/16),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*4*4;const u=oi.newInstance({label:"hardwareSelectColorBuffer"});u.setDevice(i),u.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);const l=e._WebGPURenderWindow.getCommandEncoder();l.copyTextureToBuffer({texture:a.getHandle()},{buffer:u.getHandle(),bytesPerRow:16*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1});let f;e.captureZValues&&(c.zbufferBufferWidth=64*Math.floor((c.width+63)/64),f=oi.newInstance({label:"hardwareSelectDepthBuffer"}),f.setDevice(i),c.zbufferSizeInBytes=c.height*c.zbufferBufferWidth*4,f.create(c.zbufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),l.copyTextureToBuffer({texture:o.getHandle(),aspect:"depth-only"},{buffer:f.getHandle(),bytesPerRow:4*c.zbufferBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1})),i.submitCommandEncoder(l);const h=u.mapAsync(GPUMapMode.READ);if(e.captureZValues){const g=f.mapAsync(GPUMapMode.READ);await Promise.all([h,g]),c.depthValues=new Float32Array(f.getMappedRange().slice()),f.unmap()}else await h;return c.colorValues=new Uint32Array(u.getMappedRange().slice()),u.unmap(),c.generateSelection=(g,d,p,y)=>DB(c,g,d,p,y),c}}const LB={};function iv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LB,n),BT.extend(t,e,n),e._selectionPass=EB.newInstance(),C.setGet(t,e,["_WebGPURenderWindow"]),C.moveToProtected(t,e,["WebGPURenderWindow"]),bB(t,e)}const VB=C.newInstance(iv,"vtkWebGPUHardwareSelector");var av={newInstance:VB,extend:iv};const{vtkErrorMacro:Kp}=C,FB={position:"absolute",top:0,left:0,width:"100%",height:"100%"};function BB(t,e){e.classHierarchy.push("vtkWebGPURenderWindow"),t.getViewNodeFactory=()=>e.myFactory;const n=[0,0];function r(){e.renderable&&(e.size[0]!==n[0]||e.size[1]!==n[1])&&(n[0]=e.size[0],n[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1]),t.recreateSwapChain()),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(r),t.recreateSwapChain=()=>{e.context&&(e.context.unconfigure(),e.presentationFormat=navigator.gpu.getPreferredCanvasFormat(e.adapter),e.context.configure({device:e.device.getHandle(),format:e.presentationFormat,alphaMode:"premultiplied",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,width:e.size[0],height:e.size[1]}),e._configured=!0)},t.getCurrentTexture=()=>e.context.getCurrentTexture(),t.buildPass=a=>{if(a){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.removeUnusedNodes(),t.initialize()}else e.initialized&&(e._configured||t.recreateSwapChain(),e.commandEncoder=e.device.createCommandEncoder())},t.initialize=()=>{if(!e.initializing){if(e.initializing=!0,!navigator.gpu){Kp("WebGPU is not enabled.");return}t.create3DContextAsync().then(()=>{e.initialized=!0,!e.deleted&&t.invokeInitialized()})}},t.setContainer=a=>{e.el&&e.el!==a&&(e.canvas.parentNode!==e.el&&Kp("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==a&&(e.el=a,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:a,height:o}=e.el.getBoundingClientRect();e.containerSize=[a,o]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.size,t.create3DContextAsync=async()=>{if(e.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!e.deleted){if(e.device=SB.newInstance(),e.device.initialize(await e.adapter.requestDevice()),e.deleted){e.device=null;return}e.context=e.canvas.getContext("webgpu")}},t.releaseGraphicsResources=()=>{const a=Jn.newInstance();a.setCurrentOperation("Release"),a.traverse(t,null),e.adapter=null,e.device=null,e.context=null,e.initialized=!1,e.initializing=!1},t.setBackgroundImage=a=>{e.bgImage.src=a.src},t.setUseBackgroundImage=a=>{e.useBackgroundImage=a,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};async function s(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const o=document.createElement("canvas"),c=o.getContext("2d");o.width=e.canvas.width,o.height=e.canvas.height;const u=await t.getPixelsAsync(),l=new ImageData(u.colorValues,u.width,u.height);c.putImageData(l,0,0);const f=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(p=>{p.getViewProps().forEach(x=>{if(x.getContainer){const T=x.getContainer().getElementsByTagName("canvas");for(let v=0;v<T.length;v++){const S=T[v],w=S.getBoundingClientRect(),M=w.x-f.x,E=w.y-f.y;c.drawImage(S,M,E)}}})});const d=o.toDataURL(a);o.remove(),t.invokeImageReady(d)}t.captureNextImage=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:o=!1,size:c=null,scale:u=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=a;const l=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:c||u!==1?c||e.size.map(f=>f*u):null},new Promise((f,h)=>{const g=t.onImageReady(d=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=l,g.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(p=>{let{restoreParamsFn:y,arg:x}=p;return y(x)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),f(d);else{const p=document.createElement("img");if(p.style=FB,p.src=d,e._screenshot.placeHolder=e.el.appendChild(p),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),o){const y=o!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(x=>{const m=x.getActiveCamera(),T=m.get("focalPoint","position","parallelScale");return{resetCameraArgs:y?{renderer:x}:void 0,resetCameraFn:y?o:x.resetCamera,restoreParamsFn:m.set,arg:JSON.parse(JSON.stringify(T))}}),e._screenshot.cameras.forEach(x=>{let{resetCameraFn:m,resetCameraArgs:T}=x;return m(T)})}t.traverseAllPasses()}})})},t.traverseAllPasses=()=>{if(!e.deleted)if(e.initialized){if(e.renderPasses)for(let a=0;a<e.renderPasses.length;++a)e.renderPasses[a].traverse(t,null);e.commandEncoder&&(e.device.submitCommandEncoder(e.commandEncoder),e.commandEncoder=null,e.notifyStartCaptureImage&&e.device.onSubmittedWorkDone().then(()=>{s()}))}else{t.initialize();const a=t.onInitialized(()=>{a.unsubscribe(),t.traverseAllPasses()})}},t.setViewStream=a=>{if(e.viewStream===a)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=a,e.viewStream){const o=e.renderable.getRenderers()[0];o.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(c=>t.setBackgroundImage(c.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.getUniquePropID=()=>e.nextPropID++,t.getPropFromID=a=>{for(let o=0;o<e.children.length;o++){const c=e.children[o].getPropFromID(a);if(c!==null)return c}return null},t.getPixelsAsync=async()=>{const a=e.device,o=e.renderPasses[0].getOpaquePass().getColorTexture(),c={width:o.getWidth(),height:o.getHeight()};c.colorBufferWidth=32*Math.floor((c.width+31)/32),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*8;const u=oi.newInstance();u.setDevice(a),u.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);const l=e.device.createCommandEncoder();l.copyTextureToBuffer({texture:o.getHandle()},{buffer:u.getHandle(),bytesPerRow:8*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1}),a.submitCommandEncoder(l),await u.mapAsync(GPUMapMode.READ),c.colorValues=new Uint16Array(u.getMappedRange().slice()),u.unmap();const h=new Uint8ClampedArray(c.height*c.width*4);for(let g=0;g<c.height;g++)for(let d=0;d<c.width;d++){const p=(g*c.width+d)*4,y=(g*c.colorBufferWidth+d)*4;h[p]=255*en.fromHalf(c.colorValues[y]),h[p+1]=255*en.fromHalf(c.colorValues[y+1]),h[p+2]=255*en.fromHalf(c.colorValues[y+2]),h[p+3]=255*en.fromHalf(c.colorValues[y+3])}return c.colorValues=h,c},t.createSelector=()=>{const a=av.newInstance();return a.setWebGPURenderWindow(t),a};const i=t.setSize;t.setSize=(a,o)=>{const c=i(a,o);return c&&t.invokeWindowResizeEvent({width:a,height:o}),c},t.delete=C.chain(t.delete,t.setViewStream)}const kB={initialized:!1,context:null,adapter:null,device:null,canvas:null,cursorVisibility:!0,cursor:"pointer",containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1,nextPropID:1,xrSupported:!1,presentationFormat:null};function NB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kB,n),e.canvas=document.createElement("canvas"),e.canvas.style.width="100%",e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",PT.extend(t,e,n),e.myFactory=yb.newInstance(),e.renderPasses[0]=hB.newInstance(),e.selector||(e.selector=av.newInstance(),e.selector.setWebGPURenderWindow(t)),C.event(t,e,"imageReady"),C.event(t,e,"initialized"),C.get(t,e,["commandEncoder","device","presentationFormat","useBackgroundImage","xrSupported"]),C.setGet(t,e,["initialized","context","canvas","device","renderPasses","notifyStartCaptureImage","cursor","useOffScreen"]),C.setGetArray(t,e,["size"],2),C.event(t,e,"windowResizeEvent"),BB(t,e)}const ov=C.newInstance(NB,"vtkWebGPURenderWindow");Sh("WebGPU",ov);Dn("vtkRenderWindow",ov);const UB=BV.extractURLParameters(),GB={margin:"0",padding:"0",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"},AB={position:"absolute",left:"25px",top:"25px",backgroundColor:"white",borderRadius:"5px",listStyle:"none",padding:"5px 10px",margin:"0",display:"block",border:"solid 1px black",maxWidth:"calc(100% - 70px)",maxHeight:"calc(100% - 60px)",overflow:"auto"};function Xp(t,e){Object.keys(e).forEach(n=>{t.style[n]=e[n]})}function zB(t,e){e.classHierarchy.push("vtkFullScreenRenderWindow");const n=document.querySelector("body");e.rootContainer||(e.rootContainer=n),e.container||(e.container=document.createElement("div"),Xp(e.container,e.containerStyle||GB),e.rootContainer.appendChild(e.container)),e.rootContainer===n&&(document.documentElement.style.height="100%",n.style.height="100%",n.style.padding="0",n.style.margin="0"),e.renderWindow=aV.newInstance(),e.renderer=eV.newInstance(),e.renderWindow.addRenderer(e.renderer),e.apiSpecificRenderWindow=e.renderWindow.newAPISpecificView(UB.viewAPI??e.defaultViewAPI),e.apiSpecificRenderWindow.setContainer(e.container),e.renderWindow.addView(e.apiSpecificRenderWindow),e.interactor=ET.newInstance(),e.interactor.setInteractorStyle(LV.newInstance()),e.interactor.setView(e.apiSpecificRenderWindow),e.interactor.initialize(),e.interactor.bindEvents(e.container),t.setBackground=e.renderer.setBackground,t.removeController=()=>{const s=e.controlContainer;s&&s.parentNode.removeChild(s)},t.setControllerVisibility=s=>{e.controllerVisibility=s,e.controlContainer&&(s?e.controlContainer.style.display="block":e.controlContainer.style.display="none")},t.toggleControllerVisibility=()=>{t.setControllerVisibility(!e.controllerVisibility)};function r(s){String.fromCharCode(s.charCode)==="c"&&t.toggleControllerVisibility()}t.addController=s=>{e.controlContainer=document.createElement("div"),Xp(e.controlContainer,e.controlPanelStyle||AB),e.rootContainer.appendChild(e.controlContainer),e.controlContainer.innerHTML=s,t.setControllerVisibility(e.controllerVisibility),e.rootContainer.addEventListener("keypress",r)},t.setBackground(...e.background),t.addRepresentation=s=>{s.getActors().forEach(i=>{e.renderer.addActor(i)})},t.removeRepresentation=s=>{s.getActors().forEach(i=>e.renderer.removeActor(i))},t.delete=C.chain(t.setContainer,e.apiSpecificRenderWindow.delete,()=>{var s;(s=e.rootContainer)==null||s.removeEventListener("keypress",r),window.removeEventListener("resize",t.resize)},t.delete),t.resize=()=>{const s=e.container.getBoundingClientRect(),i=window.devicePixelRatio||1;e.apiSpecificRenderWindow.setSize(Math.floor(s.width*i),Math.floor(s.height*i)),e.resizeCallback&&e.resizeCallback(s),e.renderWindow.render()},t.setResizeCallback=s=>{e.resizeCallback=s,t.resize()},e.listenWindowResize&&window.addEventListener("resize",t.resize),t.resize()}const $B={background:[.32,.34,.43],containerStyle:null,controlPanelStyle:null,listenWindowResize:!0,resizeCallback:null,controllerVisibility:!0};function cv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$B,n),C.obj(t,e),C.get(t,e,["renderWindow","renderer","apiSpecificRenderWindow","interactor","rootContainer","container","controlContainer"]),zB(t,e)}const WB=C.newInstance(cv);var HB={newInstance:WB,extend:cv};const IB=Oc({__name:"vtk_viewer",setup(t){const e=va(null),n=ds.newInstance({scalarVisibility:!1}),r=ps.newInstance();let s=null;r.setMapper(n);const i=Cf();function a(o){if(!s){console.warn("FullScreenRenderer not initialized");return}try{const c=s.getRenderer();c.removeAllActors(),console.log("Rendering VtkManager:",{type:o.constructor.name,storageId:o.StorageId});const u=o.getOutputPort();if(!u){console.warn("No output available for VtkManager");return}u&&typeof u.isA=="function"&&u.isA("vtkPolyData")?n.setInputData(u):n.setInputConnection(u),c.addActor(r),c.resetCamera(),s.getRenderWindow().render(),console.log("Renderer updated, actors:",c.getActors().length)}catch(c){console.error("Render error:",c)}}return bl(()=>{if(console.log("VtkViewer mounted"),!e.value){console.error("VTK container not found");return}console.log("Container size:",{width:e.value.clientWidth,height:e.value.clientHeight}),s=HB.newInstance({rootContainer:e.value,containerStyle:{height:"100%",width:"100%",display:"block"}}),Pi(()=>i.mgr,(o,c)=>{if(console.log("VtkStore.mgr changed:",{newValue:o,oldValue:c}),!o){console.log("No VtkManager, clearing renderer"),s&&(s.getRenderer().removeAllActors(),s.getRenderWindow().render());return}a(o)},{immediate:!0})}),Ll(()=>{console.log("Cleaning up VTK resources"),r.delete(),n.delete(),s&&s.delete()}),(o,c)=>(Bl(),A0("div",{id:"container",ref_key:"vtkContainer",ref:e},null,512))}}),jB=`#container[data-v-42cfbbf4]{flex:1}
`,uv=(t,e)=>{const n=t.__vccOpts||t;for(const[r,s]of e)n[r]=s;return n},fv=uv(IB,[["styles",[jB]],["__scopeId","data-v-42cfbbf4"]]),PB=Object.freeze(Object.defineProperty({__proto__:null,default:fv},Symbol.toStringTag,{value:"Module"})),KB=Oc({__name:"App",setup(t){return(e,n)=>(Bl(),BS(fv))}}),XB=`:host{display:block}#app{display:flex;width:100%;height:100%}
`,lv=uv(KB,[["styles",[XB]]]),YB=Object.freeze(Object.defineProperty({__proto__:null,default:lv},Symbol.toStringTag,{value:"Module"})),dc="gl-editor";function qB(){const t=mw(),e=xw(lv);return e.use(t),e}const _h={};function hv(t){return!!_h[t]}function ZB(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return _h[t](e)}function gv(t,e){_h[t]=e}var pv={get:ZB,has:hv,registerType:gv};function dv(){const t=new ArrayBuffer(4),e=new Uint8Array(t),n=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,n[0]===3569595041?"LittleEndian":n[0]===2712847316?"BigEndian":null}const QB=dv();function JB(t,e){if(e<2)return;const n=new Int8Array(t),r=n.length,s=[];for(let i=0;i<r;i+=e){for(let a=0;a<e;a++)s.push(n[i+a]);for(let a=0;a<e;a++)n[i+a]=s.pop()}}var Ru={ENDIANNESS:QB,getEndianness:dv,swapBytes:JB};const{vtkErrorMacro:yv,vtkDebugMacro:ek}=C,Rh=()=>(yv("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let ci=0;function $c(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new XMLHttpRequest;return r.open(t,e,!0),n.headers&&Object.entries(n.headers).forEach(s=>{let[i,a]=s;return r.setRequestHeader(i,a)}),n.progressCallback&&r.addEventListener("progress",n.progressCallback),r}function tk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((n,r)=>{const s=$c("GET",t,e);s.onreadystatechange=i=>{s.readyState===4&&(s.status===200||s.status===0?n(s.response):r({xhr:s,e:i}))},s.responseType="arraybuffer",s.send()})}function nk(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return r&&r.compression?Rh():n.ref&&!n.ref.pending?new Promise((s,i)=>{const a=[e,n.ref.basepath,n.ref.id].join("/"),o=$c("GET",a,r);o.onreadystatechange=c=>{o.readyState===1&&(n.ref.pending=!0,++ci===1&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!0)),o.readyState===4&&(n.ref.pending=!1,o.status===200||o.status===0?(n.buffer=o.response,n.ref.encode==="JSON"?n.values=JSON.parse(n.buffer):(Ru.ENDIANNESS!==n.ref.encode&&Ru.ENDIANNESS&&(ek(`Swap bytes of ${n.name}`),Ru.swapBytes(n.buffer,jx[n.dataType])),n.values=C.newTypedArray(n.dataType,n.buffer)),n.values.length!==n.size&&yv(`Error in FetchArray: ${n.name}, does not have the proper array size. Got ${n.values.length}, instead of ${n.size}`),delete n.ref,--ci===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),t!=null&&t.modified&&t.modified(),s(n)):i({xhr:o,e:c}))},o.responseType=n.dataType!=="string"?"arraybuffer":"text",o.send()}):Promise.resolve(n)}function rk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n&&n.compression?Rh():new Promise((r,s)=>{const i=$c("GET",e,n);i.onreadystatechange=a=>{i.readyState===1&&++ci===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),i.readyState===4&&(--ci===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),i.status===200||i.status===0?r(JSON.parse(i.responseText)):s({xhr:i,e:a}))},i.responseType="text",i.send()})}function sk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n&&n.compression?Rh():new Promise((r,s)=>{const i=$c("GET",e,n);i.onreadystatechange=a=>{i.readyState===1&&++ci===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),i.readyState===4&&(--ci===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),i.status===200||i.status===0?r(i.responseText):s({xhr:i,e:a}))},i.responseType="text",i.send()})}function ik(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((r,s)=>{const i=new Image;n.crossOrigin&&(i.crossOrigin=n.crossOrigin),i.onload=()=>r(i),i.onerror=s,i.src=e})}const ak={fetchArray:nk,fetchJSON:rk,fetchText:sk,fetchBinary:tk,fetchImage:ik};hv("http")||gv("http",t=>ak);const se={};function Ou(t,e,n,r,s){for(let i=0;i<s;i++)n[r+i]=t[e+i]}function ok(t){se.splitOn=t,se.pieces=[],se.v=[],se.vt=[],se.vn=[],se.f=[[]],se.size=0}function ck(t){const e=t.split("/").map(i=>Number(i));let n=e[0]-1;n=n<0?n+1+se.v.length/3:n;let r=e[1]?e[1]-1:n;r=r<0?r+1+se.vt.length/2:r;let s=e[2]?e[2]-1:n;return s=s<0?s+1+se.vn.length/3:s,[n,r,s]}function uk(t){if(t[0]==="#")return;const e=t.split(/[ \t]+/);if(e[0]===se.splitOn)e.shift(),se.pieces.push(e.join(" ").trim()),se.f.push([]),se.size++;else if(e[0]==="v")se.v.push(Number(e[1])),se.v.push(Number(e[2])),se.v.push(Number(e[3]));else if(e[0]==="vt")se.vt.push(Number(e[1])),se.vt.push(Number(e[2]));else if(e[0]==="vn")se.vn.push(Number(e[1])),se.vn.push(Number(e[2])),se.vn.push(Number(e[3]));else if(e[0]==="f"){se.size===0&&se.size++;const n=se.f[se.size-1];e.shift();const r=e.filter(i=>i.length>0&&i!=="\r"),s=r.length;n.push(s);for(let i=0;i<s;i++)n.push(ck(r[i]))}}function fk(t){const e=!!se.vt.length,n=!!se.vn.length;if(t.splitMode){t.numberOfOutputs=se.size;for(let r=0;r<se.size;r++){const s=se.f[r],i=s.length,a=se.v.length/3,o={};let c;if(t.trackDuplicates){const y=[];let x=0;for(let T=0;T<i;){const v=s[T++];for(let S=0;S<v;S++){const[w,M,E]=s[T++],D=`${w}/${M}/${E}`;o[D]===void 0&&(y[w]===void 0?y[w]=[D]:(y[w].push(D),++x),o[D]=w)}}c=new Uint16Array(a+x);let m=0;for(let T=0;T<y.length;++T){const v=y[T]?y[T].length:0;c[T]=v>1?a+m:T;for(let S=1;S<v;++S){const w=a+m++;c[w]=T,o[y[T][S]]=w}}}const u={},l=hn.newInstance({name:se.pieces[r]}),f=[],h=[],g=[],d=[];let p=0;for(;p<i;){const y=s[p];d.push(y);for(let x=0;x<y;x++){const[m,T,v]=s[p+x+1],S=`${m}/${T}/${v}`;if(u[S]===void 0){const w=t.trackDuplicates?o[S]:f.length/3;u[S]=w,Ou(se.v,m*3,f,w*3,3),e&&Ou(se.vt,T*2,h,w*2,2),n&&Ou(se.vn,v*3,g,w*3,3)}d.push(u[S])}p+=y+1}if(l.getPoints().setData(Float32Array.from(f),3),t.trackDuplicates){const y=ve.newInstance({name:"Duplicates",values:c});l.getPointData().addArray(y)}if(l.getPolys().setData(Uint32Array.from(d)),e){const y=ve.newInstance({numberOfComponents:2,values:Float32Array.from(h),name:"TextureCoordinates"});l.getPointData().setTCoords(y)}if(n){const y=ve.newInstance({numberOfComponents:3,values:Float32Array.from(g),name:"Normals"});l.getPointData().setNormals(y)}t.output[r]=l}}else{t.numberOfOutputs=1;const r=hn.newInstance();if(r.getPoints().setData(Float32Array.from(se.v),3),e&&se.v.length/3===se.vt.length/2){const c=ve.newInstance({numberOfComponents:2,values:Float32Array.from(se.vt),name:"TextureCoordinates"});r.getPointData().setTCoords(c)}if(n&&se.v.length===se.vn.length){const c=ve.newInstance({numberOfComponents:3,values:Float32Array.from(se.vn),name:"Normals"});r.getPointData().setNormals(c)}const s=[],i=se.f[0],a=i.length;let o=0;for(;o<a;){const c=i[o];s.push(c);for(let u=0;u<c;u++){const[l]=i[o+u+1];s.push(l)}o+=c+1}r.getPolys().setData(Uint32Array.from(s)),t.output[0]=r}}function lk(t,e){const n=[],r=t.getPointData().getArrayByName("Duplicates");if(r==null)return n;const s=r.getData(),i=Math.min(e,s[e]);n.push(i);let a=s[i];if(a!==i)for(;a<s.length&&s[a]===i;)n.push(a++);return n}const hk={getPointDuplicateIds:lk};function gk(t,e){e.classHierarchy.push("vtkOBJReader"),e.dataAccessHelper||(e.dataAccessHelper=pv.get("http"));function n(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.dataAccessHelper.fetchText(t,r,s)}t.setUrl=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r.indexOf(".obj")===-1&&!s.fullpath)e.baseURL=r,e.url=`${r}/index.obj`;else{e.url=r;const i=r.split("/");i.pop(),e.baseURL=i.join("/")}return t.loadData(s)},t.loadData=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return n(e.url,r).then(s=>t.isDeleted()?!1:t.parseAsText(s))},t.parseAsText=r=>(r&&(r!==e.parseData&&t.modified(),e.parseData=r,e.numberOfOutputs=0,ok(e.splitMode),r.split(`
`).forEach(uk),fk(e)),!0),t.requestData=(r,s)=>{t.parseAsText(e.parseData)},t.isBusy=()=>!!e.requestCount,t.getNumberOfOutputPorts=()=>e.numberOfOutputs}const pk={numberOfOutputs:1,requestCount:0,splitMode:null,trackDuplicates:!1};function xv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pk,n),C.obj(t,e),C.get(t,e,["url","baseURL"]),C.setGet(t,e,["dataAccessHelper","splitMode","trackDuplicates"]),C.algo(t,e,0,1),C.event(t,e,"busy"),gk(t,e)}const dk=C.newInstance(xv,"vtkOBJReader");var yk={newInstance:dk,extend:xv,...hk};class xk{constructor(){Fr(this,"_reader");Fr(this,"_storage_id",null);this._reader=yk.newInstance()}getOutputPort(){return this._reader.getOutputPort()}get StorageId(){return this._storage_id}set StorageId(e){this._storage_id=e}async loadFromUrl(e){const n={fullpath:!0};await this._reader.setUrl(e,n)}}function Tv(t){return new TextDecoder("latin1").decode(t)}function Tk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const r=Tv(t),s=e.exec(r);if(!s)return{text:r};const i=s.index+s[0].length,a=r.substring(0,i);let o=null;const c=n?n.exec(r):null;if(c){const u=r.substr(c.index);o={text:a+u,binaryBuffer:t.slice(i,c.index)}}else o={text:a,binaryBuffer:t.slice(i)};return o}var Yp={arrayBufferToString:Tv,extractBinary:Tk};const vk=t=>t,qp=1e-6;class vv{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=ce(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?Ow:vk}rotateFromDirections(e,n){const r=new Float64Array(3),s=new Float64Array(3),i=new Float64Array(16);Cn(r,e[0],e[1],e[2]),Cn(s,n[0],n[1],n[2]),_r(r,r),_r(s,s);const a=jl(r,s);return a>=1?this:(Xs(this.tmp,r,s),Rf(this.tmp)<qp&&(Xs(this.tmp,[1,0,0],e),Rf(this.tmp)<qp&&Xs(this.tmp,[0,1,0],e)),ry(i,Math.acos(a),this.tmp),Ye(this.matrix,this.matrix,i),this)}rotate(e,n){return Cn(this.tmp,...n),_r(this.tmp,this.tmp),Pt(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return Wl(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return Hl(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return Il(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return Cn(this.tmp,e,n,r),Ae(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return Cn(this.tmp,e,n,r),hs(this.matrix,this.matrix,this.tmp),this}multiply(e){return Ye(this.matrix,this.matrix,e),this}multiply3x3(e){return Ye(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return wt(this.matrix,this.matrix),this}identity(){return ce(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(cx(_E,this.matrix))return this;const s=r===-1?e.length:n+r*3;for(let i=n;i<s;i+=3)Cn(this.tmp,e[i],e[i+1],e[i+2]),we(this.tmp,this.tmp,this.matrix),e[i]=this.tmp[0],e[i+1]=this.tmp[1],e[i+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&it(this.matrix,e),this}}function mk(){return new vv(!0)}function Sk(){return new vv(!1)}var wk={buildFromDegree:mk,buildFromRadian:Sk};const{vtkErrorMacro:Du}=C;function Ck(t){const n=t.split(" ").filter(s=>s.indexOf("=")>-1),r={};for(let s=0;s<n.length;++s){const a=n[s].split("=");a.length===2&&(r[a[0]]=a[1])}return r}function Zp(t,e){for(let n=0;n<t.length;n++)e.push(t[n])}function Mk(t,e,n,r,s){const i=t[e];if(i===void 0)return-1;if(i.indexOf("endfacet")!==-1||i.indexOf("facet")===-1)return e+1;let a=0,o=2;const c=n.length/3,u=i.split(/[ \t]+/).filter(l=>l).slice(-3).map(Number);for(Zp(u,s);t[e+o].indexOf("vertex")!==-1;){const f=t[e+o].split(/[ \t]+/).filter(h=>h).slice(-3).map(Number);Zp(f,n),a++,o++}r.push(a);for(let l=0;l<a;l++)r.push(c+l);for(;t[e+o]&&t[e+o].indexOf("endfacet")!==-1;)o++;return e+o+2}function Ek(t,e){e.classHierarchy.push("vtkSTLReader"),e.dataAccessHelper||(e.dataAccessHelper=pv.get("http"));function n(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=i.compression!==void 0?i.compression:e.compression,o=i.progressCallback!==void 0?i.progressCallback:e.progressCallback;return i.binary?e.dataAccessHelper.fetchBinary(s,{compression:a,progressCallback:o}):e.dataAccessHelper.fetchText(t,s,{compression:a,progressCallback:o})}function r(s){const i=e.output[0],a=i.getPoints().getData(),o=i.getPolys().getData();if(!a||!o){console.warn("No valid polydata.");return}const c=new Map,u=new Map;let l=0,f=!1;for(let h=0;h<a.length;h+=3){const g=(a[h]*10**s).toFixed(0),d=(a[h+1]*10**s).toFixed(0),p=(a[h+2]*10**s).toFixed(0),y=`${g},${d},${p}`;c.get(y)!==void 0?(u.set(h/3,c.get(y)),f=!0):(u.set(h/3,l),c.set(y,l),l++)}if(f){const h=new Float32Array(c.size*3),g=Array.from(c.keys());for(let p=0;p<g.length;p++){const y=g[p],x=c.get(y)*3,m=y.split(",").map(T=>+T*10**-s);h[x]=m[0],h[x+1]=m[1],h[x+2]=m[2]}const d=new Int32Array(o.length);for(let p=0;p<o.length;p+=4)d[p]=3,d[p+1]=u.get(o[p+1]),d[p+2]=u.get(o[p+2]),d[p+3]=u.get(o[p+3]);i.getPoints().setData(h),i.getPolys().setData(d),i.modified()}}t.setUrl=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{binary:!0};e.url=s;const a=s.split("/");return a.pop(),e.baseURL=a.join("/"),t.loadData(i)},t.loadData=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=n(e.url,s);return i.then(t.parse),i},t.parse=s=>{typeof s=="string"?t.parseAsText(s):t.parseAsArrayBuffer(s)},t.parseAsArrayBuffer=s=>{if(!s)return;if(s!==e.parseData)t.modified();else return;e.parseData=s;let i=!1;if(i=84+new DataView(s,0,80+4).getUint32(80,!0)*50===s.byteLength,!i){t.parseAsText(Yp.arrayBufferToString(s));return}const c=s.slice(0,80),u=Yp.arrayBufferToString(c),l=Ck(u),f=new DataView(s,84),h=(s.byteLength-84)/50,g=new Float32Array(h*9),d=new Float32Array(h*3),p=new Uint32Array(h*4),y=new Uint16Array(h);let x=0;for(let v=0;v<h;v++){const S=v*50;d[v*3+0]=f.getFloat32(S+0,!0),d[v*3+1]=f.getFloat32(S+4,!0),d[v*3+2]=f.getFloat32(S+8,!0),g[v*9+0]=f.getFloat32(S+12,!0),g[v*9+1]=f.getFloat32(S+16,!0),g[v*9+2]=f.getFloat32(S+20,!0),g[v*9+3]=f.getFloat32(S+24,!0),g[v*9+4]=f.getFloat32(S+28,!0),g[v*9+5]=f.getFloat32(S+32,!0),g[v*9+6]=f.getFloat32(S+36,!0),g[v*9+7]=f.getFloat32(S+40,!0),g[v*9+8]=f.getFloat32(S+44,!0),p[x++]=3,p[x++]=v*3+0,p[x++]=v*3+1,p[x++]=v*3+2,y[v]=f.getUint16(S+48,!0)}const m="SPACE";if(m in l&&l[m]!=="LPS"){const v=l[m],S=new Float32Array(16);switch(S[15]=1,v[0]){case"L":S[0]=1;break;case"R":S[0]=-1;break;default:Du(`Can not convert STL file from ${v} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}switch(v[1]){case"P":S[5]=1;break;case"A":S[5]=-1;break;default:Du(`Can not convert STL file from ${v} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}switch(v[2]){case"S":S[10]=1;break;case"I":S[10]=-1;break;default:Du(`Can not convert STL file from ${v} to LPS space: permutations not supported. Use itk.js STL reader instead.`);return}wk.buildFromDegree().setMatrix(S).apply(g).apply(d)}const T=hn.newInstance();T.getPoints().setData(g,3),T.getPolys().setData(p),T.getCellData().setScalars(ve.newInstance({name:"Attribute",values:y})),T.getCellData().setNormals(ve.newInstance({name:"Normals",values:d,numberOfComponents:3})),e.output[0]=T,e.removeDuplicateVertices>=0&&r(e.removeDuplicateVertices)},t.parseAsText=s=>{if(!s)return;if(s!==e.parseData)t.modified();else return;e.parseData=s;const i=s.split(`
`);let a=1;const o=[],c=[],u=[];for(;a!==-1;)a=Mk(i,a,o,c,u);const l=hn.newInstance();l.getPoints().setData(Float32Array.from(o),3),l.getPolys().setData(Uint32Array.from(c)),l.getCellData().setNormals(ve.newInstance({name:"Normals",values:Float32Array.from(u),numberOfComponents:3})),e.output[0]=l,e.removeDuplicateVertices>=0&&r(e.removeDuplicateVertices)},t.requestData=(s,i)=>{t.parse(e.parseData)}}const _k={removeDuplicateVertices:-1};function mv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_k,n),C.obj(t,e),C.get(t,e,["url","baseURL"]),C.setGet(t,e,["dataAccessHelper","removeDuplicateVertices"]),C.algo(t,e,0,1),Ek(t,e),e.compression||(e.compression=null),e.progressCallback||(e.progressCallback=null)}const Rk=C.newInstance(mv,"vtkSTLReader");var Ok={extend:mv,newInstance:Rk};class Dk{constructor(){Fr(this,"_reader");Fr(this,"_storage_id",null);this._reader=Ok.newInstance()}getOutputPort(){return this._reader.getOutputPort()}get StorageId(){return this._storage_id}set StorageId(e){this._storage_id=e}async loadFromUrl(e){const n={fullpath:!0,binary:!0};await this._reader.setUrl(e,n)}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Sv="177",yc=0,bk=1,Lk=2,Qp=1,Jp=100,ed=204,td=205,nd=3,Vk=0,rd="attached",Fk="detached",wv=300,da=1e3,Hi=1001,sl=1002,xc=1003,Bk=1004,kk=1005,Tc=1006,Nk=1007,Oh=1008,Cv=1009,Dh=1015,Mv=1023,Uk=1028,ya=2300,xa=2301,bu=2302,sd=2400,id=2401,ad=2402,Gk=2500,Ak=0,Ev=1,il=2,zk=0,_v="",lt="srgb",gn="srgb-linear",od="linear",Lu="srgb",_s=7680,cd=519,al=35044,rs=2e3,ol=2001;class Wc{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){const r=this._listeners;if(r===void 0)return;const s=r[e];if(s!==void 0){const i=s.indexOf(n);i!==-1&&s.splice(i,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const r=n[e.type];if(r!==void 0){e.target=this;const s=r.slice(0);for(let i=0,a=s.length;i<a;i++)s[i].call(this,e);e.target=null}}}const ut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ud=1234567;const Ji=Math.PI/180,Ta=180/Math.PI;function un(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(ut[t&255]+ut[t>>8&255]+ut[t>>16&255]+ut[t>>24&255]+"-"+ut[e&255]+ut[e>>8&255]+"-"+ut[e>>16&15|64]+ut[e>>24&255]+"-"+ut[n&63|128]+ut[n>>8&255]+"-"+ut[n>>16&255]+ut[n>>24&255]+ut[r&255]+ut[r>>8&255]+ut[r>>16&255]+ut[r>>24&255]).toLowerCase()}function fe(t,e,n){return Math.max(e,Math.min(n,t))}function bh(t,e){return(t%e+e)%e}function $k(t,e,n,r,s){return r+(t-e)*(s-r)/(n-e)}function Wk(t,e,n){return t!==e?(n-t)/(e-t):0}function ea(t,e,n){return(1-n)*t+n*e}function Hk(t,e,n,r){return ea(t,e,1-Math.exp(-n*r))}function Ik(t,e=1){return e-Math.abs(bh(t,e*2)-e)}function jk(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function Pk(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function Kk(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Xk(t,e){return t+Math.random()*(e-t)}function Yk(t){return t*(.5-Math.random())}function qk(t){t!==void 0&&(ud=t);let e=ud+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Zk(t){return t*Ji}function Qk(t){return t*Ta}function Jk(t){return(t&t-1)===0&&t!==0}function eN(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function tN(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function nN(t,e,n,r,s){const i=Math.cos,a=Math.sin,o=i(n/2),c=a(n/2),u=i((e+r)/2),l=a((e+r)/2),f=i((e-r)/2),h=a((e-r)/2),g=i((r-e)/2),d=a((r-e)/2);switch(s){case"XYX":t.set(o*l,c*f,c*h,o*u);break;case"YZY":t.set(c*h,o*l,c*f,o*u);break;case"ZXZ":t.set(c*f,c*h,o*l,o*u);break;case"XZX":t.set(o*l,c*d,c*g,o*u);break;case"YXY":t.set(c*g,o*l,c*d,o*u);break;case"ZYZ":t.set(c*d,c*g,o*l,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function tn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Me(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const rN={DEG2RAD:Ji,RAD2DEG:Ta,generateUUID:un,clamp:fe,euclideanModulo:bh,mapLinear:$k,inverseLerp:Wk,lerp:ea,damp:Hk,pingpong:Ik,smoothstep:jk,smootherstep:Pk,randInt:Kk,randFloat:Xk,randFloatSpread:Yk,seededRandom:qk,degToRad:Zk,radToDeg:Qk,isPowerOfTwo:Jk,ceilPowerOfTwo:eN,floorPowerOfTwo:tN,setQuaternionFromProperEuler:nN,normalize:Me,denormalize:tn};class Ie{constructor(e=0,n=0){Ie.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,s=e.elements;return this.x=s[0]*n+s[3]*r+s[6],this.y=s[1]*n+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=fe(this.x,e.x,n.x),this.y=fe(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=fe(this.x,e,n),this.y=fe(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(fe(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(fe(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),s=Math.sin(n),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*s+e.x,this.y=i*s+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Vr{constructor(e=0,n=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=s}static slerpFlat(e,n,r,s,i,a,o){let c=r[s+0],u=r[s+1],l=r[s+2],f=r[s+3];const h=i[a+0],g=i[a+1],d=i[a+2],p=i[a+3];if(o===0){e[n+0]=c,e[n+1]=u,e[n+2]=l,e[n+3]=f;return}if(o===1){e[n+0]=h,e[n+1]=g,e[n+2]=d,e[n+3]=p;return}if(f!==p||c!==h||u!==g||l!==d){let y=1-o;const x=c*h+u*g+l*d+f*p,m=x>=0?1:-1,T=1-x*x;if(T>Number.EPSILON){const S=Math.sqrt(T),w=Math.atan2(S,x*m);y=Math.sin(y*w)/S,o=Math.sin(o*w)/S}const v=o*m;if(c=c*y+h*v,u=u*y+g*v,l=l*y+d*v,f=f*y+p*v,y===1-o){const S=1/Math.sqrt(c*c+u*u+l*l+f*f);c*=S,u*=S,l*=S,f*=S}}e[n]=c,e[n+1]=u,e[n+2]=l,e[n+3]=f}static multiplyQuaternionsFlat(e,n,r,s,i,a){const o=r[s],c=r[s+1],u=r[s+2],l=r[s+3],f=i[a],h=i[a+1],g=i[a+2],d=i[a+3];return e[n]=o*d+l*f+c*g-u*h,e[n+1]=c*d+l*h+u*f-o*g,e[n+2]=u*d+l*g+o*h-c*f,e[n+3]=l*d-o*f-c*h-u*g,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,s){return this._x=e,this._y=n,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,s=e._y,i=e._z,a=e._order,o=Math.cos,c=Math.sin,u=o(r/2),l=o(s/2),f=o(i/2),h=c(r/2),g=c(s/2),d=c(i/2);switch(a){case"XYZ":this._x=h*l*f+u*g*d,this._y=u*g*f-h*l*d,this._z=u*l*d+h*g*f,this._w=u*l*f-h*g*d;break;case"YXZ":this._x=h*l*f+u*g*d,this._y=u*g*f-h*l*d,this._z=u*l*d-h*g*f,this._w=u*l*f+h*g*d;break;case"ZXY":this._x=h*l*f-u*g*d,this._y=u*g*f+h*l*d,this._z=u*l*d+h*g*f,this._w=u*l*f-h*g*d;break;case"ZYX":this._x=h*l*f-u*g*d,this._y=u*g*f+h*l*d,this._z=u*l*d-h*g*f,this._w=u*l*f+h*g*d;break;case"YZX":this._x=h*l*f+u*g*d,this._y=u*g*f+h*l*d,this._z=u*l*d-h*g*f,this._w=u*l*f-h*g*d;break;case"XZY":this._x=h*l*f-u*g*d,this._y=u*g*f-h*l*d,this._z=u*l*d+h*g*f,this._w=u*l*f+h*g*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],s=n[4],i=n[8],a=n[1],o=n[5],c=n[9],u=n[2],l=n[6],f=n[10],h=r+o+f;if(h>0){const g=.5/Math.sqrt(h+1);this._w=.25/g,this._x=(l-c)*g,this._y=(i-u)*g,this._z=(a-s)*g}else if(r>o&&r>f){const g=2*Math.sqrt(1+r-o-f);this._w=(l-c)/g,this._x=.25*g,this._y=(s+a)/g,this._z=(i+u)/g}else if(o>f){const g=2*Math.sqrt(1+o-r-f);this._w=(i-u)/g,this._x=(s+a)/g,this._y=.25*g,this._z=(c+l)/g}else{const g=2*Math.sqrt(1+f-r-o);this._w=(a-s)/g,this._x=(i+u)/g,this._y=(c+l)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(fe(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const s=Math.min(1,n/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,s=e._y,i=e._z,a=e._w,o=n._x,c=n._y,u=n._z,l=n._w;return this._x=r*l+a*o+s*u-i*c,this._y=s*l+a*c+i*o-r*u,this._z=i*l+a*u+r*c-s*o,this._w=a*l-r*o-s*c-i*u,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,s=this._y,i=this._z,a=this._w;let o=a*e._w+r*e._x+s*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=s,this._z=i,this;const c=1-o*o;if(c<=Number.EPSILON){const g=1-n;return this._w=g*a+n*this._w,this._x=g*r+n*this._x,this._y=g*s+n*this._y,this._z=g*i+n*this._z,this.normalize(),this}const u=Math.sqrt(c),l=Math.atan2(u,o),f=Math.sin((1-n)*l)/u,h=Math.sin(n*l)/u;return this._w=a*f+this._w*h,this._x=r*f+this._x*h,this._y=s*f+this._y*h,this._z=i*f+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),s=Math.sqrt(1-r),i=Math.sqrt(r);return this.set(s*Math.sin(e),s*Math.cos(e),i*Math.sin(n),i*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class B{constructor(e=0,n=0,r=0){B.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(fd.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(fd.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,s=this.z,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6]*s,this.y=i[1]*n+i[4]*r+i[7]*s,this.z=i[2]*n+i[5]*r+i[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,s=this.z,i=e.elements,a=1/(i[3]*n+i[7]*r+i[11]*s+i[15]);return this.x=(i[0]*n+i[4]*r+i[8]*s+i[12])*a,this.y=(i[1]*n+i[5]*r+i[9]*s+i[13])*a,this.z=(i[2]*n+i[6]*r+i[10]*s+i[14])*a,this}applyQuaternion(e){const n=this.x,r=this.y,s=this.z,i=e.x,a=e.y,o=e.z,c=e.w,u=2*(a*s-o*r),l=2*(o*n-i*s),f=2*(i*r-a*n);return this.x=n+c*u+a*f-o*l,this.y=r+c*l+o*u-i*f,this.z=s+c*f+i*l-a*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,s=this.z,i=e.elements;return this.x=i[0]*n+i[4]*r+i[8]*s,this.y=i[1]*n+i[5]*r+i[9]*s,this.z=i[2]*n+i[6]*r+i[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=fe(this.x,e.x,n.x),this.y=fe(this.y,e.y,n.y),this.z=fe(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=fe(this.x,e,n),this.y=fe(this.y,e,n),this.z=fe(this.z,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(fe(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,s=e.y,i=e.z,a=n.x,o=n.y,c=n.z;return this.x=s*c-i*o,this.y=i*a-r*c,this.z=r*o-s*a,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Vu.copy(this).projectOnVector(e),this.sub(Vu)}reflect(e){return this.sub(Vu.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(fe(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return n*n+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const s=Math.sin(n)*e;return this.x=s*Math.sin(r),this.y=Math.cos(n)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=s,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Vu=new B,fd=new Vr;class er{constructor(e,n,r,s,i,a,o,c,u){er.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,s,i,a,o,c,u)}set(e,n,r,s,i,a,o,c,u){const l=this.elements;return l[0]=e,l[1]=s,l[2]=o,l[3]=n,l[4]=i,l[5]=c,l[6]=r,l[7]=a,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,s=n.elements,i=this.elements,a=r[0],o=r[3],c=r[6],u=r[1],l=r[4],f=r[7],h=r[2],g=r[5],d=r[8],p=s[0],y=s[3],x=s[6],m=s[1],T=s[4],v=s[7],S=s[2],w=s[5],M=s[8];return i[0]=a*p+o*m+c*S,i[3]=a*y+o*T+c*w,i[6]=a*x+o*v+c*M,i[1]=u*p+l*m+f*S,i[4]=u*y+l*T+f*w,i[7]=u*x+l*v+f*M,i[2]=h*p+g*m+d*S,i[5]=h*y+g*T+d*w,i[8]=h*x+g*v+d*M,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],l=e[8];return n*a*l-n*o*u-r*i*l+r*o*c+s*i*u-s*a*c}invert(){const e=this.elements,n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],l=e[8],f=l*a-o*u,h=o*c-l*i,g=u*i-a*c,d=n*f+r*h+s*g;if(d===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/d;return e[0]=f*p,e[1]=(s*u-l*r)*p,e[2]=(o*r-s*a)*p,e[3]=h*p,e[4]=(l*n-s*c)*p,e[5]=(s*i-o*n)*p,e[6]=g*p,e[7]=(r*c-u*n)*p,e[8]=(a*n-r*i)*p,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,s,i,a,o){const c=Math.cos(i),u=Math.sin(i);return this.set(r*c,r*u,-r*(c*a+u*o)+a+e,-s*u,s*c,-s*(-u*a+c*o)+o+n,0,0,1),this}scale(e,n){return this.premultiply(Fu.makeScale(e,n)),this}rotate(e){return this.premultiply(Fu.makeRotation(-e)),this}translate(e,n){return this.premultiply(Fu.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let s=0;s<9;s++)if(n[s]!==r[s])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Fu=new er;function sN(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function cl(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const ld={};function hd(t){t in ld||(ld[t]=!0,console.warn(t))}const gd=new er().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),pd=new er().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function iN(){const t={enabled:!0,workingColorSpace:gn,spaces:{},convert:function(s,i,a){return this.enabled===!1||i===a||!i||!a||(this.spaces[i].transfer===Lu&&(s.r=Yn(s.r),s.g=Yn(s.g),s.b=Yn(s.b)),this.spaces[i].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[i].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Lu&&(s.r=Zs(s.r),s.g=Zs(s.g),s.b=Zs(s.b))),s},workingToColorSpace:function(s,i){return this.convert(s,this.workingColorSpace,i)},colorSpaceToWorking:function(s,i){return this.convert(s,i,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===_v?od:this.spaces[s].transfer},getLuminanceCoefficients:function(s,i=this.workingColorSpace){return s.fromArray(this.spaces[i].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,i,a){return s.copy(this.spaces[i].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,i){return hd("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(s,i)},toWorkingColorSpace:function(s,i){return hd("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(s,i)}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[gn]:{primaries:e,whitePoint:r,transfer:od,toXYZ:gd,fromXYZ:pd,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:lt},outputColorSpaceConfig:{drawingBufferColorSpace:lt}},[lt]:{primaries:e,whitePoint:r,transfer:Lu,toXYZ:gd,fromXYZ:pd,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:lt}}}),t}const bt=iN();function Yn(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Zs(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let Rs;class aN{static getDataURL(e,n="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{Rs===void 0&&(Rs=cl("canvas")),Rs.width=e.width,Rs.height=e.height;const s=Rs.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),r=Rs}return r.toDataURL(n)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=cl("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),i=s.data;for(let a=0;a<i.length;a++)i[a]=Yn(i[a]/255)*255;return r.putImageData(s,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(Yn(n[r]/255)*255):n[r]=Yn(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let oN=0;class cN{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:oN++}),this.uuid=un(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const n=this.data;return n instanceof HTMLVideoElement?e.set(n.videoWidth,n.videoHeight):n!==null?e.set(n.width,n.height,n.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let i;if(Array.isArray(s)){i=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?i.push(Bu(s[a].image)):i.push(Bu(s[a]))}else i=Bu(s);r.url=i}return n||(e.images[this.uuid]=r),r}}function Bu(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?aN.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let uN=0;const ku=new B;class fn extends Wc{constructor(e=fn.DEFAULT_IMAGE,n=fn.DEFAULT_MAPPING,r=Hi,s=Hi,i=Tc,a=Oh,o=Mv,c=Cv,u=fn.DEFAULT_ANISOTROPY,l=_v){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:uN++}),this.uuid=un(),this.name="",this.source=new cN(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=i,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=c,this.offset=new Ie(0,0),this.repeat=new Ie(1,1),this.center=new Ie(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new er,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(ku).x}get height(){return this.source.getSize(ku).y}get depth(){return this.source.getSize(ku).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Texture.setValues(): parameter '${n}' has value of undefined.`);continue}const s=this[n];if(s===void 0){console.warn(`THREE.Texture.setValues(): property '${n}' does not exist.`);continue}s&&r&&s.isVector2&&r.isVector2||s&&r&&s.isVector3&&r.isVector3||s&&r&&s.isMatrix3&&r.isMatrix3?s.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==wv)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case da:e.x=e.x-Math.floor(e.x);break;case Hi:e.x=e.x<0?0:1;break;case sl:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case da:e.y=e.y-Math.floor(e.y);break;case Hi:e.y=e.y<0?0:1;break;case sl:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}fn.DEFAULT_IMAGE=null;fn.DEFAULT_MAPPING=wv;fn.DEFAULT_ANISOTROPY=1;class St{constructor(e=0,n=0,r=0,s=1){St.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,s){return this.x=e,this.y=n,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,s=this.z,i=this.w,a=e.elements;return this.x=a[0]*n+a[4]*r+a[8]*s+a[12]*i,this.y=a[1]*n+a[5]*r+a[9]*s+a[13]*i,this.z=a[2]*n+a[6]*r+a[10]*s+a[14]*i,this.w=a[3]*n+a[7]*r+a[11]*s+a[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,s,i;const c=e.elements,u=c[0],l=c[4],f=c[8],h=c[1],g=c[5],d=c[9],p=c[2],y=c[6],x=c[10];if(Math.abs(l-h)<.01&&Math.abs(f-p)<.01&&Math.abs(d-y)<.01){if(Math.abs(l+h)<.1&&Math.abs(f+p)<.1&&Math.abs(d+y)<.1&&Math.abs(u+g+x-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const T=(u+1)/2,v=(g+1)/2,S=(x+1)/2,w=(l+h)/4,M=(f+p)/4,E=(d+y)/4;return T>v&&T>S?T<.01?(r=0,s=.707106781,i=.707106781):(r=Math.sqrt(T),s=w/r,i=M/r):v>S?v<.01?(r=.707106781,s=0,i=.707106781):(s=Math.sqrt(v),r=w/s,i=E/s):S<.01?(r=.707106781,s=.707106781,i=0):(i=Math.sqrt(S),r=M/i,s=E/i),this.set(r,s,i,n),this}let m=Math.sqrt((y-d)*(y-d)+(f-p)*(f-p)+(h-l)*(h-l));return Math.abs(m)<.001&&(m=1),this.x=(y-d)/m,this.y=(f-p)/m,this.z=(h-l)/m,this.w=Math.acos((u+g+x-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=fe(this.x,e.x,n.x),this.y=fe(this.y,e.y,n.y),this.z=fe(this.z,e.z,n.z),this.w=fe(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=fe(this.x,e,n),this.y=fe(this.y,e,n),this.z=fe(this.z,e,n),this.w=fe(this.w,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(fe(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class tr{constructor(e=new B(1/0,1/0,1/0),n=new B(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(Ht.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(Ht.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=Ht.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const i=r.getAttribute("position");if(n===!0&&i!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=i.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Ht):Ht.fromBufferAttribute(i,a),Ht.applyMatrix4(e.matrixWorld),this.expandByPoint(Ht);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),oo.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),oo.copy(r.boundingBox)),oo.applyMatrix4(e.matrixWorld),this.union(oo)}const s=e.children;for(let i=0,a=s.length;i<a;i++)this.expandByObject(s[i],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Ht),Ht.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Di),co.subVectors(this.max,Di),Os.subVectors(e.a,Di),Ds.subVectors(e.b,Di),bs.subVectors(e.c,Di),cr.subVectors(Ds,Os),ur.subVectors(bs,Ds),Ir.subVectors(Os,bs);let n=[0,-cr.z,cr.y,0,-ur.z,ur.y,0,-Ir.z,Ir.y,cr.z,0,-cr.x,ur.z,0,-ur.x,Ir.z,0,-Ir.x,-cr.y,cr.x,0,-ur.y,ur.x,0,-Ir.y,Ir.x,0];return!Nu(n,Os,Ds,bs,co)||(n=[1,0,0,0,1,0,0,0,1],!Nu(n,Os,Ds,bs,co))?!1:(uo.crossVectors(cr,ur),n=[uo.x,uo.y,uo.z],Nu(n,Os,Ds,bs,co))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ht).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ht).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Fn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fn),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Fn=[new B,new B,new B,new B,new B,new B,new B,new B],Ht=new B,oo=new tr,Os=new B,Ds=new B,bs=new B,cr=new B,ur=new B,Ir=new B,Di=new B,co=new B,uo=new B,jr=new B;function Nu(t,e,n,r,s){for(let i=0,a=t.length-3;i<=a;i+=3){jr.fromArray(t,i);const o=s.x*Math.abs(jr.x)+s.y*Math.abs(jr.y)+s.z*Math.abs(jr.z),c=e.dot(jr),u=n.dot(jr),l=r.dot(jr);if(Math.max(-Math.max(c,u,l),Math.min(c,u,l))>o)return!1}return!0}const fN=new tr,bi=new B,Uu=new B;class bn{constructor(e=new B,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):fN.setFromPoints(e).getCenter(r);let s=0;for(let i=0,a=e.length;i<a;i++)s=Math.max(s,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;bi.subVectors(e,this.center);const n=bi.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),s=(r-this.radius)*.5;this.center.addScaledVector(bi,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Uu.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(bi.copy(e.center).add(Uu)),this.expandByPoint(bi.copy(e.center).sub(Uu))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Bn=new B,Gu=new B,fo=new B,fr=new B,Au=new B,lo=new B,zu=new B;class Hc{constructor(e=new B,n=new B(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Bn)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=Bn.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Bn.copy(this.origin).addScaledVector(this.direction,n),Bn.distanceToSquared(e))}distanceSqToSegment(e,n,r,s){Gu.copy(e).add(n).multiplyScalar(.5),fo.copy(n).sub(e).normalize(),fr.copy(this.origin).sub(Gu);const i=e.distanceTo(n)*.5,a=-this.direction.dot(fo),o=fr.dot(this.direction),c=-fr.dot(fo),u=fr.lengthSq(),l=Math.abs(1-a*a);let f,h,g,d;if(l>0)if(f=a*c-o,h=a*o-c,d=i*l,f>=0)if(h>=-d)if(h<=d){const p=1/l;f*=p,h*=p,g=f*(f+a*h+2*o)+h*(a*f+h+2*c)+u}else h=i,f=Math.max(0,-(a*h+o)),g=-f*f+h*(h+2*c)+u;else h=-i,f=Math.max(0,-(a*h+o)),g=-f*f+h*(h+2*c)+u;else h<=-d?(f=Math.max(0,-(-a*i+o)),h=f>0?-i:Math.min(Math.max(-i,-c),i),g=-f*f+h*(h+2*c)+u):h<=d?(f=0,h=Math.min(Math.max(-i,-c),i),g=h*(h+2*c)+u):(f=Math.max(0,-(a*i+o)),h=f>0?i:Math.min(Math.max(-i,-c),i),g=-f*f+h*(h+2*c)+u);else h=a>0?-i:i,f=Math.max(0,-(a*h+o)),g=-f*f+h*(h+2*c)+u;return r&&r.copy(this.origin).addScaledVector(this.direction,f),s&&s.copy(Gu).addScaledVector(fo,h),g}intersectSphere(e,n){Bn.subVectors(e.center,this.origin);const r=Bn.dot(this.direction),s=Bn.dot(Bn)-r*r,i=e.radius*e.radius;if(s>i)return null;const a=Math.sqrt(i-s),o=r-a,c=r+a;return c<0?null:o<0?this.at(c,n):this.at(o,n)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,s,i,a,o,c;const u=1/this.direction.x,l=1/this.direction.y,f=1/this.direction.z,h=this.origin;return u>=0?(r=(e.min.x-h.x)*u,s=(e.max.x-h.x)*u):(r=(e.max.x-h.x)*u,s=(e.min.x-h.x)*u),l>=0?(i=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(i=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),r>a||i>s||((i>r||isNaN(r))&&(r=i),(a<s||isNaN(s))&&(s=a),f>=0?(o=(e.min.z-h.z)*f,c=(e.max.z-h.z)*f):(o=(e.max.z-h.z)*f,c=(e.min.z-h.z)*f),r>c||o>s)||((o>r||r!==r)&&(r=o),(c<s||s!==s)&&(s=c),s<0)?null:this.at(r>=0?r:s,n)}intersectsBox(e){return this.intersectBox(e,Bn)!==null}intersectTriangle(e,n,r,s,i){Au.subVectors(n,e),lo.subVectors(r,e),zu.crossVectors(Au,lo);let a=this.direction.dot(zu),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;fr.subVectors(this.origin,e);const c=o*this.direction.dot(lo.crossVectors(fr,lo));if(c<0)return null;const u=o*this.direction.dot(Au.cross(fr));if(u<0||c+u>a)return null;const l=-o*fr.dot(zu);return l<0?null:this.at(l/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class xe{constructor(e,n,r,s,i,a,o,c,u,l,f,h,g,d,p,y){xe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,s,i,a,o,c,u,l,f,h,g,d,p,y)}set(e,n,r,s,i,a,o,c,u,l,f,h,g,d,p,y){const x=this.elements;return x[0]=e,x[4]=n,x[8]=r,x[12]=s,x[1]=i,x[5]=a,x[9]=o,x[13]=c,x[2]=u,x[6]=l,x[10]=f,x[14]=h,x[3]=g,x[7]=d,x[11]=p,x[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xe().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,s=1/Ls.setFromMatrixColumn(e,0).length(),i=1/Ls.setFromMatrixColumn(e,1).length(),a=1/Ls.setFromMatrixColumn(e,2).length();return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[3]=0,n[4]=r[4]*i,n[5]=r[5]*i,n[6]=r[6]*i,n[7]=0,n[8]=r[8]*a,n[9]=r[9]*a,n[10]=r[10]*a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,s=e.y,i=e.z,a=Math.cos(r),o=Math.sin(r),c=Math.cos(s),u=Math.sin(s),l=Math.cos(i),f=Math.sin(i);if(e.order==="XYZ"){const h=a*l,g=a*f,d=o*l,p=o*f;n[0]=c*l,n[4]=-c*f,n[8]=u,n[1]=g+d*u,n[5]=h-p*u,n[9]=-o*c,n[2]=p-h*u,n[6]=d+g*u,n[10]=a*c}else if(e.order==="YXZ"){const h=c*l,g=c*f,d=u*l,p=u*f;n[0]=h+p*o,n[4]=d*o-g,n[8]=a*u,n[1]=a*f,n[5]=a*l,n[9]=-o,n[2]=g*o-d,n[6]=p+h*o,n[10]=a*c}else if(e.order==="ZXY"){const h=c*l,g=c*f,d=u*l,p=u*f;n[0]=h-p*o,n[4]=-a*f,n[8]=d+g*o,n[1]=g+d*o,n[5]=a*l,n[9]=p-h*o,n[2]=-a*u,n[6]=o,n[10]=a*c}else if(e.order==="ZYX"){const h=a*l,g=a*f,d=o*l,p=o*f;n[0]=c*l,n[4]=d*u-g,n[8]=h*u+p,n[1]=c*f,n[5]=p*u+h,n[9]=g*u-d,n[2]=-u,n[6]=o*c,n[10]=a*c}else if(e.order==="YZX"){const h=a*c,g=a*u,d=o*c,p=o*u;n[0]=c*l,n[4]=p-h*f,n[8]=d*f+g,n[1]=f,n[5]=a*l,n[9]=-o*l,n[2]=-u*l,n[6]=g*f+d,n[10]=h-p*f}else if(e.order==="XZY"){const h=a*c,g=a*u,d=o*c,p=o*u;n[0]=c*l,n[4]=-f,n[8]=u*l,n[1]=h*f+p,n[5]=a*l,n[9]=g*f-d,n[2]=d*f-g,n[6]=o*l,n[10]=p*f+h}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(lN,e,hN)}lookAt(e,n,r){const s=this.elements;return Ot.subVectors(e,n),Ot.lengthSq()===0&&(Ot.z=1),Ot.normalize(),lr.crossVectors(r,Ot),lr.lengthSq()===0&&(Math.abs(r.z)===1?Ot.x+=1e-4:Ot.z+=1e-4,Ot.normalize(),lr.crossVectors(r,Ot)),lr.normalize(),ho.crossVectors(Ot,lr),s[0]=lr.x,s[4]=ho.x,s[8]=Ot.x,s[1]=lr.y,s[5]=ho.y,s[9]=Ot.y,s[2]=lr.z,s[6]=ho.z,s[10]=Ot.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,s=n.elements,i=this.elements,a=r[0],o=r[4],c=r[8],u=r[12],l=r[1],f=r[5],h=r[9],g=r[13],d=r[2],p=r[6],y=r[10],x=r[14],m=r[3],T=r[7],v=r[11],S=r[15],w=s[0],M=s[4],E=s[8],D=s[12],O=s[1],_=s[5],V=s[9],L=s[13],F=s[2],G=s[6],A=s[10],H=s[14],P=s[3],U=s[7],Y=s[11],ee=s[15];return i[0]=a*w+o*O+c*F+u*P,i[4]=a*M+o*_+c*G+u*U,i[8]=a*E+o*V+c*A+u*Y,i[12]=a*D+o*L+c*H+u*ee,i[1]=l*w+f*O+h*F+g*P,i[5]=l*M+f*_+h*G+g*U,i[9]=l*E+f*V+h*A+g*Y,i[13]=l*D+f*L+h*H+g*ee,i[2]=d*w+p*O+y*F+x*P,i[6]=d*M+p*_+y*G+x*U,i[10]=d*E+p*V+y*A+x*Y,i[14]=d*D+p*L+y*H+x*ee,i[3]=m*w+T*O+v*F+S*P,i[7]=m*M+T*_+v*G+S*U,i[11]=m*E+T*V+v*A+S*Y,i[15]=m*D+T*L+v*H+S*ee,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],s=e[8],i=e[12],a=e[1],o=e[5],c=e[9],u=e[13],l=e[2],f=e[6],h=e[10],g=e[14],d=e[3],p=e[7],y=e[11],x=e[15];return d*(+i*c*f-s*u*f-i*o*h+r*u*h+s*o*g-r*c*g)+p*(+n*c*g-n*u*h+i*a*h-s*a*g+s*u*l-i*c*l)+y*(+n*u*f-n*o*g-i*a*f+r*a*g+i*o*l-r*u*l)+x*(-s*o*l-n*c*f+n*o*h+s*a*f-r*a*h+r*c*l)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=n,s[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],u=e[7],l=e[8],f=e[9],h=e[10],g=e[11],d=e[12],p=e[13],y=e[14],x=e[15],m=f*y*u-p*h*u+p*c*g-o*y*g-f*c*x+o*h*x,T=d*h*u-l*y*u-d*c*g+a*y*g+l*c*x-a*h*x,v=l*p*u-d*f*u+d*o*g-a*p*g-l*o*x+a*f*x,S=d*f*c-l*p*c-d*o*h+a*p*h+l*o*y-a*f*y,w=n*m+r*T+s*v+i*S;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/w;return e[0]=m*M,e[1]=(p*h*i-f*y*i-p*s*g+r*y*g+f*s*x-r*h*x)*M,e[2]=(o*y*i-p*c*i+p*s*u-r*y*u-o*s*x+r*c*x)*M,e[3]=(f*c*i-o*h*i-f*s*u+r*h*u+o*s*g-r*c*g)*M,e[4]=T*M,e[5]=(l*y*i-d*h*i+d*s*g-n*y*g-l*s*x+n*h*x)*M,e[6]=(d*c*i-a*y*i-d*s*u+n*y*u+a*s*x-n*c*x)*M,e[7]=(a*h*i-l*c*i+l*s*u-n*h*u-a*s*g+n*c*g)*M,e[8]=v*M,e[9]=(d*f*i-l*p*i-d*r*g+n*p*g+l*r*x-n*f*x)*M,e[10]=(a*p*i-d*o*i+d*r*u-n*p*u-a*r*x+n*o*x)*M,e[11]=(l*o*i-a*f*i-l*r*u+n*f*u+a*r*g-n*o*g)*M,e[12]=S*M,e[13]=(l*p*s-d*f*s+d*r*h-n*p*h-l*r*y+n*f*y)*M,e[14]=(d*o*s-a*p*s-d*r*c+n*p*c+a*r*y-n*o*y)*M,e[15]=(a*f*s-l*o*s+l*r*c-n*f*c-a*r*h+n*o*h)*M,this}scale(e){const n=this.elements,r=e.x,s=e.y,i=e.z;return n[0]*=r,n[4]*=s,n[8]*=i,n[1]*=r,n[5]*=s,n[9]*=i,n[2]*=r,n[6]*=s,n[10]*=i,n[3]*=r,n[7]*=s,n[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,s))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),s=Math.sin(n),i=1-r,a=e.x,o=e.y,c=e.z,u=i*a,l=i*o;return this.set(u*a+r,u*o-s*c,u*c+s*o,0,u*o+s*c,l*o+r,l*c-s*a,0,u*c-s*o,l*c+s*a,i*c*c+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,s,i,a){return this.set(1,r,i,0,e,1,a,0,n,s,1,0,0,0,0,1),this}compose(e,n,r){const s=this.elements,i=n._x,a=n._y,o=n._z,c=n._w,u=i+i,l=a+a,f=o+o,h=i*u,g=i*l,d=i*f,p=a*l,y=a*f,x=o*f,m=c*u,T=c*l,v=c*f,S=r.x,w=r.y,M=r.z;return s[0]=(1-(p+x))*S,s[1]=(g+v)*S,s[2]=(d-T)*S,s[3]=0,s[4]=(g-v)*w,s[5]=(1-(h+x))*w,s[6]=(y+m)*w,s[7]=0,s[8]=(d+T)*M,s[9]=(y-m)*M,s[10]=(1-(h+p))*M,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,n,r){const s=this.elements;let i=Ls.set(s[0],s[1],s[2]).length();const a=Ls.set(s[4],s[5],s[6]).length(),o=Ls.set(s[8],s[9],s[10]).length();this.determinant()<0&&(i=-i),e.x=s[12],e.y=s[13],e.z=s[14],It.copy(this);const u=1/i,l=1/a,f=1/o;return It.elements[0]*=u,It.elements[1]*=u,It.elements[2]*=u,It.elements[4]*=l,It.elements[5]*=l,It.elements[6]*=l,It.elements[8]*=f,It.elements[9]*=f,It.elements[10]*=f,n.setFromRotationMatrix(It),r.x=i,r.y=a,r.z=o,this}makePerspective(e,n,r,s,i,a,o=rs){const c=this.elements,u=2*i/(n-e),l=2*i/(r-s),f=(n+e)/(n-e),h=(r+s)/(r-s);let g,d;if(o===rs)g=-(a+i)/(a-i),d=-2*a*i/(a-i);else if(o===ol)g=-a/(a-i),d=-a*i/(a-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=l,c[9]=h,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=d,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,n,r,s,i,a,o=rs){const c=this.elements,u=1/(n-e),l=1/(r-s),f=1/(a-i),h=(n+e)*u,g=(r+s)*l;let d,p;if(o===rs)d=(a+i)*f,p=-2*f;else if(o===ol)d=i*f,p=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-h,c[1]=0,c[5]=2*l,c[9]=0,c[13]=-g,c[2]=0,c[6]=0,c[10]=p,c[14]=-d,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let s=0;s<16;s++)if(n[s]!==r[s])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const Ls=new B,It=new xe,lN=new B(0,0,0),hN=new B(1,1,1),lr=new B,ho=new B,Ot=new B,dd=new xe,yd=new Vr;class vi{constructor(e=0,n=0,r=0,s=vi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,s=this._order){return this._x=e,this._y=n,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const s=e.elements,i=s[0],a=s[4],o=s[8],c=s[1],u=s[5],l=s[9],f=s[2],h=s[6],g=s[10];switch(n){case"XYZ":this._y=Math.asin(fe(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,g),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-fe(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,g),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-f,i),this._z=0);break;case"ZXY":this._x=Math.asin(fe(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-f,g),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,i));break;case"ZYX":this._y=Math.asin(-fe(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(h,g),this._z=Math.atan2(c,i)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(fe(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-f,i)):(this._x=0,this._y=Math.atan2(o,g));break;case"XZY":this._z=Math.asin(-fe(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-l,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return dd.makeRotationFromQuaternion(e),this.setFromRotationMatrix(dd,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return yd.setFromEuler(this),this.setFromQuaternion(yd,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vi.DEFAULT_ORDER="XYZ";class gN{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let pN=0;const xd=new B,Vs=new Vr,kn=new xe,go=new B,Li=new B,dN=new B,yN=new Vr,Td=new B(1,0,0),vd=new B(0,1,0),md=new B(0,0,1),Sd={type:"added"},xN={type:"removed"},Fs={type:"childadded",child:null},$u={type:"childremoved",child:null};class ze extends Wc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:pN++}),this.uuid=un(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ze.DEFAULT_UP.clone();const e=new B,n=new vi,r=new Vr,s=new B(1,1,1);function i(){r.setFromEuler(n,!1)}function a(){n.setFromQuaternion(r,void 0,!1)}n._onChange(i),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new xe},normalMatrix:{value:new er}}),this.matrix=new xe,this.matrixWorld=new xe,this.matrixAutoUpdate=ze.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ze.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new gN,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return Vs.setFromAxisAngle(e,n),this.quaternion.multiply(Vs),this}rotateOnWorldAxis(e,n){return Vs.setFromAxisAngle(e,n),this.quaternion.premultiply(Vs),this}rotateX(e){return this.rotateOnAxis(Td,e)}rotateY(e){return this.rotateOnAxis(vd,e)}rotateZ(e){return this.rotateOnAxis(md,e)}translateOnAxis(e,n){return xd.copy(e).applyQuaternion(this.quaternion),this.position.add(xd.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(Td,e)}translateY(e){return this.translateOnAxis(vd,e)}translateZ(e){return this.translateOnAxis(md,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(kn.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?go.copy(e):go.set(e,n,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Li.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?kn.lookAt(Li,go,this.up):kn.lookAt(go,Li,this.up),this.quaternion.setFromRotationMatrix(kn),s&&(kn.extractRotation(s.matrixWorld),Vs.setFromRotationMatrix(kn),this.quaternion.premultiply(Vs.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Sd),Fs.child=e,this.dispatchEvent(Fs),Fs.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(xN),$u.child=e,this.dispatchEvent($u),$u.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),kn.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),kn.multiply(e.parent.matrixWorld)),e.applyMatrix4(kn),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Sd),Fs.child=e,this.dispatchEvent(Fs),Fs.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(e,n);if(a!==void 0)return a}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const s=this.children;for(let i=0,a=s.length;i<a;i++)s[i].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Li,e,dN),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Li,yN,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].updateMatrixWorld(e)}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const s=this.children;for(let i=0,a=s.length;i<a;i++)s[i].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(e),s.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function i(o,c){return o[c.uuid]===void 0&&(o[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=i(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const c=o.shapes;if(Array.isArray(c))for(let u=0,l=c.length;u<l;u++){const f=c[u];i(e.shapes,f)}else i(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(i(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let c=0,u=this.material.length;c<u;c++)o.push(i(e.materials,this.material[c]));s.material=o}else s.material=i(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const c=this.animations[o];s.animations.push(i(e.animations,c))}}if(n){const o=a(e.geometries),c=a(e.materials),u=a(e.textures),l=a(e.images),f=a(e.shapes),h=a(e.skeletons),g=a(e.animations),d=a(e.nodes);o.length>0&&(r.geometries=o),c.length>0&&(r.materials=c),u.length>0&&(r.textures=u),l.length>0&&(r.images=l),f.length>0&&(r.shapes=f),h.length>0&&(r.skeletons=h),g.length>0&&(r.animations=g),d.length>0&&(r.nodes=d)}return r.object=s,r;function a(o){const c=[];for(const u in o){const l=o[u];delete l.metadata,c.push(l)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}}ze.DEFAULT_UP=new B(0,1,0);ze.DEFAULT_MATRIX_AUTO_UPDATE=!0;ze.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const jt=new B,Nn=new B,Wu=new B,Un=new B,Bs=new B,ks=new B,wd=new B,Hu=new B,Iu=new B,ju=new B,Pu=new St,Ku=new St,Xu=new St;class nn{constructor(e=new B,n=new B,r=new B){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,s){s.subVectors(r,n),jt.subVectors(e,n),s.cross(jt);const i=s.lengthSq();return i>0?s.multiplyScalar(1/Math.sqrt(i)):s.set(0,0,0)}static getBarycoord(e,n,r,s,i){jt.subVectors(s,n),Nn.subVectors(r,n),Wu.subVectors(e,n);const a=jt.dot(jt),o=jt.dot(Nn),c=jt.dot(Wu),u=Nn.dot(Nn),l=Nn.dot(Wu),f=a*u-o*o;if(f===0)return i.set(0,0,0),null;const h=1/f,g=(u*c-o*l)*h,d=(a*l-o*c)*h;return i.set(1-g-d,d,g)}static containsPoint(e,n,r,s){return this.getBarycoord(e,n,r,s,Un)===null?!1:Un.x>=0&&Un.y>=0&&Un.x+Un.y<=1}static getInterpolation(e,n,r,s,i,a,o,c){return this.getBarycoord(e,n,r,s,Un)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(i,Un.x),c.addScaledVector(a,Un.y),c.addScaledVector(o,Un.z),c)}static getInterpolatedAttribute(e,n,r,s,i,a){return Pu.setScalar(0),Ku.setScalar(0),Xu.setScalar(0),Pu.fromBufferAttribute(e,n),Ku.fromBufferAttribute(e,r),Xu.fromBufferAttribute(e,s),a.setScalar(0),a.addScaledVector(Pu,i.x),a.addScaledVector(Ku,i.y),a.addScaledVector(Xu,i.z),a}static isFrontFacing(e,n,r,s){return jt.subVectors(r,n),Nn.subVectors(e,n),jt.cross(Nn).dot(s)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,s){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,n,r,s){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return jt.subVectors(this.c,this.b),Nn.subVectors(this.a,this.b),jt.cross(Nn).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return nn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return nn.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,s,i){return nn.getInterpolation(e,this.a,this.b,this.c,n,r,s,i)}containsPoint(e){return nn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return nn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,s=this.b,i=this.c;let a,o;Bs.subVectors(s,r),ks.subVectors(i,r),Hu.subVectors(e,r);const c=Bs.dot(Hu),u=ks.dot(Hu);if(c<=0&&u<=0)return n.copy(r);Iu.subVectors(e,s);const l=Bs.dot(Iu),f=ks.dot(Iu);if(l>=0&&f<=l)return n.copy(s);const h=c*f-l*u;if(h<=0&&c>=0&&l<=0)return a=c/(c-l),n.copy(r).addScaledVector(Bs,a);ju.subVectors(e,i);const g=Bs.dot(ju),d=ks.dot(ju);if(d>=0&&g<=d)return n.copy(i);const p=g*u-c*d;if(p<=0&&u>=0&&d<=0)return o=u/(u-d),n.copy(r).addScaledVector(ks,o);const y=l*d-g*f;if(y<=0&&f-l>=0&&g-d>=0)return wd.subVectors(i,s),o=(f-l)/(f-l+(g-d)),n.copy(s).addScaledVector(wd,o);const x=1/(y+p+h);return a=p*x,o=h*x,n.copy(r).addScaledVector(Bs,a).addScaledVector(ks,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Rv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},hr={h:0,s:0,l:0},po={h:0,s:0,l:0};function Yu(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class qe{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=lt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,bt.colorSpaceToWorking(this,n),this}setRGB(e,n,r,s=bt.workingColorSpace){return this.r=e,this.g=n,this.b=r,bt.colorSpaceToWorking(this,s),this}setHSL(e,n,r,s=bt.workingColorSpace){if(e=bh(e,1),n=fe(n,0,1),r=fe(r,0,1),n===0)this.r=this.g=this.b=r;else{const i=r<=.5?r*(1+n):r+n-r*n,a=2*r-i;this.r=Yu(a,i,e+1/3),this.g=Yu(a,i,e),this.b=Yu(a,i,e-1/3)}return bt.colorSpaceToWorking(this,s),this}setStyle(e,n=lt){function r(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,n);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,n);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=s[1],a=i.length;if(a===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,n);if(a===6)return this.setHex(parseInt(i,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=lt){const r=Rv[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Yn(e.r),this.g=Yn(e.g),this.b=Yn(e.b),this}copyLinearToSRGB(e){return this.r=Zs(e.r),this.g=Zs(e.g),this.b=Zs(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=lt){return bt.workingToColorSpace(ft.copy(this),e),Math.round(fe(ft.r*255,0,255))*65536+Math.round(fe(ft.g*255,0,255))*256+Math.round(fe(ft.b*255,0,255))}getHexString(e=lt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=bt.workingColorSpace){bt.workingToColorSpace(ft.copy(this),n);const r=ft.r,s=ft.g,i=ft.b,a=Math.max(r,s,i),o=Math.min(r,s,i);let c,u;const l=(o+a)/2;if(o===a)c=0,u=0;else{const f=a-o;switch(u=l<=.5?f/(a+o):f/(2-a-o),a){case r:c=(s-i)/f+(s<i?6:0);break;case s:c=(i-r)/f+2;break;case i:c=(r-s)/f+4;break}c/=6}return e.h=c,e.s=u,e.l=l,e}getRGB(e,n=bt.workingColorSpace){return bt.workingToColorSpace(ft.copy(this),n),e.r=ft.r,e.g=ft.g,e.b=ft.b,e}getStyle(e=lt){bt.workingToColorSpace(ft.copy(this),e);const n=ft.r,r=ft.g,s=ft.b;return e!==lt?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(s*255)})`}offsetHSL(e,n,r){return this.getHSL(hr),this.setHSL(hr.h+e,hr.s+n,hr.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(hr),e.getHSL(po);const r=ea(hr.h,po.h,n),s=ea(hr.s,po.s,n),i=ea(hr.l,po.l,n);return this.setHSL(r,s,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,s=this.b,i=e.elements;return this.r=i[0]*n+i[3]*r+i[6]*s,this.g=i[1]*n+i[4]*r+i[7]*s,this.b=i[2]*n+i[5]*r+i[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ft=new qe;qe.NAMES=Rv;let TN=0;class ls extends Wc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:TN++}),this.uuid=un(),this.name="",this.type="Material",this.blending=Qp,this.side=yc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ed,this.blendDst=td,this.blendEquation=Jp,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new qe(0,0,0),this.blendAlpha=0,this.depthFunc=nd,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=cd,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=_s,this.stencilZFail=_s,this.stencilZPass=_s,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const s=this[n];if(s===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Qp&&(r.blending=this.blending),this.side!==yc&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==ed&&(r.blendSrc=this.blendSrc),this.blendDst!==td&&(r.blendDst=this.blendDst),this.blendEquation!==Jp&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==nd&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==cd&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==_s&&(r.stencilFail=this.stencilFail),this.stencilZFail!==_s&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==_s&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function s(i){const a=[];for(const o in i){const c=i[o];delete c.metadata,a.push(c)}return a}if(n){const i=s(e.textures),a=s(e.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const s=n.length;r=new Array(s);for(let i=0;i!==s;++i)r[i]=n[i].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class js extends ls{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vi,this.combine=Vk,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const He=new B,yo=new Ie;let vN=0;class ln{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:vN++}),this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=al,this.updateRanges=[],this.gpuType=Dh,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let s=0,i=this.itemSize;s<i;s++)this.array[e+s]=n.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)yo.fromBufferAttribute(this,n),yo.applyMatrix3(e),this.setXY(n,yo.x,yo.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)He.fromBufferAttribute(this,n),He.applyMatrix3(e),this.setXYZ(n,He.x,He.y,He.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)He.fromBufferAttribute(this,n),He.applyMatrix4(e),this.setXYZ(n,He.x,He.y,He.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)He.fromBufferAttribute(this,n),He.applyNormalMatrix(e),this.setXYZ(n,He.x,He.y,He.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)He.fromBufferAttribute(this,n),He.transformDirection(e),this.setXYZ(n,He.x,He.y,He.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=tn(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=Me(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=tn(n,this.array)),n}setX(e,n){return this.normalized&&(n=Me(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=tn(n,this.array)),n}setY(e,n){return this.normalized&&(n=Me(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=tn(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Me(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=tn(n,this.array)),n}setW(e,n){return this.normalized&&(n=Me(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=Me(n,this.array),r=Me(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,s){return e*=this.itemSize,this.normalized&&(n=Me(n,this.array),r=Me(r,this.array),s=Me(s,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,n,r,s,i){return e*=this.itemSize,this.normalized&&(n=Me(n,this.array),r=Me(r,this.array),s=Me(s,this.array),i=Me(i,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==al&&(e.usage=this.usage),e}}class mN extends ln{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class SN extends ln{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class Lh extends ln{constructor(e,n,r){super(new Float32Array(e),n,r)}}let wN=0;const Bt=new xe,qu=new ze,Ns=new B,Dt=new tr,Vi=new tr,et=new B;class mi extends Wc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:wN++}),this.uuid=un(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(sN(e)?SN:mN)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const i=new er().getNormalMatrix(e);r.applyNormalMatrix(i),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Bt.makeRotationFromQuaternion(e),this.applyMatrix4(Bt),this}rotateX(e){return Bt.makeRotationX(e),this.applyMatrix4(Bt),this}rotateY(e){return Bt.makeRotationY(e),this.applyMatrix4(Bt),this}rotateZ(e){return Bt.makeRotationZ(e),this.applyMatrix4(Bt),this}translate(e,n,r){return Bt.makeTranslation(e,n,r),this.applyMatrix4(Bt),this}scale(e,n,r){return Bt.makeScale(e,n,r),this.applyMatrix4(Bt),this}lookAt(e){return qu.lookAt(e),qu.updateMatrix(),this.applyMatrix4(qu.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ns).negate(),this.translate(Ns.x,Ns.y,Ns.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const r=[];for(let s=0,i=e.length;s<i;s++){const a=e[s];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Lh(r,3))}else{const r=Math.min(e.length,n.count);for(let s=0;s<r;s++){const i=e[s];n.setXYZ(s,i.x,i.y,i.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new tr);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new B(-1/0,-1/0,-1/0),new B(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,s=n.length;r<s;r++){const i=n[r];Dt.setFromBufferAttribute(i),this.morphTargetsRelative?(et.addVectors(this.boundingBox.min,Dt.min),this.boundingBox.expandByPoint(et),et.addVectors(this.boundingBox.max,Dt.max),this.boundingBox.expandByPoint(et)):(this.boundingBox.expandByPoint(Dt.min),this.boundingBox.expandByPoint(Dt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new bn);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new B,1/0);return}if(e){const r=this.boundingSphere.center;if(Dt.setFromBufferAttribute(e),n)for(let i=0,a=n.length;i<a;i++){const o=n[i];Vi.setFromBufferAttribute(o),this.morphTargetsRelative?(et.addVectors(Dt.min,Vi.min),Dt.expandByPoint(et),et.addVectors(Dt.max,Vi.max),Dt.expandByPoint(et)):(Dt.expandByPoint(Vi.min),Dt.expandByPoint(Vi.max))}Dt.getCenter(r);let s=0;for(let i=0,a=e.count;i<a;i++)et.fromBufferAttribute(e,i),s=Math.max(s,r.distanceToSquared(et));if(n)for(let i=0,a=n.length;i<a;i++){const o=n[i],c=this.morphTargetsRelative;for(let u=0,l=o.count;u<l;u++)et.fromBufferAttribute(o,u),c&&(Ns.fromBufferAttribute(e,u),et.add(Ns)),s=Math.max(s,r.distanceToSquared(et))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,s=n.normal,i=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ln(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],c=[];for(let E=0;E<r.count;E++)o[E]=new B,c[E]=new B;const u=new B,l=new B,f=new B,h=new Ie,g=new Ie,d=new Ie,p=new B,y=new B;function x(E,D,O){u.fromBufferAttribute(r,E),l.fromBufferAttribute(r,D),f.fromBufferAttribute(r,O),h.fromBufferAttribute(i,E),g.fromBufferAttribute(i,D),d.fromBufferAttribute(i,O),l.sub(u),f.sub(u),g.sub(h),d.sub(h);const _=1/(g.x*d.y-d.x*g.y);isFinite(_)&&(p.copy(l).multiplyScalar(d.y).addScaledVector(f,-g.y).multiplyScalar(_),y.copy(f).multiplyScalar(g.x).addScaledVector(l,-d.x).multiplyScalar(_),o[E].add(p),o[D].add(p),o[O].add(p),c[E].add(y),c[D].add(y),c[O].add(y))}let m=this.groups;m.length===0&&(m=[{start:0,count:e.count}]);for(let E=0,D=m.length;E<D;++E){const O=m[E],_=O.start,V=O.count;for(let L=_,F=_+V;L<F;L+=3)x(e.getX(L+0),e.getX(L+1),e.getX(L+2))}const T=new B,v=new B,S=new B,w=new B;function M(E){S.fromBufferAttribute(s,E),w.copy(S);const D=o[E];T.copy(D),T.sub(S.multiplyScalar(S.dot(D))).normalize(),v.crossVectors(w,D);const _=v.dot(c[E])<0?-1:1;a.setXYZW(E,T.x,T.y,T.z,_)}for(let E=0,D=m.length;E<D;++E){const O=m[E],_=O.start,V=O.count;for(let L=_,F=_+V;L<F;L+=3)M(e.getX(L+0)),M(e.getX(L+1)),M(e.getX(L+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new ln(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let h=0,g=r.count;h<g;h++)r.setXYZ(h,0,0,0);const s=new B,i=new B,a=new B,o=new B,c=new B,u=new B,l=new B,f=new B;if(e)for(let h=0,g=e.count;h<g;h+=3){const d=e.getX(h+0),p=e.getX(h+1),y=e.getX(h+2);s.fromBufferAttribute(n,d),i.fromBufferAttribute(n,p),a.fromBufferAttribute(n,y),l.subVectors(a,i),f.subVectors(s,i),l.cross(f),o.fromBufferAttribute(r,d),c.fromBufferAttribute(r,p),u.fromBufferAttribute(r,y),o.add(l),c.add(l),u.add(l),r.setXYZ(d,o.x,o.y,o.z),r.setXYZ(p,c.x,c.y,c.z),r.setXYZ(y,u.x,u.y,u.z)}else for(let h=0,g=n.count;h<g;h+=3)s.fromBufferAttribute(n,h+0),i.fromBufferAttribute(n,h+1),a.fromBufferAttribute(n,h+2),l.subVectors(a,i),f.subVectors(s,i),l.cross(f),r.setXYZ(h+0,l.x,l.y,l.z),r.setXYZ(h+1,l.x,l.y,l.z),r.setXYZ(h+2,l.x,l.y,l.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)et.fromBufferAttribute(e,n),et.normalize(),e.setXYZ(n,et.x,et.y,et.z)}toNonIndexed(){function e(o,c){const u=o.array,l=o.itemSize,f=o.normalized,h=new u.constructor(c.length*l);let g=0,d=0;for(let p=0,y=c.length;p<y;p++){o.isInterleavedBufferAttribute?g=c[p]*o.data.stride+o.offset:g=c[p]*l;for(let x=0;x<l;x++)h[d++]=u[g++]}return new ln(h,l,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new mi,r=this.index.array,s=this.attributes;for(const o in s){const c=s[o],u=e(c,r);n.setAttribute(o,u)}const i=this.morphAttributes;for(const o in i){const c=[],u=i[o];for(let l=0,f=u.length;l<f;l++){const h=u[l],g=e(h,r);c.push(g)}n.morphAttributes[o]=c}n.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,c=a.length;o<c;o++){const u=a[o];n.addGroup(u.start,u.count,u.materialIndex)}return n}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const u in c)c[u]!==void 0&&(e[u]=c[u]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const c in r){const u=r[c];e.data.attributes[c]=u.toJSON(e.data)}const s={};let i=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],l=[];for(let f=0,h=u.length;f<h;f++){const g=u[f];l.push(g.toJSON(e.data))}l.length>0&&(s[c]=l,i=!0)}i&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const s=e.attributes;for(const u in s){const l=s[u];this.setAttribute(u,l.clone(n))}const i=e.morphAttributes;for(const u in i){const l=[],f=i[u];for(let h=0,g=f.length;h<g;h++)l.push(f[h].clone(n));this.morphAttributes[u]=l}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,l=a.length;u<l;u++){const f=a[u];this.addGroup(f.start,f.count,f.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Cd=new xe,Pr=new Hc,xo=new bn,Md=new B,To=new B,vo=new B,mo=new B,Zu=new B,So=new B,Ed=new B,wo=new B;class _a extends ze{constructor(e=new mi,n=new js){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const s=n[r[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,a=s.length;i<a;i++){const o=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}getVertexPosition(e,n){const r=this.geometry,s=r.attributes.position,i=r.morphAttributes.position,a=r.morphTargetsRelative;n.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(i&&o){So.set(0,0,0);for(let c=0,u=i.length;c<u;c++){const l=o[c],f=i[c];l!==0&&(Zu.fromBufferAttribute(f,e),a?So.addScaledVector(Zu,l):So.addScaledVector(Zu.sub(n),l))}n.add(So)}return n}raycast(e,n){const r=this.geometry,s=this.material,i=this.matrixWorld;s!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),xo.copy(r.boundingSphere),xo.applyMatrix4(i),Pr.copy(e.ray).recast(e.near),!(xo.containsPoint(Pr.origin)===!1&&(Pr.intersectSphere(xo,Md)===null||Pr.origin.distanceToSquared(Md)>(e.far-e.near)**2))&&(Cd.copy(i).invert(),Pr.copy(e.ray).applyMatrix4(Cd),!(r.boundingBox!==null&&Pr.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,Pr)))}_computeIntersections(e,n,r){let s;const i=this.geometry,a=this.material,o=i.index,c=i.attributes.position,u=i.attributes.uv,l=i.attributes.uv1,f=i.attributes.normal,h=i.groups,g=i.drawRange;if(o!==null)if(Array.isArray(a))for(let d=0,p=h.length;d<p;d++){const y=h[d],x=a[y.materialIndex],m=Math.max(y.start,g.start),T=Math.min(o.count,Math.min(y.start+y.count,g.start+g.count));for(let v=m,S=T;v<S;v+=3){const w=o.getX(v),M=o.getX(v+1),E=o.getX(v+2);s=Co(this,x,e,r,u,l,f,w,M,E),s&&(s.faceIndex=Math.floor(v/3),s.face.materialIndex=y.materialIndex,n.push(s))}}else{const d=Math.max(0,g.start),p=Math.min(o.count,g.start+g.count);for(let y=d,x=p;y<x;y+=3){const m=o.getX(y),T=o.getX(y+1),v=o.getX(y+2);s=Co(this,a,e,r,u,l,f,m,T,v),s&&(s.faceIndex=Math.floor(y/3),n.push(s))}}else if(c!==void 0)if(Array.isArray(a))for(let d=0,p=h.length;d<p;d++){const y=h[d],x=a[y.materialIndex],m=Math.max(y.start,g.start),T=Math.min(c.count,Math.min(y.start+y.count,g.start+g.count));for(let v=m,S=T;v<S;v+=3){const w=v,M=v+1,E=v+2;s=Co(this,x,e,r,u,l,f,w,M,E),s&&(s.faceIndex=Math.floor(v/3),s.face.materialIndex=y.materialIndex,n.push(s))}}else{const d=Math.max(0,g.start),p=Math.min(c.count,g.start+g.count);for(let y=d,x=p;y<x;y+=3){const m=y,T=y+1,v=y+2;s=Co(this,a,e,r,u,l,f,m,T,v),s&&(s.faceIndex=Math.floor(y/3),n.push(s))}}}}function CN(t,e,n,r,s,i,a,o){let c;if(e.side===bk?c=r.intersectTriangle(a,i,s,!0,o):c=r.intersectTriangle(s,i,a,e.side===yc,o),c===null)return null;wo.copy(o),wo.applyMatrix4(t.matrixWorld);const u=n.ray.origin.distanceTo(wo);return u<n.near||u>n.far?null:{distance:u,point:wo.clone(),object:t}}function Co(t,e,n,r,s,i,a,o,c,u){t.getVertexPosition(o,To),t.getVertexPosition(c,vo),t.getVertexPosition(u,mo);const l=CN(t,e,n,r,To,vo,mo,Ed);if(l){const f=new B;nn.getBarycoord(Ed,To,vo,mo,f),s&&(l.uv=nn.getInterpolatedAttribute(s,o,c,u,f,new Ie)),i&&(l.uv1=nn.getInterpolatedAttribute(i,o,c,u,f,new Ie)),a&&(l.normal=nn.getInterpolatedAttribute(a,o,c,u,f,new B),l.normal.dot(r.direction)>0&&l.normal.multiplyScalar(-1));const h={a:o,b:c,c:u,normal:new B,materialIndex:0};nn.getNormal(To,vo,mo,h.normal),l.face=h,l.barycoord=f}return l}class Ov extends ze{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new xe,this.projectionMatrix=new xe,this.projectionMatrixInverse=new xe,this.coordinateSystem=rs}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const gr=new B,_d=new Ie,Rd=new Ie;class Vh extends Ov{constructor(e=50,n=1,r=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=s,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=Ta*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ji*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Ta*2*Math.atan(Math.tan(Ji*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){gr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(gr.x,gr.y).multiplyScalar(-e/gr.z),gr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(gr.x,gr.y).multiplyScalar(-e/gr.z)}getViewSize(e,n){return this.getViewBounds(e,_d,Rd),n.subVectors(Rd,_d)}setViewOffset(e,n,r,s,i,a){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=s,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(Ji*.5*this.fov)/this.zoom,r=2*n,s=this.aspect*r,i=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,u=a.fullHeight;i+=a.offsetX*s/c,n-=a.offsetY*r/u,s*=a.width/c,r*=a.height/u}const o=this.filmOffset;o!==0&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+s,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}class Qu extends ze{constructor(){super(),this.isGroup=!0,this.type="Group"}}class MN{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=al,this.updateRanges=[],this.version=0,this.uuid=un()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,r){e*=this.stride,r*=n.stride;for(let s=0,i=this.stride;s<i;s++)this.array[e+s]=n.array[r+s];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=un()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(n,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=un()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Tt=new B;class Fh{constructor(e,n,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,r=this.data.count;n<r;n++)Tt.fromBufferAttribute(this,n),Tt.applyMatrix4(e),this.setXYZ(n,Tt.x,Tt.y,Tt.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)Tt.fromBufferAttribute(this,n),Tt.applyNormalMatrix(e),this.setXYZ(n,Tt.x,Tt.y,Tt.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)Tt.fromBufferAttribute(this,n),Tt.transformDirection(e),this.setXYZ(n,Tt.x,Tt.y,Tt.z);return this}getComponent(e,n){let r=this.array[e*this.data.stride+this.offset+n];return this.normalized&&(r=tn(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=Me(r,this.array)),this.data.array[e*this.data.stride+this.offset+n]=r,this}setX(e,n){return this.normalized&&(n=Me(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=Me(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=Me(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=Me(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=tn(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=tn(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=tn(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=tn(n,this.array)),n}setXY(e,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=Me(n,this.array),r=Me(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this}setXYZ(e,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(n=Me(n,this.array),r=Me(r,this.array),s=Me(s,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,n,r,s,i){return e=e*this.data.stride+this.offset,this.normalized&&(n=Me(n,this.array),r=Me(r,this.array),s=Me(s,this.array),i=Me(i,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=i,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)n.push(this.data.array[s+i])}return new ln(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Fh(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)n.push(this.data.array[s+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Od=new B,Dd=new St,bd=new St,EN=new B,Ld=new xe,Mo=new B,Ju=new bn,Vd=new xe,ef=new Hc;class _N extends _a{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=rd,this.bindMatrix=new xe,this.bindMatrixInverse=new xe,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new tr),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)this.getVertexPosition(r,Mo),this.boundingBox.expandByPoint(Mo)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new bn),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)this.getVertexPosition(r,Mo),this.boundingSphere.expandByPoint(Mo)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const r=this.material,s=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Ju.copy(this.boundingSphere),Ju.applyMatrix4(s),e.ray.intersectsSphere(Ju)!==!1&&(Vd.copy(s).invert(),ef.copy(e.ray).applyMatrix4(Vd),!(this.boundingBox!==null&&ef.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,ef)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new St,n=this.geometry.attributes.skinWeight;for(let r=0,s=n.count;r<s;r++){e.fromBufferAttribute(n,r);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),n.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===rd?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Fk?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const r=this.skeleton,s=this.geometry;Dd.fromBufferAttribute(s.attributes.skinIndex,e),bd.fromBufferAttribute(s.attributes.skinWeight,e),Od.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let i=0;i<4;i++){const a=bd.getComponent(i);if(a!==0){const o=Dd.getComponent(i);Ld.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),n.addScaledVector(EN.copy(Od).applyMatrix4(Ld),a)}}return n.applyMatrix4(this.bindMatrixInverse)}}class Dv extends ze{constructor(){super(),this.isBone=!0,this.type="Bone"}}class bv extends fn{constructor(e=null,n=1,r=1,s,i,a,o,c,u=xc,l=xc,f,h){super(null,a,o,c,u,l,s,i,f,h),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Fd=new xe,RN=new xe;class Bh{constructor(e=[],n=[]){this.uuid=un(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,s=this.bones.length;r<s;r++)this.boneInverses.push(new xe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const r=new xe;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,n=this.boneInverses,r=this.boneMatrices,s=this.boneTexture;for(let i=0,a=e.length;i<a;i++){const o=e[i]?e[i].matrixWorld:RN;Fd.multiplyMatrices(o,n[i]),Fd.toArray(r,i*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Bh(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const r=new bv(n,e,e,Mv,Dh);return r.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=r,this}getBoneByName(e){for(let n=0,r=this.bones.length;n<r;n++){const s=this.bones[n];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let r=0,s=e.bones.length;r<s;r++){const i=e.bones[r];let a=n[i];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),a=new Dv),this.bones.push(a),this.boneInverses.push(new xe().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,r=this.boneInverses;for(let s=0,i=n.length;s<i;s++){const a=n[s];e.bones.push(a.uuid);const o=r[s];e.boneInverses.push(o.toArray())}return e}}class ul extends ln{constructor(e,n,r,s=1){super(e,n,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Us=new xe,Bd=new xe,Eo=[],kd=new tr,ON=new xe,Fi=new _a,Bi=new bn;class DN extends _a{constructor(e,n,r){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new ul(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<r;s++)this.setMatrixAt(s,ON)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new tr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,Us),kd.copy(e.boundingBox).applyMatrix4(Us),this.boundingBox.union(kd)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new bn),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,Us),Bi.copy(e.boundingSphere).applyMatrix4(Us),this.boundingSphere.union(Bi)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const r=n.morphTargetInfluences,s=this.morphTexture.source.data.data,i=r.length+1,a=e*i+1;for(let o=0;o<r.length;o++)r[o]=s[a+o]}raycast(e,n){const r=this.matrixWorld,s=this.count;if(Fi.geometry=this.geometry,Fi.material=this.material,Fi.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Bi.copy(this.boundingSphere),Bi.applyMatrix4(r),e.ray.intersectsSphere(Bi)!==!1))for(let i=0;i<s;i++){this.getMatrixAt(i,Us),Bd.multiplyMatrices(r,Us),Fi.matrixWorld=Bd,Fi.raycast(e,Eo);for(let a=0,o=Eo.length;a<o;a++){const c=Eo[a];c.instanceId=i,c.object=this,n.push(c)}Eo.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new ul(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const r=n.morphTargetInfluences,s=r.length+1;this.morphTexture===null&&(this.morphTexture=new bv(new Float32Array(s*this.count),s,this.count,Uk,Dh));const i=this.morphTexture.source.data.data;let a=0;for(let u=0;u<r.length;u++)a+=r[u];const o=this.geometry.morphTargetsRelative?1:1-a,c=s*e;i[c]=o,i.set(r,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const tf=new B,bN=new B,LN=new er;class Gs{constructor(e=new B(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,s){return this.normal.set(e,n,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const s=tf.subVectors(r,n).cross(bN.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(tf),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/s;return i<0||i>1?null:n.copy(e.start).addScaledVector(r,i)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||LN.getNormalMatrix(e),s=this.coplanarPoint(tf).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Kr=new bn,_o=new B;class VN{constructor(e=new Gs,n=new Gs,r=new Gs,s=new Gs,i=new Gs,a=new Gs){this.planes=[e,n,r,s,i,a]}set(e,n,r,s,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(n),o[2].copy(r),o[3].copy(s),o[4].copy(i),o[5].copy(a),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=rs){const r=this.planes,s=e.elements,i=s[0],a=s[1],o=s[2],c=s[3],u=s[4],l=s[5],f=s[6],h=s[7],g=s[8],d=s[9],p=s[10],y=s[11],x=s[12],m=s[13],T=s[14],v=s[15];if(r[0].setComponents(c-i,h-u,y-g,v-x).normalize(),r[1].setComponents(c+i,h+u,y+g,v+x).normalize(),r[2].setComponents(c+a,h+l,y+d,v+m).normalize(),r[3].setComponents(c-a,h-l,y-d,v-m).normalize(),r[4].setComponents(c-o,h-f,y-p,v-T).normalize(),n===rs)r[5].setComponents(c+o,h+f,y+p,v+T).normalize();else if(n===ol)r[5].setComponents(o,f,p,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Kr.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Kr.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Kr)}intersectsSprite(e){return Kr.center.set(0,0,0),Kr.radius=.7071067811865476,Kr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Kr)}intersectsSphere(e){const n=this.planes,r=e.center,s=-e.radius;for(let i=0;i<6;i++)if(n[i].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const s=n[r];if(_o.x=s.normal.x>0?e.max.x:e.min.x,_o.y=s.normal.y>0?e.max.y:e.min.y,_o.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(_o)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Lv extends ls{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new qe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const vc=new B,mc=new B,Nd=new xe,ki=new Hc,Ro=new bn,nf=new B,Ud=new B;class kh extends ze{constructor(e=new mi,n=new Lv){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[0];for(let s=1,i=n.count;s<i;s++)vc.fromBufferAttribute(n,s-1),mc.fromBufferAttribute(n,s),r[s]=r[s-1],r[s]+=vc.distanceTo(mc);e.setAttribute("lineDistance",new Lh(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const r=this.geometry,s=this.matrixWorld,i=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Ro.copy(r.boundingSphere),Ro.applyMatrix4(s),Ro.radius+=i,e.ray.intersectsSphere(Ro)===!1)return;Nd.copy(s).invert(),ki.copy(e.ray).applyMatrix4(Nd);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),c=o*o,u=this.isLineSegments?2:1,l=r.index,h=r.attributes.position;if(l!==null){const g=Math.max(0,a.start),d=Math.min(l.count,a.start+a.count);for(let p=g,y=d-1;p<y;p+=u){const x=l.getX(p),m=l.getX(p+1),T=Oo(this,e,ki,c,x,m,p);T&&n.push(T)}if(this.isLineLoop){const p=l.getX(d-1),y=l.getX(g),x=Oo(this,e,ki,c,p,y,d-1);x&&n.push(x)}}else{const g=Math.max(0,a.start),d=Math.min(h.count,a.start+a.count);for(let p=g,y=d-1;p<y;p+=u){const x=Oo(this,e,ki,c,p,p+1,p);x&&n.push(x)}if(this.isLineLoop){const p=Oo(this,e,ki,c,d-1,g,d-1);p&&n.push(p)}}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const s=n[r[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,a=s.length;i<a;i++){const o=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}}function Oo(t,e,n,r,s,i,a){const o=t.geometry.attributes.position;if(vc.fromBufferAttribute(o,s),mc.fromBufferAttribute(o,i),n.distanceSqToSegment(vc,mc,nf,Ud)>r)return;nf.applyMatrix4(t.matrixWorld);const u=e.ray.origin.distanceTo(nf);if(!(u<e.near||u>e.far))return{distance:u,point:Ud.clone().applyMatrix4(t.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:t}}const Gd=new B,Ad=new B;class FN extends kh{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[];for(let s=0,i=n.count;s<i;s+=2)Gd.fromBufferAttribute(n,s),Ad.fromBufferAttribute(n,s+1),r[s]=s===0?0:r[s-1],r[s+1]=r[s]+Gd.distanceTo(Ad);e.setAttribute("lineDistance",new Lh(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class BN extends kh{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class Vv extends ls{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new qe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const zd=new xe,fl=new Hc,Do=new bn,bo=new B;class kN extends ze{constructor(e=new mi,n=new Vv){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,s=this.matrixWorld,i=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Do.copy(r.boundingSphere),Do.applyMatrix4(s),Do.radius+=i,e.ray.intersectsSphere(Do)===!1)return;zd.copy(s).invert(),fl.copy(e.ray).applyMatrix4(zd);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),c=o*o,u=r.index,f=r.attributes.position;if(u!==null){const h=Math.max(0,a.start),g=Math.min(u.count,a.start+a.count);for(let d=h,p=g;d<p;d++){const y=u.getX(d);bo.fromBufferAttribute(f,y),$d(bo,y,c,s,e,n,this)}}else{const h=Math.max(0,a.start),g=Math.min(f.count,a.start+a.count);for(let d=h,p=g;d<p;d++)bo.fromBufferAttribute(f,d),$d(bo,d,c,s,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const s=n[r[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,a=s.length;i<a;i++){const o=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}}function $d(t,e,n,r,s,i,a){const o=fl.distanceSqToPoint(t);if(o<n){const c=new B;fl.closestPointToPoint(t,c),c.applyMatrix4(r);const u=s.ray.origin.distanceTo(c);if(u<s.near||u>s.far)return;i.push({distance:u,distanceToRay:Math.sqrt(o),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class Nh extends ls{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new qe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zk,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ln extends Nh{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ie(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return fe(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new qe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new qe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new qe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function Lo(t,e){return!t||t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function NN(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function UN(t){function e(s,i){return t[s]-t[i]}const n=t.length,r=new Array(n);for(let s=0;s!==n;++s)r[s]=s;return r.sort(e),r}function Wd(t,e,n){const r=t.length,s=new t.constructor(r);for(let i=0,a=0;a!==r;++i){const o=n[i]*e;for(let c=0;c!==e;++c)s[a++]=t[o+c]}return s}function Fv(t,e,n,r){let s=1,i=t[0];for(;i!==void 0&&i[r]===void 0;)i=t[s++];if(i===void 0)return;let a=i[r];if(a!==void 0)if(Array.isArray(a))do a=i[r],a!==void 0&&(e.push(i.time),n.push(...a)),i=t[s++];while(i!==void 0);else if(a.toArray!==void 0)do a=i[r],a!==void 0&&(e.push(i.time),a.toArray(n,n.length)),i=t[s++];while(i!==void 0);else do a=i[r],a!==void 0&&(e.push(i.time),n.push(a)),i=t[s++];while(i!==void 0)}class Ra{constructor(e,n,r,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let r=this._cachedIndex,s=n[r],i=n[r-1];e:{t:{let a;n:{r:if(!(e<s)){for(let o=r+2;;){if(s===void 0){if(e<i)break r;return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(i=s,s=n[++r],e<s)break t}a=n.length;break n}if(!(e>=i)){const o=n[1];e<o&&(r=2,i=o);for(let c=r-2;;){if(i===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===c)break;if(s=i,i=n[--r-1],e>=i)break t}a=r,r=0;break n}break e}for(;r<a;){const o=r+a>>>1;e<n[o]?a=o:r=o+1}if(s=n[r],i=n[r-1],i===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,i,s)}return this.interpolate_(r,i,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,s=this.valueSize,i=e*s;for(let a=0;a!==s;++a)n[a]=r[i+a];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class GN extends Ra{constructor(e,n,r,s){super(e,n,r,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:sd,endingEnd:sd}}intervalChanged_(e,n,r){const s=this.parameterPositions;let i=e-2,a=e+1,o=s[i],c=s[a];if(o===void 0)switch(this.getSettings_().endingStart){case id:i=e,o=2*n-r;break;case ad:i=s.length-2,o=n+s[i]-s[i+1];break;default:i=e,o=r}if(c===void 0)switch(this.getSettings_().endingEnd){case id:a=e,c=2*r-n;break;case ad:a=1,c=r+s[1]-s[0];break;default:a=e-1,c=n}const u=(r-n)*.5,l=this.valueSize;this._weightPrev=u/(n-o),this._weightNext=u/(c-r),this._offsetPrev=i*l,this._offsetNext=a*l}interpolate_(e,n,r,s){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=e*o,u=c-o,l=this._offsetPrev,f=this._offsetNext,h=this._weightPrev,g=this._weightNext,d=(r-n)/(s-n),p=d*d,y=p*d,x=-h*y+2*h*p-h*d,m=(1+h)*y+(-1.5-2*h)*p+(-.5+h)*d+1,T=(-1-g)*y+(1.5+g)*p+.5*d,v=g*y-g*p;for(let S=0;S!==o;++S)i[S]=x*a[l+S]+m*a[u+S]+T*a[c+S]+v*a[f+S];return i}}class AN extends Ra{constructor(e,n,r,s){super(e,n,r,s)}interpolate_(e,n,r,s){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=e*o,u=c-o,l=(r-n)/(s-n),f=1-l;for(let h=0;h!==o;++h)i[h]=a[u+h]*f+a[c+h]*l;return i}}class zN extends Ra{constructor(e,n,r,s){super(e,n,r,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class pn{constructor(e,n,r,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Lo(n,this.TimeBufferType),this.values=Lo(r,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let r;if(n.toJSON!==this.toJSON)r=n.toJSON(e);else{r={name:e.name,times:Lo(e.times,Array),values:Lo(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(r.interpolation=s)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new zN(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new AN(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new GN(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case ya:n=this.InterpolantFactoryMethodDiscrete;break;case xa:n=this.InterpolantFactoryMethodLinear;break;case bu:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ya;case this.InterpolantFactoryMethodLinear:return xa;case this.InterpolantFactoryMethodSmooth:return bu}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let r=0,s=n.length;r!==s;++r)n[r]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let r=0,s=n.length;r!==s;++r)n[r]*=e}return this}trim(e,n){const r=this.times,s=r.length;let i=0,a=s-1;for(;i!==s&&r[i]<e;)++i;for(;a!==-1&&r[a]>n;)--a;if(++a,i!==0||a!==s){i>=a&&(a=Math.max(a,1),i=a-1);const o=this.getValueSize();this.times=r.slice(i,a),this.values=this.values.slice(i*o,a*o)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,s=this.values,i=r.length;i===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==i;o++){const c=r[o];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,c),e=!1;break}if(a!==null&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,c,a),e=!1;break}a=c}if(s!==void 0&&NN(s))for(let o=0,c=s.length;o!==c;++o){const u=s[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),n=this.values.slice(),r=this.getValueSize(),s=this.getInterpolation()===bu,i=e.length-1;let a=1;for(let o=1;o<i;++o){let c=!1;const u=e[o],l=e[o+1];if(u!==l&&(o!==1||u!==e[0]))if(s)c=!0;else{const f=o*r,h=f-r,g=f+r;for(let d=0;d!==r;++d){const p=n[f+d];if(p!==n[h+d]||p!==n[g+d]){c=!0;break}}}if(c){if(o!==a){e[a]=e[o];const f=o*r,h=a*r;for(let g=0;g!==r;++g)n[h+g]=n[f+g]}++a}}if(i>0){e[a]=e[i];for(let o=i*r,c=a*r,u=0;u!==r;++u)n[c+u]=n[o+u];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=n.slice(0,a*r)):(this.times=e,this.values=n),this}clone(){const e=this.times.slice(),n=this.values.slice(),r=this.constructor,s=new r(this.name,e,n);return s.createInterpolant=this.createInterpolant,s}}pn.prototype.ValueTypeName="";pn.prototype.TimeBufferType=Float32Array;pn.prototype.ValueBufferType=Float32Array;pn.prototype.DefaultInterpolation=xa;class Si extends pn{constructor(e,n,r){super(e,n,r)}}Si.prototype.ValueTypeName="bool";Si.prototype.ValueBufferType=Array;Si.prototype.DefaultInterpolation=ya;Si.prototype.InterpolantFactoryMethodLinear=void 0;Si.prototype.InterpolantFactoryMethodSmooth=void 0;class Bv extends pn{constructor(e,n,r,s){super(e,n,r,s)}}Bv.prototype.ValueTypeName="color";class ui extends pn{constructor(e,n,r,s){super(e,n,r,s)}}ui.prototype.ValueTypeName="number";class $N extends Ra{constructor(e,n,r,s){super(e,n,r,s)}interpolate_(e,n,r,s){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=(r-n)/(s-n);let u=e*o;for(let l=u+o;u!==l;u+=4)Vr.slerpFlat(i,0,a,u-o,a,u,c);return i}}class fi extends pn{constructor(e,n,r,s){super(e,n,r,s)}InterpolantFactoryMethodLinear(e){return new $N(this.times,this.values,this.getValueSize(),e)}}fi.prototype.ValueTypeName="quaternion";fi.prototype.InterpolantFactoryMethodSmooth=void 0;class wi extends pn{constructor(e,n,r){super(e,n,r)}}wi.prototype.ValueTypeName="string";wi.prototype.ValueBufferType=Array;wi.prototype.DefaultInterpolation=ya;wi.prototype.InterpolantFactoryMethodLinear=void 0;wi.prototype.InterpolantFactoryMethodSmooth=void 0;class li extends pn{constructor(e,n,r,s){super(e,n,r,s)}}li.prototype.ValueTypeName="vector";class WN{constructor(e="",n=-1,r=[],s=Gk){this.name=e,this.tracks=r,this.duration=n,this.blendMode=s,this.uuid=un(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],r=e.tracks,s=1/(e.fps||1);for(let a=0,o=r.length;a!==o;++a)n.push(IN(r[a]).scale(s));const i=new this(e.name,e.duration,n,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const n=[],r=e.tracks,s={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let i=0,a=r.length;i!==a;++i)n.push(pn.toJSON(r[i]));return s}static CreateFromMorphTargetSequence(e,n,r,s){const i=n.length,a=[];for(let o=0;o<i;o++){let c=[],u=[];c.push((o+i-1)%i,o,(o+1)%i),u.push(0,1,0);const l=UN(c);c=Wd(c,1,l),u=Wd(u,1,l),!s&&c[0]===0&&(c.push(i),u.push(u[0])),a.push(new ui(".morphTargetInfluences["+n[o].name+"]",c,u).scale(1/r))}return new this(e,-1,a)}static findByName(e,n){let r=e;if(!Array.isArray(e)){const s=e;r=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<r.length;s++)if(r[s].name===n)return r[s];return null}static CreateClipsFromMorphTargetSequences(e,n,r){const s={},i=/^([\w-]*?)([\d]+)$/;for(let o=0,c=e.length;o<c;o++){const u=e[o],l=u.name.match(i);if(l&&l.length>1){const f=l[1];let h=s[f];h||(s[f]=h=[]),h.push(u)}}const a=[];for(const o in s)a.push(this.CreateFromMorphTargetSequence(o,s[o],n,r));return a}static parseAnimation(e,n){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(f,h,g,d,p){if(g.length!==0){const y=[],x=[];Fv(g,y,x,d),y.length!==0&&p.push(new f(h,y,x))}},s=[],i=e.name||"default",a=e.fps||30,o=e.blendMode;let c=e.length||-1;const u=e.hierarchy||[];for(let f=0;f<u.length;f++){const h=u[f].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const g={};let d;for(d=0;d<h.length;d++)if(h[d].morphTargets)for(let p=0;p<h[d].morphTargets.length;p++)g[h[d].morphTargets[p]]=-1;for(const p in g){const y=[],x=[];for(let m=0;m!==h[d].morphTargets.length;++m){const T=h[d];y.push(T.time),x.push(T.morphTarget===p?1:0)}s.push(new ui(".morphTargetInfluence["+p+"]",y,x))}c=g.length*a}else{const g=".bones["+n[f].name+"]";r(li,g+".position",h,"pos",s),r(fi,g+".quaternion",h,"rot",s),r(li,g+".scale",h,"scl",s)}}return s.length===0?null:new this(i,c,s,o)}resetDuration(){const e=this.tracks;let n=0;for(let r=0,s=e.length;r!==s;++r){const i=this.tracks[r];n=Math.max(n,i.times[i.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function HN(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ui;case"vector":case"vector2":case"vector3":case"vector4":return li;case"color":return Bv;case"quaternion":return fi;case"bool":case"boolean":return Si;case"string":return wi}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function IN(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=HN(t.type);if(t.times===void 0){const n=[],r=[];Fv(t.keys,n,r,"value"),t.times=n,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Cr={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class jN{constructor(e,n,r){const s=this;let i=!1,a=0,o=0,c;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(l){o++,i===!1&&s.onStart!==void 0&&s.onStart(l,a,o),i=!0},this.itemEnd=function(l){a++,s.onProgress!==void 0&&s.onProgress(l,a,o),a===o&&(i=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(l){s.onError!==void 0&&s.onError(l)},this.resolveURL=function(l){return c?c(l):l},this.setURLModifier=function(l){return c=l,this},this.addHandler=function(l,f){return u.push(l,f),this},this.removeHandler=function(l){const f=u.indexOf(l);return f!==-1&&u.splice(f,2),this},this.getHandler=function(l){for(let f=0,h=u.length;f<h;f+=2){const g=u[f],d=u[f+1];if(g.global&&(g.lastIndex=0),g.test(l))return d}return null}}}const PN=new jN;class Ci{constructor(e){this.manager=e!==void 0?e:PN,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(s,i){r.load(e,s,n,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ci.DEFAULT_MATERIAL_NAME="__DEFAULT";const Gn={};class KN extends Error{constructor(e,n){super(e),this.response=n}}class kv extends Ci{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,n,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=Cr.get(e);if(i!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(i),this.manager.itemEnd(e)},0),i;if(Gn[e]!==void 0){Gn[e].push({onLoad:n,onProgress:r,onError:s});return}Gn[e]=[],Gn[e].push({onLoad:n,onProgress:r,onError:s});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,c=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const l=Gn[e],f=u.body.getReader(),h=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),g=h?parseInt(h):0,d=g!==0;let p=0;const y=new ReadableStream({start(x){m();function m(){f.read().then(({done:T,value:v})=>{if(T)x.close();else{p+=v.byteLength;const S=new ProgressEvent("progress",{lengthComputable:d,loaded:p,total:g});for(let w=0,M=l.length;w<M;w++){const E=l[w];E.onProgress&&E.onProgress(S)}x.enqueue(v),m()}},T=>{x.error(T)})}}});return new Response(y)}else throw new KN(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(c){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(l=>new DOMParser().parseFromString(l,o));case"json":return u.json();default:if(o==="")return u.text();{const f=/charset="?([^;"\s]*)"?/i.exec(o),h=f&&f[1]?f[1].toLowerCase():void 0,g=new TextDecoder(h);return u.arrayBuffer().then(d=>g.decode(d))}}}).then(u=>{Cr.add(e,u);const l=Gn[e];delete Gn[e];for(let f=0,h=l.length;f<h;f++){const g=l[f];g.onLoad&&g.onLoad(u)}}).catch(u=>{const l=Gn[e];if(l===void 0)throw this.manager.itemError(e),u;delete Gn[e];for(let f=0,h=l.length;f<h;f++){const g=l[f];g.onError&&g.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class XN extends Ci{constructor(e){super(e)}load(e,n,r,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Cr.get(e);if(a!==void 0)return i.manager.itemStart(e),setTimeout(function(){n&&n(a),i.manager.itemEnd(e)},0),a;const o=cl("img");function c(){l(),Cr.add(e,this),n&&n(this),i.manager.itemEnd(e)}function u(f){l(),s&&s(f),i.manager.itemError(e),i.manager.itemEnd(e)}function l(){o.removeEventListener("load",c,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",c,!1),o.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}class YN extends Ci{constructor(e){super(e)}load(e,n,r,s){const i=new fn,a=new XN(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){i.image=o,i.needsUpdate=!0,n!==void 0&&n(i)},r,s),i}}class Uh extends ze{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new qe(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(n.object.target=this.target.uuid),n}}const rf=new xe,Hd=new B,Id=new B;class Gh{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ie(512,512),this.mapType=Cv,this.map=null,this.mapPass=null,this.matrix=new xe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new VN,this._frameExtents=new Ie(1,1),this._viewportCount=1,this._viewports=[new St(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,r=this.matrix;Hd.setFromMatrixPosition(e.matrixWorld),n.position.copy(Hd),Id.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(Id),n.updateMatrixWorld(),rf.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rf),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(rf)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class qN extends Gh{constructor(){super(new Vh(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const n=this.camera,r=Ta*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,i=e.distance||n.far;(r!==n.fov||s!==n.aspect||i!==n.far)&&(n.fov=r,n.aspect=s,n.far=i,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class ZN extends Uh{constructor(e,n,r=0,s=Math.PI/3,i=0,a=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ze.DEFAULT_UP),this.updateMatrix(),this.target=new ze,this.distance=r,this.angle=s,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new qN}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const jd=new xe,Ni=new B,sf=new B;class QN extends Gh{constructor(){super(new Vh(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ie(4,2),this._viewportCount=6,this._viewports=[new St(2,1,1,1),new St(0,1,1,1),new St(3,1,1,1),new St(1,1,1,1),new St(3,0,1,1),new St(1,0,1,1)],this._cubeDirections=[new B(1,0,0),new B(-1,0,0),new B(0,0,1),new B(0,0,-1),new B(0,1,0),new B(0,-1,0)],this._cubeUps=[new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,0,1),new B(0,0,-1)]}updateMatrices(e,n=0){const r=this.camera,s=this.matrix,i=e.distance||r.far;i!==r.far&&(r.far=i,r.updateProjectionMatrix()),Ni.setFromMatrixPosition(e.matrixWorld),r.position.copy(Ni),sf.copy(r.position),sf.add(this._cubeDirections[n]),r.up.copy(this._cubeUps[n]),r.lookAt(sf),r.updateMatrixWorld(),s.makeTranslation(-Ni.x,-Ni.y,-Ni.z),jd.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(jd)}}class JN extends Uh{constructor(e,n,r=0,s=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=s,this.shadow=new QN}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Nv extends Ov{constructor(e=-1,n=1,r=1,s=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=s,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,s,i,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=s,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let i=r-e,a=r+e,o=s+n,c=s-n;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=u*this.view.offsetX,a=i+u*this.view.width,o-=l*this.view.offsetY,c=o-l*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}class eU extends Gh{constructor(){super(new Nv(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class tU extends Uh{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ze.DEFAULT_UP),this.updateMatrix(),this.target=new ze,this.shadow=new eU}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ta{static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}const af=new WeakMap;class nU extends Ci{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=Cr.get(e);if(a!==void 0){if(i.manager.itemStart(e),a.then){a.then(u=>{if(af.has(a)===!0)s&&s(af.get(a)),i.manager.itemError(e),i.manager.itemEnd(e);else return n&&n(u),i.manager.itemEnd(e),u});return}return setTimeout(function(){n&&n(a),i.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const c=fetch(e,o).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(u){return Cr.add(e,u),n&&n(u),i.manager.itemEnd(e),u}).catch(function(u){s&&s(u),af.set(c,u),Cr.remove(e),i.manager.itemError(e),i.manager.itemEnd(e)});Cr.add(e,c),i.manager.itemStart(e)}}const Ah="\\[\\]\\.:\\/",rU=new RegExp("["+Ah+"]","g"),zh="[^"+Ah+"]",sU="[^"+Ah.replace("\\.","")+"]",iU=/((?:WC+[\/:])*)/.source.replace("WC",zh),aU=/(WCOD+)?/.source.replace("WCOD",sU),oU=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zh),cU=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zh),uU=new RegExp("^"+iU+aU+oU+cU+"$"),fU=["material","materials","bones","map"];class lU{constructor(e,n,r){const s=r||Ee.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,s)}getValue(e,n){this.bind();const r=this._targetGroup.nCachedObjects_,s=this._bindings[r];s!==void 0&&s.getValue(e,n)}setValue(e,n){const r=this._bindings;for(let s=this._targetGroup.nCachedObjects_,i=r.length;s!==i;++s)r[s].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].unbind()}}class Ee{constructor(e,n,r){this.path=n,this.parsedPath=r||Ee.parseTrackName(n),this.node=Ee.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,r){return e&&e.isAnimationObjectGroup?new Ee.Composite(e,n,r):new Ee(e,n,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(rU,"")}static parseTrackName(e){const n=uU.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const i=r.nodeName.substring(s+1);fU.indexOf(i)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=i)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(n);if(r!==void 0)return r}if(e.children){const r=function(i){for(let a=0;a<i.length;a++){const o=i[a];if(o.name===n||o.uuid===n)return o;const c=r(o.children);if(c)return c}return null},s=r(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const r=this.resolvedProperty;for(let s=0,i=r.length;s!==i;++s)e[n++]=r[s]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const r=this.resolvedProperty;for(let s=0,i=r.length;s!==i;++s)r[s]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const r=this.resolvedProperty;for(let s=0,i=r.length;s!==i;++s)r[s]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const r=this.resolvedProperty;for(let s=0,i=r.length;s!==i;++s)r[s]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,r=n.objectName,s=n.propertyName;let i=n.propertyIndex;if(e||(e=Ee.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let u=n.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let l=0;l<e.length;l++)if(e[l].name===u){u=l;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(u!==void 0){if(e[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const a=e[s];if(a===void 0){const u=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+s+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(i!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[i]!==void 0&&(i=e.morphTargetDictionary[i])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ee.Composite=lU;Ee.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ee.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ee.prototype.GetterByBindingType=[Ee.prototype._getValue_direct,Ee.prototype._getValue_array,Ee.prototype._getValue_arrayElement,Ee.prototype._getValue_toArray];Ee.prototype.SetterByBindingTypeAndVersioning=[[Ee.prototype._setValue_direct,Ee.prototype._setValue_direct_setNeedsUpdate,Ee.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ee.prototype._setValue_array,Ee.prototype._setValue_array_setNeedsUpdate,Ee.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ee.prototype._setValue_arrayElement,Ee.prototype._setValue_arrayElement_setNeedsUpdate,Ee.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ee.prototype._setValue_fromArray,Ee.prototype._setValue_fromArray_setNeedsUpdate,Ee.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Sv}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Sv);function Pd(t,e){if(e===Ak)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===il||e===Ev){let n=t.getIndex();if(n===null){const a=[],o=t.getAttribute("position");if(o!==void 0){for(let c=0;c<o.count;c++)a.push(c);t.setIndex(a),n=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const r=n.count-2,s=[];if(e===il)for(let a=1;a<=r;a++)s.push(n.getX(0)),s.push(n.getX(a)),s.push(n.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(s.push(n.getX(a)),s.push(n.getX(a+1)),s.push(n.getX(a+2))):(s.push(n.getX(a+2)),s.push(n.getX(a+1)),s.push(n.getX(a)));s.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=t.clone();return i.setIndex(s),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class hU extends Ci{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new xU(n)}),this.register(function(n){return new TU(n)}),this.register(function(n){return new RU(n)}),this.register(function(n){return new OU(n)}),this.register(function(n){return new DU(n)}),this.register(function(n){return new mU(n)}),this.register(function(n){return new SU(n)}),this.register(function(n){return new wU(n)}),this.register(function(n){return new CU(n)}),this.register(function(n){return new yU(n)}),this.register(function(n){return new MU(n)}),this.register(function(n){return new vU(n)}),this.register(function(n){return new _U(n)}),this.register(function(n){return new EU(n)}),this.register(function(n){return new pU(n)}),this.register(function(n){return new bU(n)}),this.register(function(n){return new LU(n)})}load(e,n,r,s){const i=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const u=ta.extractUrlBase(e);a=ta.resolveURL(u,this.path)}else a=ta.extractUrlBase(e);this.manager.itemStart(e);const o=function(u){s?s(u):console.error(u),i.manager.itemError(e),i.manager.itemEnd(e)},c=new kv(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(u){try{i.parse(u,a,function(l){n(l),i.manager.itemEnd(e)},o)}catch(l){o(l)}},r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,s){let i;const a={},o={},c=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===Uv){try{a[le.KHR_BINARY_GLTF]=new VU(e)}catch(f){s&&s(f);return}i=JSON.parse(a[le.KHR_BINARY_GLTF].content)}else i=JSON.parse(c.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new jU(i,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const f=this.pluginCallbacks[l](u);f.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[f.name]=f,a[f.name]=!0}if(i.extensionsUsed)for(let l=0;l<i.extensionsUsed.length;++l){const f=i.extensionsUsed[l],h=i.extensionsRequired||[];switch(f){case le.KHR_MATERIALS_UNLIT:a[f]=new dU;break;case le.KHR_DRACO_MESH_COMPRESSION:a[f]=new FU(i,this.dracoLoader);break;case le.KHR_TEXTURE_TRANSFORM:a[f]=new BU;break;case le.KHR_MESH_QUANTIZATION:a[f]=new kU;break;default:h.indexOf(f)>=0&&o[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}u.setExtensions(a),u.setPlugins(o),u.parse(r,s)}parseAsync(e,n){const r=this;return new Promise(function(s,i){r.parse(e,n,s,i)})}}function gU(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const le={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class pU{constructor(e){this.parser=e,this.name=le.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let r=0,s=n.length;r<s;r++){const i=n[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let s=n.cache.get(r);if(s)return s;const i=n.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let u;const l=new qe(16777215);c.color!==void 0&&l.setRGB(c.color[0],c.color[1],c.color[2],gn);const f=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new tU(l),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new JN(l),u.distance=f;break;case"spot":u=new ZN(l),u.distance=f,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),$n(u,c),c.intensity!==void 0&&(u.intensity=c.intensity),u.name=n.createUniqueName(c.name||"light_"+e),s=Promise.resolve(u),n.cache.add(r,s),s}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,r=this.parser,i=r.json.nodes[e],o=(i.extensions&&i.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(c){return r._getNodeRef(n.cache,o,c)})}}class dU{constructor(){this.name=le.KHR_MATERIALS_UNLIT}getMaterialType(){return js}extendParams(e,n,r){const s=[];e.color=new qe(1,1,1),e.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const a=i.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],gn),e.opacity=a[3]}i.baseColorTexture!==void 0&&s.push(r.assignTexture(e,"map",i.baseColorTexture,lt))}return Promise.all(s)}}class yU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(n.emissiveIntensity=i),Promise.resolve()}}class xU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],a=s.extensions[this.name];if(a.clearcoatFactor!==void 0&&(n.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&i.push(r.assignTexture(n,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&i.push(r.assignTexture(n,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(i.push(r.assignTexture(n,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new Ie(o,o)}return Promise.all(i)}}class TU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_DISPERSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class vU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],a=s.extensions[this.name];return a.iridescenceFactor!==void 0&&(n.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&i.push(r.assignTexture(n,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(n.iridescenceIOR=a.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&i.push(r.assignTexture(n,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(i)}}class mU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];n.sheenColor=new qe(0,0,0),n.sheenRoughness=0,n.sheen=1;const a=s.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;n.sheenColor.setRGB(o[0],o[1],o[2],gn)}return a.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&i.push(r.assignTexture(n,"sheenColorMap",a.sheenColorTexture,lt)),a.sheenRoughnessTexture!==void 0&&i.push(r.assignTexture(n,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}class SU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],a=s.extensions[this.name];return a.transmissionFactor!==void 0&&(n.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&i.push(r.assignTexture(n,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class wU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],a=s.extensions[this.name];n.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&i.push(r.assignTexture(n,"thicknessMap",a.thicknessTexture)),n.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return n.attenuationColor=new qe().setRGB(o[0],o[1],o[2],gn),Promise.all(i)}}class CU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class MU{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],a=s.extensions[this.name];n.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&i.push(r.assignTexture(n,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return n.specularColor=new qe().setRGB(o[0],o[1],o[2],gn),a.specularColorTexture!==void 0&&i.push(r.assignTexture(n,"specularColorMap",a.specularColorTexture,lt)),Promise.all(i)}}class EU{constructor(e){this.parser=e,this.name=le.EXT_MATERIALS_BUMP}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],a=s.extensions[this.name];return n.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&i.push(r.assignTexture(n,"bumpMap",a.bumpTexture)),Promise.all(i)}}class _U{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Ln}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],a=s.extensions[this.name];return a.anisotropyStrength!==void 0&&(n.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(n.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&i.push(r.assignTexture(n,"anisotropyMap",a.anisotropyTexture)),Promise.all(i)}}class RU{constructor(e){this.parser=e,this.name=le.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],a=n.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,i.source,a)}}class OU{constructor(e){this.parser=e,this.name=le.EXT_TEXTURE_WEBP}loadTexture(e){const n=this.name,r=this.parser,s=r.json,i=s.textures[e];if(!i.extensions||!i.extensions[n])return null;const a=i.extensions[n],o=s.images[a.source];let c=r.textureLoader;if(o.uri){const u=r.options.manager.getHandler(o.uri);u!==null&&(c=u)}return r.loadTextureImage(e,a.source,c)}}class DU{constructor(e){this.parser=e,this.name=le.EXT_TEXTURE_AVIF}loadTexture(e){const n=this.name,r=this.parser,s=r.json,i=s.textures[e];if(!i.extensions||!i.extensions[n])return null;const a=i.extensions[n],o=s.images[a.source];let c=r.textureLoader;if(o.uri){const u=r.options.manager.getHandler(o.uri);u!==null&&(c=u)}return r.loadTextureImage(e,a.source,c)}}class bU{constructor(e){this.name=le.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,r=n.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const s=r.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(o){const c=s.byteOffset||0,u=s.byteLength||0,l=s.count,f=s.byteStride,h=new Uint8Array(o,c,u);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(l,f,h,s.mode,s.filter).then(function(g){return g.buffer}):a.ready.then(function(){const g=new ArrayBuffer(l*f);return a.decodeGltfBuffer(new Uint8Array(g),l,f,h,s.mode,s.filter),g})})}else return null}}class LU{constructor(e){this.name=le.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,r=n.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const s=n.meshes[r.mesh];for(const u of s.primitives)if(u.mode!==Nt.TRIANGLES&&u.mode!==Nt.TRIANGLE_STRIP&&u.mode!==Nt.TRIANGLE_FAN&&u.mode!==void 0)return null;const a=r.extensions[this.name].attributes,o=[],c={};for(const u in a)o.push(this.parser.getDependency("accessor",a[u]).then(l=>(c[u]=l,c[u])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(u=>{const l=u.pop(),f=l.isGroup?l.children:[l],h=u[0].count,g=[];for(const d of f){const p=new xe,y=new B,x=new Vr,m=new B(1,1,1),T=new DN(d.geometry,d.material,h);for(let v=0;v<h;v++)c.TRANSLATION&&y.fromBufferAttribute(c.TRANSLATION,v),c.ROTATION&&x.fromBufferAttribute(c.ROTATION,v),c.SCALE&&m.fromBufferAttribute(c.SCALE,v),T.setMatrixAt(v,p.compose(y,x,m));for(const v in c)if(v==="_COLOR_0"){const S=c[v];T.instanceColor=new ul(S.array,S.itemSize,S.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&d.geometry.setAttribute(v,c[v]);ze.prototype.copy.call(T,d),this.parser.assignFinalMaterial(T),g.push(T)}return l.isGroup?(l.clear(),l.add(...g),l):g[0]}))}}const Uv="glTF",Ui=12,Kd={JSON:1313821514,BIN:5130562};class VU{constructor(e){this.name=le.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,Ui),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Uv)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Ui,i=new DataView(e,Ui);let a=0;for(;a<s;){const o=i.getUint32(a,!0);a+=4;const c=i.getUint32(a,!0);if(a+=4,c===Kd.JSON){const u=new Uint8Array(e,Ui+a,o);this.content=r.decode(u)}else if(c===Kd.BIN){const u=Ui+a;this.body=e.slice(u,u+o)}a+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class FU{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=le.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const r=this.json,s=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},c={},u={};for(const l in a){const f=ll[l]||l.toLowerCase();o[f]=a[l]}for(const l in e.attributes){const f=ll[l]||l.toLowerCase();if(a[l]!==void 0){const h=r.accessors[e.attributes[l]],g=Qs[h.componentType];u[f]=g.name,c[f]=h.normalized===!0}}return n.getDependency("bufferView",i).then(function(l){return new Promise(function(f,h){s.decodeDracoFile(l,function(g){for(const d in g.attributes){const p=g.attributes[d],y=c[d];y!==void 0&&(p.normalized=y)}f(g)},o,u,gn,h)})})}}class BU{constructor(){this.name=le.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class kU{constructor(){this.name=le.KHR_MESH_QUANTIZATION}}class Gv extends Ra{constructor(e,n,r,s){super(e,n,r,s)}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,s=this.valueSize,i=e*s*3+s;for(let a=0;a!==s;a++)n[a]=r[i+a];return n}interpolate_(e,n,r,s){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=o*2,u=o*3,l=s-n,f=(r-n)/l,h=f*f,g=h*f,d=e*u,p=d-u,y=-2*g+3*h,x=g-h,m=1-y,T=x-h+f;for(let v=0;v!==o;v++){const S=a[p+v+o],w=a[p+v+c]*l,M=a[d+v+o],E=a[d+v]*l;i[v]=m*S+T*w+y*M+x*E}return i}}const NU=new Vr;class UU extends Gv{interpolate_(e,n,r,s){const i=super.interpolate_(e,n,r,s);return NU.fromArray(i).normalize().toArray(i),i}}const Nt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Qs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Xd={9728:xc,9729:Tc,9984:Bk,9985:Nk,9986:kk,9987:Oh},Yd={33071:Hi,33648:sl,10497:da},of={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ll={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},pr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},GU={CUBICSPLINE:void 0,LINEAR:xa,STEP:ya},cf={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function AU(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new Nh({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:yc})),t.DefaultMaterial}function Xr(t,e,n){for(const r in n.extensions)t[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function $n(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function zU(t,e,n){let r=!1,s=!1,i=!1;for(let u=0,l=e.length;u<l;u++){const f=e[u];if(f.POSITION!==void 0&&(r=!0),f.NORMAL!==void 0&&(s=!0),f.COLOR_0!==void 0&&(i=!0),r&&s&&i)break}if(!r&&!s&&!i)return Promise.resolve(t);const a=[],o=[],c=[];for(let u=0,l=e.length;u<l;u++){const f=e[u];if(r){const h=f.POSITION!==void 0?n.getDependency("accessor",f.POSITION):t.attributes.position;a.push(h)}if(s){const h=f.NORMAL!==void 0?n.getDependency("accessor",f.NORMAL):t.attributes.normal;o.push(h)}if(i){const h=f.COLOR_0!==void 0?n.getDependency("accessor",f.COLOR_0):t.attributes.color;c.push(h)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(c)]).then(function(u){const l=u[0],f=u[1],h=u[2];return r&&(t.morphAttributes.position=l),s&&(t.morphAttributes.normal=f),i&&(t.morphAttributes.color=h),t.morphTargetsRelative=!0,t})}function $U(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let r=0,s=n.length;r<s;r++)t.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function WU(t){let e;const n=t.extensions&&t.extensions[le.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+uf(n.attributes):e=t.indices+":"+uf(t.attributes)+":"+t.mode,t.targets!==void 0)for(let r=0,s=t.targets.length;r<s;r++)e+=":"+uf(t.targets[r]);return e}function uf(t){let e="";const n=Object.keys(t).sort();for(let r=0,s=n.length;r<s;r++)e+=n[r]+":"+t[n[r]]+";";return e}function hl(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function HU(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":t.search(/\.ktx2($|\?)/i)>0||t.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const IU=new xe;class jU{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new gU,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,s=-1,i=!1,a=-1;if(typeof navigator<"u"){const o=navigator.userAgent;r=/^((?!chrome|android).)*safari/i.test(o)===!0;const c=o.match(/Version\/(\d+)/);s=r&&c?parseInt(c[1],10):-1,i=o.indexOf("Firefox")>-1,a=i?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||r&&s<17||i&&a<98?this.textureLoader=new YN(this.options.manager):this.textureLoader=new nU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new kv(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const r=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(a){const o={scene:a[0][s.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:s.asset,parser:r,userData:{}};return Xr(i,o,s),$n(o,s),Promise.all(r._invokeAll(function(c){return c.afterRoot&&c.afterRoot(o)})).then(function(){for(const c of o.scenes)c.updateMatrixWorld();e(o)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],r=this.json.meshes||[];for(let s=0,i=n.length;s<i;s++){const a=n[s].joints;for(let o=0,c=a.length;o<c;o++)e[a[o]].isBone=!0}for(let s=0,i=e.length;s<i;s++){const a=e[s];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,r){if(e.refs[n]<=1)return r;const s=r.clone(),i=(a,o)=>{const c=this.associations.get(a);c!=null&&this.associations.set(o,c);for(const[u,l]of a.children.entries())i(l,o.children[u])};return i(r,s),s.name+="_instance_"+e.uses[n]++,s}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let r=0;r<n.length;r++){const s=e(n[r]);if(s)return s}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const r=[];for(let s=0;s<n.length;s++){const i=e(n[s]);i&&r.push(i)}return r}getDependency(e,n){const r=e+":"+n;let s=this.cache.get(r);if(!s){switch(e){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(i){return i.loadNode&&i.loadNode(n)});break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,n)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(r,s)}return s}getDependencies(e){let n=this.cache.get(e);if(!n){const r=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(i,a){return r.getDependency(e,a)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],r=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[le.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,a){r.load(ta.resolveURL(n.uri,s.path),i,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(r){const s=n.byteLength||0,i=n.byteOffset||0;return r.slice(i,i+s)})}loadAccessor(e){const n=this,r=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const a=of[s.type],o=Qs[s.componentType],c=s.normalized===!0,u=new o(s.count*a);return Promise.resolve(new ln(u,a,c))}const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(a){const o=a[0],c=of[s.type],u=Qs[s.componentType],l=u.BYTES_PER_ELEMENT,f=l*c,h=s.byteOffset||0,g=s.bufferView!==void 0?r.bufferViews[s.bufferView].byteStride:void 0,d=s.normalized===!0;let p,y;if(g&&g!==f){const x=Math.floor(h/g),m="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+x+":"+s.count;let T=n.cache.get(m);T||(p=new u(o,x*g,s.count*g/l),T=new MN(p,g/l),n.cache.add(m,T)),y=new Fh(T,c,h%g/l,d)}else o===null?p=new u(s.count*c):p=new u(o,h,s.count*c),y=new ln(p,c,d);if(s.sparse!==void 0){const x=of.SCALAR,m=Qs[s.sparse.indices.componentType],T=s.sparse.indices.byteOffset||0,v=s.sparse.values.byteOffset||0,S=new m(a[1],T,s.sparse.count*x),w=new u(a[2],v,s.sparse.count*c);o!==null&&(y=new ln(y.array.slice(),y.itemSize,y.normalized)),y.normalized=!1;for(let M=0,E=S.length;M<E;M++){const D=S[M];if(y.setX(D,w[M*c]),c>=2&&y.setY(D,w[M*c+1]),c>=3&&y.setZ(D,w[M*c+2]),c>=4&&y.setW(D,w[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}y.normalized=d}return y})}loadTexture(e){const n=this.json,r=this.options,i=n.textures[e].source,a=n.images[i];let o=this.textureLoader;if(a.uri){const c=r.manager.getHandler(a.uri);c!==null&&(o=c)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,n,r){const s=this,i=this.json,a=i.textures[e],o=i.images[n],c=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[c])return this.textureCache[c];const u=this.loadImageSource(n,r).then(function(l){l.flipY=!1,l.name=a.name||o.name||"",l.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(l.name=o.uri);const h=(i.samplers||{})[a.sampler]||{};return l.magFilter=Xd[h.magFilter]||Tc,l.minFilter=Xd[h.minFilter]||Oh,l.wrapS=Yd[h.wrapS]||da,l.wrapT=Yd[h.wrapT]||da,l.generateMipmaps=!l.isCompressedTexture&&l.minFilter!==xc&&l.minFilter!==Tc,s.associations.set(l,{textures:e}),l}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(e,n){const r=this,s=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const a=s.images[e],o=self.URL||self.webkitURL;let c=a.uri||"",u=!1;if(a.bufferView!==void 0)c=r.getDependency("bufferView",a.bufferView).then(function(f){u=!0;const h=new Blob([f],{type:a.mimeType});return c=o.createObjectURL(h),c});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(c).then(function(f){return new Promise(function(h,g){let d=h;n.isImageBitmapLoader===!0&&(d=function(p){const y=new fn(p);y.needsUpdate=!0,h(y)}),n.load(ta.resolveURL(f,i.path),d,void 0,g)})}).then(function(f){return u===!0&&o.revokeObjectURL(c),$n(f,a),f.userData.mimeType=a.mimeType||HU(a.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),f});return this.sourceCache[e]=l,l}assignTexture(e,n,r,s){const i=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(a=a.clone(),a.channel=r.texCoord),i.extensions[le.KHR_TEXTURE_TRANSFORM]){const o=r.extensions!==void 0?r.extensions[le.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const c=i.associations.get(a);a=i.extensions[le.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),i.associations.set(a,c)}}return s!==void 0&&(a.colorSpace=s),e[n]=a,a})}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const s=n.attributes.tangent===void 0,i=n.attributes.color!==void 0,a=n.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+r.uuid;let c=this.cache.get(o);c||(c=new Vv,ls.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.sizeAttenuation=!1,this.cache.add(o,c)),r=c}else if(e.isLine){const o="LineBasicMaterial:"+r.uuid;let c=this.cache.get(o);c||(c=new Lv,ls.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,this.cache.add(o,c)),r=c}if(s||i||a){let o="ClonedMaterial:"+r.uuid+":";s&&(o+="derivative-tangents:"),i&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let c=this.cache.get(o);c||(c=r.clone(),i&&(c.vertexColors=!0),a&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(o,c),this.associations.set(c,this.associations.get(r))),r=c}e.material=r}getMaterialType(){return Nh}loadMaterial(e){const n=this,r=this.json,s=this.extensions,i=r.materials[e];let a;const o={},c=i.extensions||{},u=[];if(c[le.KHR_MATERIALS_UNLIT]){const f=s[le.KHR_MATERIALS_UNLIT];a=f.getMaterialType(),u.push(f.extendParams(o,i,n))}else{const f=i.pbrMetallicRoughness||{};if(o.color=new qe(1,1,1),o.opacity=1,Array.isArray(f.baseColorFactor)){const h=f.baseColorFactor;o.color.setRGB(h[0],h[1],h[2],gn),o.opacity=h[3]}f.baseColorTexture!==void 0&&u.push(n.assignTexture(o,"map",f.baseColorTexture,lt)),o.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,o.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(u.push(n.assignTexture(o,"metalnessMap",f.metallicRoughnessTexture)),u.push(n.assignTexture(o,"roughnessMap",f.metallicRoughnessTexture))),a=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,o)})))}i.doubleSided===!0&&(o.side=Lk);const l=i.alphaMode||cf.OPAQUE;if(l===cf.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===cf.MASK&&(o.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&a!==js&&(u.push(n.assignTexture(o,"normalMap",i.normalTexture)),o.normalScale=new Ie(1,1),i.normalTexture.scale!==void 0)){const f=i.normalTexture.scale;o.normalScale.set(f,f)}if(i.occlusionTexture!==void 0&&a!==js&&(u.push(n.assignTexture(o,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&a!==js){const f=i.emissiveFactor;o.emissive=new qe().setRGB(f[0],f[1],f[2],gn)}return i.emissiveTexture!==void 0&&a!==js&&u.push(n.assignTexture(o,"emissiveMap",i.emissiveTexture,lt)),Promise.all(u).then(function(){const f=new a(o);return i.name&&(f.name=i.name),$n(f,i),n.associations.set(f,{materials:e}),i.extensions&&Xr(s,f,i),f})}createUniqueName(e){const n=Ee.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,r=this.extensions,s=this.primitiveCache;function i(o){return r[le.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,n).then(function(c){return qd(c,o,n)})}const a=[];for(let o=0,c=e.length;o<c;o++){const u=e[o],l=WU(u),f=s[l];if(f)a.push(f.promise);else{let h;u.extensions&&u.extensions[le.KHR_DRACO_MESH_COMPRESSION]?h=i(u):h=qd(new mi,u,n),s[l]={primitive:u,promise:h},a.push(h)}}return Promise.all(a)}loadMesh(e){const n=this,r=this.json,s=this.extensions,i=r.meshes[e],a=i.primitives,o=[];for(let c=0,u=a.length;c<u;c++){const l=a[c].material===void 0?AU(this.cache):this.getDependency("material",a[c].material);o.push(l)}return o.push(n.loadGeometries(a)),Promise.all(o).then(function(c){const u=c.slice(0,c.length-1),l=c[c.length-1],f=[];for(let g=0,d=l.length;g<d;g++){const p=l[g],y=a[g];let x;const m=u[g];if(y.mode===Nt.TRIANGLES||y.mode===Nt.TRIANGLE_STRIP||y.mode===Nt.TRIANGLE_FAN||y.mode===void 0)x=i.isSkinnedMesh===!0?new _N(p,m):new _a(p,m),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),y.mode===Nt.TRIANGLE_STRIP?x.geometry=Pd(x.geometry,Ev):y.mode===Nt.TRIANGLE_FAN&&(x.geometry=Pd(x.geometry,il));else if(y.mode===Nt.LINES)x=new FN(p,m);else if(y.mode===Nt.LINE_STRIP)x=new kh(p,m);else if(y.mode===Nt.LINE_LOOP)x=new BN(p,m);else if(y.mode===Nt.POINTS)x=new kN(p,m);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(x.geometry.morphAttributes).length>0&&$U(x,i),x.name=n.createUniqueName(i.name||"mesh_"+e),$n(x,i),y.extensions&&Xr(s,x,y),n.assignFinalMaterial(x),f.push(x)}for(let g=0,d=f.length;g<d;g++)n.associations.set(f[g],{meshes:e,primitives:g});if(f.length===1)return i.extensions&&Xr(s,f[0],i),f[0];const h=new Qu;i.extensions&&Xr(s,h,i),n.associations.set(h,{meshes:e});for(let g=0,d=f.length;g<d;g++)h.add(f[g]);return h})}loadCamera(e){let n;const r=this.json.cameras[e],s=r[r.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?n=new Vh(rN.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):r.type==="orthographic"&&(n=new Nv(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),$n(n,r),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],r=[];for(let s=0,i=n.joints.length;s<i;s++)r.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",n.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(s){const i=s.pop(),a=s,o=[],c=[];for(let u=0,l=a.length;u<l;u++){const f=a[u];if(f){o.push(f);const h=new xe;i!==null&&h.fromArray(i.array,u*16),c.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[u])}return new Bh(o,c)})}loadAnimation(e){const n=this.json,r=this,s=n.animations[e],i=s.name?s.name:"animation_"+e,a=[],o=[],c=[],u=[],l=[];for(let f=0,h=s.channels.length;f<h;f++){const g=s.channels[f],d=s.samplers[g.sampler],p=g.target,y=p.node,x=s.parameters!==void 0?s.parameters[d.input]:d.input,m=s.parameters!==void 0?s.parameters[d.output]:d.output;p.node!==void 0&&(a.push(this.getDependency("node",y)),o.push(this.getDependency("accessor",x)),c.push(this.getDependency("accessor",m)),u.push(d),l.push(p))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(c),Promise.all(u),Promise.all(l)]).then(function(f){const h=f[0],g=f[1],d=f[2],p=f[3],y=f[4],x=[];for(let m=0,T=h.length;m<T;m++){const v=h[m],S=g[m],w=d[m],M=p[m],E=y[m];if(v===void 0)continue;v.updateMatrix&&v.updateMatrix();const D=r._createAnimationTracks(v,S,w,M,E);if(D)for(let O=0;O<D.length;O++)x.push(D[O])}return new WN(i,void 0,x)})}createNodeMesh(e){const n=this.json,r=this,s=n.nodes[e];return s.mesh===void 0?null:r.getDependency("mesh",s.mesh).then(function(i){const a=r._getNodeRef(r.meshCache,s.mesh,i);return s.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let c=0,u=s.weights.length;c<u;c++)o.morphTargetInfluences[c]=s.weights[c]}),a})}loadNode(e){const n=this.json,r=this,s=n.nodes[e],i=r._loadNodeShallow(e),a=[],o=s.children||[];for(let u=0,l=o.length;u<l;u++)a.push(r.getDependency("node",o[u]));const c=s.skin===void 0?Promise.resolve(null):r.getDependency("skin",s.skin);return Promise.all([i,Promise.all(a),c]).then(function(u){const l=u[0],f=u[1],h=u[2];h!==null&&l.traverse(function(g){g.isSkinnedMesh&&g.bind(h,IU)});for(let g=0,d=f.length;g<d;g++)l.add(f[g]);return l})}_loadNodeShallow(e){const n=this.json,r=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=n.nodes[e],a=i.name?s.createUniqueName(i.name):"",o=[],c=s._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return c&&o.push(c),i.camera!==void 0&&o.push(s.getDependency("camera",i.camera).then(function(u){return s._getNodeRef(s.cameraCache,i.camera,u)})),s._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){o.push(u)}),this.nodeCache[e]=Promise.all(o).then(function(u){let l;if(i.isBone===!0?l=new Dv:u.length>1?l=new Qu:u.length===1?l=u[0]:l=new ze,l!==u[0])for(let f=0,h=u.length;f<h;f++)l.add(u[f]);if(i.name&&(l.userData.name=i.name,l.name=a),$n(l,i),i.extensions&&Xr(r,l,i),i.matrix!==void 0){const f=new xe;f.fromArray(i.matrix),l.applyMatrix4(f)}else i.translation!==void 0&&l.position.fromArray(i.translation),i.rotation!==void 0&&l.quaternion.fromArray(i.rotation),i.scale!==void 0&&l.scale.fromArray(i.scale);if(!s.associations.has(l))s.associations.set(l,{});else if(i.mesh!==void 0&&s.meshCache.refs[i.mesh]>1){const f=s.associations.get(l);s.associations.set(l,{...f})}return s.associations.get(l).nodes=e,l}),this.nodeCache[e]}loadScene(e){const n=this.extensions,r=this.json.scenes[e],s=this,i=new Qu;r.name&&(i.name=s.createUniqueName(r.name)),$n(i,r),r.extensions&&Xr(n,i,r);const a=r.nodes||[],o=[];for(let c=0,u=a.length;c<u;c++)o.push(s.getDependency("node",a[c]));return Promise.all(o).then(function(c){for(let l=0,f=c.length;l<f;l++)i.add(c[l]);const u=l=>{const f=new Map;for(const[h,g]of s.associations)(h instanceof ls||h instanceof fn)&&f.set(h,g);return l.traverse(h=>{const g=s.associations.get(h);g!=null&&f.set(h,g)}),f};return s.associations=u(i),i})}_createAnimationTracks(e,n,r,s,i){const a=[],o=e.name?e.name:e.uuid,c=[];pr[i.path]===pr.weights?e.traverse(function(h){h.morphTargetInfluences&&c.push(h.name?h.name:h.uuid)}):c.push(o);let u;switch(pr[i.path]){case pr.weights:u=ui;break;case pr.rotation:u=fi;break;case pr.translation:case pr.scale:u=li;break;default:switch(r.itemSize){case 1:u=ui;break;case 2:case 3:default:u=li;break}break}const l=s.interpolation!==void 0?GU[s.interpolation]:xa,f=this._getArrayFromAccessor(r);for(let h=0,g=c.length;h<g;h++){const d=new u(c[h]+"."+pr[i.path],n.array,f,l);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(d),a.push(d)}return a}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const r=hl(n.constructor),s=new Float32Array(n.length);for(let i=0,a=n.length;i<a;i++)s[i]=n[i]*r;n=s}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(r){const s=this instanceof fi?UU:Gv;return new s(this.times,this.values,this.getValueSize()/3,r)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function PU(t,e,n){const r=e.attributes,s=new tr;if(r.POSITION!==void 0){const o=n.json.accessors[r.POSITION],c=o.min,u=o.max;if(c!==void 0&&u!==void 0){if(s.set(new B(c[0],c[1],c[2]),new B(u[0],u[1],u[2])),o.normalized){const l=hl(Qs[o.componentType]);s.min.multiplyScalar(l),s.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const o=new B,c=new B;for(let u=0,l=i.length;u<l;u++){const f=i[u];if(f.POSITION!==void 0){const h=n.json.accessors[f.POSITION],g=h.min,d=h.max;if(g!==void 0&&d!==void 0){if(c.setX(Math.max(Math.abs(g[0]),Math.abs(d[0]))),c.setY(Math.max(Math.abs(g[1]),Math.abs(d[1]))),c.setZ(Math.max(Math.abs(g[2]),Math.abs(d[2]))),h.normalized){const p=hl(Qs[h.componentType]);c.multiplyScalar(p)}o.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}t.boundingBox=s;const a=new bn;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=a}function qd(t,e,n){const r=e.attributes,s=[];function i(a,o){return n.getDependency("accessor",a).then(function(c){t.setAttribute(o,c)})}for(const a in r){const o=ll[a]||a.toLowerCase();o in t.attributes||s.push(i(r[a],o))}if(e.indices!==void 0&&!t.index){const a=n.getDependency("accessor",e.indices).then(function(o){t.setIndex(o)});s.push(a)}return bt.workingColorSpace!==gn&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${bt.workingColorSpace}" not supported.`),$n(t,e),PU(t,e,n),Promise.all(s).then(function(){return e.targets!==void 0?zU(t,e.targets,n):t})}class KU{constructor(){Fr(this,"_polyData",null);Fr(this,"_storage_id",null)}getOutputPort(){return this._polyData}get StorageId(){return this._storage_id}set StorageId(e){console.log("Setting GLB StorageId:",e),this._storage_id=e}async loadFromUrl(e){try{console.log("Loading GLB:",e);const n=await this.loadGLB(e);this._polyData=this.convertToVtkPolyData(n),console.log("GLB loaded, points:",this._polyData.getPoints().getNumberOfPoints(),"polys:",this._polyData.getPolys().getNumberOfCells())}catch(n){throw console.error(`Failed to load GLB from ${e}:`,n),n}}async loadGLB(e){return new Promise((n,r)=>{new hU().load(e,i=>n(i),void 0,i=>r(i))})}convertToVtkPolyData(e){const n=hn.newInstance();let r=new Float32Array(0),s=new Uint32Array(0);return e.scene.traverse(i=>{if(i instanceof _a){const a=i.geometry;if(a.attributes.position){const o=a.attributes.position.array,c=a.index?a.index.array:null;console.log(`Processing mesh: ${i.name||"unnamed"}`),console.log(`Points: ${o.length/3}, Indices: ${c?c.length/3:"none"}`);const u=new Float32Array(r.length+o.length);if(u.set(r),u.set(o,r.length),r=u,c){const l=new Uint32Array(s.length+c.length+c.length/3);let f=s.length;for(let h=0;h<c.length;h+=3)l[f++]=3,l[f++]=c[h]+(r.length/3-o.length/3),l[f++]=c[h+1]+(r.length/3-o.length/3),l[f++]=c[h+2]+(r.length/3-o.length/3);s=l}else{const l=o.length/3;if(l%3===0){const f=new Uint32Array(s.length+l+l/3);let h=s.length;const g=r.length/3-l;for(let d=0;d<l;d+=3)f[h++]=3,f[h++]=g+d,f[h++]=g+d+1,f[h++]=g+d+2;s=f}else console.warn(`Mesh ${i.name||"unnamed"} has non-triangular geometry, skipping.`)}}else console.warn(`Mesh ${i.name||"unnamed"} has no position attribute.`)}}),console.log(`Final PolyData: ${r.length/3} points, ${s.length/4} triangles`),(r.length===0||s.length===0)&&console.error("PolyData is empty: no points or cells generated."),n.getPoints().setData(r,3),n.getPolys().setData(s),n}}const XU={id:"app"},Zd=Oc({__name:"GlComponent",props:{storage_id:{type:String,default:null}},emits:["created"],setup(t,{expose:e,emit:n}){async function r(f){if(f.toLowerCase()==="stl")return new Dk;if(f.toLowerCase()==="obj")return new xk;if(f.toLowerCase()==="glb"||f.toLowerCase()==="gltf")return new KU;throw new Error(`Unknown extension ${f}`)}async function s(f){Cf().setVtk(f)}function i(){const f=Cf(),{mgr:h}=Ew(f);return h.value}e({createVtkManager:r,setVtkManager:s,getVtkManager:i});const a=qB(),o=document.createElement("div");o.setAttribute("id","app");const c=W0();let u=Array.from(document.getElementsByTagName(dc));if(u.length===0){const f=document.getElementsByTagName("ppt-editor")[0];u=Array.from(f.shadowRoot.querySelectorAll(dc))}return u.find(f=>f._instance===c).shadowRoot.appendChild(o),bl(()=>{_w().setRoot(o),a.mount(o),n("created")}),(f,h)=>(Bl(),A0("div",XU))}});{const t=Object.assign({"./App.vue":()=>Ic(()=>Promise.resolve().then(()=>YB),void 0),"./GlComponent.vue":()=>Ic(()=>import("./GlComponent.js"),[]),"./components/vtk_viewer.vue":()=>Ic(()=>Promise.resolve().then(()=>PB),void 0)}),e=[];for(const n in t){const r=t[n]();e.push(r)}Promise.all(e).then(n=>{let r=n.map(s=>s.default.styles);r=r.filter(s=>s!==void 0),Zd.styles=[...r,Hv],customElements.get(dc)||(customElements.define(dc,pw(Zd)),window.parent.postMessage({type:"registered"},"*"))})}export{Zd as _};
